define(["libs","c","cUtility"],function(e,t,n){function o(e){var t={btn:'<i style="position:fixed;bottom:300px;color:green;z-index:9999;">CL</i>',div:'<div style="position:fixed;bottom:290px;z-index:10000;display:none;"><button class="J_clearStorage btn_blue"> Clear</button><div class="J_debugLogSwitch"></div></div>',conBox:'<div class="J_logContent" style="position: fixed;bottom:100px;z-index: 10001;height:180px;width: 100%;display: none;"><i>****</i><textarea style="width: 100%;height: 100%;"></textarea></div>'};this.opt=$.extend(t,e),this.init()}var r=$("#main"),i=$("body"),s="IS_TUAN_DEBUG";return o.prototype={init:function(){this._isDevEnv()&&(window._log=function(e){var t=this.consoleBox.find("textarea");t.html(t.html()?t.html()+"\n"+JSON.stringify(e):JSON.stringify(e))}.bind(this)),this.renderHtml(),this.showMask(),this.renderConsoleBox(),this._bindEvents(),this.clearAds()},_isDevEnv:function(){var e=!1,t;if(n.isInApp()){t=n.isPreProduction();if(t==="0"||t==="1"||t==="2")e=!0}else location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(e=!0);return e},_bindEvents:function(){var e=this;this.btn&&this.btn.on("click",function(){e.renderHtml(),e.showMask()}),r.on("click",".J_clearStorage",function(){e.clearLocal(),e.showToast("Clear",1,function(){e.reset()})}),i.on("click",".J_logContent i",function(){e.consoleBox.hide(),localStorage.setItem(s,!1)})},showToast:function(e,n,r){!this.toast&&(this.toast=new t.ui.Toast),this.toast.show(e,n||1,r)},showMask:function(e){var n=this;!this.mask&&(this.mask=new t.ui.Mask({onCreate:function(){this.root.on("click",function(){n.reset()})}})),this.mask.show()},hideMask:function(){this.mask&&this.mask.hide()},renderHtml:function(){var e=this;this.div||(this.div=$(this.opt.div).appendTo(r),this.switch=new t.ui.cuiSwitch({rootBox:$(".J_debugLogSwitch"),checked:this.getStatusLocal()?!0:!1,changed:function(){localStorage.setItem(s,this.getStatus()),e.switchConsoleBox(this.getStatus())}})),this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.div.show()},clearLocal:function(){var e=localStorage.getItem(s);localStorage&&localStorage.clear(),localStorage.setItem(s,e)},clearAds:function(){var e=setInterval(function(){var t=$(".dl_panel-bg .dl_btn-close");t&&t.length&&(t.trigger("click"),clearInterval(e))},100)},renderConsoleBox:function(){this.consoleBox=$(this.opt.conBox).appendTo(i),this.consoleBox[this.getStatusLocal()?"show":"hide"]()},switchConsoleBox:function(e){this.consoleBox[e?"show":"hide"](),this.reset()},reset:function(){this.hideMask(),this.div&&this.div.hide()},getStatusLocal:function(){var e=localStorage.getItem(s);return!e||e=="false"?!1:!0},show:function(){this.switch&&this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.showMask(),this.div.show()}},o});