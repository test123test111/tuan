define(["cBase","cUICore","cWidgetFactory","libs"],function(e,t,n){function l(e){return e===Object(e)}var r="TabSlide",i=function(){},s=null,o=/\-?[0-9]+\.?[0-9]*/g,u,a=function(){var e=$.browser,t="";return t=e.webkit?"-webkit-":e.firefox?"-moz-":e.ie?"-ms-":"",t}(),f=a.replace(/\-/g,"");if(n.hasWidget(r))return;u=new e.Class({__propertys__:function(){this.options={container:s,currentIndex:0,direction:u.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:s,tpl:'<div class="sw_clip"><%var num =Math.ceil(data.length / 6);%><%for(var i = 1; i <= num ; i++){%><ul class="sw_con" js_index="<%=i%>"  ><%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%><li data-json=<%=JSON.stringify(data[index])%>><%=data[index].word%></li><%}%></ul><%}%></div><%if(num > 1){%><p class="sw_nav"><%for(var ni=1; ni<= num; ni++){%><i js_index="<%=ni%>" class="<%if(ni==1){%>current<%}%>"></i><%}%></p><%}%>',itemCls:".sw_con",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:i,onSwitchEnd:i,onInit:i}},initialize:function(e){var t;l(e)&&(this.options=$.extend(this.options,e)),t=this.options,this.container=t.container,this.tpl=t.tpl;if(this.container&&this.container.length){this.render(t.source,t.currentIndex);var n=this;window.addEventListener("resize",$.proxy(n._resize,n)),this._isInteractive()&&this._bindEvents()}else console.error("no container!")},_isInteractive:function(){var e=this.options;return e.source.length/6>1},_createLayout:function(){var e=this.source;this.container.html(_.template(this.tpl)({data:e}))},_bindEvents:function(){var e=this._runtime,t=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),t.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),t.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),t.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),e.root.on(f+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var e=this._runtime,t=this.container;t.off("touchmove",this.__moveHandler),t.on("touchstart",this.__touchStartHandler),t.on("touchend",this.__touchEndHandler),e.root.off(f+"TransitionEnd",this.__transitionEndHandler)},destroy:function(){var e=this;e.container.innerHTML="",window.removeEventListener("resize",e._resize)},_current:0,count:function(){return Math.ceil(this.source.length/6)},render:function(e,t){var n=this.options;return this.source=e,this._createLayout(e),this.items=this.container.find(n.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,t),this},current:function(){return this._current},next:function(e){this.goto(this._current+this.options.pageSize,u.LEFT,e)},prev:function(){this.goto(this._current-this.options.pageSize,u.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(e,t,n){var r=this,i=this._runtime,s=this.options,o=s.direction,a=i.count,f=i.width;e>=0&&e<a&&(u.animate(i.root,o*f*this._current,o*f*e,this.options.animationDuration),this._current=e,_.each(this.container.find(".sw_nav>i"),function(t){$(t).attr("js_index")==e?$(t).addClass("current"):$(t).removeClass("current")}))},_resize:function(){this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,this._current)},_showCurrent:function(e,t){var n=this._runtime;u.translate(n.root,this.options.direction*n.width*t,0),this._current=t},_getSwipeDirection:function(e,t){var n=t-e,r=Math.abs(n),i;return r>0&&r>this.options.minSwipe&&(i=n/r),i},_getRuntimeEnv:function(){var e=this.items,t=this.options,n=$(e[0]),r=n.parent(),i=r.parent(),s=i.offset(),o=this.count();return{width:t.width||s.width,root:r,stage:i,count:o}},__touchStartHandler:function(e){var t=e.touches[0],n=this._getRuntimeEnv().root,r=n.css(a+"transform").match(o);r=r&&r[0]||0,this.__lastTouchStartPos={left:Number(r),x:t.pageX,y:t.pageY,t:+(new Date)}},__touchEndHandler:function(e){var t=this.__lastTouchStartPos,n=this._getSwipeDirection(t.x,e.changedTouches[0].pageX);this[n===u.LEFT?"next":n===u.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(e){var t=this._current,n=this},__moveHandler:function(e){e.preventDefault();if(e.touches.length>1||e.scale&&e.scale!==1)return;var t=e.touches[0],n=this._getRuntimeEnv(),r=n.root,i=this.__lastTouchStartPos,s=i.left+t.pageX-i.x}}),u.LEFT=-1,u.RIGHT=1,u.translate=function(e,t,n){var r=e[0],i=r&&r.style;if(!i)return;e.css(a+"transform","translate3d("+t+"px, 0, 0)")},u.animate=function(e,t,n,r){this.translate(e,n,r)},n.register({name:r,fn:u})});