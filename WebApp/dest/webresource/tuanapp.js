define(["PageHistory"],function(e){var t="/webapp/",n=/^ctrip:\/\//i,r=/(.*)\/webapp\/(\w+)\/(.*)/,i=/^#\w/i,s="TUAN_HISTORY_KEY",o=Lizard.appBaseUrl.toLowerCase(),u=window.GROUP_DEBUG_MODE||!0,a={init:function(){this.saveUnion()},networkMonitor:function(){var e=this;window.addEventListener("online",function(){}),window.addEventListener("offline",function(){})},showLoading:function(){this.loading.show()},hideLoading:function(){this.loading.hide()},isInternalPage:function(e){return e.toLowerCase().indexOf("/tuan/")>-1},back:function(e){var t=this.lastUrl();t?(this.app.history.pop(),this.isInternalPage(t)?location.hash=t.split("#")[1]||"home":location.replace(t)):(e?(e.indexOf("#")==-1&&(e="#"+e),this.app.curView.jump(e)):window.history.go(-1),this.app.history=[])},lastUrl:function(){var e=this.app.history,t=e.length,n=t&&e[t-2]||"";return n},parsePageURL:function(e){if(!e)return!1;var t={module:"",link:e,isNative:!1,isInternal:!1,domain:document.domain},s;return e.match(i)?(t.module="tuan",t.isInternal=!0,t):e.match(n)?(t.domain="ctrip",t.isNative=!0,t):(s=r.exec(e),s&&(t.module=s[2],t.link=s[3],t.isInternal=!0),t)},gotoExternalPage:function(e,t){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(n,r){var i=r.create("Guider");n.isInApp()?i.cross({path:e,param:t}):location.href=location.protocol+"//"+location.host+"/webapp/"+e+"/"+t})},jumpToPage:function(e,t){if(!e)return;var n=this,r=n.parsePageURL(e);require(["cUtility","cWidgetFactory","cWidgetGuider"],function(n,i){var s=i.create("Guider"),o=n.isInApp();if(!o){location.href=e;return}if(r.isInternal){r.module=="tuan"?t.forwardJump(r.link.split("/")[0],"/webapp/tuan/"+r.link):s.cross({path:r.module,param:r.link});return}s.jump({targetModel:r.isNative?"app":"h5",url:r.link,title:document.title})})},getQuery:function(e){return Lizard.P(e)},saveUnion:function(e){require(["CommonStore"],function(t){var n=t.UnionStore&&t.UnionStore.getInstance(),r=a.getQuery("PartnerID"),i=a.getQuery("Source"),s=a.getQuery("AllianceID"),o=a.getQuery("SID"),u=a.getQuery("OUID"),f=n.get();!i&&!s?e==1&&document.referrer!=""&&document.referrer.indexOf("/html5")>0&&f&&f.targetTuan==1&&n.remove():(!f||f.AllianceID!=s||f.SID!=o||f.OUID!=u||f.Source!=i||f.PartnerID!=r)&&n.set({AllianceID:s,SID:o,OUID:u,Source:i,PartnerID:r,targetTuan:!0})})},initVoiceSearch:function(e){require(["cWidgetFactory","VoiceSearch"],function(t){var n=t.create("VoiceSearch");new n(e)})},environment:0,tGoTo:function(t,n,r,i,s){n=n||{};var u=o+t;r?(u=e.forward(t,u,1,i),this.jump(u)):(u=e.forward(t,u,2,i),n.viewName=t,s&&(n.cache=!0),Lizard.goTo(u,n))},tBack:function(t,n,r){var i=e.back(t,n);console.log(i),r===undefined&&(r=!0),i.jump?location.href=i.fullurl:Lizard.goTo(i.fullurl,{viewName:i.id,cache:r})},tHome:function(){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(e,t){var n=t.create("Guider"),r=e.isInApp();r?n.home():location.href=location.protocol+"//"+location.host+"/html5"})}};return require(["libs","cUtility","cWidgetFactory","cHybridFacade","cWidgetGuider"],function(e,t,n,r){var i=n.create("Guider");a.init(),t.isInApp()&&(_.isFunction(i.app_check_network_status)&&i.app_check_network_status({callback:function(e){a.environment=e.networkType==="WIFI"?0:1}}),i.register({tagname:r.METHOD_APP_NETWORK_DID_CHANGED,callback:function(e){a.environment=e.networkType==="WIFI"?0:1}}))}),window.noPic=function(e){e&&(e.src="http://pic.c-ctrip.com/common/pic_alpha.gif",e.onerror=null)},a});