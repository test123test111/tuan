define(["libs","c","cWidgetFactory","cWidgetGuider","cUtility"],function(e,t,n,r,i){function u(e){var t=function(){},n={tpl:'<%_.each(data, function(t) {%> <div class="base_btn02 J_phoneItem" data-phone="<%=t %>"><a href="tel:<%=t %>" style="display: inline-block;width: 100%;"><%=t %></a></div> <%});%><div class="base_btn02 J_cancelPhone">取消</div>',wrap:'<div class="wrapBottom J_phoneListPanel" style="z-index: 9999"></div>',ele:".J_phone",onSelect:t,onHide:t,onShow:t,dataName:"data-phone",view:""};this.opt=$.extend(n,e),this.view=this.opt.view,this.ele=$(this.opt.ele),this.dataName=this.opt.dataName,this.bindEvents()}var s=n.create("Guider"),o=i.isInApp();return u.prototype={_initMask:function(){var e=this;!this.mask&&(this.mask=new t.ui.Mask({onCreate:function(){this.root.on("click",function(){e.hidePanel(),e.hideMask()})}})),this.showMask()},showMask:function(){this.mask&&this.mask.show(),this.opt.onShow&&this.opt.onShow.apply(this)},hideMask:function(){this.mask&&this.mask.hide(),this.opt.onHide&&this.opt.onHide.apply(this)},bindEvents:function(){this.ele.on("click",this._clickHandler.bind(this))},_clickHandler:function(e){o&&e.preventDefault();var t=$(e.currentTarget).attr(this.dataName);t&&(t=t.split(",")),t&&t.length&&(t.length===1?this.makePhoneCall(t[0]):(this._initMask(),this._initPanel(),this._updatePhoneList(t)))},_phoneItemHandler:function(e){o&&e.preventDefault(),this.hideMask(),this.hidePanel();var t=$(e.currentTarget).attr("data-phone");t&&this.makePhoneCall(t),this.opt.onSelect&&this.opt.onSelect.apply(this)},_initPanel:function(){this.phonePanel=this.view.$el.find(".J_phoneListPanel");if(!this.phonePanel||this.phonePanel&&this.phonePanel.length===0)this.view.$el.append(this.opt.wrap),this.phonePanel=this.view.$el.find(".J_phoneListPanel"),this.phonePanel.on("click",".J_phoneItem",this._phoneItemHandler.bind(this)),this.phonePanel.on("click",".J_cancelPhone",function(){this.hideMask(),this.hidePanel()}.bind(this))},hidePanel:function(){this.phonePanel&&this.phonePanel.hide()},_updatePhoneList:function(e){this.phonePanel.html(_.template(this.opt.tpl,{data:e})),this.phonePanel.show()},makePhoneCall:function(e){s.apply({hybridCallback:function(){return s.callPhone({tel:e}),!1},callback:function(){return!0}})},updateDom:function(e){this.ele=$(e),this.bindEvents()}},u});