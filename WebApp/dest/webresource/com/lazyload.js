define(["libs"],function(){function e(e){var t=function(){},n={attr:"data-lazy",wrap:window,container:window,event:["scroll","resize"],time:100,threshold:180,vertical:!0,stateAttr:"data-load-state",onComplete:t,animateCls:"fade-in"};this.options=$.extend(n,e),this.container=$(this.options.container),this.wrap=$(this.options.wrap),this.eles=this.options.wrap===window?$("img"):$("img",this.wrap),this.bindEvents()}return e.prototype={constructor:e,bindEvents:function(){for(var e in this.options.event)this.container.on(this.options.event[e],function(e){this.TimerFun&&clearTimeout(this.TimerFun),this.TimerFun=setTimeout(function(){this.triggerEvent(e)}.bind(this),this.options.time)}.bind(this))},triggerEvent:function(e){var t=0,n,r,i=this.options;for(;t<this.eles.length;t++){n=$(this.eles[t]),r=n.attr(i.attr);if(!r||n[0].src.trim()===r.trim())continue;this.isReady(n)&&this._loadImage(r,function(e){return function(){e[0].src=e.attr(i.attr),e.addClass(i.animateCls),e.attr(i.stateAttr,"true")}}(n))}i.onComplete.call(this,e)},_loadImage:function(e,t){var n=new Image;n.src=e;if(n.complete){t.call(n);return}n.onload=function(){n.onload=null,t.call(n)}},isReady:function(e){var t=this.options.vertical?"scrollTop":"scrollLeft",n=this.options.vertical?"top":"left",r=e.offset()[n],i=this.options.vertical?this.container.height():this.container.width(),s=this.container[t]();return r>=s&&r<=i+s+this.options.threshold},updateDom:function(){this.eles=this.options.wrap===window?$("img").not("["+this.options.stateAttr+' = "true"]'):$("img",this.wrap).not("["+this.options.stateAttr+'="true"]'),this.container.trigger(this.options.event[0])},unbindEvents:function(){for(var e in this.options.event)this.container.off(this.options.event[e])}},e});