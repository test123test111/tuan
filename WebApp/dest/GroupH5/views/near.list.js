define(["TuanApp","TuanBaseView","cCommonPageFactory","LazyLoad","TuanStore","TuanModel","text!DetailNearTpl","StringsData","Helper"],function(t,e,a,i,n,r,d,o){var s,c=r.TuanNearListModel.getInstance(),h=n.GroupSearchStore.getInstance(),u="周边团购",L=a.create("TuanBaseView");return s=L.extend({pageid:"214008",hpageid:"215008",setHeader:function(t){var e=this;this.header.set({title:t||u,back:!0,view:this,events:{returnHandler:function(){e.back()}}}),this.header.show()},events:{"click li[data-id]":"detailHandler"},onCreate:function(){this.itemRenderFn=_.template(d)},onLoad:function(){var t=Lizard.P("pid"),e=Lizard.P("title");this.category=Lizard.P("category"),t||this.back(),this.setHeader(e||"周边"+o.groupType[this.category||1].name+"团购"),this.getNearList(t)},onHide:function(){this.hideWarning404(),this.LazyLoad&&this.LazyLoad.unbindEvents()},onShow:function(){this.LazyLoad=new i({wrap:this.$el,animate:"opacity-fade-in"})},getNearList:function(e){var a={id:e,environment:t.environment},i=Lizard.P("category");i&&(a.category=i),c.setParam(a),c.excute(function(t){t.showTags=!1,this.renderList(t)},function(){var t=this;t.showWarning404(function(){t.onLoad()})},!1,this)},renderList:function(t){t.ctype=h.getAttr("ctype");var e=this.itemRenderFn({data:t});this.$el.html($.trim(e)),this.LazyLoad&&this.LazyLoad.updateDom()},detailHandler:function(t){var e=$(t.currentTarget).attr("data-id"),a=Lizard.P("cityid");this.forwardJump("detail","/webapp/tuan/detail/"+e+".html"+(a?"?cityid="+a:""))}})});