define(["TuanApp","libs","TuanBaseView","cCommonPageFactory","cUtility","TuanModel","TuanStore","cHolidayPriceCalendar"],function(e,t,n,a,i,r,o,c){var d,s=r.TicketBookingModel.getInstance(),u=o.TuanDetailsStore.getInstance(),l=a.create("TuanBaseView");return d=l.extend({events:{},onLoad:function(){},onShow:function(){var e=this;this.header.set({title:"选择日历",view:this,back:!0,events:{returnHandler:function(){e.back()}}});var t=u.getAttr("ckintime"),n="cui_cld_daycrt";this.showLoading(),s.setParam({pid:e.pid,daterange:{sdate:"",edate:""}}),s.excute(function(a){e.hideLoading();var r=a.plist[0].PDList;_.each(r,function(t){t.dateStr=t.date,t.date=new Date(e._convertTimeString(t.date)),t.price=parseInt(t.price,10)}),e.calendar=new c({monthsNum:2,voidInvalid:!0,priceDate:r,header:!1,onShow:function(){i.isInApp()&&this.$el.find(".cui_cldweek").css("top","0px"),t&&this.$el.find('[data-date="'+t+'"]').addClass(n)},onHide:function(){e.show(),this.remove()},callback:function(t,a,i){var o=e._formatCalendarDate(t)+(a.holiday||a.days);this.$el.find("."+n).removeClass(n),i.addClass(n),u.setAttr("ckintimetxt",o),e._storeDailyPrice(r,a.value),e.forwardJump("booking","/webapp/tuan/booking")}}),e.$el.append(e.calendar.$el),e.calendar.show()},function(){e.hideLoading()})},onHide:function(){},onCreate:function(){},_storeDailyPrice:function(e,t){var n;_.each(e,function(e){return e.dateStr==t?(n=e.price,!1):void 0}),u.setAttr("ckintime",t),u.setAttr("ticketPrice",n||0)},_formatCalendarDate:function(e){return"string"==typeof e&&(e=new Date(this._convertTimeString(e))),e.getMonth()+1+"月"+e.getDate()+"日 "},_convertTimeString:function(e){return e&&e.replace(/-/g,"/")}})});