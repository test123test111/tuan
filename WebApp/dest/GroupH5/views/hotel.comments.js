define(["TuanApp","libs","c","TuanStore","TuanBaseView","cCommonPageFactory","TuanModel","text!HotelCommentsTpl"],function(e,t,n,r,i,s,o,u){var a={pageTitle:"酒店点评"},f=n.base,l=r.TuanDetailsStore.getInstance(),c=r.TuanHotelCommentListStore.getInstance(),h=o.TuanHotelCommentListModel.getInstance(),p=s.create("TuanBaseView"),d=p.extend({pageid:"214012",hpageid:"215012",pageSize:25,events:{},onCreate:function(){var e=this.$el;e.html($.trim(u)),this.totalWrap=e.find("#J_commTotal"),this.listWrap=e.find("#J_commList"),this.totalTpl=_.template(e.find("#J_commTotalTpl").html()),this.listTpl=_.template(e.find("#J_commListTpl").html()),this.onWindowScroll=$.proxy(this._onWindowScroll,this),this.showLoading(),l&&l.get()!=null?(this.productId=l.get().id,this.hotelId=l.get().hotels[0].id,this.showComments()):this.backAction(),this.totalWrap.empty(),this.listWrap.empty()},setHeader:function(){var e=this;this.header.set({title:a.pageTitle,back:!0,home:!0,view:this,tel:4000086666,events:{returnHandler:function(){e.backAction()},homeHandler:function(){e.backHome()}}}),this.header.show()},showComments:function(){this.pageIdx=1,this.getCommentListData(this.pageIdx)},rederList:function(e){e.dateFormat=f.Date.format,e.cDate=f.Date,this.totalPages=Math.ceil(e.count/this.pageSize),pageNum=isNaN(this.pageIdx)?1:this.pageIdx,pageNum<=1&&this.totalWrap.html(this.totalTpl(e)),this.listWrap.append(this.listTpl(e)),this.pageIdx==1&&$(window).bind("scroll",this.onWindowScroll)},getCommentListData:function(e){h.setParam({hotelId:this.hotelId,pageIdx:e}),h.param.head=h.getHead().get(),h.excute(function(e){this.hideLoading(),this.isLoading=!1;if(!e){this.showMessage("抱歉，数据加载失败，请重试!");return}this.rederList(e)},function(e){this.isLoading=!1;var t=e.msg?e.msg:"啊哦,数据加载出错了!",n=this;this.showHeadWarning("酒店评论信息",t,function(){n.backAction()}),this.hideLoading()},!0,this)},_onWindowScroll:function(){var e=n.ui.Tools.getPageScrollPos(),t=isNaN(this.pageIdx)?1:this.pageIdx;if(!(this.pageIdx<this.totalPages&&this.totalPages>1)){this.isComplete=!0,$(window).unbind("scroll",this.onWindowScroll);return}this.isComplete=!1;var r=e.pageHeight-(e.top+e.height);if(r<=300&&!this.isComplete&&!this.isLoading){this.isLoading=!0;if(this.pageIdx>this.totalPages){this.isComplete=!0;return}this.pageIdx=++t,this.getCommentListData(this.pageIdx)}},onShow:function(){this.setHeader()},onHide:function(){$(window).unbind("scroll",this.onWindowScroll)},backAction:function(){this.back()},backHome:function(t){e.tHome()}});return d});