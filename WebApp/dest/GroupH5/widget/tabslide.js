define(["cBase","cUICore","cWidgetFactory","libs"],function(t,i,n){function e(t){return t===Object(t)}var r,s="TabSlide",o=function(){},a=null,h=/\-?[0-9]+\.?[0-9]*/g,u=function(){var t=$.browser,i="";return i=t.webkit?"-webkit-":t.firefox?"-moz-":t.ie?"-ms-":""}(),c=u.replace(/\-/g,"");n.hasWidget(s)||(r=new t.Class({__propertys__:function(){this.options={container:a,currentIndex:0,direction:r.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:a,tpl:'<div class="sw_clip"><%var num =Math.ceil(data.length / 6);%><%for(var i = 1; i <= num ; i++){%><ul class="sw_con" js_index="<%=i%>"  ><%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%><li data-json=<%=JSON.stringify(data[index])%>><%=data[index].word%></li><%}%></ul><%}%></div><%if(num > 1){%><p class="sw_nav"><%for(var ni=1; ni<= num; ni++){%><i js_index="<%=ni%>" class="<%if(ni==1){%>current<%}%>"></i><%}%></p><%}%>',itemCls:".sw_con",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:o,onSwitchEnd:o,onInit:o}},initialize:function(t){var i;if(e(t)&&(this.options=$.extend(this.options,t)),i=this.options,this.container=i.container,this.tpl=i.tpl,this.container&&this.container.length){this.render(i.source,i.currentIndex);var n=this;window.addEventListener("resize",$.proxy(n._resize,n)),this._isInteractive()&&this._bindEvents()}},_isInteractive:function(){var t=this.options;return t.source.length/6>1},_createLayout:function(){var t=this.source;this.container.html(_.template(this.tpl)({data:t}))},_bindEvents:function(){var t=this._runtime,i=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),i.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),i.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),i.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),t.root.on(c+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var t=this._runtime,i=this.container;i.off("touchmove",this.__moveHandler),i.on("touchstart",this.__touchStartHandler),i.on("touchend",this.__touchEndHandler),t.root.off(c+"TransitionEnd",this.__transitionEndHandler)},destroy:function(){var t=this;t.container.innerHTML="",window.removeEventListener("resize",t._resize)},_current:0,count:function(){return Math.ceil(this.source.length/6)},render:function(t,i){var n=this.options;return this.source=t,this._createLayout(t),this.items=this.container.find(n.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,i),this},current:function(){return this._current},next:function(t){this.goto(this._current+this.options.pageSize,r.LEFT,t)},prev:function(){this.goto(this._current-this.options.pageSize,r.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(t){var i=this._runtime,n=this.options,e=n.direction,s=i.count,o=i.width;t>=0&&s>t&&(r.animate(i.root,e*o*this._current,e*o*t,this.options.animationDuration),this._current=t,_.each(this.container.find(".sw_nav>i"),function(i){$(i).attr("js_index")==t?$(i).addClass("current"):$(i).removeClass("current")}))},_resize:function(){this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,this._current)},_showCurrent:function(t,i){var n=this._runtime;r.translate(n.root,this.options.direction*n.width*i,0),this._current=i},_getSwipeDirection:function(t,i){var n,e=i-t,r=Math.abs(e);return r>0&&r>this.options.minSwipe&&(n=e/r),n},_getRuntimeEnv:function(){var t=this.items,i=this.options,n=$(t[0]),e=n.parent(),r=e.parent(),s=r.offset(),o=this.count();return{width:i.width||s.width,root:e,stage:r,count:o}},__touchStartHandler:function(t){var i=t.touches[0],n=this._getRuntimeEnv().root,e=n.css(u+"transform").match(h);e=e&&e[0]||0,this.__lastTouchStartPos={left:Number(e),x:i.pageX,y:i.pageY,t:+new Date}},__touchEndHandler:function(t){var i=this.__lastTouchStartPos,n=this._getSwipeDirection(i.x,t.changedTouches[0].pageX);this[n===r.LEFT?"next":n===r.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(){this._current},__moveHandler:function(t){if(t.preventDefault(),!(t.touches.length>1||t.scale&&1!==t.scale)){var i=t.touches[0],n=this._getRuntimeEnv(),e=(n.root,this.__lastTouchStartPos);e.left+i.pageX-e.x}}}),r.LEFT=-1,r.RIGHT=1,r.translate=function(t,i){var n=t[0],e=n&&n.style;e&&t.css(u+"transform","translate3d("+i+"px, 0, 0)")},r.animate=function(t,i,n,e){this.translate(t,n,e)},n.register({name:s,fn:r}))});