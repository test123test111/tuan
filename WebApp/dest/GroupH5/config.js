<<<<<<< HEAD
!function(){var t=Lizard.WebresourcePDBaseUrl,e="undefined"!=typeof location&&-1!=location.search.indexOf("debug=1"),i={paths:{TuanApp:t+"tuanapp",TuanStore:t+"models/tuanstore",TuanModel:t+"models/tuanmodel",DropDown:t+"com/dropdown",TuanFilters:t+"widget/tuanfilters",SmoothSlide:t+"widget/slide",TabSlide:t+"widget/tabslide",Switch:t+"com/switch",VoiceSearch:t+"widget/voicesearch",StoreManage:t+"util/storemanage",HttpErrorHelper:t+"util/httperrortpl",NumberStep:t+"com/numberstep",Payment:t+"widget/payment",WechatShare:t+"widget/wechatshare",ScrollObserver:t+"util/scrollobserver",MemCache:t+"util/memcache",AMapWidget:t+"widget/amap",POIWidget:t+"widget/poi",LazyLoad:t+"com/lazyload",CallPhone:t+"com/callPhone",FilterXss:t+"util/filterxss",CityListData:t+"data/citylist",StringsData:t+"data/strings",Tab:t+"com/tab",PageHistory:t+"com/history",ConsoleDebug:t+"debug/console",PageTreeConfig:t+"com/pagetreeconfig",TuanBaseView:t+"com/baseview",ValidatorUtil:t+"util/form/validator",FieldUtil:t+"util/form/field",HomeTpl:t+"templates/home.html",ListProductTpl:t+"templates/list.product.html",ListBusinessTpl:t+"templates/list.business.html",BookingTpl:t+"templates/booking.html",BookingSuccessTpl:t+"templates/booking.success.html",CityListTpl:t+"templates/citylist.html",CouponTpl:t+"templates/coupon.html",DetailTpl:t+"templates/detail.html",DetailTipsTpl:t+"templates/detail.tips.html",HotelCommentsTpl:t+"templates/hotel.comments.html",HotelImagesTpl:t+"templates/hotel.images.html",HotelImageSlideTpl:t+"templates/hotel.imageslide.html",HotelMapTpl:t+"templates/hotel.map.html",HotelServiceTpl:t+"templates/hotel.service.html",HotelSubbranchTpl:t+"templates/hotel.subbranch.html",LashouTpl:t+"templates/lashou.html",InvoiceTpl:t+"templates/invoice.html",KeywordSearchTpl:t+"templates/keywordsearch.html",NearListTpl:t+"templates/near.list.html",RefundTpl:t+"templates/refund.html",RefundTipTpl:t+"templates/refund.tip.html",TuanOrderDetailTpl:t+"templates/tuanorderdetail.html",OrderDetailItemTpl:t+"templates/order.detail.item.html",RecommendTpl:t+"templates/recommend.html",MapNavTpl:t+"templates/hotel.map.nav.html"}};e&&(i.urlArgs=Date.now()),require.config(i)}(),define("config",function(){}),define("PageTreeConfig",[],function(){var t={home:{prev:"",url:"/webapp/tuan/home",range:[]},list:{prev:"home",url:"/webapp/tuan/list",range:["home"]},lottery:{prev:"home",url:"/webapp/tuan/lottery",range:["home"]},localfeature:{prev:"home",url:"/webapp/tuan/localfeature",range:["home"]},listmap:{prev:"list",url:"/webapp/tuan/listmap",range:["list"]},detail:{prev:"list",url:"/webapp/tuan/detail/{did}.html?cityid={cityid}",range:["list","detail","home","nearlist","tuanorderdetail","listmap","bookingsuccess"],params:{did:0,cityid:0}},detailtips:{prev:"detail",url:"/webapp/tuan/detailtips",range:["detail"]},lashou:{prev:"list",url:"/webapp/tuan/lashou/{pid}.html",range:["detail"],params:{pid:0}},citylist:{prev:"home",url:"/webapp/tuan/citylist",range:[]},hotelimages:{prev:"detail",url:"/webapp/tuan/hotelimages/{did}.html",range:["detail"],params:{did:0}},hotelimageslide:{prev:"hotelimages",url:"/webapp/tuan/hotelimageslide?index={imgindex}",range:["hotelimages"],params:{imgindex:1}},hotelcomments:{prev:"detail",url:"/webapp/tuan/hotelcomments",range:["detail"]},hotelservice:{prev:"detail",url:"/webapp/tuan/hotelservice",range:["detail"]},hotelmap:{prev:"detail",url:"/webapp/tuan/hotelmap?lon={lon}&lat={lat}&hotelName={hotelname}",range:["detail","tuanorderdetail","hotelsubbranch"],params:{lon:0,lat:0,hotelname:""}},hotelmapnav:{prev:"hotelmap",url:"/webapp/tuan/hotelmapnav?url={url}",range:["hotelmap"],params:{url:""}},booking:{prev:"detail",url:"/webapp/tuan/booking",range:["detail"]},bookingsuccess:{prev:"list",url:"/webapp/tuan/bookingsuccess/{orderid}.html",range:["list"],params:{orderid:0}},coupon:{prev:"booking",url:"/webapp/tuan/coupon",range:["booking"]},invoice:{prev:"booking",url:"/webapp/tuan/invoice",range:["booking"]},calendar:{prev:"booking",url:"/webapp/tuan/calendar",range:["booking"]},hotelsubbranch:{prev:"detail",url:"/webapp/tuan/hotelsubbranch",range:["detail"]},keywordsearch:{prev:"home",url:"/webapp/tuan/keywordsearch",range:["home","list"]},nearlist:{prev:"detail",url:"/webapp/tuan/nearlist",range:["detail","bookingsuccess","tuanorderdetail"]},tuanorderdetail:{prev:"home",url:"/webapp/tuan/tuanorderdetail/{orderid}.html",range:["home","bookingsuccess"],params:{orderid:0}},refund:{prev:"home",url:"/webapp/tuan/refund/{orderid}.html",range:["home","tuanorderdetail"],params:{orderid:0}},refundtip:{prev:"tuanorderdetail",url:"/webapp/tuan/refundtip",range:["tuanorderdetail"]}};return t}),define("PageHistory",["c","cStore","PageTreeConfig"],function(t,e,i){function n(t){return null===t||void 0===t}function a(t){this.data={};for(var e in t)t[e]&&this.add(e,t[e].url,t[e].prev,t[e].jump,t[e].range,t[e].params)}function s(){this.stack=c.getInstance()}var o=t.base,r=/\{([^\{\}]+)\}/g;a.prototype={constructor:a,buildNode:function(t,e,i,n,a,s){return{id:t,prev:i,url:e,jump:n||!1,range:a,params:s||{}}},add:function(t,e,i,n,a,s){this.data[t]=this.buildNode(t,e,i,n,a,s)},getNode:function(t,e){var i=this.data[t];if(!i)return null;var a=i.param||{};e=e||{};var s=(i.url||"").replace(r,function(t,i){return n(e[i])?n(a[i])?"":a[i]:e[i]});return{id:i.id,prev:i.prev,url:i.url,reurl:s,jump:i.jump,range:i.range}},getPrevNode:function(t,e){var i=this.data[t],a=i&&i.prev&&this.data[i.prev]&&this.data[i.prev];if(!a)return null;e=e||{};var s=a.params||{},o=(a.url||"").replace(r,function(t,i){return n(e[i])?n(s[i])?"":s[i]:e[i]});return{id:a.id,url:a.url,prevurl:o,prev:a.prev,jump:a.jump,range:a.range}}};var l=new a(i),c=new o.Class(e,{__propertys__:function(){this.key="P_TUAN_HISTORY_STACK",this.lifeTime="30D",this.isUserData=!0},initialize:function($super,t){$super(t)},pop:function(){var t=this.getAttr("history")||[],e=t.pop();return this.setAttr("history",t),e},push:function(t,e){var i=this.getAttr("history")||[],n=Math.max(0,i.length-1);e?i[n]=t:i.push(t),this.setAttr("history",i)},top:function(){var t=this.getAttr("history")||[],e=Math.max(0,t.length-1);return t[e]},length:function(){var t=this.getAttr("history");return t&&t.length||0},clear:function(){this.setAttr("history",[])},index:function(t){var e=this.getAttr("history")||[];return t=0>t?e.length+t:t,e[t]},addCache:function(t,e,i){var n={id:t,obj:e,replace:i};this.setAttr("cache",n)},getCache:function(){return this.getAttr("cache")||{}},clearCache:function(){this.setAttr("cache",{})},popById:function(t){for(var e=this.getAttr("history")||[],i=-1,n=0,a=null,s=e.length-1;s>-1;s--)if(n++,e[s].id===t){i=s;break}return i>-1&&(a=e.splice(i,n)),this.setAttr("history",e),a},addSequeHistory:function(t){var e=this.getAttr("sequehistory")||[],i=Math.max(0,e.length-1),n=e[i]||{};n.id!==t.id&&(e.length>10&&e.splice(0,3),e.push(t),this.setAttr("sequehistory",e))},getSequeTop:function(t){var e=this.getAttr("sequehistory")||[],i=Math.max(0,e.length-1),n=null;return e[i]&&(e[i].id!=t?n=e[i]:e[i-1]&&(n=e[i-1])),n}});s.prototype={constructor:s,push:function(t,e,i,n){this.stack.addCache(t,s.buildEntry(t,e,i),n)},confirmPush:function(t){var e=this.stack.getCache();e.id===t&&(this.stack.push(e.obj,e.replace),this.stack.clearCache())},pop:function(){return this.stack.pop()},top:function(){return this.stack.top()},index:function(t){return this.stack.index(t)},clear:function(){this.stack.clear()},getCache:function(){return this.stack.getCache()},clearCache:function(){this.stack.clearCache()},popById:function(t){return this.stack.popById(t)},addSequeHistory:function(t){this.stack.addSequeHistory(t)},getSequeTop:function(t){return this.stack.getSequeTop(t)}},s.buildEntry=function(t,e,i){return{id:t,url:e,ver:i}};var d="_____FROM_____",p=function(t,e){this.tree=t,this.stack=e};p.prototype={constructor:p,back:function(t,e){var i=this.stack.pop(),n=this.stack.top(),a=this.tree.getPrevNode(t,e),s=this.tree.getNode(t),o="",r=s.range||[];if(n&&n.id===d)return this.stack.addSequeHistory({id:t,url:o}),this.stack.pop(),{fullurl:n.url,url:n.url.replace(/^[^#]+#/g,"").replace(/^#+/g,""),jump:!0};var l=!1;return i&&i.id===t&&n&&n.id&&(!r.length||_.indexOf(r,n.id)>-1)?(o=n.url,l=i.ver!==n.ver||s.jump,t=n.id):(o=a.prevurl,l=!!s.jump,t=a.id,this.stack.clear()),this.stack.addSequeHistory({id:t,url:o}),{fullurl:o,url:o.replace(/^[^#]+#/g,"").replace(/^#+/g,""),jump:l,id:t}},popById:function(t){return this.stack.popById(t)},forward:function(t,e,i,n){if("object"==typeof e){var a=this.tree.getNode(t,e);e=a.reurl}return this.stack.push(t,e,i,n),this.stack.addSequeHistory({id:t,url:e}),e},confirmForward:function(t){this.stack.confirmPush(t)},getLastView:function(){var t,e=this.stack.getCache()||{};return t=e.id?this.stack.top():this.stack.index(-2)},getLatelyView:function(t){var e=this.stack.getSequeTop(t);return e?e.id:null},addHistory:function(t,e,i){var n=this.stack.getCache()||{};n.id&&n.id!==t&&this.stack.clearCache();var a=this.stack.top(),s=this._getFromByUrl(e);(!a||a.id!==t||s)&&(s&&(this.clearHistory(),this.stack.push(d,s),this.stack.addSequeHistory({id:d,url:s}),this.confirmForward(d)),this.stack.push(t,e,i),this.stack.addSequeHistory({id:t,url:e}),this.confirmForward(t))},clearHistory:function(t,e,i){this.stack.clear(),t&&e&&this.addHistory(t,e,i)},isPrevPageOrigin:function(){var t=this.getLastView();return t&&t.id===d},switchTree:function(t){this.tree=t},_getFromByUrl:function(t){var e="from",i=(t||"").split(/#+/g),n=i[0],a=i[1]||"",s=null;if(n.indexOf(e)>-1){var o=this._getQueryString(n);o[e]&&(s=o[e])}if(a.indexOf(e)>-1){var r=this._getQueryString(a);r[e]&&(s=r[e])}return s&&(s=decodeURIComponent(s)),s&&!s.match(/^\s*(?:http|\/)/)&&(s=null),s},_getQueryString:function(t){var e=(t||"").split("?");e.shift(),e=e.join("?").split(/(?!\?[^?]*)&/g);for(var i,n={},a=0,s=e.length;s>a;a++)i=e[a].split("="),n[i.shift()]=i.join("=");return n}};var u=new p(l,new s);return u}),define("TuanApp",["PageHistory"],function(){var t=/^ctrip:\/\//i,e=/(.*)\/webapp\/(\w+)\/(.*)/,i=/^#\w/i;window._log={stash:[],log:function(t){this.stash.push(t?JSON.stringify(t):t)}};var n={init:function(){this.saveUnion()},showLoading:function(){this.loading.show()},hideLoading:function(){this.loading.hide()},isInternalPage:function(t){return t.toLowerCase().indexOf("/tuan/")>-1},back:function(t){var e=this.lastUrl();e?(this.app.history.pop(),this.isInternalPage(e)?location.hash=e.split("#")[1]||"home":location.replace(e)):(t?(-1==t.indexOf("#")&&(t="#"+t),this.app.curView.jump(t)):window.history.go(-1),this.app.history=[])},lastUrl:function(){var t=this.app.history,e=t.length,i=e&&t[e-2]||"";return i},parsePageURL:function(n){if(!n)return!1;var a,s={module:"",link:n,isNative:!1,isInternal:!1,domain:document.domain};return n.match(i)?(s.module="tuan",s.isInternal=!0,s):n.match(t)?(s.domain="ctrip",s.isNative=!0,s):(a=e.exec(n),a&&(s.module=a[2],s.link=a[3],s.isInternal=!0),s)},gotoExternalPage:function(t,e){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,n){var a=n.create("Guider");i.isInApp()?a.cross({path:t,param:e}):location.href=location.protocol+"//"+location.host+"/webapp/"+t+"/"+e})},jumpToPage:function(t,e){if(t){var i=this,n=i.parsePageURL(t);require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,a){var s=a.create("Guider"),o=i.isInApp();return o?n.isInternal?void("tuan"==n.module?e.forwardJump(n.link.split("/")[0],"/webapp/tuan/"+n.link):s.cross({path:n.module,param:n.link})):void s.jump({targetModel:n.isNative?"app":"h5",url:n.link,title:document.title}):void(location.href=t)})}},getQuery:function(t){return Lizard.P(t)},saveUnion:function(t){require(["CommonStore"],function(e){var i=e.UnionStore&&e.UnionStore.getInstance(),a=n.getQuery("PartnerID"),s=n.getQuery("Source"),o=n.getQuery("AllianceID"),r=n.getQuery("SID"),l=n.getQuery("OUID"),c=i.get();s||o?c&&c.AllianceID==o&&c.SID==r&&c.OUID==l&&c.Source==s&&c.PartnerID==a||i.set({AllianceID:o,SID:r,OUID:l,Source:s,PartnerID:a,targetTuan:!0}):t===!0&&""!==document.referrer&&document.referrer.indexOf("/html5")>0&&c&&c.targetTuan===!0&&i.remove()})},initVoiceSearch:function(t){require(["cWidgetFactory","VoiceSearch"],function(e){var i=e.create("VoiceSearch");return new i(t)})},environment:0,tHome:function(){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(t,e){var i=e.create("Guider"),n=t.isInApp();n?i.home():location.href=location.protocol+"//"+location.host+"/html5"})},backToLastPage:function(){require(["cWidgetFactory","cWidgetGuider"],function(t){var e=t.create("Guider");e.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})})})},isOverOS7:function(){return $.os&&$.os.ios&&parseInt($.os.version,10)>=7},isProduction:!0};return require(["libs","cUtility","cWidgetFactory","cHybridFacade","cWidgetGuider"],function(t,e,i,a){var s=i.create("Guider");if(n.init(),e.isInApp()&&(_.isFunction(s.app_check_network_status)&&s.app_check_network_status({callback:function(t){n.environment="WIFI"===t.networkType?0:1}}),s.register({tagname:a.METHOD_APP_NETWORK_DID_CHANGED,callback:function(t){n.environment="WIFI"===t.networkType?0:1}})),e.isInApp()){var o=e.isPreProduction();("0"===o||"1"===o||"2"===o)&&(n.isProduction=!1)}else location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(n.isProduction=!1);!function(){var t,e,i=0;!n.isProduction&&$(document).on("click",function(){i++,t&&clearTimeout(t),t=setTimeout(function(){i>=5&&(!e&&require(["ConsoleDebug"],function(t){e=new t}),e&&e.show()),i=0},350)})}()}),window.noPic=function(t){t&&(t.src="http://pic.c-ctrip.com/common/pic_alpha.gif",t.onerror=null)},n}),define("TuanStore",["cStore","cBase","cUtility"],function(t,e,i){var n={},a=6.1;return n.TuanDetailsStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_DETAILS",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanStatusStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_STATUS",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanBranchOfficeStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_BRANCH_OFFICE",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanHotelCommentListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOTEL_COMMENT",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanInvoiceStore=new e.Class(t,{__propertys__:function(){this.key="GROUP_INVOICE",this.lifetime="30M"},initialize:function($super,t){$super(t)}}),n.TuanOrderListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_LIST",this.lifeTime="3M"},initialize:function($super,t){$super(t)}}),n.TuanOrderInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_INFO",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupHotelListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOTEL_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupHotListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOT_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupSearchStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SEARCH",this.lifeTime="1D",this.defaultData={pageIdx:"1",ctyId:"2",ctyName:"上海",bdate:e.Date.format(i.getServerDate(),"Y-m-d H:i:s"),edate:e.Date.format(i.getServerDate(),"Y-m-d H:i:s"),flag:0,productType:"0",qparams:[],sortRule:"2",sortType:"0",ver:a,ctype:0}},initialize:function($super,t){$super(t)}}),n.GroupPositionFilterStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POSITIONFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.GroupConditionStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CONDITIONFILTER",this.lifeTime="3D"},initialize:function($super,t){$super(t)}}),n.TuanOrderDetailStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_DETAIL",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupOrderParamStore=new e.Class(t,{__propertys__:function(){this.key="USER_GROUP_ORDERPARAM",this.lifeTime="15M",this.isUserData=!0},initialize:function($super,t){$super(t)}}),n.OrderDetailReturnPage=new e.Class(t,{__propertys__:function(){this.key="GROUP_RETURNPAGE",this.lifeTime="15M"},initialize:function($super,t){$super(t)}}),n.TuanCityListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CITY_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanHistoryCityListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HISTORYCITY_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.GroupCategoryFilterStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CATEGORYFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.GroupSortStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SORTFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanHistoryKeySearchStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HISTORYKEYSEARCH_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanKeyWordListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_KEYWORD_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanLocalCityInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_LOCAL_CITY_INFO",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupGeolocation=new e.Class(t,{__propertys__:function(){this.key="TUAN_GEOLOCATION",this.lifeTime="60M"},initialize:function($super,t){$super(t)}}),n.GroupCustomFilters=new e.Class(t,{__propertys__:function(){this.key="TUAN_CUSTOM_FILTERS",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanInvoiceTitleStore=new e.Class(t,{__propertys__:function(){this.key="TuanGou_InvoiceTitle",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanImagesListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_IMAGES_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanPOIListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POI_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanNearListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_NEAR_LIST",this.lifeTime="15D"}}),n.TuanStrategyIDStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_STRATEGY_ID",this.lifeTime="15D"}}),n.TuanCouponListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_COUPON_LIST",this.lifeTime="1D"}}),n.TuanSelectedCouponStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SELECTED_COUPON",this.lifeTime="1D"}}),n.ColaPrizeStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_COLA_PRIZE",this.lifeTime="1D"}}),n.TuanHotKeywords=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOT_KEYWORDS",this.lifeTime="1D"}}),n.TuanRegionInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_REGION_INFO",this.lifeTime="1D"}}),n.TuanPositionStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POSITION",this.lifeTime="2M"},initialize:function($super,t){$super(t)}}),n.BannerClassStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_BANNER_CLASS",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),window.testStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_TEST",this.lifeTime="1M"}}),n.TicketBookingStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_TICKET_BOOKING",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n}),define("TuanModel",["cModel","cBase","TuanStore","cUtility"],function(t,e,i,n){t.baseurl=function(t){var e={test:"soa2/10101",uat:"restapi/soa2/10101",pro:"restapi/soa2/10101"},i={test:"m.fat.ctripqa.com",uat:"m.uat.ctripqa.com",pro:"m.ctrip.com"},a=location.host,s=i.test,o=e.test;return n.isInApp()?"1"==n.isPreProduction()?(s="https"==t?"restful.m.ctrip.com":i.pro,o=e.pro):"0"==n.isPreProduction()?(s="https"==t?"restful.waptest.ctrip.com":i.test,o=e.test):"2"==n.isPreProduction()?(s=i.uat,o=e.uat):(s="https"==t?"restful.m.ctrip.com":i.pro,o=e.pro):a.match(/^(m|3g|wap)\.ctrip\.com/i)?(s=i.pro,o=e.pro):!a.match(/^(localhost|172\.16|127\.0)/i)||"https"!=location.protocol&&"https"!=t?a.match(/^(localhost|172\.16|127\.0)/i)?"https"==t?(s="restful.waptest.ctrip.com",o=e.test):(s=i.test,o=e.test):a.match(/^10\.8\.2\.111/i)?(s=i.pro,o=e.pro):!a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)||"https"!=location.protocol&&"https"!=t?a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)?(s="waptest.ctrip.com",o=e.test):a.match(/^m\.uat/i)?(s=i.uat,o=e.uat):(s=i.test,o=e.test):(s="restful.waptest.ctrip.com",o=e.test):(s="restful.waptest.ctrip.com",o=e.test),{domain:s,path:o}};var a={100:"操作成功",101:"节点数据验证不通过",102:"系统程序错误",201999:"产品不处于可售状态，不能生成订单",201e3:"产品没有供应商,生成订单失败",201001:"产品已团完,生成订单失败",201002:"产品无分销商,生成订单失败",201003:"电话格式不符合规范（例：021-10106666-），未能生成订单",201004:"产品属0元团购，分销联盟不能生成订单",201005:"产品属马上订产品，分销联盟不能生成订单",201006:"超过此产品的最大购买数量，不能生成订单",201007:"小于此产品的最少购买数量，不能生成订单",201008:"本产品携程不开发票，不能生成订单",201009:"发票创建失败，不能生成订单",201010:"发票信息有误，不能生成订单",201012:"本产品每个手机号码仅限购买一次",201011:"产品属0元团购，一个手机号只能预订一次",301e3:"订单取消成功",301001:"订单不属于用户或订单不存在",301002:"订单状态为非新订单",301003:"取消订单失败,订单状态修改失败",301004:"订单删除失败",301005:"订单删除成功",301006:"生成订单失败",301007:"订单状态修改失败",301008:"订单未查到支付记录",301009:"订单不存在",301010:"该订单已在处理中",401e3:"券号或者订单不存在或已更新，券取消失败",401001:"更新订单失败，券取消失败",401002:"更新券号失败，券取消失败",401003:"券使用失败",401004:"现渠道和此张券应属于的渠道不同，不能取消券",401005:"券取消失败",401006:"此张券已使用，不能取消券",401007:"此张券已取消，不能再次取消券",401008:"此张券已作废，不能取消券",401009:"券号已有预约记录,不能使用",401010:"券状态:已过期超过两天,不可使用",401011:"订单类型错误(1为携程收款，2为对方收款)",501e3:"联盟信息错误，无法取消券",501001:"更新联盟信息失败，未能生成订单",501002:"生成券号时发生异常，未能生成订单",601e3:"信用卡发送扣款请求失败",601001:"存在重复流水号",601002:"保存信用卡信息错误",601003:"增加支付记录失败",601004:"调用支付接口失败"},s={},o=6.1;return s.TuanDetailModel=new e.Class(t,{__propertys__:function(){this.url="/json/DetailSearch",this.method="POST",this.param={ext:"",flag:0,id:33483,ver:o},this.result=i.TuanDetailsStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanStatusModel=new e.Class(t,{__propertys__:function(){this.url="/json/RoomStatusSearch",this.method="POST",this.param={bdate:"",edate:"",pid:0,ext:"",flag:0,ver:o},this.result=i.TuanStatusStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanBranchOfficeModel=new e.Class(t,{__propertys__:function(){this.url="/json/BranchOffice",this.method="POST",this.param={ext:"",flag:0,id:0,ver:o},this.result=i.TuanBranchOfficeStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotelCommentListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CommentListSearch",this.method="POST",this.param={ext:"",flag:0,hotelId:0,pageIdx:1,ver:o},this.result=i.TuanHotelCommentListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanOrderListModel=new e.Class(t,{__propertys__:function(){this.url="/OrderList/Query",this.method="POST",this.isUserData=!0,this.param={ext:"",flag:0,pageIdx:1,ver:o},this.result=i.TuanOrderListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanOrderDetailModel=new e.Class(t,{__propertys__:function(){this.url="/json/OrderDetailSearch",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o},this.result=i.TuanOrderDetailStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanSendMsgModel=new e.Class(t,{__propertys__:function(){this.url="/json/MessageSend",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o}},initialize:function($super,t){$super(t)}}),s.TuanListModel=new e.Class(t,{__propertys__:function(){this.url="/json/ListSearch",this.method="POST",this.result=i.GroupListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotelListModel=new e.Class(t,{__propertys__:function(){this.url="/json/HotelListSearch",this.method="POST",this.result=i.GroupHotelListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotListModel=new e.Class(t,{__propertys__:function(){this.url="/json/HotCitySearch",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o},this.result=i.GroupHotListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanConditionModel=new e.Class(t,{__propertys__:function(){this.url="/json/ConditionListSearch",this.method="POST",this.param={ver:o},this.result=i.GroupConditionStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanCityListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CityListSearch",this.method="POST",this.param={dataVer:99,ver:o},this.result=i.TuanCityListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanKeyWordListModel=new e.Class(t,{__propertys__:function(){this.url="/json/KeywordSearch",this.method="POST",this.param={},this.result=i.TuanKeyWordListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanLocalCityInfo=new e.Class(t,{__propertys__:function(){this.url="/json/SearchCityIdByLat",this.param={},this.method="POST",this.result=i.TuanLocalCityInfoStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanCreateOrder=new e.Class(t,{__propertys__:function(){this.url="/json/CreateOrder",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)},getErrorMessage:function(t){var e=t&&t.ErrorCode,i=t&&t.Message||"";return a[e]||i}}),s.TuanSubmitOrder=new e.Class(t,{__propertys__:function(){this.url="/json/SubmitOrder",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanApplyOrder=new e.Class(t,{__propertys__:function(){this.url="/json/PaymentApply",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanRetryPayment=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/ContinueToPay",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.BannerSearch=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/bannersearch",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanRefundlTicketModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/cancelticket",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanCancelOrderModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/OrderCancel",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanDeleteOrderModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/OrderDelete",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanImagesListModel=new e.Class(t,{__propertys__:function(){this.url="/json/ProductPictures",this.param={},this.method="POST",this.result=i.TuanImagesListStore.getInstance()}}),s.TuanPOIListModel=new e.Class(t,{__propertys__:function(){this.url="/json/POISearch",this.param={ver:o},this.method="POST",this.result=i.TuanPOIListStore.getInstance()}}),s.TuanNearListModel=new e.Class(t,{__propertys__:function(){this.url="/json/NearGroup",this.param={},this.method="POST",this.result=i.TuanNearListStore.getInstance()}}),s.TuanStrategyIDModel=new e.Class(t,{__propertys__:function(){this.url="/json/Destination",this.param={},this.method="POST",this.result=i.TuanStrategyIDStore.getInstance()}}),s.TuanValidateCouponModel=new e.Class(t,{__propertys__:function(){this.url="/json/ValidateCoupon",this.param={},this.method="POST"}}),s.TuanCouponListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CouponList",this.param={ver:o},this.method="POST",this.result=i.TuanCouponListStore.getInstance()}}),s.ColaDrawModel=new e.Class(t,{__propertys__:function(){this.url="/json/GetPrizeResultService",this.param={},this.method="POST"}}),s.ColaAddPrizeModel=new e.Class(t,{__propertys__:function(){this.url="/json/SetPrizeToUser",this.param={},this.method="POST"}}),s.TuanAddFavorite=new e.Class(t,{__propertys__:function(){this.url="/json/FavoriteAdd",this.param={},this.method="POST"}}),s.TuanDelFavorite=new e.Class(t,{__propertys__:function(){this.url="/json/FavoriteDelete",this.param={},this.method="POST"}}),s.TuanHotKeywordsModel=new e.Class(t,{__propertys__:function(){this.url="/json/SearchHotWord",this.method="POST",this.param={cityid:0},this.result=i.TuanHotKeywords.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanRegionInfoModel=new e.Class(t,{__propertys__:function(){this.url="/json/ExpressCity",this.method="POST",this.param={},this.result=i.TuanRegionInfoStore.getInstance()},initialize:function($super,t){$super(t)}}),s.CrossRecommendModel=new e.Class(t,{__propertys__:function(){this.url="/json/ProductRecommend",this.method="POST",this.param={ver:o}},initialize:function($super,t){$super(t)}}),s.BannerClassModel=new e.Class(t,{__propertys__:function(){this.url="/json/BannerClass",this.method="POST",this.param={},this.result=i.BannerClassStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TicketBookingModel=new e.Class(t,{__propertys__:function(){this.url="/json/TicketBooking",this.method="POST",this.param={},this.result=i.TicketBookingStore.getInstance()},initialize:function($super,t){$super(t)}}),s}),define("DropDown",["libs","cUIMask"],function(t,e){function i(t){var i={triggerEvent:"click",trigger:null,panel:null,label:null,itemCls:"li[data-type]",hasEffect:!0,hasMask:!0,selectedIndex:0,activeTriggerCls:"",selectedItemCls:"typecrt",multiple:!1,onShow:n,onHide:n,onSelect:n},s=this;this.options=a(i,t),this.trigger=this.options.trigger,this.panel=this.options.panel,this.label=this.options.label,this.disabled=!1,this.opened=!1,this.items=this.panel.find(this.options.itemCls),this.reset(!0),this.options.hasMask&&(this.mask=new e({onCreate:function(){var t=this;this.root.on("click",function(){s.hide(),t.hide()})}}),this.panel.css("z-index",9999)),this._bindEvents()}var n=function(){},a=$.extend;return i.prototype={constructor:i,_bindEvents:function(){var t=this,e=this.options,i=this.trigger;this._showHandler=$.proxy(function(){this.opened?(this.hide(),e.onHide.call(t)):(this.show(),e.onShow.call(t))},this),this._selectHandler=$.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.select(t.target),this.hide()},this),this._hideHandler=$.proxy(function(){var t=this;setTimeout(function(){t.hide()},200)},this),i.on(e.triggerEvent,this._showHandler),i.on("blur",this._hideHandler),this.panel.on("click",e.itemCls,this._selectHandler)},_unbindEvents:function(){var t=this.options;this.trigger.off(t.triggerEvent,this._showHandler),this.panel.off("click",this._selectHandler)},disable:function(){this._unbindEvents(),this.disabled=!0},enable:function(){this._bindEvents(),this.disabled=!1},show:function(){var t=this.panel;t.show(),this.options.hasEffect&&(t.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),t.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1})),this.mask&&this.mask.show(),this.trigger.addClass(this.options.activeTriggerCls),this.opened=!0},hide:function(){var t=this;t.panel.hide(),t.mask&&t.mask.hide(),t.trigger.removeClass(t.options.activeTriggerCls),t.opened=!1},getItemByAttr:function(t,e){return this.panel.find("[data-"+t+'="'+e+'"]')},getItemByIndex:function(t){return this.items[t]},select:function(t,e){var i=this.options,n=this._selected,a=i.selectedItemCls;n&&n.removeClass(a),"LI"!=t.tagName&&(t=t.parentNode),this.selectedIndex=this.items.indexOf(t),t=$(t),this.label.html(t.attr("data-name")||t.text()),t.addClass(a),!e&&this.options.onSelect.call(this,t),this._selected=t},reset:function(t,e){this.select(this.items["number"==typeof e?e:this.options.selectedIndex],t)}},i}),define("Tab",["libs","cUIScroll"],function(t,e){function i(t){var e={onSwitch:a};this.options=n(e,t),this.panel=this.options.panel,this.label=this.options.label,this.isScroll=this.options.isScroll,this.inited=!1,this.switch(this.options.labelSelectedIndex),this._bindEvents()}var n=$.extend,a=function(){};return i.prototype={constructor:i,_bindEvents:function(){var t=this.options;
this._switchHandler=$.proxy(function(t){var e=this.label.indexOf(t.currentTarget);this.switch(e)},this),this._selectHandler=$.proxy(function(e){t.onSelect($(e.currentTarget))},this),this.label.on("click",this._switchHandler),this.panel.on("click",t.itemClass,this._selectHandler)},_unbindEvents:function(){var t=this.options;this.trigger.off(t.triggerEvent,this._showHandler),this.panel.off("click",this._selectHandler)},"switch":function(t){var i=this.options;this.options.onSwitch(),$(this.label[i.labelSelectedIndex]).removeClass(i.labelSelectedClass),$(this.label[t]).addClass(i.labelSelectedClass),$(this.panel[i.labelSelectedIndex]).hide();var n=$(this.panel[t]);if(n.show(),i.isScroll&&(n.css({overflow:"hidden","max-height":"285px","margin-bottom":"5px","margin-top":"5px"}),this.scroller=new e({wrapper:n,scroller:n.find("ul")})),this.options.labelSelectedIndex=t,this.inited){var a=n.find(i.itemClass);1==a.length&&i.onSelect(a)}this.inited=!0}},i}),define("StringsData",[],function(){var t=4;return{SEARCH_DISTANCE:t,SEARCH_DISTANCE_TEXT:t+"公里内",MAP_SOURCE_ID:3,MAX_KEYWORDS_HISTORY:5,CITY_CENTER:"市中心",defaultCity:{id:2,name:"上海"},priceText:{"0|99":"&yen; 100 以下","100|250":"&yen; 100-250","250|400":"&yen; 250-400","400|600":"&yen; 400-600","601|":"&yen; 600 以上","0|1999":"&yen; 2000 以下","2000|3000":"&yen; 2000-3000","3001|":"&yen; 3000 以上"},traitText:{"103|101":"一元酒店","103|10303":"别墅轰趴","103|10304":"住店游玩","103|10305":"情侣酒店"},starText:{2:"二星/经济",3:"三星/舒适",4:"四星/高档",5:"五星/豪华"},groupType:{0:{index:0,name:"全部团购",category:"all"},1:{index:1,name:"酒店",category:"hotel"},8:{index:2,name:"美食",category:"catering"},7:{index:3,name:"旅游度假",category:"vacation"},6:{index:4,name:"门票",category:"ticket"},9:{index:5,name:"娱乐",category:"entertainment"},106:{index:6,name:"一元团购",category:"onepaygroup"},108:{index:7,name:"当地特色",category:"feature"}},index2ctype:{0:"0",1:"1",2:"8",3:"7",4:"6",5:"9"},traType:{hotelid:18,zone:5,hotelgroupid:3,location:4,activity:11,district:16,markland:17},typeToName:{zone:"位置",location:"位置",district:"位置",markland:"位置",hotelid:"名称",hotelgroupid:"名称"}}}),define("CityListData",[],function(){return{1:"北京",2:"上海",3:"天津",4:"重庆",5:"哈尔滨",6:"大连",7:"青岛",10:"西安",11:"敦煌",12:"南京",13:"无锡",14:"苏州",15:"扬州",16:"镇江",17:"杭州",18:"西塘",19:"舟山",20:"淳安",21:"千岛湖镇",22:"绍兴",23:"黄山",24:"九江",25:"厦门",26:"武夷山",27:"张家界",28:"成都",30:"深圳",31:"珠海",32:"广州",33:"桂林",34:"昆明",35:"西双版纳",36:"大理市",37:"丽江",38:"贵阳",39:"乌鲁木齐",40:"吐鲁番市",41:"拉萨",42:"海口",43:"三亚",44:"文昌",45:"万宁",46:"五指山",47:"屯昌",48:"东方",50:"定安",52:"琼海",54:"保亭",55:"陵水",57:"儋州",58:"香港",59:"澳门",82:"南通",83:"昆山",84:"海宁",86:"湖州",87:"奉化",90:"临安",91:"九寨沟",92:"日喀则",94:"都江堰",95:"峨眉山",96:"常熟",99:"银川",100:"兰州",103:"呼和浩特",104:"平遥",105:"太原",106:"五台山",108:"林芝",109:"喀什市",110:"延安",111:"咸阳",112:"宝鸡",117:"潼关",118:"铜川",119:"华阴",124:"西宁",129:"汉中",132:"格尔木",133:"榆次",134:"灵石",135:"介休",136:"大同",137:"长治",139:"临汾",140:"运城",141:"包头",143:"曲阜",144:"济南",145:"泰山",147:"秦皇岛",149:"齐齐哈尔",150:"牡丹江",155:"漠河",158:"长春",159:"吉林",171:"安康",177:"安庆",178:"鞍山",179:"安顺",180:"安溪",181:"安阳",182:"蚌埠",185:"保定",186:"玉溪",187:"北戴河",189:"北海",197:"保山",199:"长白山",201:"常德",202:"赤峰",203:"长乐",206:"长沙",209:"广德",210:"顺德",211:"朝阳",213:"常州",214:"滁州",215:"潮州",216:"沧州",218:"池州",221:"丹东",222:"登封",223:"东莞",231:"大庆",236:"东营",237:"德阳",238:"丹阳",245:"恩施",246:"福鼎",247:"丰都",251:"佛山",252:"抚顺",254:"阜新",256:"富阳",257:"阜阳",258:"福州",267:"广元",268:"赣州",270:"惠安",272:"淮北",275:"邯郸",278:"合肥",281:"黑河",282:"怀化",283:"汉口",285:"哈密市",287:"淮南",288:"华山",290:"衡水",292:"黄石",296:"黄岩",297:"衡阳",299:"惠州",305:"景德镇",307:"井冈山",308:"金华",309:"景洪",310:"蓬莱",314:"九龙",316:"江门",317:"佳木斯",318:"济宁",321:"固原",324:"建阳",325:"江阴",326:"嘉峪关",327:"锦州",328:"荆州",330:"库尔勒",331:"开封",333:"凯里",335:"开平",340:"廊坊",344:"庐山",345:"乐山",346:"丽水",348:"龙岩",350:"洛阳",351:"辽阳",352:"辽源",353:"连云港",354:"柳州",355:"泸州",365:"德宏",370:"绵阳",374:"南安",375:"宁波",376:"南昌",377:"南充",378:"宁德",380:"南宁",385:"南阳",387:"盘锦",388:"平凉",392:"平潭",403:"黟县",406:"泉州",407:"衢州",408:"瑞安",411:"上饶",412:"瑞丽",421:"绥芬河",422:"韶关",426:"石河子",427:"梁平",428:"石家庄",431:"石林",433:"汉寿",436:"三门峡",437:"三明",440:"四平",441:"商丘",443:"泗水",444:"石狮",446:"韶山",447:"汕头",448:"邵武",451:"沈阳",452:"十堰",454:"泰安",456:"通化",458:"通辽",459:"铜陵",460:"桐庐",464:"天水",468:"唐山",470:"天台",474:"武当山",475:"潍坊",477:"武汉",478:"芜湖",479:"威海",481:"吴江",484:"乌兰浩特",485:"永安",489:"婺源",491:"温州",492:"梧州",493:"新安江",494:"西昌",496:"襄阳",500:"锡林浩特",503:"萧山",507:"新乡",508:"歙县",510:"信阳",512:"徐州",513:"忻州",514:"宜宾",515:"宜昌",518:"宜春",521:"宿州",523:"延吉",527:"榆林",529:"伊宁市",533:"烟台",534:"鹰潭",536:"义乌",537:"宜兴",539:"岳阳",540:"余姚",541:"兖州",542:"淄博",544:"自贡",545:"遵化",547:"湛江",548:"诸暨",550:"张家口",551:"驻马店",552:"肇庆",553:"中山",555:"昭通",556:"中卫",557:"浑源",558:"遵义",559:"郑州",560:"漳州",561:"周庄",562:"承德",569:"临沂",571:"嘉兴",577:"淮安",578:"台州",579:"泰州",580:"桐乡",582:"海盐",583:"九华山",589:"巢湖",595:"上虞",596:"嘉善",598:"湘潭",601:"株洲",603:"新余",605:"六盘水",606:"南平",612:"郴州",614:"枣庄",617:"台北",619:"温岭",620:"雁荡山",621:"张家港",654:"太仓",658:"建德",659:"安吉",660:"香格里拉",662:"酒泉",663:"张掖",664:"武威",667:"莆田",677:"衡山",692:"阳江",693:"河源",696:"盱眙",697:"启东",729:"台山",732:"乐清",750:"广汉",755:"东阳",833:"荣成",866:"凤凰",868:"仙居",870:"三清山",871:"阳朔",872:"新昌",887:"吴桥",893:"庐江",894:"东海",895:"新沂",900:"砀山",905:"辛集",907:"阳泉",909:"滕州",918:"娄底",929:"浦江",933:"吉安",937:"咸宁",940:"耒阳",944:"桐城",947:"邢台",951:"鹤壁",956:"揭阳",957:"偃师",958:"巩义",959:"武义",960:"永康",963:"海城",965:"塘沽",966:"瓦房店",967:"大石桥",969:"荥阳",970:"永州",975:"都匀",983:"桐梓",984:"宣威",985:"曲靖",986:"镇远",992:"鄂州",996:"古田",1000:"江山",1001:"玉山",1005:"宁国",1006:"宣城",1007:"当涂",1008:"绩溪",1010:"凤阳",1011:"宁乡",1016:"繁昌",1022:"兴平",1023:"灵宝",1024:"马鞍山",1026:"祁门",1029:"义马",1030:"渭南",1031:"临潼",1037:"海阳",1038:"莱阳",1040:"高密",1043:"胶州",1044:"青州",1048:"铁岭",1050:"葫芦岛",1051:"兴城",1052:"昌黎",1054:"江油",1055:"勉县",1058:"邓州",1060:"汝州",1068:"霸州",1071:"聊城",1073:"梁山",1074:"菏泽",1078:"亳州",1079:"麻城",1083:"满洲里",1088:"漯河",1090:"定州",1092:"晋城",1093:"焦作",1094:"许昌",1095:"侯马",1097:"攀枝花",1098:"怀柔",1105:"茂名",1106:"日照",1107:"长兴",1110:"吉首",1113:"玉林",1116:"白城",1117:"随州",1121:"荆门",1122:"当阳",1123:"石门",1125:"益阳",1128:"绥化",1133:"乌海",1139:"兴义",1140:"百色",1148:"眉山",1155:"本溪",1200:"盐城",1201:"宁海",1205:"同里",1206:"平湖",1208:"慈溪",1209:"临海",1212:"嵊州",1221:"涉县",1222:"稻城",1223:"江都",1224:"仪征",1226:"南戴河",1230:"崇明",1232:"濮阳",1233:"达州",1300:"营口",1303:"松原",1317:"朔州",1323:"澧县",1332:"千岛湖",1333:"开远",1341:"红河",1342:"文山县",1358:"溧阳",1367:"德清",1370:"德州",1371:"遂宁",1372:"松潘",1422:"清远",1428:"恩平",1436:"汕尾",1443:"泰顺",1452:"莱芜",1453:"晋中",1454:"济源",1466:"安图",1472:"宿迁",1474:"丰宁",1490:"孝感",1495:"河口",1517:"汉源",1518:"贵港",1521:"赤壁",1541:"白银",1555:"枣阳",1557:"枝江",1565:"开原",1575:"安平",1592:"江津",1610:"榆树",1632:"三河",1634:"顺义",1635:"蓟县",1646:"庄河",1658:"阿尔山",1664:"亚布力",1677:"防城港",1700:"瑞昌",1705:"六安",1706:"海螺沟",1708:"荔波",1803:"晋江",1804:"莱西",1806:"怒江",1819:"腾冲",1820:"滨州",1823:"象山",1838:"阿坝",1839:"金坛",1840:"萍乡",1882:"仙桃",1884:"肥城",1892:"来宾",1893:"南丹",1899:"钦州",1904:"师宗",1983:"徐水",1991:"新乐",1993:"正定",1996:"元氏",2049:"修武",2063:"沁阳",2088:"北碚",2096:"大厂",2109:"伊川",2230:"迁安",2313:"水富",2431:"蒙自",2442:"建水",2552:"大英",2607:"五峰",2625:"绵竹",2950:"林口",2963:"平山",2966:"尚志",3053:"梅州",3221:"周口",3222:"平顶山",3230:"句容",3233:"东台",3275:"阆中",3277:"雅安",3309:"横店",3327:"布尔津",3329:"通州",3852:"黎平",3863:"寿光",3881:"泗阳",3884:"抚州",3885:"黄冈",3886:"白山",3887:"巴彦淖尔",3906:"即墨",3908:"文登",3909:"胶南",3913:"沂源",3914:"大冶",3915:"莱州",3917:"福清",3918:"乌镇",3921:"楚雄市",3923:"海安",3925:"玉环",3926:"靖江",3929:"邳州",3931:"连州",3933:"云浮",3937:"扬中",3943:"平度",3944:"彬县",3946:"龙口",3967:"东兴",3968:"桂平",3969:"河池",3972:"宜都",3976:"鄂尔多斯",3980:"泰兴",3989:"济阳",3995:"舞钢",3996:"普洱",3997:"芒市",4004:"靖边",4026:"姜堰",4029:"大丰",4124:"甘孜",4125:"高邮",4130:"康定",4132:"香河",4136:"新密",4139:"如皋",4144:"诸城",4145:"陆丰",4146:"贺州",4154:"潜江",4159:"博鳌",4185:"浏阳",4216:"石嘴山",4243:"弥勒",4244:"普陀山",4251:"招远",4255:"呼伦贝尔",7519:"邹城",7521:"龙胜",7525:"北川",7534:"昌吉市",7536:"平邑",7544:"赤水",7549:"泸定",7551:"商洛",7553:"邛崃",7554:"乳山",7557:"如东",7558:"三门",7559:"海门",7561:"密云",7564:"平谷",7567:"房山",7577:"天长",7578:"兴化",7587:"吴忠",7592:"南康",7593:"章丘",7594:"元阳",7596:"扶风",7604:"汾阳",7605:"涿州",7606:"吴川",7618:"洪湖",7619:"仁怀",7630:"沂水",7631:"吕梁",7637:"栾川",7638:"额尔古纳",7646:"酉阳",7650:"长葛",7663:"大兴安岭",7666:"苍南",7667:"罗田",7669:"栖霞",7673:"郓城",7674:"长岛",7675:"沂南",7678:"崇州",7680:"垦利",7685:"丹江口",7687:"藁城",7692:"金湖",7693:"涟水",7694:"睢宁",7695:"响水",7700:"五莲",7714:"莒南",7716:"大邑",7724:"武功山",7727:"贺兰",7728:"东平",7745:"金乡",7751:"理县",7759:"河间",7771:"新泰",7779:"利川",7799:"白沟",7834:"若尔盖",7835:"红原",7840:"沽源",10270:"杨凌",10271:"洛宁",10272:"丹巴",10273:"莒县",10297:"昌乐",10298:"茂县",19953:"平原",19956:"高唐",19959:"蒙阴",20743:"微山",20794:"灵武",20807:"和顺镇",20808:"吉县",20809:"临沭",20812:"嵩县",20825:"灌南",20827:"肥东",20846:"惠水",20849:"永泰",20868:"临高",20881:"长武",20883:"阿巴嘎旗",20896:"鹿泉",20898:"衡阳县",20914:"围场",20916:"滨海",20919:"澄江",20926:"社旗",20932:"青阳",20950:"盂县",20960:"元谋",20963:"文山",20976:"多伦",20980:"霞浦",20990:"晋州",21001:"克什克腾旗",21008:"休宁",21009:"新郑",21025:"白沙",21027:"芜湖县",21052:"长阳",21056:"芦溪",21089:"涞水",21094:"固始",21096:"雅江",21111:"沭阳",21115:"金寨",21138:"巨野",21140:"潜山",21144:"肥乡",21166:"洪泽",21168:"汶上",21179:"黔南",21182:"盐源",21183:"石柱",21194:"中牟",21199:"黔西",21208:"勐腊",21214:"栾城",21230:"阜宁",21258:"唐县",21259:"武隆",21268:"大理",21269:"阿拉善左旗",21286:"雷山",21301:"南部",21316:"彭水",21330:"迁西",21339:"额济纳旗",21349:"房县",21385:"费县",21399:"鄄城",21404:"赣榆",21409:"石台",21410:"涡阳",21411:"周至",21416:"南靖",21421:"长沙县",21436:"织金",21437:"灌云",21448:"馆陶",21452:"永春",21464:"抚松",21469:"博爱",21475:"华容",21486:"定边",21488:"肥西",21490:"文安",21508:"永顺",21509:"连江",21511:"祁县",21514:"璧山",21515:"商河",21542:"于都",21555:"青川",21560:"仙游",21563:"曲沃",21574:"泰宁",21584:"巴林左旗",21590:"建湖",21603:"射阳",21609:"小金",21610:"开县",21619:"遂平",21624:"献县",21629:"金沙",21633:"湘阴",21648:"无为",21660:"昌邑",21675:"桂阳",21683:"威宁",21691:"北流",21699:"孟州",21710:"眉县",21739:"星子",21750:"赵县",21764:"荣昌",21765:"太仆寺旗",21773:"辉县",21777:"云梦",21778:"黔东南",21783:"嘉祥",21790:"张北",21795:"滑县",21807:"丘北",21812:"内乡",21815:"阳新",21818:"广水",21858:"怀来",21860:"太谷",21863:"阿拉善右旗",21871:"泾县",21872:"容城",21883:"汶川",21885:"合浦",21896:"华县",21897:"深州",21898:"翁牛特旗",21902:"闽侯",21903:"平江",21908:"安国",21914:"南陵",21917:"行唐",21929:"兴和",21954:"漳浦",21962:"平塘",21976:"惠东",21994:"和县",21996:"利津",22001:"仁寿",22005:"大城",22012:"罗源",22024:"绥滨",22026:"西乌旗",22031:"毕节",22033:"铜仁",62441:"永定"}}),define("StoreManage",["TuanApp","TuanStore","CityListData","StringsData"],function(t,e,i,n){var a=e.GroupSearchStore.getInstance(),s=e.GroupPositionFilterStore.getInstance(),o=e.GroupCategoryFilterStore.getInstance(),r=e.TuanHistoryCityListStore.getInstance(),l=e.GroupSortStore.getInstance(),c=e.TuanCityListStore.getInstance(),d=e.GroupGeolocation.getInstance(),p=e.TuanHistoryKeySearchStore.getInstance(),u=e.GroupCustomFilters.getInstance(),h={clearSpecified:function(t){t&&a.setAttr("sortRule",2),t&&a.setAttr("sortType",0),!t&&u.remove(),!t&&a.setAttr("ctype",0),!t&&a.setAttr("weekendsAvailable",0),s.remove(),l.remove(),this.setCurrentKeyWord(!1),a.setAttr("qparams",this.getGroupQueryParam()),a.removeAttr("pos")},clearAll:function(){this.clearSpecified(),a.remove(),o.remove()},isNearBy:function(){return a.getAttr("nearby")||r.getAttr("nearby")},addHistoryCity:function(t){var e=r.get(),i=[];e&&e.list&&$.isArray(e.list)&&(i=e.list);var a,s=0;$.each(i,function(e,i){return i!=t?!0:(a=i,s=e,!1)}),a&&a==t?(i.splice(s,1),i.unshift(t)):(i.unshift(t),i.length>n.MAX_KEYWORDS_HISTORY&&i.pop()),r.setAttr("list",i)},findHistoryCity:function(t){var e=r.get(),i=[];if(!t){var n=c.get();if(!n)return;t=n.cities||n}if(e&&e.list)for(var a=e.list.length>3?3:e.list.length,s=0;a>s;s++){var o=e.list[s],l=this.findCityInfoById(o,t);l&&i.push(l)}return i},getCityCount:function(t){if(!t){var e=c.get();if(!e)return;t=e.cities||e}var i=0;if(t&&t.cities&&t.cities.length>0)for(var n,a=0,s=t.cities.length;s>a;a++)n=t.cities[a],n&&n.tag&&"热门"!=n.tag&&(i+=n.cities.length);return i},findCityInfoById:function(t,e,n){var a,s,o,r,l,d;if(!e){if(a=c.get(),!a)return{CityID:t,name:i[t]||n,cGroups:""};e=a.cities||a}for(s=0,d=e.length;d>s;s++)if(l=e[s],"热门"==l.tag&&l.cities)for(o in l.cities)if(r=l.cities[o],r.id==t)return r;for(s=0,d=e.length;d>s;s++)if(l=e[s],"热门"!=l.tag&&l.cities)for(o in l.cities)if(r=l.cities[o],r.id==t)return r;return!1},setCurrentCity:function(t){if(t){var e=d.get();if(e&&e.gps){var i=t.CityID||t,n=this.findCityInfoById(i);if(n)return e.gps.CityId=t.CityID,e.gps.CityName=n.name,e.gps.Groups=n.cGroups,d.setAttr("gps",e.gps),!0;t.CityID&&t.CityName&&(e.gps.CityId=t.CityID,e.gps.CityName=t.CityName,e.gps.Groups=0,d.setAttr("gps",e.gps))}}return!1},getCurrentCity:function(){var t=d.get();return t&&t.gps&&+t.gps.CityId>0?t.gps:!1},addHistoryKeyWord:function(t,e,i){var a,o=p.get(),r=s.getAttr("type"),l=[],c=0;o&&o.list&&$.isArray(o.list)&&(l=o.list),$.each(l,function(e,i){return i.id!=t?!0:(a=i,c=e,!1)}),a&&a.id==t?(l.splice(c,1),l.unshift({id:t,word:e,type:i})):(l.unshift({id:t,word:e,type:i}),l.length>n.MAX_KEYWORDS_HISTORY&&l.pop()),p.remove(),p.setAttr("list",l),this.setCurrentKeyWord({id:t,word:e,type:i}),(0>r||"5"==r)&&s.remove(),"4"==r&&"location"==i&&s.remove()},getHistoryKeyWord:function(){var t=p.get(),e=[];return t&&t.list&&(e=t.list),e},setCurrentKeyWord:function(t){p.setAttr("key",t)},removeCurrentKeyWord:function(){p.removeAttr("key")},getCurrentKeyWord:function(){var t=p.get();return t?t.key:!1},getGroupQueryParam:function(){var t=[],e=u.get(),i=s.get(),a=e&&e.price&&e.price.val;a&&t.push({type:1,value:a});var l=e&&e.star;if(l&&!$.isEmptyObject(l)){var c,p=[];for(c in l)p.push(c);t.push({type:2,value:p.join(",")})}var h=e&&e.brand&&e.brand.val;h&&t.push({type:3,value:h});var f=e&&e.trait&&e.trait.val;f&&t.push({type:14,value:f});var _=d.get()&&d.get().gps,m=e&&e.distance&&e.distance.val;r.getAttr("nearby")&&_?t.push({type:9,value:_.lat+"|"+_.lng+(m?"|"+m:"")}):m&&t.push({type:9,value:m});var v=e&&e.day&&e.day.val;v&&t.push({type:14,value:v});var g=e&&e.multiShop;1==g&&t.push({type:14,value:"102|10201"});var y=e&&e.voucher;1==y&&t.push({type:14,value:"102|10202"});var b=o.get();b&&b.subVal&&t.push({type:14,value:b.subVal}),i=i?i:{type:"",val:""},i&&i.type&&+i.type>0&&i.val&&""!==i.val&&t.push({type:i.type,name:i.name,value:i.val});var w=this.getCurrentKeyWord();if(w){var T=(w.type||"").toString().toLowerCase(),x=w.id||w.word,C=n.traType;T?/\D/.test(T)&&(T=C[T]?C[T]:7):T=7,t.push({type:T,value:x})}return t},saveQueryString:function(t){var e=Lizard.P,s=e("ctype"),l=e("price"),c=e("star"),p=e("kwd"),h=e("place"),f=e("lat"),_=e("lng")||e("lon"),m=e("cityid"),v=e("cityname"),g=e("sort");if(m&&m!=a.getAttr("ctyId")&&(this.clearAll(),r.remove()),m&&(a.setAttr("ctyId",m),v=v||i[m]||"",a.setAttr("ctyName",v)),f&&+f>0&&_&&+_>0&&h&&""!==h){d.setAttr("gps",{address:h,location:_+","+f,city:v,lng:+_,lat:+f}),r.setAttr("nearby",!0),m&&(this.setCurrentCity({CityID:m}),this.addHistoryCity(m,v));for(var y=a.getAttr("qparams")||[],b=0,w=y.length;w>b;b++)if(9==y[b].type){y.splice(b,1);break}y.push({type:9,value:f+"|"+_+"|"+n.SEARCH_DISTANCE}),a.setAttr("qparams",y)}if(s&&(o.remove(),a.setAttr("ctype",n.index2ctype[s])),c&&1==s&&u.setAttr("star",c.replace(",","|")),l&&u.setAttr("price",l),p&&(p=p.split("|"),this.addHistoryKeyWord(p[1],p[0],p[2])),g){var T=g.indexOf("/")>-1?"/":"|";g=g.split(T),a.setAttr("sortRule",g[0]),a.setAttr("sortType",g[1]||1)}t&&t()},getCityIdByName:function(t){var e;return t&&(e=i[t]),!1},saveHotWordParam:function(t){var e=a.get();if(h.clearAll(),r.removeAttr("nearby"),t.pos){var i=t.pos.type,l=t.pos.val,c=t.pos.lat,d=t.pos.lon,p=t.pos.name;s.set({type:i,val:l,name:p,pos:{type:3,lat:c,lon:d,name:p}})}if(t.price&&n.priceText[t.price]&&u.setAttr("price",{val:t.price,txt:n.priceText[t.price]}),t.trait&&n.traitText[t.trait]&&u.setAttr("trait",{val:t.trait,txt:n.traitText[t.trait]}),t.star){var f=t.star.split(","),_={};for(var m in f)m=f[m],n.starText[m]&&(_[m]=n.starText[m]);_&&u.setAttr("star",_)}if(t.brand&&t.brand.length>0)for(var v in t.brand)v=t.brand[v],v&&v.val&&v.key&&u.setAttr("brand",{flag:1,val:v.val,txt:v.key});if(t.markland&&h.setCurrentKeyWord({id:t.markland.id,word:t.markland.name,type:"markland"}),t.hotel&&h.setCurrentKeyWord({id:t.hotel.id,word:t.hotel.name,type:"hotelid"}),t.keyword&&h.setCurrentKeyWord({word:t.word}),t.activity&&h.setCurrentKeyWord({id:t.activity.id,word:t.activity.name,type:"activity"}),t.district&&h.setCurrentKeyWord({id:t.district.id,word:t.district.name,type:"district"}),t.isweekend&&a.setAttr("weekendsAvailable",t.isweekend),t.multishop&&u.setAttr("multiShop",t.multishop),t.voucher&&u.setAttr("voucher",t.voucher),t.sort&&(a.setAttr("sortRule",t.sort.stype),a.setAttr("sortType",t.sort.sval)),t.classty){var g,y,b,w;t.classty.parent?(g=t.classty.parent.val,y=n.groupType[g],b=t.classty.val,w=t.word):(g=t.classty.val,y=n.groupType[g]),o.setAttr("tuanType",g),y&&(o.setAttr("category",y.category),o.setAttr("name",y.name),o.setAttr("tuanTypeIndex",y.index)),o.setAttr("subVal",b),o.setAttr("subName",w),a.setAttr("ctype",g)}var T=h.getGroupQueryParam();a.setAttr("qparams",T),a.setAttr("ctyId",e.ctyId),a.setAttr("ctyName",e.ctyName)}};return h}),define("TuanFilters",["cBase","cUtility","cWidgetFactory","cUIMask","cUIScroll","DropDown","Tab","StringsData","TuanModel","TuanStore","StoreManage"],function(t,e,i,n,a,s,o,r,l,c,d){var p,u=$.extend,h={weizhiquyu:"位置区域"},f=!1,m="youth"===e.getAppSys(),v=c.GroupCategoryFilterStore.getInstance(),g=c.GroupSortStore.getInstance(),y=c.GroupSearchStore.getInstance(),b=l.TuanConditionModel.getInstance(),w=c.GroupConditionStore.getInstance(),T=c.GroupCustomFilters.getInstance(),x=c.TuanHistoryCityListStore.getInstance(),C=c.GroupPositionFilterStore.getInstance(),S=["price","day","trait","distance","brand"],k=_.template(['<%if(["all", "hotel", "catering"].indexOf(category)!=-1){%>','<div class="pop_filter_chkitem" data-type="weekendsAvailable" data-text="周末可用">周末可用','<div class="pop_filter_label">','<input type="checkbox" id="weekends"<%if(weekendsAvailable==1){%> checked<%}%> /><label for="weekends"></label>',"</div>","</div>","<%}%>",'<%if(category=="hotel"){%>','<div class="pop_filter_chkitem" data-type="multiShop" data-text="多店可用">多店可用','<div class="pop_filter_label">','<input type="checkbox" id="multiShop"<%if(multiShop==1){%> checked<%}%> /><label for="multiShop"></label>',"</div>","</div>",'<div class="pop_filter_chkitem" data-type="voucher" data-text="代金券">代金券','<div class="pop_filter_label">','<input type="checkbox" id="voucher"<%if(voucher==1){%> checked<%}%> /><label for="voucher"></label>',"</div>","</div>","<%}%>"].join("")),I=_.template(['<ul class="pop_filter_tabs">','<li data-tab="price"><i class="pop_filter_point"<%if(!customdata.price || (customdata.price && customdata.price.val == "1|1")){%> style="display:none"<%}%>></i>价格</li>','<%if(category=="vacation"){%><li data-tab="day"><i class="pop_filter_point"<%if(!customdata.day){%> style="display:none"<%}%>></i>天数</li><%}%>','<%if(category=="hotel"){%><li data-tab="star"><i class="pop_filter_point"<%if(!customdata.star){%> style="display:none"<%}%>></i>星级</li><%}%>','<%if(category=="hotel"){%><li data-tab="brand"><i class="pop_filter_point"<%if(!customdata.brand){%> style="display:none"<%}%>></i>品牌</li><%}%>','<%if(category=="hotel"){%><li data-tab="trait"><i class="pop_filter_point"<%if(!customdata.trait){%> style="display:none"<%}%>></i>特色</li><%}%>','<%if((isNearBy && ["all", "hotel", "catering", "ticket", "entertainment"].indexOf(category)!=-1) || isUniversityNearBy){%><li data-tab="distance"><i class="pop_filter_point"<%if(!customdata.distance){%> style="display:none"<%}%>></i>距离</li><%}%>',"</ul>"].join("")),A=_.template(['<li data-filter="brand"<%if(!val){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-filter="brand" data-value="<%=a.val%>" data-text="<%=a.txt%>"<%if(a.val==val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div>',"</li>","<%})%>"].join("")),P=_.template(['<li data-filter="trait"<%if(!val){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-filter="trait" data-value="<%=a.val%>" data-text="<%=a.txt%>"<%if(a.val==val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div>',"</li>","<%})%>"].join("")),L=_.template(['<div class="pop_filter_lefttab">','<ul class="pop_filter_tabs">',"<%_.each(tuanType, function(v){%>",'<li class="J_categoryTabLabel<%if(v.val==tuanTypeVal){%> choosed<%}%>"><%=v.txt%></li>',"<%})%>","</ul>","</div>",'<div class="pop_filter_righttab">',"<%_.each(tuanType, function(v){%>",'<div class="J_categoryTabPanel" style="height:285px;<%if(v.val!=tuanTypeVal){%>display:none<%}%>">','<ul class="pop_filter_baselist" style="min-height:285px">','<li data-type="<%=v.val%>"<%if(v.val==tuanTypeVal && typeof subVal == "undefined"){%> class="choosed"<%}%>><div class="txt01"><%=v.val>0 ? "全部" : ""%><%=v.txt%></div><span class="txt02"><%=v.groupCount%></span></li>',"<%_.each(subTuanType, function(s){%>","<%if (s.parentType == v.val){%>",'<li data-type="<%=v.val%>" data-value="<%=s.val%>" data-name="<%=s.txt%>"<%if(typeof subVal !== "undefined" && s.val==subVal){%> class="choosed"<%}%>><div class="txt01"><%=s.txt%></div><span class="txt02"><%=s.groupCount%></span></li>',"<%}%>","<%})%>","</ul>","</div>","<%})%>","</div>"].join("")),D=_.template(['<div class="pop_filter_lefttab">','<ul class="pop_filter_tabs">','<%if(Zone.length){%><li class="J_positionTabLabel<%if(curr.type==5){%> choosed<%}%>">商业区</li><%}%>','<%if(Location.length){%><li class="J_positionTabLabel<%if(curr.type==4){%> choosed<%}%>">行政区</li><%}%>','<%if(tuanType!=7 && AirportStation.length){%><li class="J_positionTabLabel<%if(curr.type==-4){%> choosed<%}%>">机场车站</li><%}%>','<%if(tuanType!=7 && SubwayLine.length){%><li class="J_positionTabLabel<%if(curr.type==-3){%> choosed<%}%>">地铁线</li><%}%>','<%if(tuanType!=7 && Attraction.length){%><li class="J_positionTabLabel<%if(curr.type==-2){%> choosed<%}%>">景点</li><%}%>','<%if(tuanType!=7 && College.length){%><li class="J_positionTabLabel<%if(curr.type==-1){%> choosed<%}%>">大学周边</li><%}%>',"</ul>","</div>",'<div class="pop_filter_righttab">',"<%if(Zone.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=5){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=5){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Zone, function(val){%>",'<li data-type="5" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==5&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(Location.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=4){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=4){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Location, function(val){%>",'<li data-type="4" data-value="<%=val.val%>" data-text="<%=val.txt%>"<%if(curr.type==4&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && AirportStation.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-4){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=-4){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(AirportStation, function(val){%>",'<li data-type="-4" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-4&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && SubwayLine.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=19){%> style="height:285px;display:none"<%}%> id="J_subwayLine">','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.line){%> class="backwards"<%}%>><div class="txt01">不限</div></li>',"<%_.each(SubwayLine, function(val){%>",'<li data-type="-5" data-value="<%=val.val%>" data-text="<%=val.txt%>" class="arr_r<%if(curr.line==val.val){%> backwards<%}%>"><div class="txt01"><%=val.txt%></div><span class="txt03"><%if(curr.line==val.val&&curr.type==-3){%><%=curr.name%><%}%></span><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && Attraction.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-2){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=-2){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Attraction, function(val){%>",'<li data-type="-2" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-2&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && College.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-1){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.pos||curr.type!=-1){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(College, function(val){%>",'<li data-type="-1" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-1&&curr.pos.lat==val.lat&&curr.pos.lon==val.lon){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>",'<div class="J_positionTabPanel" style="height:285px;overflow:hidden;display:none" id="J_subwayStation">','<ul class="pop_filter_baselist" style="min-height:285px;"></ul>',"</div>","</div>"].join("")),E=_.template(['<li data-type="-3"><div class="pop_filter_back">返回</div></li>','<li data-type="19" data-line="<%=lineId%>"<%if(curr.val==lineId&&curr.type==19){%> class="choosed"<%}%> data-text="<%=lineName%>"><div class="txt01">全线</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-type="-3" data-value="<%=a.val%>" data-line="<%=lineId%>" data-pos=\'<%=JSON.stringify(a.pos)%>\' data-text="<%=a.txt%>"<%if(curr.val==a.val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div><span class="txt02"><%=a.groupCount%></span>',"</li>","<%})%>"].join(""));return p=new t.Class({__propertys__:function(){var t=this;this.options={},this.page=null,this.mask=new n({onCreate:function(){var e=this;this.root.on("click",function(){t.options.categoryPanel.hide(),t.options.positionPanel.hide(),t.options.filterPanel.hide(),t._categoryStatus=!1,t._positionStatus=!1,t._customFilterStatus=!1,e.hide()})}})},initSort:function(){var t=this,e=g.getAttr("sortTypeIndex")||0,i=y.getAttr("sortRule"),n=y.getAttr("sortType"),a=t.options;this.sort=new s({trigger:a.sortTrigger,panel:a.sortPanel,label:a.sortLabel,selectedIndex:e,selectedItemCls:"choosed",onShow:function(){a.categoryPanel.hide(),a.positionPanel.hide(),a.filterPanel.hide(),t.mask.hide(),t._categoryStatus=!1,t._positionStatus=!1,t._customFilterStatus=!1},onSelect:function(e){var i=$(e),n=i.attr("data-id"),a=i.attr("data-type"),s=+this.selectedIndex>=0?this.selectedIndex:0;g.setAttr("sortTypeIndex",s),y.setAttr("sortRule",n),2==n&&m&&(a=8),y.setAttr("sortType",a),t.getListData()}});var o=this.sort.panel.find('[data-id="'+i+'"][data-type="'+n+'"]');o=o&&o[0]||$(this.sort.getItemByIndex(e))[0],this.sort.select(o,!0),a.sortPanel.on("touchmove",function(t){t.preventDefault()})},initCategory:function(){var t=this,e=this.options.categoryTrigger,i=this.options.categoryPanel;this.renderCategory(),e.on("click",function(){t._categoryStatus?(i.hide(),t.mask.hide(),t._categoryStatus=!1):(t.options.positionPanel.hide(),t.options.filterPanel.hide(),t._positionStatus=!1,t._customFilterStatus=!1,t.sort.hide(),i.show(),t.mask.show(),i.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),i.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),t._categoryStatus=!0,void 0===t._categoryInited&&(t.initCategoryTab(),t._categoryInited=!0))}),i.on("touchmove",function(t){t.preventDefault()})},initCategoryTab:function(){var t=this,e=this.page.$el,i=e.find(".J_categoryTabLabel"),n=e.find(".J_categoryTabPanel");this.categoryTab=new o({label:i,panel:n,isScroll:!0,labelSelectedClass:"choosed",labelSelectedIndex:v.getAttr("tuanTypeIndex")||0,itemClass:".pop_filter_baselist li",itemSelectedClass:"choosed",onSelect:function(e){var i=e.data("type"),a=e.data("value")||"",s=e.data("name"),o=r.groupType[i];n.find(".choosed").removeClass("choosed"),e.addClass("choosed"),t.page.updateTitle(o.name),7==i&&x.removeAttr("nearby");var l=T.getAttr("distance");d.clearSpecified(!1),l&&d.isNearBy()&&T.setAttr("distance",l),t.clearCustomFilter(!0),v.setAttr("tuanType",i),v.setAttr("category",o.category),v.setAttr("name",o.name),v.setAttr("tuanTypeIndex",o.index),v.setAttr("subVal",a),v.setAttr("subName",s),y.setAttr("qparams",d.getGroupQueryParam()),y.setAttr("ctype",i),t.options.categoryTrigger.html(s||r.groupType[i].name),t.resetPosition(i),t.getListData(),t.renderFilter(o.category),t.mask.hide(),t.options.categoryPanel.hide(),t._categoryStatus=!1}})},renderCategory:function(){var t={},e=w.get(),i=v.get()||{},n=this.options.categoryTrigger;if(t.tuanTypeVal=i.tuanType||y.getAttr("ctype")||0,i.subVal&&(t.subVal=i.subVal),n.html(i.subName||r.groupType[t.tuanTypeVal].name),e&&$.isArray(e.categroy)&&e.categroy.length>0){var a=e.categroy[0].groupCondition;a&&$.isArray(a)&&a.length>0&&(t.tuanType=$.grep(a,function(t){return 16==t.type}),t.subTuanType=$.grep(a,function(t){return 32==t.type}),this.options.categoryPanel.html(L(t)))}},updateCategoryName:function(){var t=v.getAttr("tuanTypeIndex")||0,e=v.getAttr("tuanType")||0;this.categoryTab?this.categoryTab.switch(t):this.renderCategory(),this.options.categoryTrigger.html(r.groupType[e].name)},initPosition:function(){var t=this,e=this.options.positionTrigger,i=this.options.positionPanel;this.renderPosition(),e.on("click",function(){f||(t._positionStatus?(i.hide(),t.mask.hide(),t._positionStatus=!1):(t.options.categoryPanel.hide(),t.options.filterPanel.hide(),t._categoryStatus=!1,t._customFilterStatus=!1,t.sort.hide(),i.show(),t.mask.show(),i.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),i.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),void 0===t._positionInited&&(t.initPositionTab(),t._positionInited=!0),t._positionStatus=!0))}),i.on("touchmove",function(t){t.preventDefault()})},initPositionTab:function(){function t(t){c.find(".choosed").removeClass("choosed"),c.find("li:first-child").addClass("choosed"),t.addClass("choosed").siblings().removeClass("choosed")}function e(){p.find(".backwards").removeClass("backwards"),p.find(".txt03").text("")}function i(i){t(i),e()}var n=this,s=this.page.$el,l=s.find(".J_positionTabLabel"),c=s.find(".J_positionTabPanel"),p=s.find("#J_subwayLine"),u=s.find("#J_subwayStation"),f={5:0,4:1,"-4":2,"-3":3,19:3,"-2":4,"-1":5};this.positionTab=new o({label:l,panel:c,isScroll:!0,labelSelectedClass:"choosed",labelSelectedIndex:f[C.getAttr("type")]||0,itemClass:".pop_filter_baselist li",itemSelectedClass:"choosed",onSwitch:function(){u.hide()},onSelect:function(t){var e,s,o=t.data("type"),l=t.data("text"),c=y.get(),f=d.getCurrentKeyWord();if(d.isNearBy()){x.setAttr("nearby",!1),T.removeAttr("distance");var _=n.page.$el.find('#J_filterTabLabel li[data-tab="distance"]'),m=n.page.$el.find('#J_filterTabPanel div[data-tab="distance"]');_.hide(),m.hide(),_.find("i").hide(),n.updateCustomFilterIcon(),y.removeAttr("pos")}if(f&&((0>o||"5"==o)&&d.removeCurrentKeyWord(),"4"==o&&"location"==f.type&&d.removeCurrentKeyWord()),c){if(+c.ctyId>0){var v=d.findCityInfoById(c.ctyId);v&&y.setAttr("ctyName",v.name)}c.edate||y.setAttr("edate",c.bdate)}if(l)switch(o){case 5:i(t),C.set({type:5,name:l,val:t.data("value"),pos:t.data("pos")});break;case 4:i(t),C.set({type:4,name:l,val:t.data("value")});
break;case 19:i(t),e=t.data("line"),s=p.find('li[data-value="'+e+'"]'),C.set({type:19,name:l,line:e,val:e}),u.hide(),p.show(),p.find(".txt03").text(""),p.find("li:first-child").removeClass("choosed"),s.addClass("backwards").siblings().removeClass("backwards");break;case-5:if(e=t.data("value"),e==u.data("line"))return p.hide(),void u.show();var g=n.getSubwayStation(e,l),b=u.find("ul");p.hide(),u.data("line",e).show(),b.html(E(g));var w=new a({wrapper:u,scroller:b});return void w.scrollTo(0,0,0);case-3:case-4:case-2:case-1:var S={type:o,name:l,pos:t.data("pos")},k=t.data("value");k&&(S.val=k),-3==o?(e=t.data("line"),s=p.find('li[data-value="'+e+'"]'),S.line=e,p.show(),u.hide(),p.find("li:first-child").removeClass("choosed"),p.find(".txt03").text(""),s.addClass("backwards").siblings().removeClass("backwards"),s.find(".txt03").text(l),t.addClass("choosed").siblings().removeClass("choosed")):i(t),C.set(S),T.setAttr("distance",{val:1,txt:"1公里内"})}else{if(-3==o)return p.show(),void u.hide();i(t),C.remove(),T.removeAttr("distance")}n.updatePositionName(l||h.weizhiquyu);var I=y.getAttr("ctype");0>o?n.renderFilter(r.groupType[I].category,!0):(T.removeAttr("distance"),n.renderFilter(r.groupType[I].category,!1)),n.updateCustomFilterIcon();var A=d.getGroupQueryParam();y.setAttr("qparams",A),C.setAttr("ctyId",c.ctyId),n.getListData(),n.mask.hide(),n.options.positionPanel.hide(),n._positionStatus=!1}})},renderPosition:function(t,e){var i={Zone:[],Location:[],College:[],AirportStation:[],SubwayLine:[],Attraction:[]},n=this.options.positionPanel,a=this.options.positionTrigger,s=w.get();if(i.curr=C.get()||{},this.updatePositionName(),t=t||y.getAttr("ctype")||0,i.tuanType=t,s&&$.isArray(s.categroy)&&s.categroy.length>0){var o=$.grep(s.categroy,function(e){return e.ctype==t});if(o&&$.isArray(o)&&o.length>0){var r=s.categroy[0].groupCondition;r&&$.isArray(r)&&r.length>0&&$.each(r,function(t,e){switch(e.type){case 2:i.Location.push(e);break;case 4:i.Zone.push(e);break;case 8:i.College.push(e);break;case 256:case 512:i.AirportStation.push(e);break;case 1024:i.SubwayLine.push(e);break;case 4096:i.Attraction.push(e)}})}else a.hide();7===+t?i.Zone.length||i.Location.length||i.College.length?(a.show(),n.html(D(i)),e&&e()):a.hide():i.Zone.length||i.Location.length||i.College.length||i.AirportStation.length||i.SubwayLine.length||i.Attraction.length?(a.show(),n.html(D(i)),e&&e()):a.hide()}},resetPosition:function(t){var e=this,i=1;i|=2,i|=4,i|=8,i|=64,i|=128,i|=256,i|=512,i|=1024,i|=2048,i|=4096,i|=8192,f=!0,this.options.positionTrigger.html(h.weizhiquyu),b.setParam({ctyId:y.getAttr("ctyId"),categroy:t,type:i}),b.excute(function(){e.renderPosition(t,function(){f=!1,e._positionInited=void 0})},function(){},!1,this)},updatePositionName:function(t){var e=this.options.positionTrigger;if(t)e.html(t);else{var i=C.get()||{},n=i.name;-6==i.type&&(n=h.weizhiquyu),e.html(n||h.weizhiquyu)}},initCustomFilter:function(){var t=this,e=t.options.customFilter,i=this.page.$el,n=i.find("#J_filterPanel"),a=i.find("#J_checkboxWrap"),s=i.find(".pop_filter_cancel"),o=i.find(".pop_filter_sure"),r=i.find(".pop_filter_clear");this.renderFilter(v.getAttr("category")),this.updateCustomFilterIcon(),e.on("click",function(){t._customFilterStatus?(n.hide(),t.mask.hide(),t._customFilterStatus=!1):(t.sort.hide(),t.options.categoryPanel.hide(),t.options.positionPanel.hide(),t._categoryStatus=!1,t._positionStatus=!1,n.show(),t.mask.show(),n.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),n.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),void 0===t._customFilterInited&&(t.initFilterTab(),t._customFilterInited=!0),t._customFilterStatus=!0)}),s.on("click",function(){n.hide(),t.mask.hide(),t._customFilterStatus=!1}),o.on("click",function(){n.hide(),t.mask.hide(),t.sureCustomFilter(),t._customFilterStatus=!1}),r.on("click",function(){t.clearCustomFilter(),t._customFilterStatus=!1}),a.on("click","div[data-type]",function(e){if("LABEL"!=e.target.tagName){var i=$(e.currentTarget),n=i.data("type"),a=i.find("input:checked").length;"weekendsAvailable"==n?y.setAttr("weekendsAvailable",a?1:0):T.setAttr(n,a?1:0),r[t.customFilterSelectedCount()?"removeClass":"addClass"]("sta-disabled")}}),n.on("touchmove",function(t){t.preventDefault()})},initFilterTab:function(){var t=this,e=this.page.$el,i=e.find("#J_filterTabLabel"),n=e.find("#J_filterTabPanel"),a=e.find("input[data-value]"),s=e.find(".pop_filter_clear");i.on("click","li",function(e){var a=$(e.currentTarget);if(!a.hasClass("choosed")){var s=a.data("tab");i.find(".choosed").removeClass("choosed"),a.addClass("choosed"),n.find("div[data-tab]").hide(),t.renderTabWrap(s,n,!0)}}),n.on("click",".pop_filter_baselist li",function(e){var n=$(e.currentTarget),o=n.data("value"),r=n.data("text"),l=n.data("filter");if(S.indexOf(l)>-1)n.addClass("choosed").siblings(".choosed").removeClass("choosed"),o?T.setAttr(l,{val:o,txt:r}):T.removeAttr(l),i.find('li[data-tab="'+l+'"]>i')[o?"show":"hide"]();else if("star"==l)if(o){o=o.toString();var c=T.getAttr("star")||{};a[0].checked=n.parent().find("input:checked").length?!1:!0,n.find("input:checked").length?c[o]=r:delete c[o],T.setAttr("star",c),i.find('li[data-tab="star"]>i')[$.isEmptyObject(c)?"hide":"show"]()}else a.each(function(t,e){t>0&&(e.checked=!1)}),T.removeAttr("star"),i.find('li[data-tab="star"]>i').hide();s[t.customFilterSelectedCount()?"removeClass":"addClass"]("sta-disabled")})},renderTabWrap:function(t,e,i){var n,s,o,r=T.get(),l=e.find('div[data-tab="'+t+'"]');switch(i&&l.show(),t){case"price":7==y.getAttr("ctype")?(l.find('li[data-ptype="0"]').hide(),l.find('li[data-ptype="1"]').show()):(l.find('li[data-ptype="0"]').show(),l.find('li[data-ptype="1"]').hide()),l.find(".choosed").removeClass("choosed"),r&&r.price?l.find('li[data-value="'+r.price.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed");break;case"day":l.find(".choosed").removeClass("choosed"),r&&r.day?l.find('li[data-value="'+r.day.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed");break;case"star":if(r&&r.star){var c=r.star;l.find("input:checked")[0].checked=!1,_.each(c,function(t,e){l.find('input[data-value="'+e+'"]')[0].checked=!0})}else l.find("input[data-value]").each(function(t,e){e.checked=0>=t});break;case"brand":var d=l.find("#J_brand");if(d.length){var p=d.parent();p.css({overflow:"hidden","max-height":"295px"}),d.html(A(this.getDataFromCondition("brand",1))),n=new a({wrapper:p,scroller:d})}break;case"trait":var u=l.find("#J_trait");if(u.length){var h=u.parent();h.css({overflow:"hidden","max-height":"295px"}),u.html(P(this.getDataFromCondition("trait",8192))),s=new a({traitWrapper:h,scroller:u})}break;case"distance":l.data("scrolled")||(o=new a({wrapper:l,scroller:l.find("ul")}),l.data("scrolled","true")),l.find(".choosed").removeClass("choosed"),r&&r.distance?l.find('li[data-value="'+r.distance.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed")}},renderFilter:function(t,e){var i=this.page.$el,n=T.get(),a=i.find("#J_checkboxWrap"),s=i.find("#J_filterTabLabel"),o=i.find("#J_filterTabPanel"),r={category:t,weekendsAvailable:y.getAttr("weekendsAvailable"),multiShop:n&&n.multiShop,voucher:n&&n.voucher},l=k(r);l?a.show().html(l):a.hide(),s.html(I({category:t||"all",isNearBy:d.isNearBy(),customdata:n||{},isUniversityNearBy:e})),o.find("div[data-tab]").hide(),this.renderTabWrap(s.find("li:first-child").addClass("choosed").data("tab"),o,!0)},getDataFromCondition:function(t,e){var i={val:"",arr:[]},n=w.get(),a=T.getAttr(t);if(a&&a.val&&(i.val=a.val),n&&$.isArray(n.categroy)&&n.categroy.length>0){var s=n.categroy[0].groupCondition;s&&$.isArray(s)&&s.length>0&&(i.arr=$.grep(s,function(t){return t.type==e}))}return i},getSubwayStation:function(t,e){var i={lineId:t,lineName:e,arr:[]},n=w.get();if(i.curr=C.get()||{},n&&$.isArray(n.categroy)&&n.categroy.length>0){var a=n.categroy[0].groupCondition;a&&$.isArray(a)&&a.length>0&&(i.arr=$.grep(a,function(e){return e.parentType==t}))}return i},clearCustomFilter:function(t){var e=this,i=d.isNearBy(),n=this.page.$el,a=n.find(".pop_filter_clear");if(!a.hasClass("sta-disabled")){var s=n.find("#J_filterTabLabel"),o=n.find("#J_filterTabPanel");y.removeAttr("weekendsAvailable"),T.removeAttr("multiShop"),T.removeAttr("voucher");var r=S.concat(["star"]);t&&i&&r.splice(r.indexOf("distance"),1),_.each(r,function(t){T.removeAttr(t),e.renderTabWrap(t,o,!1)}),s.find(".choosed").removeClass("choosed"),s.find("li i").hide(),o.find("div[data-tab]").hide(),this.renderTabWrap(s.find("li:first-child").addClass("choosed").data("tab"),o,!0),n.find("#J_checkboxWrap input:checked").each(function(t,e){e.checked=!1}),this.updateCustomFilterIcon()}},sureCustomFilter:function(){var t=y.get(),e=d.getGroupQueryParam();t&&(t.edate||y.setAttr("edate",t.bdate)),y.setAttr("qparams",e),this.getListData(),this.updateCustomFilterIcon()},customFilterSelectedCount:function(){var t=!1,e=d.getGroupQueryParam(),i=y.getAttr("weekendsAvailable"),n=e&&e.length>0&&e.filter(function(e){!t&&(t=9===parseInt(e.type,10));var i=parseInt(e.type,10);return 14==i&&e.value==v.getAttr("subVal")?!1:-1!==[1,2,3,9,14].indexOf(i)}).length;return 1==i&&(n+=1),!T.getAttr("distance")&&t&&(n-=1),"1|1"==T.getAttr("price.val")&&(n-=1),n>0?n:0},updateCustomFilterIcon:function(){var t=this,e=this.page.$el,i=t.options.customFilter,n=t.customFilterSelectedCount(),a=e.find(".pop_filter_clear");i.find(".fil_num").text(n)[n>0?"show":"hide"](),a[n>0?"removeClass":"addClass"]("sta-disabled")},getListData:function(){y.setAttr("pageIdx","1"),this.page.isLoading=!0,window.scrollTo(0,0),this.page.showLoading(),this.page.hideBottomLoading(),this.page.getGroupListData()},initialize:function(t){u(this.options,t),this.page=this.options.page,this.initCategory(),this.initPosition(),this.initSort(),this.initCustomFilter()}}),p.getInstance=function(t){return new p(t)},p}),define("SmoothSlide",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}function a(t){if(t&&!$(t).data("loaded")){var e=new Image;e.src=t.dataset["data-src"]||t.getAttribute("data-src"),e.onload=function(){t.src=e.src,$(t).data("loaded",!0)}}}var s,o="SmoothSlide",r=function(){},l=null,c=/\-?[0-9]+\.?[0-9]*/g,d=function(){var t=$.browser,e="";return e=t.webkit?"-webkit-":t.firefox?"-moz-":t.ie?"-ms-":""}(),p=d.replace(/\-/g,"");i.hasWidget(o)||(s=new t.Class({__propertys__:function(){this.options={container:l,autoplay:5e3,currentIndex:0,direction:s.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:l,tpl:'<div class="cui-slide"><div class="cui-slide-imgsouter"><div class="cui-slide-imgsinter" style="width:9999px"><%for(var i=0,len=data.length;i<len;i++){%><%var item = data[i]%><div class="cui-slide-img-item"><img data-href="<%=item.href%>" data-src="<%=item.src%>" data-img-id="<%=item.id%>" data-img-title="<%=item.title%>"/></div><%}%></div></div></div>',itemCls:".cui-slide-img-item",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:r,onSwitchEnd:r,onInit:r}},initialize:function(t){var e;n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.container=e.container,this.tpl=e.tpl,this.container&&this.container.length&&(this.render(e.source,e.currentIndex),this._isInteractive()&&this._bindEvents(),e.autoplay&&this._autoplay())},_isInteractive:function(){var t=this.options;return t.pageSize<t.source.length},_createLayout:function(){var t=this.source;this.container.html(_.template(this.tpl)({data:t})),this.source&&1===this.source.length&&this.container.find(".pics_show_box_in").css("width","100%")},_autoplay:function(){var t=this;clearTimeout(this.__autoplayTimer),this.__autoplayTimer=setTimeout(function(){t.next(!0),t._autoplay()},this.options.autoplay)},_bindEvents:function(){var t=this._runtime,e=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),e.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),e.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),e.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),t.root.on(p+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var t=this._runtime,e=this.container;e.off("touchmove",this.__moveHandler),e.on("touchstart",this.__touchStartHandler),e.on("touchend",this.__touchEndHandler),t.root.off(p+"TransitionEnd",this.__transitionEndHandler)},_current:0,count:function(){return this.source.length},render:function(t,e){clearTimeout(this.__autoplayTimer);var i=this.options;return this.source=t,this._createLayout(t),this.items=this.container.find(i.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._showCurrent(this._runtime.root,e),this._prefetch(i.direction),i.onInit.call(this,this._current),this},current:function(){return this._current},next:function(t){this.goto(this._current+this.options.pageSize,s.LEFT,t)},prev:function(){this.goto(this._current-this.options.pageSize,s.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(t,e,i){var n=this,a=this._runtime,o=this.options,r=o.direction,l=o.autoplay&&i,c=a.count,d=a.width;l&&(0>t?t=c-1:t>=c&&(t=0)),t>=0&&c>t?(s.animate(a.root,r*d*this._current,r*d*t,this.options.animationDuration),this._current=t,this._prefetch(e),setTimeout(function(){n.options.onSwitch.call(n,t,n.source[t])},10)):this.goto(this._current)},_showCurrent:function(t,e){var i=this._runtime;s.translate(i.root,this.options.direction*i.width*e,0),this._current=e,this._prefetch()},_prefetch:function(t){if(!(this.options.prefetch<0)){t||(t=s.LEFT);var e,i=this._current,n=this.options.prefetch,o=n*t;do e=this.items[i+n-o*t],e=e&&e.children[0],e&&a(e);while(o-=t)}},_getSwipeDirection:function(t,e){var i,n=e-t,a=Math.abs(n);return a>0&&a>this.options.minSwipe&&(i=n/a),i},_getRuntimeEnv:function(){var t=this.items,e=this.options,i=$(t[0]),n=i.parent(),a=n.parent(),s=a.offset(),o=this.count();return{width:e.width||s.width,root:n,stage:a,count:o}},__touchStartHandler:function(t){var e=t.touches[0],i=this._getRuntimeEnv().root,n=i.css(d+"transform").match(c);n=n&&n[0]||0,this.__lastTouchStartPos={left:Number(n),x:e.pageX,y:e.pageY,t:+new Date}},__touchEndHandler:function(t){var e=this.__lastTouchStartPos,i=this._getSwipeDirection(e.x,t.changedTouches[0].pageX);this[i===s.LEFT?"next":i===s.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(t){var e=this._current,i=this;setTimeout(function(){i.options.onSwitchEnd.call(i,t,e,i.source[e])},10)},__moveHandler:function(t){if(t.preventDefault(),!(t.touches.length>1||t.scale&&1!==t.scale)){var e=t.touches[0],i=this._getRuntimeEnv(),n=i.root,a=this.__lastTouchStartPos,o=a.left+e.pageX-a.x;s.translate(n,o,0)}}}),s.LEFT=-1,s.RIGHT=1,s.translate=function(t,e,i){var n=t[0],a=n&&n.style;a&&(t.css(d+"transition",i+"ms ease-out"),t.css(d+"transform","translate("+e+"px,0) translateZ(0)"))},s.animate=function(t,e,i,n){this.translate(t,i,n)},i.register({name:o,fn:s}))}),define("TabSlide",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}var a,s="TabSlide",o=function(){},r=null,l=/\-?[0-9]+\.?[0-9]*/g,c=function(){var t=$.browser,e="";return e=t.webkit?"-webkit-":t.firefox?"-moz-":t.ie?"-ms-":""}(),d=c.replace(/\-/g,"");i.hasWidget(s)||(a=new t.Class({__propertys__:function(){this.options={container:r,currentIndex:0,direction:a.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:r,tpl:'<div class="sw_clip"><%var num =Math.ceil(data.length / 6);%><%for(var i = 1; i <= num ; i++){%><ul class="sw_con" js_index="<%=i%>"  ><%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%><li data-json=<%=JSON.stringify(data[index])%>><%=data[index].word%></li><%}%></ul><%}%></div><%if(num > 1){%><p class="sw_nav"><%for(var ni=1; ni<= num; ni++){%><i js_index="<%=ni%>" class="<%if(ni==1){%>current<%}%>"></i><%}%></p><%}%>',itemCls:".sw_con",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:o,onSwitchEnd:o,onInit:o}},initialize:function(t){var e;if(n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.container=e.container,this.tpl=e.tpl,this.container&&this.container.length){this.render(e.source,e.currentIndex);var i=this;window.addEventListener("resize",$.proxy(i._resize,i)),this._isInteractive()&&this._bindEvents()}},_isInteractive:function(){var t=this.options;return t.source.length/6>1},_createLayout:function(){var t=this.source;this.container.html(_.template(this.tpl)({data:t}))},_bindEvents:function(){var t=this._runtime,e=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),e.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),e.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),e.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),t.root.on(d+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var t=this._runtime,e=this.container;e.off("touchmove",this.__moveHandler),e.on("touchstart",this.__touchStartHandler),e.on("touchend",this.__touchEndHandler),t.root.off(d+"TransitionEnd",this.__transitionEndHandler)},destroy:function(){var t=this;t.container.innerHTML="",window.removeEventListener("resize",t._resize)},_current:0,count:function(){return Math.ceil(this.source.length/6)},render:function(t,e){var i=this.options;return this.source=t,this._createLayout(t),this.items=this.container.find(i.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,e),this},current:function(){return this._current},next:function(t){this.goto(this._current+this.options.pageSize,a.LEFT,t)},prev:function(){this.goto(this._current-this.options.pageSize,a.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(t){var e=this._runtime,i=this.options,n=i.direction,s=e.count,o=e.width;t>=0&&s>t&&(a.animate(e.root,n*o*this._current,n*o*t,this.options.animationDuration),this._current=t,_.each(this.container.find(".sw_nav>i"),function(e){$(e).attr("js_index")==t?$(e).addClass("current"):$(e).removeClass("current")}))},_resize:function(){this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,this._current)},_showCurrent:function(t,e){var i=this._runtime;a.translate(i.root,this.options.direction*i.width*e,0),this._current=e},_getSwipeDirection:function(t,e){var i,n=e-t,a=Math.abs(n);return a>0&&a>this.options.minSwipe&&(i=n/a),i},_getRuntimeEnv:function(){var t=this.items,e=this.options,i=$(t[0]),n=i.parent(),a=n.parent(),s=a.offset(),o=this.count();return{width:e.width||s.width,root:n,stage:a,count:o}},__touchStartHandler:function(t){var e=t.touches[0],i=this._getRuntimeEnv().root,n=i.css(c+"transform").match(l);n=n&&n[0]||0,this.__lastTouchStartPos={left:Number(n),x:e.pageX,y:e.pageY,t:+new Date}},__touchEndHandler:function(t){var e=this.__lastTouchStartPos,i=this._getSwipeDirection(e.x,t.changedTouches[0].pageX);this[i===a.LEFT?"next":i===a.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(){},__moveHandler:function(t){t.preventDefault(),t.touches.length>1||t.scale&&1!==t.scale}}),a.LEFT=-1,a.RIGHT=1,a.translate=function(t,e){var i=t[0],n=i&&i.style;n&&t.css(c+"transform","translate3d("+e+"px, 0, 0)")},a.animate=function(t,e,i,n){this.translate(t,i,n)},i.register({name:s,fn:a}))}),define("Switch",["cBase"],function(){function t(t){this.options={wrap:null,cursor:null,cursorCls:"",turnOnCls:"active",html:"<i>关</i>",isTurnOn:!1,onChange:e},this.initialize(t),this.turn(this.isTurnOn,!0)}var e=function(){},i=$.extend;return t.prototype={initialize:function(t){i(this.options,t),this.isTurnOn=this.options.isTurnOn,this.wrap=this.options.wrap,this.wrap&&this.renderHTML(),this.cursor=this.options.cursor?this.options.cursor:this.wrap.find(this.options.cursorCls),this.bindEvents()},renderHTML:function(){this.wrap.html(this.options.html)},bindEvents:function(){var t=this.cursor,e=this;this._clickHandler=function(){e.turn()},t&&t.length&&t.parent().bind("click",this._clickHandler)},unbindEvents:function(){this.cursor.parent().unbind("click",this._clickHandler)},turn:function(t){var e,i=this.options;e=void 0===t?!this.isTurnOn:t;try{this.wrap&&this.wrap[e?"addClass":"removeClass"](i.turnOnCls),i.onChange.call(this,e),this.isTurnOn=e}catch(n){}},on:function(){this.turn(!0)},off:function(){this.turn(!1)}},t}),define("VoiceSearch",["cBase","cWidgetFactory","cWidgetGuider","libs"],function(t,e){var i,n="VoiceSearch",a=e.create("Guider");e.hasWidget(n)||(i=new t.Class({__propertys__:function(){this.trigger=null},initialize:function(t){this.trigger=t,t&&t.length&&this._bindEvents()},_bindEvents:function(){var t=this;this.trigger.on("click",function(){t.showPanel()})},showPanel:function(){a.show_voice_search({bussinessType:i.TUAN})}}),i.TUAN=70,e.register({name:n,fn:i}))}),define("HttpErrorHelper",[],function(){var t={500:"服务器出错，请稍后再试！",404:"连接失败，网络不给力哦！",408:"网络不给力哦，请在更好的网络环境下使用！"},e=function(e){return t[e]},i={getMessage:function(t){var i=t.status,n=t.statusText;if(i>=500)switch(i){case 500:n=e(500,{});break;default:n=e(500,{})}else if(i>=400)switch(i){case 408:n=e(408,{});break;case 404:n=e(404,{});break;default:n=e(404,{})}else n=e(404,{});return n}};return i}),define("NumberStep",["libs"],function(){function t(t){var e=function(){},i={max:9,min:1,initialVal:1,step:1,html:'<i class="minus <%if(initialVal <= min ){ %>num_invalid<%} %>">-</i><span id="J_curNum"><%=initialVal %></span><i class="plus <%if(initialVal >= max ){ %>num_invalid<%} %>">+</i>',wrap:null,disableClass:"num_invalid",onChange:e,onMax:e,onMin:e};this.options=$.extend(i,t),this.wrap=this.options.wrap,this.renderHtml(),this.els={curNumDom:this.wrap.find("#J_curNum"),plusDom:this.wrap.find(".plus"),minusDom:this.wrap.find(".minus"),flagDom:this.wrap.find("i")},this.bindEvents()}return t.prototype={constructor:t,bindEvents:function(){var t=this;this.wrap.on("click",".plus,.minus",function(e){var i=$(e.target),n=parseInt(t.els.curNumDom.text().trim()),a=i.text().trim()||i.attr("data-flag");return i.hasClass(t.options.disableClass)?!1:("+"===a&&n<t.options.max?n++:"-"===a&&n>t.options.min?n--:n=t.options.min,t.els.flagDom.removeClass(t.options.disableClass),n===t.options.min&&(i.addClass(t.options.disableClass),t.options.onMin(e)),n===t.options.max&&(i.addClass(t.options.disableClass),t.options.onMax(e)),t.els.curNumDom.html(n),void t.options.onChange.call(t))})},triggerChange:function(){this.options.onChange.call(this)},unbindEvents:function(){this.wrap.off("click")},_changeStatus:function(t,e){var i="disable"===e?"addClass":"removeClass";"+"===t?this.els.plusDom[i](this.options.disableClass):"-"===t?this.els.minusDom[i](this.options.disableClass):this.els.flagDom[i](this.options.disableClass)},disable:function(t){this._changeStatus(t,"disable")},enable:function(t){this._changeStatus(t,"enable")},renderHtml:function(){this.wrap.html(_.template(this.options.html,this.options))},getCurrentNum:function(){return this.els.curNumDom.text().trim()},setCurrentNum:function(t){this.els.curNumDom.text(t)},setOptions:function(t,e){e&&(this.options[t]=e,this.options.onChange.call(this))}},t}),define("Payment",["cUtility","cWidgetGuider","cWidgetFactory","cHybridFacade","cUtilityCrypt"],function(t,e,i,n,a){function s(t,e,i){var n,s,r,l=t.oid||t.orderID,d=e?"/webapp/tuan/index.html#booking":"/webapp/tuan/booking",p=e?"/webapp/tuan/index.html#booking.success!{orderid}":"/webapp/tuan/bookingsuccess/{orderid}.html",u=e?"index.html":c[o()],h=e?"file:/":"http://"+location.host,f={IsNeedCardRisk:!0,payTypeList:t.payTypeList,subPayTypeList:t.subPayTypeList},_=p.replace("{orderid}",l);return i&&(f.isRealTimePay=i.IsRealPay||0),n=h+_,s=h+d,r=h+(t.from||d),t.oid=t.oid.toString(10),t.from=r,t.sback=n,t.eback=n,t.rback="",u+"#index?bustype="+t.bustype+"&extend="+encodeURIComponent(a.Base64.encode(JSON.stringify(f)))+"&oid="+t.oid+"&token="+encodeURIComponent(a.Base64.encode(JSON.stringify(t)))}function o(){var t=d.location.host.toLowerCase(),e="uat";return t.match(/^(m|3g|wap)\.ctrip\.com/i)||"10.8.2.111"==t?e="pro":t.match(/^m\.uat\.qa/i)?e="uat":(t.match(/^(m|w\-tuan\-m)\.fat/i)||t.match(/^(localhost|127\.0)/i))&&(e="dev"),e.toUpperCase()}var r,l="Payment",c={DEV:"https://secure.fat18.qa.nt.ctripcorp.com/webapp/payment2/index.html",TEST:"https://secure.fat18.qa.nt.ctripcorp.com/webapp/payment2/index.html",UAT:"https://secure.uat.qa.nt.ctripcorp.com/webapp/payment2/index.html",PRO:"https://secure.ctrip.com/webapp/payment2/index.html"},d=window,p=t.isInApp(),u=i.create("Guider");r=p?{submit:function(t,e,i){var n=s(e,!0,i);/file\:[\\\/]*/i.test(n)&&(n="index.html#"+n.split("#")[1]),u.cross({path:"payment2",param:n})}}:{submit:function(t,e,i){t.jump(s(e,!1,i))}},i.register({name:l,fn:r})}),define("WechatShare",["cBase"],function(t){function e(t){return t===Object(t)}var i,n=function(){};return i=new t.Class({__propertys__:function(){this.options={data:null,enableNative:!0,onShared:n}},share:function(t,e,i){this._invoke(e,t,i||this.options.onShared)},shareFriends:function(t){t=t||this.options.data,this.share(t,i.SHARE_APP_MESSAGE)},shareTimeline:function(t){t=t||this.options.data,this.share(t,i.SHARE_TIMELINE)},shareWeibo:function(t){t=t||this.options.data,this.share({content:t.desc,url:t.link},i.SHARE_WEIBO)},initialize:function(t){e(t)&&(this.options=$.extend(this.options,t),this.options.enableNative&&this._bindEvents())},_bindEvents:function(){var t=this;WeixinJSBridge.on("menu:share:appmessage",function(){t.shareFriends()}),WeixinJSBridge.on("menu:share:timeline",function(){t.shareTimeline()}),WeixinJSBridge.on("menu:share:weibo",function(){t.shareWeibo()})},_invoke:function(t,e,i){WeixinJSBridge.invoke(t,e,function(t){i&&i(t)})}}),i.SHARE_TIMELINE="shareTimeline",i.SHARE_APP_MESSAGE="sendAppMessage",i.SHARE_WEIBO="shareWeibo",i}),define("ScrollObserver",["c"],function(){function t(t,e,i,n){return Math.abs(t-e)>=Math.abs(i-n)?t-e>c?"left":"right":i-n>c?"up":"down"}function e(){var t=this,e=r.body,i=e.scrollLeft,n=e.scrollTop;t.status=p.END,o.trigger(u.END,{direction:t.direction,y:n,x:i}),f=e.scrollTop,h=e.scrollLeft}function n(){var n=this,a=r.body,s=a.scrollLeft,c=a.scrollTop;i=(new Date).getTime(),n.status===p.END?(n.status=p.START,n.direction=t(h,s,f,c),o.trigger(u.START,{direction:n.direction,y:c,x:s})):n.status=p.SCROLLING,clearTimeout(_),_=setTimeout($.proxy(e,n),l)}function a(){n.call(this)}var s,o=window,r=o.document,l=800,c=0,d="scroll",p={START:0,SCROLLING:1,END:2},u={START:"customScrollStart",END:"customScrollEnd"},h=0,f=0,_=null;return o=$(o),s={init:function(){return this.status=p.END,this.__scrollHandler=$.proxy(a,this),this},enable:function(){o.on(d,this.__scrollHandler)},disable:function(){o.off(d,this.__scrollHandler)}}}),define("MemCache",["c"],function(){var t,e={};return t={setItem:function(t,i){return e[t]=i,this},getItem:function(t){return e[t]},removeItem:function(t){delete e[t]}}}),define("AMapWidget",["cBase","cUICore","cUtility","cWidgetFactory","cGeoService","cWidgetGeolocation","libs"],function(t,e,i,n,a){function s(t){return t===Object(t)}var o,r="AMapWidget",l=function(){},c=null,d=$.isArray;o=new t.Class({__propertys__:function(){this.options={key:"0b895f63ca21c9e82eb158f46fe7f502",webapi:"http://webapi.amap.com/maps?v=1.2",level:13,center:c,height:0,width:0,locationButton:c,onReady:l,onZoom:l,onMovestart:l,onGeoBegin:l,onGeoComplete:l,onGeoError:l},this.__stacks=[]},initialize:function(t){var e,i=this;s(t)&&(e=$.extend(this.options,t)),this.options=e,i._updateContainerSize(e.width,e.height),i._loadScript($.proxy(i._createMap,i)),i.gps=a.GeoLocation},addMarker:function(t){var e=this,i=this.host,n=[];return i?d(t)?(t.forEach(function(t){n.push(e.addMarker(t))}),n):(n=new i.Marker(t),n.setMap(this.map),n):void this.__stacks.push(t)},removeMarker:function(t){t.setMap(null)},addEvent:function(t,e,i,n){var a,o=this;if(s(e))for(a in e)e.hasOwnProperty(a)&&o.addEvent(t,e,e[a],n);else o.host.event.addListener(t,e,i,n)},removeEvent:function(t,e,i){var n,a=this;if(s(e))for(n in e)e.hasOwnProperty(n)&&a.addEvent(e,e[n]);else a.host.event.removeListener(t,e,i)},setFitView:function(){this.map.setFitView()},setPosition:function(t,e,i){t.setPosition(new this.host.LngLat(e,i))},removeControl:function(t){this.map.removeControl(t)},_bindEvents:function(){var t=this.host.event;this.__zoomendHandler=$.proxy(this._zoomendHandler,this),this.__movestartHandler=$.proxy(this._movestartHandler,this),t.addListener(this.map,"zoomchange",this.__zoomendHandler),t.addListener(this.map,"movestart",this.__movestartHandler),this.__clickHandler=$.proxy(this._clickHandler,this),t.addListener(this.map,"click",this.__clickHandler)},_unbindEvents:function(){this.host.event.event.removeListener(this.map,"zoomchange",this.__zoomendHandler),this.host.event.event.removeListener(this.map,"click",this.__clickHandler)},_clickHandler:function(){this.options.onClick.call(this)},_zoomendHandler:function(t){var e=this.options;e.onZoom.call(this,t,this.map.getZoom())},_movestartHandler:function(t){var e=this.options;e.onMovestart.call(this,t)},_formatGPSInfo:function(t){return{coords:{latitude:t.lat,longitude:t.lng,accuracy:50},timestamp:+new Date}},_addCurrentLocationTool:function(t,e,n){var a=this,s=this.map,o=this.host;s.plugin("AMap.Geolocation",function(){var r=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,buttonDom:a.options.locationButton,showButton:!0,buttonPosition:"LB",buttonOffset:new o.Pixel(0,0),showMarker:!0,showCircle:!0,panToLocation:!1,zoomToAccuracy:!1});i.isInApp()&&(r.onButtonClick=function(){n&&n.call(r,r._container),a.gps.Subscribe("tuan/amap",{onComplete:function(t){r.onPositionComplete(a._formatGPSInfo(t))},onError:function(t){r.onPositionError(t)},onPosComplete:function(){},onPosError:function(t){r.onPositionError(t)}},a,!0)}),s.addControl(r),o.event.addListener(r,"complete",$.proxy(t,a)),o.event.addListener(r,"error",$.proxy(e,a)),a.geolocation=r})},_updateContainerSize:function(t,e){var i=this.options,n=i.container,a=document.body,s=n.offset();t||(t=s.width||a.clientWidth),e||(e=s.height||a.clientHeight),n.css({width:t,height:e})},_createMap:function(){var t=window.AMap,e=this.options,i=this.__stacks,n=e.center.split("|");if(!t)throw new Error("no mapapi!");this.host=t,this.map=new t.Map(e.container[0],{level:11,center:new t.LngLat(n[0],n[1])}),i.length&&this.addMarker(i),this._bindEvents(),e.locationButton&&this._addCurrentLocationTool(e.onGeoComplete,e.onGeoError,e.onGeoBegin),e.onReady.call(this)},_loadScript:function(t){if(window.AMap)return void t();var e=document.createElement("script"),i=this.options,n="__"+r+Date.now();window[n]=t,e.type="text/javascript",e.src=i.webapi+"&key="+i.key+"&callback="+n,document.body.appendChild(e)}}),n.register({name:r,fn:o})}),define("POIWidget",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}var a,s="POIWidget",o=function(){},r=null;a=new t.Class({__propertys__:function(){this.options={model:r,source:3,params:{},onSuccess:o,onError:o}},initialize:function(t){var e;n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.model=e.model},query:function(t,e,i){var a=this,s=a.options,o=s.params;n(t)&&(t=$.extend(o,t)),this.model.param=t,this.model.excute(function(t){(e||s.onSuccess).call(a,t)},function(t){(i||s.onError).call(a,t)},!1,a)
},abort:function(){this.options.model.abort()}}),i.register({name:s,fn:a})}),define("LazyLoad",["libs"],function(){function t(t){var e=function(){},i={attr:"data-lazy",wrap:window,container:window,event:["scroll","resize"],time:100,threshold:180,vertical:!0,stateAttr:"data-load-state",onComplete:e,animateCls:"fade-in"};this.options=$.extend(i,t),this.container=$(this.options.container),this.wrap=$(this.options.wrap),this.eles=this.options.wrap===window?$("img"):$("img",this.wrap),this.bindEvents()}return t.prototype={constructor:t,bindEvents:function(){var t=this.options.event,e=function(t){this.TimerFun&&clearTimeout(this.TimerFun),this.TimerFun=setTimeout(function(){this.triggerEvent(t)}.bind(this),this.options.time)}.bind(this);for(var i in t)this.container.on(this.options.event[i],e)},_imgLoaded:function(t,e){t[0].src=t.attr(e.attr),t.addClass(e.animateCls),t.attr(e.stateAttr,"true")},triggerEvent:function(t){for(var e,i,n=this,a=0,s=n.options;a<n.eles.length;a++)e=$(n.eles[a]),i=e.attr(s.attr),i&&e[0].src.trim()!==i.trim()&&this.isReady(e)&&this._loadImage(e,n._imgLoaded);s.onComplete.call(this,t)},_loadImage:function(t,e){var i=this,n=i.options,a=new Image;return a.src=t.attr(n.attr),a.complete?void e.call(i,t,n):void(a.onload=function(){a.onload=null,e.call(i,t,n)})},isReady:function(t){var e=this.options.vertical?"scrollTop":"scrollLeft",i=this.options.vertical?"top":"left",n=t.offset()[i],a=this.options.vertical?this.container.height():this.container.width(),s=this.container[e]();return n>=s&&n<=a+s+this.options.threshold},updateDom:function(){this.eles=this.options.wrap===window?$("img").not("["+this.options.stateAttr+' = "true"]'):$("img",this.wrap).not("["+this.options.stateAttr+'="true"]'),this.container.trigger(this.options.event[0])},unbindEvents:function(){for(var t in this.options.event)this.container.off(this.options.event[t])}},t}),define("CallPhone",["libs","c","cWidgetFactory","cWidgetGuider","cUtility"],function(t,e,i,n,a){function s(t){var e=function(){},i={tpl:'<%_.each(data, function(t) {%> <div class="base_btn02 J_phoneItem" data-phone="<%=t %>"><a href="tel:<%=t %>" style="display: inline-block;width: 100%;"><%=t %></a></div> <%});%><div class="base_btn02 J_cancelPhone">取消</div>',wrap:'<div class="wrapBottom J_phoneListPanel" style="z-index: 9999"></div>',ele:".J_phone",onSelect:e,onHide:e,onShow:e,dataName:"data-phone",view:""};this.opt=$.extend(i,t),this.view=this.opt.view,this.ele=$(this.opt.ele),this.dataName=this.opt.dataName,this.bindEvents()}var o=i.create("Guider"),r=a.isInApp();return s.prototype={_initMask:function(){var t=this;!this.mask&&(this.mask=new e.ui.Mask({onCreate:function(){this.root.on("click",function(){t.hidePanel(),t.hideMask()})}})),this.showMask()},showMask:function(){this.mask&&this.mask.show(),this.opt.onShow&&this.opt.onShow.apply(this)},hideMask:function(){this.mask&&this.mask.hide(),this.opt.onHide&&this.opt.onHide.apply(this)},bindEvents:function(){this.ele.on("click",this._clickHandler.bind(this))},_clickHandler:function(t){r&&t.preventDefault();var e=$(t.currentTarget).attr(this.dataName);e&&(e=e.split(",")),e&&e.length&&(r||e.length>1)&&(this._initMask(),this._initPanel(),this._updatePhoneList(e))},_phoneItemHandler:function(t){r&&t.preventDefault(),this.hideMask(),this.hidePanel();var e=$(t.currentTarget).attr("data-phone");e&&this.makePhoneCall(e),this.opt.onSelect&&this.opt.onSelect.apply(this)},_initPanel:function(){this.phonePanel=this.view.$el.find(".J_phoneListPanel"),(!this.phonePanel||this.phonePanel&&0===this.phonePanel.length)&&(this.view.$el.append(this.opt.wrap),this.phonePanel=this.view.$el.find(".J_phoneListPanel"),this.phonePanel.on("click",".J_phoneItem",this._phoneItemHandler.bind(this)),this.phonePanel.on("click",".J_cancelPhone",function(){this.hideMask(),this.hidePanel()}.bind(this)))},hidePanel:function(){this.phonePanel&&this.phonePanel.hide()},_updatePhoneList:function(t){this.phonePanel.html(_.template(this.opt.tpl,{data:t})),this.phonePanel.show()},makePhoneCall:function(t){o.apply({hybridCallback:function(){return o.callPhone({tel:t}),!1},callback:function(){return!0}})},updateDom:function(t){this.ele=$(t),this.bindEvents()}},s}),define("FilterXss",[],function(){function t(t,e,i){if("href"===e||"src"===e){if(p.lastIndex=0,p.test(i))return"#";if(u.lastIndex=0,u.test(i))return"#"}else if("style"===e){if(h.lastIndex=0,h.test(i))return"#";if(f.lastIndex=0,f.test(i))return""}}function e(t){return i(t)}function i(t){return t.replace(o,"&lt;").replace(r,"&gt;")}function n(t,e){return String.fromCharCode(parseInt(e))}function a(i){this.options=i=i||{},this.whiteList=$.extend(!0,s,i.whiteList||{}),this.onTagAttr=$.extend(!0,t,i.onTagAttr||{}),this.onIgnoreTag=$.extend(!0,e,i.onIgnoreTag||{})}var s={h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],hr:[],span:[],strong:[],b:[],i:[],br:[],p:[],pre:[],code:[],a:["target","href","title"],img:["src","alt","title"],div:[],table:["width","border"],tr:[],td:["width","colspan"],th:["width","colspan"],tbody:[],ul:[],li:[],ol:[],dl:[],dt:[],em:[],cite:[],section:[],header:[],footer:[],blockquote:[],audio:["autoplay","controls","loop","preload","src"],video:["autoplay","controls","loop","preload","src","height","width"]},o=/</g,r=/>/g,l=/"/g,c=/[^a-zA-Z0-9_:\.\-]/gim,d=/&#([a-zA-Z0-9]*);?/gim,p=/\/\*|\*\//gm,u=/^[\s"'`]*((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,h=/\/\*|\*\//gm,f=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi;return a.prototype={constructor:a,filterAttributes:function(t,e){t=t.toLowerCase();for(var i,a=this,s=this.whiteList[t],o=0,r="",p=!1,u=!1,h=function(e,i){if(e=e.trim(),!u&&"/"===e)return void(u=!0);if(e=e.replace(c,"").toLowerCase(),!(e.length<1)&&-1!==s.indexOf(e)){if(i){i=i.trim().replace(l,"&quote;"),i=i.replace(d,n);for(var o="",p=0,h=i.length;h>p;p++)o+=i.charCodeAt(p)<32?" ":i[p];i=o.trim();var f=a.onTagAttr(t,e,i);"undefined"!=typeof f&&(i=f)}r+=e+(i?'="'+i+'"':"")+" "}},f=0,_=e.length;_>f;f++){var m=e[f];if(p!==!1||"="!==m)if(p===!1||f!==o||'"'!==m&&"'"!==m)" "!==m||(i=e.slice(o,f).trim(),p===!1?h(i):h(p,i),p=!1,o=f+1);else{var v=e.indexOf(m,f+1);if(-1===v)break;i=e.slice(o+1,v).trim(),h(p,i),p=!1,f=v,o=f+1}else p=e.slice(o,f),o=f+1}return o<e.length&&(p===!1?h(e.slice(o)):h(p,e.slice(o))),u&&(r+="/"),r.trim()},addNewTag:function(t,e,n){var a,s="",o="</"===t.slice(0,2)?2:1,r=t.indexOf(" ");if(a=-1===r?t.slice(o,t.length-1).trim():t.slice(o,r+1).trim(),a=a.toLowerCase(),a in this.whiteList)if(-1===r)s+=t.slice(0,o)+a+">";else{var l=this.filterAttributes(a,t.slice(r+1,t.length-1).trim());s+=t.slice(0,o)+a+(l.length>0?" "+l:"")+">"}else{var c={isClosing:2===o,position:n,originalPosition:e-t.length+1},d=this.onIgnoreTag(a,t,c);"undefined"==typeof d&&(d=i(t)),s+=d}return s},process:function(t){var e="",n=0,a=!1,s=!1,o=0;if("string"!==$.type(t))return"";for(var r=t.length;r>o;o++){var l=t[o];if(a===!1){if("<"===l){a=o;continue}}else if(s===!1){if("<"===l){e+=i(t.slice(n,o)),a=o,n=o;continue}if(">"===l){e+=i(t.slice(n,a)),e+=this.addNewTag(t.slice(a,o+1),o,e.length),n=o+1,a=!1;continue}if('"'===l||"'"===l){s=l;continue}}else if(l===s){s=!1;continue}}return n<t.length&&(e+=i(t.substr(n))),e}},a.Instance=new a,{filterXSS:function(t,e){return e&&$.isPlainObject(e)&&(a.Instance=new a(e)),a.Instance.process(t)},tagFilter:function(t,e){"function"!=typeof e&&(e=function(){});var i=[],n=!1;return{onIgnoreTag:function(a,s,o){if(-1!==t.indexOf(a)){var r="[removed]";if(n!==!1&&o.isClosing){var l=o.position+r.length;i.push([n,l]),n=!1}else n=o.position;return r}return e(a,s,o)},filter:function(t){var e="",n=0;return i.forEach(function(i){e+=t.slice(n,i[0]),n=i[1]}),e+=t.slice(n)}}}}}),define("ConsoleDebug",["libs","c","cUtility"],function(t,e,i){function n(t){var e={btn:'<i style="position:fixed;bottom:300px;color:green;z-index:9999;">CL</i>',div:'<div style="position:fixed;bottom:290px;z-index:10000;display:none;width: 100%;"><button class="J_clearStorage">Clear</button><button class="J_xiaoli">Xiaoli</button><button class="J_www">www</button><button class="J_normal">Normal</button><button class="J_noOne">None</button><button class="J_reload">Reload</button><div class="J_debugLogSwitch"></div></div>',conBox:'<div class="J_logContent" style="position: fixed;bottom:100px;z-index: 10001;height:130px;width: 100%;display: none;background:gray;"><i style="height: 30px;" class="cui-grayload-close"></i><textarea style="width: 100%;height: 100%;" placeholder="Here is log"></textarea></div>'};this.opt=$.extend(e,t),this.init()}var a=$("#main"),s=$("body"),o={user:'{"value":{"UserID":"21634352BAC43044380A7807B0699491","LoginName":"","IsNonUser":false,"UserName":"wwwwwwtestc","Mobile":"13523612123","BMobile":"13523612123","Address":"","Birthday":"00010101","Experience":514987975,"Gender":1,"PostCode":"","VipGrade":30,"VipGradeRemark":"钻石贵宾","Email":"yqshui@yqshui.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"5085D900D69F03960C109A10DFD383C17419D30D241A442C5CA0CAE41F6B56CE"},"oldvalue":null,"timeout":"2015/01/03 10:46:12","savedate":"2014/12/04 10:46:12"}',userinfo:'{"data":{"UserID":"21634352BAC43044380A7807B0699491","LoginName":"","IsNonUser":false,"UserName":"wwwwwwtestc","Mobile":"13523612123","BMobile":"13523612123","Address":"","Birthday":"00010101","Experience":514987975,"Gender":1,"PostCode":"","VipGrade":30,"VipGradeRemark":"钻石贵宾","Email":"yqshui@yqshui.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"5085D900D69F03960C109A10DFD383C17419D30D241A442C5CA0CAE41F6B56CE"},"timeout":"2015-01-03 10:46:07"}'},r={user:'{"value":{"UserID":"AEFF51E4F9EA6CCBA42E11736E72441C","LoginName":"","IsNonUser":false,"UserName":"xiaoli-FAT","Mobile":"13023112562","BMobile":"","Address":"","Birthday":"19210101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"chen.xiaoli@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"22489D878AF6215DED9BAB44EE3AB2D7CFE94333D4E38D59DF80561A3E5DD066"},"oldvalue":null,"timeout":"2015/12/14 10:11:42","savedate":"2014/11/14 10:11:42"}',userinfo:'{"data":{"UserID":"AEFF51E4F9EA6CCBA42E11736E72441C","LoginName":"","IsNonUser":false,"UserName":"xiaoli-FAT","Mobile":"13023112562","BMobile":"","Address":"","Birthday":"19210101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"chen.xiaoli@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"22489D878AF6215DED9BAB44EE3AB2D7CFE94333D4E38D59DF80561A3E5DD066"},"timeout":"2014-12-12 20:38:51"}'},l={user:'{"value":{"UserID":"FCA154F6235E2ECF665F5DFE71D4D5B1","LoginName":"","IsNonUser":false,"UserName":"","Mobile":"","BMobile":"","Address":"","Birthday":"00010101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"daihy@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"7B5C33A12EE614DE6656E23ABD8897D505C1DE90901325518281D46C2D640A85"},"oldvalue":null,"timeout":"2014/12/14 15:38:25","savedate":"2015/11/14 15:38:25"}',userinfo:'{"data":{"UserID":"FCA154F6235E2ECF665F5DFE71D4D5B1","LoginName":"","IsNonUser":false,"UserName":"","Mobile":"","BMobile":"","Address":"","Birthday":"00010101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"daihy@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"7B5C33A12EE614DE6656E23ABD8897D505C1DE90901325518281D46C2D640A85"},"timeout":"2014-12-14 15:38:22"}'},c="TUAN_DEBUG_CON",d=window.localStorage;return n.prototype={init:function(){var t=this;this._isDevEnv()&&(window._log=$.extend(window._log,{log:function(e){var i=t.consoleBox.find("textarea"),n=this.stash;n.push("undefined"!=typeof e?JSON.stringify(e):""),i.text(n.join("\n"))}})),this.renderHtml(),this.showMask(),this.renderConsoleBox(),this._bindEvents(),this.clearAds()},_isDevEnv:function(){var t,e=!1;return i.isInApp()?(t=i.isPreProduction(),("0"===t||"1"===t||"2"===t)&&(e=!0)):location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(e=!0),e},_bindEvents:function(){var t=this;this.btn&&this.btn.on("click",function(){t.renderHtml(),t.showMask()}),a.on("click","button",function(e){var i,n=$(e.target);n.hasClass("J_xiaoli")?(i="已切换为小丽登陆！",t.setUserLogin(r)):n.hasClass("J_noOne")?(i="已切换为无用户登陆！",t.setUserLogin()):n.hasClass("J_www")?(i="已切换为www用户登陆",t.setUserLogin(o)):n.hasClass("J_normal")?(i="已切换为普通账户登录",t.setUserLogin(l)):n.hasClass("J_clearStorage")?(i="",t.clearLocal(),t.showToast("Clear",1,function(){t.reset()})):n.hasClass("J_reload")&&(i="Reloading Page"),i&&t.showToast(i,1,function(){t.refreshPage()})}),s.on("click",".J_logContent i",function(){t.consoleBox.hide(),t.setStatusLocal(!1)})},setUserLogin:function(t){d.setItem("USER",t&&t.user),d.setItem("USERINFO",t&&t.userinfo)},showToast:function(t,i,n){!this.toast&&(this.toast=new e.ui.Toast),this.toast.show(t,i||1,n)},showMask:function(){var t=this;!this.mask&&(this.mask=new e.ui.Mask({onCreate:function(){this.root.on("click",function(){t.reset()})}})),this.mask.show()},hideMask:function(){this.mask&&this.mask.hide()},renderHtml:function(){var t=this;this.div||(this.div=$(this.opt.div).appendTo(a),this.switch=new e.ui.cuiSwitch({rootBox:$(".J_debugLogSwitch"),checked:this.getStatusLocal()?!0:!1,changed:function(){t.setStatusLocal(this.getStatus()),t.switchConsoleBox(this.getStatus())}}),this.div.find("button").addClass("btn_blue1").css({width:"70px",display:"inline-block",margin:"3px","line-height":"24px",height:"24px"})),this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.div.show()},clearLocal:function(){var t=this.getStatusLocal();d&&d.clear(),this.setStatusLocal(t)},clearAds:function(){var t=setInterval(function(){var e=$(".dl_panel-bg .dl_btn-close");e&&e.length&&(e.trigger("click"),clearInterval(t))},100)},renderConsoleBox:function(){this.consoleBox=$(this.opt.conBox).appendTo(s),this.switchConsoleBox(this.getStatusLocal())},switchConsoleBox:function(t){this.consoleBox[t?"show":"hide"](),t&&window._log.log(),this.reset()},reset:function(){this.hideMask(),this.div&&this.div.hide()},getStatusLocal:function(){var t=d.getItem(c);return t&&"false"!=t?!0:!1},setStatusLocal:function(t){d.setItem(c,t)},show:function(){this.switch&&this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.showMask(),this.div.show()},refreshPage:function(){location.reload()}},n}),define("TuanBaseView",["c","cStore","cPageView","cCommonListPage","cUtility","cHybridFacade","cCommonPageFactory","PageHistory","cWidgetFactory","cWidgetGuider"],function(t,e,i,n,a,s,o,r,l){var c="TuanBaseView",d="TuanBaseListView",p=a.isInApp(),u=l.create("Guider");if(!o.hasPage(c)&&!o.hasPage(d)){var h=new t.base.Class(e,{__propertys__:function(){this.key="P_TUAN_BURN_AFTER_READING",this.lifeTime="1H",this.defaultData={}},initialize:function($super){$super()},setOneMessage:function(t,e){this.setAttr(t,e)},getOneMessage:function(t){var e=this.getAttr(t);return e&&this.setAttr(t,""),e}}),f=h.getInstance(),m=m||{};m={"super":i.prototype,show:function(){var t=r.getLatelyView(this.getViewName())||"";this.lastViewId=t,this.__onLoad(t),this.super.show.apply(this,arguments),this.__onShow(t)},hide:function(){this.super.hide.apply(this,arguments),this.__onHide(arguments)},getViewName:function(){return this.config&&this.config.viewName},__onLoad:function(){r.confirmForward(this.getViewName()),r.addHistory(this.getViewName(),location.href,2)},__onShow:function(){},__onHide:function(){},getHistory:function(){return r},back:function(t,e){if(p&&1==Lizard.P("from_native_page"))return void u.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})});this.setOneMessage("__lastViewName__",this.getViewName());var i=r.back(this.getViewName(),t);if(void 0===e&&(e=!1),i.jump)location.href=i.fullurl;else if(a.isInApp()){var n=/#(.*)$/.exec(i.fullurl);n&&n.length>1&&n[1]?Lizard.goTo(n[1],{viewName:i.id,cache:"list"==i.id?!0:e}):Lizard.goTo(i.fullurl,{viewName:i.id,cache:"list"==i.id?!0:e})}else Lizard.goTo(i.fullurl,{viewName:i.id,cache:"list"==i.id?!0:e})},popById:function(t){var e=r.popById(t);e||r.clearHistory()},clearHistory:function(t,e){r.clearHistory(t,e)},forwardJump:function(t,e,i,n,a){if(this.setOneMessage("__lastViewName__",this.getViewName()),_.isObject(i)&&(i=!1),i)e=r.forward(t,e,1,n),this.jump(e);else{e=r.forward(t,e,2,n);var s={viewName:t};a&&(s.cache=!0),s.loading=!1,Lizard.goTo(e,s)}},getLastViewName:function(){return this.getOneMessage("__lastViewName__")},setOneMessage:function(t,e){f.setOneMessage(t,e)},getOneMessage:function(t){return f.getOneMessage(t)},showMessage:function(t,e){this.alert.setViewData({message:t,title:e,buttons:[{text:"知道了",click:function(){this.hide()}}]}),this.alert.show()},showCommonMap:function(t,e,i){var n=this.geolocation;n||(n=l.create("Geolocation"),this.geolocation=n),p?n.show_map({latitude:i,longitude:e,title:t}):this.forwardJump("hotelmap","/webapp/tuan/hotelmap?lon="+e+"&lat="+i+"&hotelName="+t)}};var v=i.extend(m);o.register({name:c,fn:v}),n=o.create("CommonListPage");var g=n.extend(m);o.register({name:d,fn:g})}}),define("ValidatorUtil",["libs"],function(){function t(t){var i=this,n={forceCheckAll:!1};i.options=e(n,t||{}),i._fields=[]}var e=$.extend;return t.prototype={constructor:t,addField:function(t){var e=this;return e._fields.push(t),e},removeField:function(t){var e=this._fields;return t="number"==typeof t?t:e.indexOf(t),t>-1&&t<e.length&&e.splice(t,1)[0].destroy()},removeAllFields:function(){for(;this._fields.length;)this._fields.pop().destroy()},validate:function(){var t=this._fields,e=t.length,i=1,n=this.options.forceCheckAll,a=0;if(e)for(;e>a&&(i&=t[a].check(),i||n);a++);return!!i}},t}),define("FieldUtil",["libs"],function(){function t(t){var i=this,n=null,a=function(){};i.options={dom:n,rules:n,onCheck:a,required:!0,triggerEvent:""},i.options=e(i.options,t||{}),i.dom=i.options.dom,i.initialize()}var e=$.extend;return t.prototype={initialize:function(){var t=this,e=t.options.triggerEvent,i=t.dom;t.required=t.options.required,i&&i[0]&&(t.__blurHandler=function(){t.check()},e&&i.on(e,t.__blurHandler))},constructor:t,check:function(){var t,e,i=this.dom,n=i&&i.val()||"",a=this.options,s=a.rules,o=1,r=0,l=this.required,c=$.isFunction;for(!Array.isArray(s)&&(s=[s]),e=s.length;e>r&&(t=s[r],!l&&!n||(o&=c(t)?t(n):t.test(n)));r++);return a.onCheck.call(this,!!o,{val:n,dom:i,rule:r}),o||!l},destroy:function(){var t=this,e=t.dom;return e&&e.off(t.options.triggerEvent,t.__blurHandler),!0}},t}),define("text!HomeTpl",[],function(){return'<div class="hot_tit">热卖推荐<a href="javascript:;" id="J_allTuan">查看全部团购</a></div>\n<ul class="pro_list pro_list1 index_hot">\n<%\nif(typeof products!="undefined" && products && products.length>0 && count && +count > 0) {\n    for(var i=0, len=products.length; i < len; i++){\n        var p=products[i];\n        var labelsNum = p.labels && p.labels.length;\n%>\n    <li data-id="<%=p.id %>" data-len="<%=products.length %>" data-count="<%=count %>">\n        <div class="pro_list_imgbox">\n            <img data-img="<%=i %>" onerror="javascript:noPic(this);" src="http://pic.c-ctrip.com/common/pic_alpha.gif" data-lazy="<%=p.imgUrl?p.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %> " />\n        </div>\n        <div class="pro_list_info">\n            <h4 class="pro_list_tit"><%=p.name%></h4>\n            <%if(p.distance>0 && ctype!==7){%>\n            <p class="pro_list_dist">\n                <%if(p.distance>=1){%>\n                    <%=p.distance.toFixed(1)+\'公里\'%>\n                <%}else{%>\n                    <%=p.distance*1000+\'米\'%>\n                <%}%>\n            </p>\n            <%}%>\n            <p class="pro_list_subtit"><%=(p.descriptionhead && p.name.indexOf(\'【多店通用】\') == -1 ? \'[\' + p.descriptionhead + \']\' : \'\') + (p.hotdescription || \'\')%></p>\n            <p class="pro_list_price">&yen;<i><%=p.price.dPrice%></i></p>\n            <p class="wrap_label">\n                <%if(labelsNum <= 2){%>\n                    <%_.each(p.labels || [], function(o) {%>\n                        <span class="onsale_label02"><%=o.labelTxt%></span>\n                    <%}); %>\n                <%} else {%>\n                    <span class="onsale_label02"><%=p.labels[0].labelTxt%></span>\n                    <span class="onsale_label03">更多优惠+</span>\n                <%}%>\n            </p>\n            <p class="pro_list_ext">\n                <span class="pro_list_oldprice"><del data-price="<%=p.price.cPrice %>">&yen;<%=p.price.cPrice %></del></span>\n                <%if(+p.cSold>0){%><span class="pro_list_sold">已售<%=p.cSold %></span><%}%>\n                <%if(+p.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=p.score %></i>分</span><%}%>\n            </p>\n            <%if (p.activities && p.activities.length > 0) {\n                for (var j in p.activities) {\n                    var a = p.activities[j];\n                    if(a && a.type && +a.type > 0 && (+a.type == 2 || +a.type == 3) && +a.arg > 0) {\n            %>\n                <!--<span class="onsale_label01">返 ¥<%=a.arg%></span> -->\n            <%      }\n                }\n            }%>\n        </div>\n        <%if(p.labelVal && p.labelVal==99){ %><div class="sold_out">售完</div><%} %>\n    </li>\n    <%\n    }\n}%>\n</ul>\n<!--/END 热卖-->\n<div class="base_btn01 btn_more">查看更多推荐团购</div>\n'}),define("text!ListProductTpl",[],function(){return'<%if(typeof products!=\'undefined\' && products && products.length>0 && count && +count > 0) {%>\n    <%if(pageIdx<=1){%><ul class="pro_list pro_list1"><%}%>\n    <%\n    for(var i = 0, len = products.length; i < len; i++){\n        var p = products[i];\n        var labelsNum = p.labels && p.labels.length;\n    %>\n    <li data-id="<%=p.id %>" data-len="<%=products.length %>" data-count="<%=count %>">\n        <div class="pro_list_imgbox">\n            <img data-img="<%=i %>" onerror="javascript:noPic(this);" data-lazy="<%=p.imgUrl?p.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %>" src="http://pic.c-ctrip.com/common/pic_alpha.gif" />\n        </div>\n        <div class="pro_list_info">\n            <h4 class="pro_list_tit"><%=p.name%></h4>\n            <%if(p.distance>0 && ctype!==7){%>\n            <p class="pro_list_dist">\n                <%if(p.distance>=1){%>\n                    <%=p.distance.toFixed(1)+\'公里\'%>\n                <%}else{%>\n                    <%=p.distance*1000+\'米\'%>\n                <%}%>\n            </p>\n            <%}%>\n            <p class="pro_list_subtit"><%=(p.descriptionhead && p.name.indexOf(\'【多店通用】\') == -1 ? \'[\' + p.descriptionhead + \']\' : \'\') + (p.hotdescription || \'\')%></p>\n            <p class="pro_list_price">&yen;<i><%=p.price.dPrice%></i></p>\n            <p class="wrap_label">\n                <%if(labelsNum <= 2){%>\n                    <%_.each(p.labels || [], function(o) {%>\n                        <span class="onsale_label02"><%=o.labelTxt%></span>\n                    <%}); %>\n                <%} else {%>\n                    <span class="onsale_label02"><%=p.labels[0].labelTxt%></span>\n                    <span class="onsale_label03">更多优惠+</span>\n                <%}%>\n            </p>\n            <p class="pro_list_ext">\n                <span class="pro_list_oldprice"><del data-price="<%=p.price.cPrice %>">&yen;<%=p.price.cPrice %></del></span>\n                <%if(+p.cSold>0){%><span class="pro_list_sold">已售<%=p.cSold %></span><%}%>\n                <%if(+p.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=p.score %></i>分</span><%}%>\n            </p>\n            <%if (p.activities && p.activities.length > 0) {\n                for (var j in p.activities) {\n                    var a = p.activities[j];\n                    if(a && a.type && +a.type > 0 && (+a.type == 2 || +a.type == 3) && +a.arg > 0) {\n            %>\n                <!--<span class="onsale_label01">返 ¥<%=a.arg%></span> -->\n            <%      }\n                }\n            }%>\n        </div>\n        <%if(p.labelVal && p.labelVal==99){ %><div class="sold_out">售完</div><%} %>\n    </li>\n    <%}%>\n    <%if(pageIdx<=1){%></ul><%}%>\n<%}else{\n    if(typeof msg != \'undefined\' &&  msg || (msg=\'未知错误\')){%>\n    <div class="sec-noresult">\n        <div class="ui-result-no">\n            <span class="ico-search"></span>\n            <span class="ui-info"><%=msg %></span>\n        </div>\n        <ul class="ui-result-tar" id="J_deleteFilter">\n            <%_.each(customFilter, function(item, key) {%>\n                <%if(key==\'star\'){%>\n                    <%_.each(item, function(v, i) {%>\n                    <li data-type="<%=key%>" data-value="<%=i%>"><%=v%></li>\n                    <%})%>\n                <%}else if(key==\'multiShop\'){%>\n                    <li data-type="multiShop">多店可用</li>\n                <%}else if(key==\'voucher\'){%>\n                    <li data-type="voucher">代金券</li>\n                <%}else{%>\n                    <li data-type="<%=key%>" data-value="<%=item.val%>"><%=item.txt%></li>\n                <%}%>\n            <%})%>\n            <%if (positionFilter.name) {%>\n                <%if (positionFilter.type != -6) {%>\n                    <li data-type="position"><%=positionFilter.name%></li>\n                <%}else{%>\n                    <li data-type="position"><%=positionFilter.pos.distance%>公里</li>\n                <%}%>\n            <%}%>\n            <%if (weekendsAvailable) {%><li data-type="weekendsAvailable">周末可用</li><%}%>\n            <%if (keywordData && keywordData.word) {%><li data-type="keyword"><%=keywordData.word%></li><%}%>\n        </ul>\n        <div class="ui-tips">\n            <p>或者拨打携程客服电话</p>\n            <a href="tel:4000086666" data-phone="4000086666" class="btn-telephone J_phone">联系客服</a>\n        </div>\n    </div>\n    <%}%>\n<%}%>\n'}),define("text!ListBusinessTpl",[],function(){return'<%if(typeof hotels != \'undefined\' && hotels && hotels.length > 0 && count > 0) {%>\n<%var n = 0;\n    _.each(hotels, function(hotel) {%>\n<section class="list_title">\n    <h2><%=hotel.name%></h2>\n    <%if(+ctype!==7){%><span class="list_distance"><%=hotel.distance > 1 ? (hotel.distance.toFixed(1) + \'公里\') : (Math.round(hotel.distance * 1000) + \'米\')%></span><%}%>\n</section>\n<ul class="pro_list pro_list2">\n    <%var len = hotel.products && hotel.products.length;\n    _.each(hotel.products, function(product, index) {\n        var labelsNum = product.labels && product.labels.length;\n    %>\n        <li<%if(index>1){%> style="display: none" <%}%> data-id="<%=product.id%>" data-len="<%=len%>" data-count="<%=count%>">\n\n            <div class="pro_list_imgbox">\n                <img data-img="<%=n++ %>" onerror="javascript:noPic(this);" data-lazy="<%=product.imgUrl?product.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %>" src="http://pic.c-ctrip.com/common/pic_alpha.gif" width="70" height="70" alt="<%=product.name%>" />\n            </div>\n            <div class="pro_list_info">\n                <h4 class="pro_list_tit"><%=product.name%></h4>\n                <p class="pro_list_price">¥<i><%=product.price.dPrice%></i></p>\n                <p class="wrap_label">\n                    <%if(labelsNum <= 2){%>\n                        <%_.each(product.labels || [], function(o) {%>\n                            <span class="onsale_label02"><%=o.labelTxt%></span>\n                        <%}); %>\n                    <%} else {%>\n                        <span class="onsale_label02"><%=product.labels[0].labelTxt%></span>\n                        <span class="onsale_label03">更多优惠+</span>\n                    <%}%>\n                </p>\n                <p class="pro_list_ext">\n                    <span class="pro_list_oldprice"><del>¥<%=product.price.cPrice%></del></span>\n                    <%if(+product.cSold>0){%><span class="pro_list_sold">已售<%=product.cSold %></span><%}%>\n                    <%if(+product.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=product.score %></i>分</span><%}%>\n                </p>\n            </div>\n        </li>\n    <%})%>\n    <%if (len>2) {%>\n        <li class="more view_unfold J_showMore">查看其他<%=len-2%>条团购<span></span></li>\n    <%}%>\n</ul>\n<%})%>\n<%}else{\n    if(typeof msg != \'undefined\' &&  msg || (msg=\'未知错误\')){%>\n    <div class="sec-noresult">\n        <div class="ui-result-no">\n            <span class="ico-search"></span>\n            <span class="ui-info"><%=msg %></span>\n        </div>\n        <ul class="ui-result-tar" id="J_deleteFilter">\n            <%_.each(customFilter, function(item, key) {%>\n                <%if(key==\'star\'){%>\n                    <%_.each(item, function(v, i) {%>\n                    <li data-type="<%=key%>" data-value="<%=i%>"><%=v%></li>\n                    <%})%>\n                <%}else if(key==\'multiShop\'){%>\n                    <li data-type="multiShop">多店可用</li>\n                <%}else if(key==\'voucher\'){%>\n                    <li data-type="voucher">代金券</li>\n                <%}else{%>\n                    <li data-type="<%=key%>" data-value="<%=item.val%>"><%=item.txt%></li>\n                <%}%>\n            <%})%>\n            <%if (positionFilter.name) {%>\n                <%if (positionFilter.type != -6) {%>\n                    <li data-type="position"><%=positionFilter.name%></li>\n                <%}else{%>\n                    <li data-type="position"><%=positionFilter.pos.distance%>公里</li>\n                <%}%>\n            <%}%>\n            <%if (weekendsAvailable) {%><li data-type="weekendsAvailable">周末可用</li><%}%>\n            <%if (keywordData && keywordData.word) {%><li data-type="keyword"><%=keywordData.word%></li><%}%>\n        </ul>\n        <div class="ui-tips">\n            <p>或者拨打携程客服电话</p>\n            <a href="tel:4000086666" data-phone="4000086666" class="btn-telephone J_phone">联系客服</a>\n        </div>\n    </div>\n    <%}%>\n<%}%>\n'}),define("text!BookingTpl",[],function(){return'<section class="cont_wrap" style="padding-bottom:55px;">\n    <%if(!user || user.IsNonUser==true) { %>\n    <ul class="fillin_list">\n        <li>\n            <%if(activities[0] && (activities[0].type == 2 || activities[0].type == 3)) {%>\n            登录后使用消费券可获得返现<span class="colmoney">¥<%=activities[0].arg %></span>\n            <% }else{%>\n            登录后预订更便捷\n            <% }%>\n            <a href="javascript:;" class="btns_login J_loginBtn ">马上登录</a>\n        </li>\n    </ul>\n    <% }%>\n    <!--@since 2014/10/21 修改门票预定页面 li.xx  -->\n    <% var isTicket = typeof category != \'undefined\' ? (category.ctgoryid === 6 && category.subctgory === 2) : false;\n    if (isTicket) {%>\n    <ul class="box_list box_list_ticketA">\n        <li class="title titleT2"><%=name %></li>\n        <li class="arr_r">\n            <span class="label">使用日期</span>\n            <span class="iptbox"><input type="text" readonly="" placeholder="请选择游玩日期" class="J_selectDate" date-date="<%= typeof ckintime === \'undefined\' ? \'\' : ckintime %>" value="<%= (typeof ckintimetxt === \'undefined\') ? \'\' : ckintimetxt  %>"></span>\n        </li>\n        <li>\n            <span class="label">购买数量</span>\n            <div class="btn_fine_tuning J_numberStep">\n            </div>\n        </li>\n    </ul>\n    <ul class="box_list box_list_ticketB">\n        <li class="">\n            <span class="label">取票人</span>\n            <span class="iptbox"><input type="text" placeholder="需与证件上的名字一致" id="J_ticketUser"><i class="icon icon_del"></i></span>\n        </li>\n        <li class="">\n            <span class="label">手机号码</span>\n            <span class="iptbox"><input type="tel" placeholder="用于接收取票凭证短信" id="J_tel" value="<%=tel%>"><i class="icon icon_del"></i></span>\n            <% if (isInApp) {%>\n            <i class="icon icon_user" id="J_selectContact" style="z-index: 999; padding: 10px 5px;"></i>\n            <%}%>\n        </li>\n    </ul>\n    <%} else { %>\n    <div class="order_htl_info">\n        <div class="order_htl_info_t"><%=name %></div>\n        <div class="fillin_price">单价：<span>&yen;<%=price.dPrice %></span></div>\n    </div>\n    <ul class="fillin_list">\n        <li>\n            <span class="label">购买数量</span>\n            <div class="btn_fine_tuning J_numberStep">\n            </div>\n        </li>\n\n        <!--TODO: 优惠  -->\n        <%if(activities && activities.length > 0 && (((activities[0].type == 2 || activities[0].type == 3) && user) || activities[0].type == 1)) { %>\n        <li <%if(activities[0].type == 1){%>style="display:none"<%}%> class="orderwrite_hint" id="privilege">\n        <%if((activities[0].type == 2 || activities[0].type == 3) && user) {%>\n        入住后返\n        <%} %>\n        <span class="price1"><i>¥</i><span id="J_pPrice"><%=activities[0].arg * curNum%></span><%if(activities[0].type == 2 && user) {%>现金<%} %><%if(activities[0].type == 3 && user){%>携程礼品卡<%} %></span>\n        </li>\n        <%} %>\n        <li>手机\n            <span class="inputbox"><input type="tel" placeholder="用于接收团购券号和密码" maxlength="11" required id="J_tel" value="<%=tel%>" /></span>\n            <% if (isInApp) {%>\n            <i class="icon icon_user" id="J_selectContact" style="z-index: 999; padding: 10px 5px;"></i>\n            <%}%>\n        </li>\n\n        <!--\n        三种情况判断：\n            1. 默认展示不需要发票，点击发票栏进入发票填写页\n            2. 酒店开具发票，提供文案: "产品发票由酒店提供，请入住酒店时向酒店前台索取。"\n            3. 携程开具发票，显示发票填写控件\n        groupFlag: 位操作(1,多家分店;  2,分店信息分组;  4,存在关联团购;  8,有房态条目;  16,携程提供发票;  32,已售完 64,酒店提供发票； 128,无发票)\n        -->\n        <%if(isLogin && (groupFlag & 16) == 16) { %>\n        <li class="arr_r" id="J_invoice">发票\n            <%if(invoice) {%>\n            <%if(invoice.deliveryMethod == 0){%>\n            <span class="txt"><%=invoice.title || \'\'%></span>\n            <%}else{%>\n            <span class="promo_code"><%=invoice.title || \'\'%></span><span class="txt2">&yen; 10</span>\n            <%}%>\n            <%}else{%>\n            <span class="txt">不需要</span>\n            <%}%>\n        </li>\n        <%}%>\n\n        <%if (price.dPrice > 0) {%>\n        <li class="arr_r" id="J_coupon"><label>优惠券</label>\n            <%\n                var couponTypeTxt = \'\';\n                if (coupon && typeof coupon === \'object\') {\n                    if (coupon.isNotUse) {\n            %>\n                <span class="num" id="J_couponCount"></span><span class="txt">不使用</span>\n            <%\n                    } else {\n                        if (coupon.couponType === 2) {\n                        couponTypeTxt = \'限1单使用\';\n                        } else if (coupon.couponType === 3) {\n                        couponTypeTxt = \'可叠加使用\';\n                        }\n            %>\n            <span class="promo_code"><%=coupon.isInput ? coupon.code : coupon.title%> <span><%=couponTypeTxt %></span></span>\n            <span class="txt2">- &yen; <span id="J_couponAmount"><%=retainTwoDecimal(coupon.amount * curNum)%></span></span>\n                <%}\n            } else{%>\n            <span class="num" id="J_couponCount"></span><span class="txt"></span>\n            <%}%>\n        </li>\n        <%}%>\n    </ul>\n\n    <%}%><!--END 门票判断-->\n\n\n    <%if((groupFlag & 16) != 16 && !_.isEmpty(invoiceText)) { %>\n        <p class="tips_attention"><%=invoiceText%></p>\n    <%}%>\n</section>\n<ul class="btm_price J_orderbtnbox">\n    <%tmpPrice = retainTwoDecimal(curNum * (price.dPrice - (coupon ? coupon.amount : 0)) + (invoice && invoice.deliveryMethod == 1 ? 10 : 0))%>\n    <li class="item03">\n        <span class="text_transparent text_size12">订单总额：</span>¥<span id="J_totalPrice"><%=tmpPrice > 0 ? tmpPrice : 0%></span>\n    </li>\n\n    <li class="btm_tuan_btn" id="J_submitOrder">去支付</li>\n</ul>'
}),define("text!BookingSuccessTpl",[],function(){return'<section class="cont_wrap">\n    <!-- 需要增加零元团的判断以及文案,模板：您的订单已成功提交！我们会尽快处理-->\n    <div class="suc_txt">\n        <%if(status==3){%>\n            <div class="fail_ico"></div>很抱歉，您的订单支付失败!\n            <p class="para01">请重新下单支付或致电携程客服</p>\n            <a href="tel:4008216666" class="telnum" id="J_tel">400-821-6666</a>\n        <%}else{%>\n            <div class="suc_ico"></div>您的订单已成功提交!\n        <%}%>\n    </div>\n    <%if(oid && +oid>0){%>\n    <div class="suc_order arr_r" id="J_orderDetail">\n        <div class="title ellipsis"><%=pname %></div>\n        <a href="javascript:;" class="ui-link">订单详情</a>\n    </div>\n    <% } %>\n    \n    <!-- 券号和密码 -->\n    <% if (!_.isArray(coupons) || coupons.length > 0 ) { %>\n        <div id="J_codeAndPwd">\n            <% _.each(coupons, function(v, i){ %>\n                <% if(!_.isEmpty(v.pwd)) { %>\n                <ul class="coupon_list m_BorderRadius">\n                    <li><span class="title">券号<%=i + 1%></span><span class="num"><%=v.code%></span></li>\n                    <li><span class="title">密码</span><span class="<%= v.pwd === \'此团购无需密码\'?\'desc\':\'num\'%>"><%=v.pwd%></span></li>\n                </ul>\n                <% } %>\n            <% }) %>\n        </div>\n    <% } %>\n    <%if (!isNonUser && typeof sendcoupons !== \'undefined\' && sendcoupons) {%>\n        <div class="coupon_info">\n            <div class="title"><span class="yuan"><i>¥</i><%=sendcoupons %></span>团购红包免费送</div>\n            <div class="context">消费成功后，将自动发至“我的携程-优惠券”中</div>\n        </div>\n    <%}%>\n    <div id="J_recommendWrap" style="display:none"></div>\n    <ul class="subblist">\n        <li id="J_destLink" class="arr_r" data-dest-id="<%=dest.id%>" data-dest-url="<%=dest.url%>" data-dest-name="<%=dest.name%>"><%=dest.name%>旅游攻略</li>\n    </ul>\n    <%if(user && user.IsNonUser){%>\n    <div class="cont_box_white">\n        <p class="order_hint">填写手机号即可成为携程会员，马上获得<i>1000</i>积分和<i>800元</i>携程消费券哦！预订还可以累计积分。</p>\n        <div class="input_box">\n                <button class="btn_blue" id="J_registerBtn" value="">提交注册</button>\n        </div>\n    </div>\n    <% }%>\n</section>'}),define("text!CityListTpl",[],function(){return'<%if(data && data.length>0){ %>\n    <h2 class="city_type J_cityType">当前</h2>\n    <ul class="city_list current m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n        <li class="J_cityItem wraploading <%if(nearby==true){%>choosed<%}%>" data-name="正在获取您的位置…" data-id="positioning" data-filter=""><div class="ui-loading-inline"><div class="ui-loading"><span class="ico-loading"></span></div>正在获取您的位置…</div></li>\n        <% if(currentcityid!=undefined && currentcityid!="" && currentcityname!=undefined && currentcityname!=""){ %>\n        <li class="J_cityItem <% if(cityid && cityid == currentcityid){ %> choosed<%} %>" data-name="<%=currentcityname%>" data-id="<%=currentcityid%>" data-filter=""><%=currentcityname %><i>(<%=currentgroups %>)</i></li>\n        <% }else{ %>\n        <li class="J_cityItem currentcity" style="display:none;" data-name="" data-id="" data-filter=""></li>\n        <% } %>\n    </ul>\n\n\n    <% if(history && history.length>0){ %>\n        <h2 class="city_type J_cityType">历史选择</h2>\n        <ul class="city_list m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n        <%\n            for(var j in history){\n            var c=history[j];\n        %>\n        <li class="J_cityItem <% if(cityid && cityid == c.id){ %> choosed<%} %>" data-name="<%=c.name%>" data-id="<%=c.id%>" data-filter="<%=((c.jp?c.jp.toLowerCase():\'\')  + \' \' + ( c.initial?\'\':c.initial.toLowerCase())  + \' \' + c.name + \' \' + (c.py?c.py.toLowerCase():\'\') ) %>"><%=c.name %></li>\n        <%}%>\n        </ul>\n    <%}%>\n    <h2 class="city_type J_cityType">热门城市</h2>\n    <ul class="city_list m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n    <%for(var i = 0, olen = data.length, Item; i < olen; i++){\n        Item=data[i];\n        if(Item.tag=="热门" && Item.cities){\n            for(var j in Item.cities){\n            var c=Item.cities[j];\n    %>\n    <li class="J_cityItem <% if(cityid && cityid == c.id){ %> choosed<%} %>" data-name="<%=c.name%>" data-id="<%=c.id%>" data-filter="<%=((c.jp?c.jp.toLowerCase():\'\')+\' \'+(c.initial?\'\':c.initial.toLowerCase())+\' \'+c.name+\' \'+(c.py?c.py.toLowerCase():\'\'))%>"><%=c.name %></li>\n    <%\n            }\n        }\n    }\n    %>\n    </ul>\n\n    <div class="box-city-all" id="J_allCitiesBox">\n        <%\n            _.each(data, function(itm) {\n            if (itm.tag !== \'热门\' && itm.cities[0]) {\n        %>\n            <dl>\n                <dt class="ui-title J_cityTagTitle arr_down"><%=itm.tag %></dt>\n                <dd>\n                    <ul class="city_list allcity">\n                        <%\n                            _.each(itm.cities, function(ctm) {\n                        %>\n                            <li style="display: none;" class="J_cityItem <% if(ctm.isHot){ %> highlight<%} %>" data-name="<%=ctm.name %>" data-id="<%=ctm.id %>" data-filter="<%=((ctm.jp?ctm.jp.toLowerCase():\'\')+\' \'+(ctm.initial?\'\':ctm.initial.toLowerCase())+\' \'+ctm.name+\' \'+(ctm.py?ctm.py.toLowerCase():\'\'))%>"><%=ctm.name %> <span><%=ctm.cGroups %></span></li>\n                        <%\n                            }); //end each citites\n                        %>\n                    </ul>\n                </dd>\n            </dl>\n        <%\n            }//end if\n        %>\n        <%\n            });//end each data\n        %>\n    </div>\n<% } %>\n<p class="city_noresult" style="display:none;">没有结果</p>\n'}),define("text!CouponTpl",[],function(){return'<article class="cont_wrap">\n    <ul class="promo_list">\n        <li <%if (notUse) {%> class="choosed"<%}%> id="J_useCouponToggle">不使用优惠券</li>\n    </ul>\n    <div id="J_enterWrap">\n        <div class="tuan_title">输入优惠券码</div>\n        <div class="promo_form">\n            <input type="text" id="J_couponInput" />\n            <div class="promo_close" id="J_clearCoupon" style="display:none"></div>\n            <div class="promo_form_btn" id="J_validateCoupon">使用</div>\n        </div>\n    </div>\n    <%if (coupons.length) {%>\n    <div class="tuan_title">选择您可用的优惠券</div>\n    <ul class="other_promo_list" id="J_couponList">\n        <%  var couponTypeTxt = \'\';\n            _.each(coupons, function(item, index) {\n            if (item.couponType === 2) {\n                couponTypeTxt = \'限1单使用\';\n            } else if (item.couponType === 3) {\n                couponTypeTxt = \'可叠加使用\';\n            }\n        %>\n        <li data-index="<%=index%>" data-code="<%=item.code%>">\n            <div class="promo_num"><%=item.amount%></div>\n            <div class="title"><%=item.title%></div>\n            <div class="time">有效期至<%=dateFormat(item.edate)%> <%=couponTypeTxt %></div>\n        </li>\n        <%})%>\n    </ul>\n    <%} %>\n</article>'}),define("text!DetailTpl",[],function(){return'<article class="cont_wrap">\n<%\nvar MAX_WORDS = 100;\nvar STRIP_TAGS = /\\<\\/*br\\s*\\/*\\>/img;  //匹配HTML\nvar imgCount=0;\nvar imgSrc=\'http://pic.c-ctrip.com/common/pic_alpha.gif\';\n//去除HTML\nvar stripTags = function(str) {\n    return str.replace(STRIP_TAGS, \'\\n\').replace(/<[^>]+>/gm, \'\');\n};\n//把\\n转化成br\nvar replaceBrTag = function(str) {\n    return str.replace(/\\n/img, \'<br/>\');\n};\n//从字符串指定位置查找第一个非数字、字母的字符的位置\nvar getNonWordNum = function(str, num) {\n    if (str[num] && /[0-9a-zA-Z]/.test(str[num])) {\n        return getNonWordNum(str, num + 1);\n    } else {\n        return num;\n    }\n};\nif (data.images && data.images[0]) {\n    imgCount = data.images.length ;\n    if (data.images[0].large) imgSrc = data.images[0].large;\n}\nvar project = \'\', prompt = \'\', lightspot = \'\', lashouProject = \'\', tips = \'\', lashouTitle = \'\';\nif (data.contents && data.contents.length) {\n    for (var n = 0, content, type; n < data.contents.length; n++) {\n        content = data.contents[n];\n        type = content.type;\n        if (type == 1) {\n            project = content.memo;\n        } else if (type == 2) {\n            prompt = content.memo;\n        } else if (type == 3) {\n            lightspot = content.memo;\n        } else if (type == 5) {\n            lashouTitle = content.title;\n            lashouProject = content.memo;\n        } else if (type == 4) {\n            tips = content.memo;\n        }\n    }\n}\nvar category = data.category;\n//是否在线订门票\nvar isOnlineBookingTicket = category ? (category.ctgoryid == 6) && (category.subctgory == 2) : false;\n%>\n<nav class="tuan_pic" id="J_pic">\n    <img src="<%=imgSrc%>"/>\n    <div class="total_num">共<%=imgCount%>张</div>\n</nav>\n<nav class="tuan_name">\n    <div class="title"><%=data.name %></div>\n    <% if (!isOnlineBookingTicket) {%>\n        <%if (lightspot && lightspot.length) {%>\n        <p class="tuan_hotel_intro"><%=lightspot%></p>\n        <%}%>\n        <p class="tuan_hotel_info">\n            <span>已售<%=data.cSold %></span>\n            <span class="tuan_hotel_time"><%if (data.groupFlag && (parseInt(data.groupFlag) < 48)) {%>剩余48小时<%}else{%>剩余2天以上<%}%></span>\n            <span class="tuan_hotel_star"><%=data.star %></span>\n        </p>\n        <%if(data.additions && data.additions.length>0){%>\n        <ul class="tuan_policy dflex" id="J_service">\n            <%\n            for(var i=0; i<data.additions.length; i++){\n            switch(data.additions[i].type){\n            case 2:%>\n            <li class="ico_return"><%=data.additions[i].txt%></li>\n            <%break; case 1:%>\n            <li class="ico_refund"><%=data.additions[i].txt%></li>\n            <%break; case 3:%>\n            <li class="ico_free"><%=data.additions[i].txt%></li>\n            <%break;}%>\n            <%\n            }\n            %>\n        </ul>\n        <%}else{%>\n        <ul class="tuan_policy dflex no_tuan_policy">\n            <li class="ico_refund">不支持未消费退款</li><li class="ico_return">不支持过期退款</li>\n        </ul>\n        <%}%>\n        <!-- 有效期展示-->\n        <%if((data.unavailableDate||data.couponBdate)&&data.type!=2) {%><!--type==2为零元团，不展示有效期-->\n        <ul class="subblist">\n            <li class="info_valid">\n                <%if(data.couponBdate) {%>\n                <span class="subb_valid i_bef">有效期：<%=data.couponBdate %>至<%=data.couponEdate%></span>\n                <%} %>\n                <%if(data.unavailableDate) {%>\n                <div class="info_suit_not" style="display:none">不适用日期：<%=data.unavailableDate %></div>\n                <div class="align_r"><span class="view_unfold" id="J_expandInvalid">查看不适用日期</span></div>\n                <%} %>\n            </li>\n        </ul>\n        <%} %>\n    <%}%>\n</nav>\n\n<%if (data.hotels && data.hotels.length) {%>\n    <div class="neg_mb10">\n        <div class="hot_tit">商户信息</div>\n    </div>\n    <ul class="subblist">\n    <%if(data.pcId!=2 && data.score&&(data.score>0)){ %>\n        <!--餐饮不显示点评 -->\n         <li class="<%if(data.ccount>0){%>arr_r <%}%>comm_qr" <%if(data.ccount>0){%>id="J_comment"<%}%>>\n            <!-- 根据实际的分数改变宽度值即可 -->\n            <div class="comm_fen"><div class="comm_fen_in" style="width:<%=data.score*100/5%>%;"></div></div>\n            <div class="comm_fen_num"><%=data.score.toFixed(1)%></div>\n            <span class="icon_txt"><%=data.ccount %>人点评</span>\n         </li>\n    <% }%>\n    <%\n    var hotel = data.hotels[0];\n    var addr = hotel && hotel.addr;\n    var hotelId = hotel && hotel.id;\n    var coords = hotel.coords[0];\n    var isShowMap=addr&&coords&&coords.lat&&coords.lon&&(coords.lat>-1&&coords.lat<1000)&&(coords.lon>-1&&coords.lon<1000);\n    var hotelTel = hotel.phoneList;\n    %>\n    <% if(addr || (hotelTel && hotelTel.length) || (data.features && data.features.length)){ %>\n        <% if(addr){ %>\n        <li class="<%if(addr&&isShowMap) {%>arr_r J_showDetailMap<%} %>" data-hotel-name="<%=hotel.shortName || hotel.name%>" data-coords="<%=coords.lon%>,<%=coords.lat%>">\n              <span class="subb_address i_bef"><%=(addr?addr:"暂无地址信息") %></span>\n              <%if(isShowMap){ %><span class="icon_txt">地图</span><%} %>\n        </li>\n        <%}%>\n    <%if(hotelTel && hotelTel.length){\n        var phones = _.map(hotelTel, function(p) {return p.phone;});\n    %>\n        <li class="arr_r wrap_phone J_phone" data-phone=\'<%=phones.join(",") %>\'>\n            <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n            <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n        </li>\n    <%} %>\n    <!-- 特色服务 -->\n    <%if(data.features && data.features.length){\n        var features = data.features,\n            featuresCount = features.length,\n            i=0,\n            feature,\n            featuresClsMap = {\n                MFTC: \'ico_parking\',\n                MFTX: \'ico_slippers\',\n                MF24XSRS: \'ico_hotwater\',\n                MFPZS: \'ico_water\',\n                MFXYYP: \'ico_toiletries\',\n                MFWIFI: \'ico_wifi_free\',\n                MFKD: \'ico_net\',\n                MFZC: \'ico_breakfast\'\n            };\n    %>\n    <li class="info_service noactive">\n      <%for(; i < featuresCount; i++) {\n         feature=features[i];\n      %>\n          <span><b class="<%=featuresClsMap[feature.code] %>"></b><%=feature.name %></span>\n      <%} %>\n    </li>\n    <%} %>\n  <%}%>\n  </ul>\n<%}%>\n    <%if(data.pcId === 1 && hotelId){%>\n    <ul class="subblist">\n        <li class="arr_r" data-hotel-id="<%=hotelId%>" id="J_gotoHotelDetail">查看更多商户信息</li>\n    </ul>\n    <%}%>\n    <%\n    var recommendHotel = data.recommendHotel;\n    var hotelData = recommendHotel && recommendHotel.hotel;\n    var coords;\n    if(hotelData){\n        _.each(hotelData.coords, function(item) {\n            if (item.type==3) {\n              coords = item.lon + \',\' + item.lat;\n            }\n        });\n    %>\n        <div class="neg_mb10">\n            <div class="hot_tit"><%=recommendHotel.title%></div>\n        </div>\n        <ul class="subblist">\n            <li class="arr_r J_showDetailMap" data-hotel-name="<%=hotelData.shortName || hotelData.name%>" data-coords="<%=coords%>">\n                <span class="subb_address i_bef"><%=hotelData.addr%></span>\n                <i class="icon_txt">地图</i>\n            </li>\n            <%if(hotelData.phoneList && hotelData.phoneList.length){\n                var phones = _.map(hotelData.phoneList, function(p) {return p.phone;});\n            %>\n            <li class="arr_r wrap_phone J_phone" data-phone="<%=phones.join(\',\')%>">\n                <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n                <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n            </li>\n            <%}%>\n        </ul>\n    <%}%>\n    <%if(data.cGroups>1){%>\n    <ul class="subblist">\n        <li id="J_branch" class="arr_r">查看全部<%=data.cGroups%>家商户</li>\n    </ul>\n    <%}%>\n\n    <!--判断非拉手产品 -->\n    <%if(!lashouProject || isOnlineBookingTicket){%>\n    <div class="neg_mb10">\n        <div class="hot_tit">团购包含</div>\n    </div>\n    <nav class="tuan_content">\n        <%\n            project = stripTags(project);\n            var nonWordNum = getNonWordNum(project, MAX_WORDS);\n        %>\n        <p><%=(replaceBrTag(project.substr(0, nonWordNum)) || "暂无相关信息")%>\n            <%if (project.length > nonWordNum) {%>\n                <span style="display:none" class="J_tipsHidden"><%=replaceBrTag(project.substr(nonWordNum))%></span>\n            <%}%>\n        </p>\n        <%if (project.length > nonWordNum) {%>\n        <p class="tac"><a href="javascript:;" class="view_unfold J_viewMoreBtn" data-state="hide">查看全部</a></p>\n        <%}%>\n    </nav>\n    <%}%>\n    <div class="neg_mb10">\n        <div class="hot_tit">特别提示</div>\n    </div>\n    <nav class="tuan_content" data-id="2">\n        <%if(prompt && prompt.length > 0){%>\n            <%\n                prompt = stripTags(prompt);\n                var nonWordNum = getNonWordNum(prompt, MAX_WORDS);\n            %>\n            <div class="tipsPanel"><%=replaceBrTag(prompt.substr(0, nonWordNum))%>\n                <%if (prompt.length > nonWordNum) {%>\n                <span style="display:none" class="J_tipsHidden"><%=replaceBrTag(prompt.substr(nonWordNum))%></span>\n                <%}%>\n            </div>\n            <%if (prompt.length > nonWordNum) {%>\n            <p class="tac"><a href="javascript:;" class="view_unfold J_viewMoreBtn" data-state="hide">查看全部</a></p>\n            <%}%>\n        <%}else{%>暂无相关信息<%}%>\n    </nav>\n    <!--拉手产品的详情需要展示在特别提示的后面 @since v2.6-->\n    <% if (lashouProject){%>\n    <ul class="subblist">\n        <li id="J_groupContain" class="arr_r"><span><%=lashouTitle || \'团购包含\'%></span><i class="icon_txt"><a href="###">查看详情</a></i></li>\n    </ul>\n    <%}%>\n    <%if(data.relatedProducts&&data.relatedProducts.length>0) {%>\n    <div class="neg_mb10">\n          <div class="hot_tit">该商户其他团购</div>\n    </div>\n    <ul class="tuan_list_other">\n      <% var MAX_VISIBLE = 10;//最大显示数量\n      _.each(data.relatedProducts,function(data, num){\n       %>\n      <li <%if(num>=MAX_VISIBLE){%>style="display:none"<%}%> class="J_relatedProducts <%if(num>=MAX_VISIBLE){%>J_relatedRest<%}%> arr_r" data-id="<%=data.id %>">\n        <div class="ellipsis"><%=data.name %></div>\n        <div class="tuan_price">\n          &yen;<%=data.dPrice %>\n        </div>\n      </li>\n      <%}) %>\n    </ul>\n    <%if(data.relatedProducts&&data.relatedProducts.length>MAX_VISIBLE) {%>\n    <p class="tuan_list_more"><a href="javascript:;" id="J_morehotel" class="view_unfold">更多</a></p>\n    <%}%>\n    <%} %>\n    <%if(data.nearGroupsCount>=2 && data.price.dPrice>0){%>\n    <div class="mod_group">\n        <div class="mod_group_tit">小伙伴们还看了\n            <%if(data.nearGroupsCount!=2 && data.nearGroupsCount!=4){ %>\n                <span id="J_recommendNearby" >更多</span>\n            <%} %>\n        </div>\n        <div class="mod_group_list">\n            <ul>\n            <% _.each(data.nearGroups,function(data,num){%>\n                <li class="J_nearProducts" data-id="<%=data.id %>">\n                    <div class="pic_thumb">\n                        <img src="<%=data.imgUrl %>" alt="" width="150" height="112">\n                    </div>\n                    <div class="hotel_info">\n                        <div class="hotel_tit"><%=data.name %></div>\n                        <div class="hotel_price">\n                            <span class="txt_color01"><dfn>¥</dfn><%=data.price.dPrice %></span>\n                            <del class="txt_color02">\n                                <dfn>¥</dfn><%=data.price.cPrice %>\n                            </del>\n                        </div>\n                    </div>\n                    <div class="ui-distance"><span class="subb_address i_bef"></span>距离该商户<%=data.distance > 1 ? (data.distance.toFixed(1) + \'公里\') : (Math.round(data.distance * 1000) + \'米\')%></div>\n                </li>\n            <%})%>\n            </ul>\n        </div>\n    </div>\n    <%}%>\n    <%if(tips&&tips.length>0){%>\n        <a class="linktips J_tips" style="margin-bottom:0" href="javascript:;" data-id="4">点击马上团代表您已阅读并同意<span>携程团购温馨提示</span></a>\n    <%}%>\n    <div style="height:45px;"></div>\n    <ul class="btm_price">\n        <li class="item01"><del>&yen;<%=data.price.cPrice %></del></li>\n        <li class="item02">\n            <%if(data.activities && data.activities[0]){\n                var type = data.activities[0].type;\n            %>\n            <%if(type==2) {%>\n            <span class="ico-text">返<i>¥</i><%=data.activities[0].arg%></span><!--返现-->\n            <%}%>\n            <%if(type==3) {%>\n            <span class="ico-text">礼<i>&yen;</i><%=data.activities[0].arg%></span><!--礼品卡-->\n            <%}%>\n            <%}%>\n            &yen;<%=data.price.dPrice %><!--原价-->\n        </li>\n        <li class="btm_tuan_btn" id="J_submit">马上团</li>\n    </ul>\n</article>\n'}),define("text!DetailTipsTpl",[],function(){return'<article class="cont_pd_wrap"><%if(data.memo){ %><%=(decodeURI(data.memo))%> <%} %></article>'}),define("text!HotelCommentsTpl",[],function(){return'<section class="cont_wrap">\n    <section class="comm_review" id="J_commTotal"></section>\n    <div class="tuan_title">用户点评</div>\n    <section class="comm_review" id="J_commList"></section>\n</section>\n\n<script type="text/template" id="J_commTotalTpl">\n    <div class="comm_overall">\n        <div class="comm_title">总评</div>\n        <div class="comm_fen">\n            <div class="comm_fen_in" style="width:<%=(custPt/5)*100%>%;"></div>\n        </div>\n        <div class="comm_fen_num"><%= custPt.toFixed(1) %></div>\n        <div class="comm_recomm"><%= (percent*100).toFixed(0)%>%用户推荐</div>\n    </div>\n    <ul class="dflex comm_score">\n        <li>卫生：<%= ratPt.toFixed(1) %></li>\n        <li>环境：<%= raatPt.toFixed(1) %></li>\n        <li>服务：<%= servPt.toFixed(1) %></li>\n        <li>设施：<%= faclPt.toFixed(1) %></li>\n    </ul>\n</script>\n\n<script type="text/template" id="J_commListTpl">\n    <% _.each(cmts,function(cmt){ %>\n    <article class="comm_list">\n        <div class="comm_user"><span><%=dateFormat(cDate.parse(cmt.date,true), "Y-m-d") %></span><%= cmt.nick %></div>\n        <div class="comm_overall">\n            <div class="comm_title">评分</div>\n            <!-- 根据实际的分数改变宽度值即可 -->\n            <div class="comm_fen">\n                <div class="comm_fen_in" style="width:<%= ((cmt.custPt/5)*100) %>%;"></div>\n            </div>\n        </div>\n        <ul class="dflex comm_score">\n            <li>卫生：<%= cmt.ratPt.toFixed(1) %></li>\n            <li>环境：<%= cmt.raatPt.toFixed(1) %></li>\n            <li>服务：<%= cmt.servPt.toFixed(1) %></li>\n            <li>设施：<%= cmt.faclPt.toFixed(1) %></li>\n        </ul>\n        <p class="comm_review_p"><%= cmt.content %></p>\n    </article>\n    <%}) %>\n</script>'}),define("text!HotelImagesTpl",[],function(){return'<article class="cont_wrap">\n    <div class="detail_pics">\n        <ul class="detail_pics_in">\n            <% _.each(obj, function(v, i) { %>\n            <li data-index="<%=i+1%>">\n                <img class="fade-in" src="<%=v.small%>" />\n            </li>\n            <% }) %>\n        </ul>\n    </div>\n</article>'}),define("text!HotelImageSlideTpl",[],function(){return'<div class="pics_show_box_in" style="height:180px;width:9999px;font-size:0;/*解决换行空格问题*/">\n    <%for(var i=0,len=data.length;i<len;i++){%>\n    <%var item = data[i]%>\n    <div class="pics_show_box_items" style="display: inline-block">\n        <img class="fade-in" data-href="<%=item.href%>" data-src="<%=item.src%>" data-img-id="<%=item.id%>" data-img-title="<%=item.title%>"/>\n    </div>\n    <%}%>\n</div>\n<p id="J_picDesc"></p>'}),define("text!HotelMapTpl",[],function(){return'<script type="application/x-javascript">addEventListener(\'DOMContentLoaded\',function(){setTimeout(function(){scrollTo(0,1);},0);},false);</script>\n<section id="J_hotelmapWrap"  class="cont_pd_wrap" style="margin: 0px; padding: 0px;">\n    <div class="ico_map_return" id="J_return"></div>\n    <div style="margin: 0px; padding: 0px;">\n        <div class="map-container" id="J_mapContainer"></div>\n    </div>\n    <div class="ico_map_navigate" id="J_navigator">导航</div>\n</section>\n<script type="text/template" id="J_centerMarkerTpl">\n    <img src="http://pic.c-ctrip.com/h5/tuan/hotel-map-locate2.png" style="width: 14px; height: 36px;">\n    <div id="J_label" class="ico_map" style="-webkit-transform: translate(-50%, -90px) !important; left: 50%; max-width:none;"><p title="<%=title%>"><%=title%></p></div>\n</script>\n'}),define("text!HotelServiceTpl",[],function(){return'<section class="cont_wrap">\n  <img src="http://pic.c-ctrip.com/h5/tuan//service.jpg" alt="" width="100%" class="service_img" />\n  <section class="service_box">\n    <div class="service_title ico_refund">未消费随时退</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>团购成功但未消费此券 → 登录“我的携程” → 在“团购订单”中“申请退款” → 审核通过后退款至携程钱包现金余额/原支付账户</dd>\n      <dt>退款时间</dt>\n      <dd>a)退至现金余额：退款申请审核通过后，会在1-2个工作日把款项退回到您的携程钱包现金账户，礼品卡支付部分退回至礼品卡账户。携程钱包现金余额可再次购买团购产品时直接冲抵现金。（此服务不收取任何手续费）<br/>\n          b) 原路退回：退款申请审核通过后，会在2-10个工作日把款项退回到您的原支付账户。（此服务不收取任何手续费）</dd>\n      <dt>以下情况不适用</dt>\n      <dd>1. 已消费的携程团购券<span class="service_txt_hl">（包括：在线预约成功的，电话预约成功的，已经使用或入住的）</span></dd>\n      <dd>2. 在产品说明中明确标明不支持"未消费，随时退"的产品或服务</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_return">券过期未消费，无条件返还</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>团购成功但未消费此券 → 登录“我的携程” → 在“团购订单”中“申请退款” → 审核通过后退款至携程钱包现金余额/原支付账户</dd>\n      <dt>退款时间</dt>\n      <dd>a) 退至现金余额：退款申请审核通过后，会在1-2个工作日把款项退回到您的携程钱包现金账户，礼品卡支付部分退回至礼品卡账户。携程钱包现金余额可再次购买团购产品时直接冲抵现金。（此服务不收取任何手续费）<br/>\n          b) 原路退回：退款申请审核通过后，会在2-10个工作日把款项退回到您的原支付账户。（此服务不收取任何手续费）</dd>\n      <dt>以下情况不适用</dt>\n      <dd>1. 已消费的携程团购券<span class="service_txt_hl">（包括：在线预约成功的，电话预约成功的，已经使用或入住的）</span></dd>\n      <dd>2. 在产品说明中明确标明不支持"券过期未消费，无条件退款"的产品或服务</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_free">消费不满意，携程来免单</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>商家未兑现服务承诺  →  立刻联系携程客服10106666  →  经携程客服核实确认后  →  给予立即退款</dd>\n      <dt>保障适用范围</dt>\n      <dd>1. 商家提供给携程会员的产品或服务与其承诺的产品或服务内容严重不符</dd>\n      <dd>2. 商家提供的产品出现严重质量问题，或有违反《中华人民共和国消费者权益保护法》，《中华人民共和国产品质量法》的情况</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_comments">全场点评信息，客观真实不造假</div>\n    <dl class="service_con">\n      <dd>全场所呈现的所有产品点评均出自真实消费者的入住亲身体验，100%真实有效，我们不做任何优化排序、造假或者篡改，保留所有好评及差评，为您的选择提供可靠参考！</dd>\n    </dl>\n  </section>\n</section>\n'}),define("text!HotelSubbranchTpl",[],function(){return'<%\n    var hotel = data && data[0];\n    var hotelInfos = hotel ? hotel.HotelInfos : [];\n    var isCurrentCity = hotelInfos[0] && hotelInfos[0].score < 0;\n%>\n<%if (isCurrentCity) {%>\n<div class="cur_pos cur_pos_has"><a href="javascript:;" class="cur_reload" id="J_relocation"></a><span id="J_gpsAddr">距离: 您的位置 <%=gps.address%></span></div>\n<%}%>\n<section class="cont_wrap"<%if (isCurrentCity) {%> style="padding-top:30px"<%}%> >\n<%_.each(data, function(hotel, index){%>\n    <div class="business_list">\n        <div class="busi_city_wrap J_busiCity <%= index==0 ?\'J_sticky\': \'\'%>">\n            <div class="busi_city"><%=hotel.ctyName %><span class="<%if(index == 0){%>arrow_skin01_up<%}else{%>arrow_skin01_down<%}%> J_arrow"></span></div>\n        </div>\n        <div class="busi_hotel J_busiHotel"<%if(index == 0){%> style="display:block;"<%}%>>\n            <% _.each(hotel.HotelInfos, function(hotelinfo){ %>\n            <%var isValidLngLat = hotelinfo.lon>0 && hotelinfo.lat>0 && hotelinfo.lon<1000 && hotelinfo.lat<1000 %>\n            <ul class="subblist">\n                <li class="<%= hotelinfo.hotelId ? \'arr_r\': \'\' %> J_jumpHotel" data-id="<%=hotelinfo.hotelId || \'\'%>" >\n                    <div class="hotelname"><%=hotelinfo.name %></div>\n                    <%if (isCurrentCity) {%>\n                        <%if (index == 0) {%><span class="icon_txt"><%=hotelinfo.distance > 1 ? (hotelinfo.distance.toFixed(1) + \'公里\') : (parseInt(hotelinfo.distance * 1000) + \'米\')%></span><%}%>\n                    <%} else {%>\n                        <%if(hotelinfo.score > 0){%><span class="icon_txt"><%=hotelinfo.score.toFixed(1) + \'分\'%></span><%}%>\n                    <%}%>\n                </li>\n                <li class="<%if(isValidLngLat){%>arr_r J_showMap<%} %>" data-coords="<%= hotelinfo.lon %>,<%= hotelinfo.lat %>" data-hotel-name="<%= hotelinfo.name %>">\n                    <span class="subb_address i_bef"><%= hotelinfo.adr %></span>\n                    <%if(isValidLngLat) {%><i class="icon_txt">地图</i><%} %>\n                </li>\n                <%if (hotelinfo.phoneList && hotelinfo.phoneList.length) {\n                    var phones = _.map(hotelinfo.phoneList, function(p) {return p.phone;});\n                %>\n                <li class="arr_r wrap_phone J_phone" data-phone=\'<%=phones.join(",") %>\'>\n                    <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n                    <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n                </li>\n                <%}%>\n\n\n                <!--<li <%if(hotelinfo.splitphone){%>class="J_phone"<%} %> data-tel="<%=hotelinfo.splitphone %>">\n                    <span class="subb_phone i_bef"><%= hotelinfo.tel %></span>\n                    <%if(hotelinfo.splitphone){%><i class="icon_txt">预约/咨询</i><%} %>\n                </li>-->\n\n                <%if (hotelinfo.userGuide){%><li class="li_info"><%=hotelinfo.userGuide%></li><%}%>\n            </ul>\n            <%}) %>\n        </div>\n    </div>\n<%}) %>\n</section>\n\n<!--\n@PRD http://doc.ui.sh.ctriptravel.com/axure/tuangou6.0/#p=产品详情页-评分最高商户信息重新定义\n\n同城且定位，距离\n 1、默认展开显示当前城市包含全部适用商户信息（需展示适用商户距离用户定位的距离信息）\n 2、折起显示其他适用商户所在城市名称，点开后展示对应城市包含全部适用商户信息（无需展示距离信息）\n\n异地或非定位，评分\n 1、默认展开显示当前城市包含全部适用商户信息（需展示适用商户评分信息，当评分为0时不展示）\n 2、折起显示其他适用商户所在城市名称，点开后展示对应城市包含全部适用商户信息（需展示适用商户评分信息，当评分为0时不展示）\n-->\n'}),define("text!LashouTpl",[],function(){return'<article class="cont_wrap lashou"> \n<%=content.memo %>\n<div style="height:44px"></div>\n<ul class="btm_price">\n    <li class="item01"><del>原价&yen;<%=price.cPrice %></del></li>\n    <li class="item02">\n        <%if(activities && activities[0]){\n            var type = activities[0].type;\n        %>\n        <%if(type==2) {%>\n        <span class="ico-text">返<i>¥</i><%=activities[0].arg%></span><!--返现-->\n        <%}%>\n        <%if(type==3) {%>\n        <span class="ico-text">礼<i>&yen;</i><%=activities[0].arg%></span><!--礼品卡-->\n        <%}%>\n        <%}%>\n        &yen;<%=price.dPrice %><!--原价-->\n    </li>\n    <li class="btm_tuan_btn" id="J_submit">马上团</li>\n</ul>\n</article>\n'}),define("text!InvoiceTpl",[],function(){return'<section class="cont_wrap">\n    <ul class="invoice_cont">\n        <li>需要发票<input type="checkbox" id="J_needInvoice" class="dn" /><label class="btn_switch"></label></li>\n    </ul>\n    <ul class="invoice_cont" id="J_invoiceWrap">\n        <li>发票抬头<span class="tips_txt01"><input id="J_invoiceTitle" type="text" placeholder="请输入发票抬头" /></span></li>\n        <li>收件人<span class="tips_txt02"><input id="J_recipient" type="text" placeholder="个人姓名或公司名称" /></span></li>\n        <li class="arr_r" id="J_region" data-region-index="2,2,2">所在地区<span class="tips_txt01" id="J_regionText"></span></li>\n        <li>收件地址<span class="tips_txt02"><input id="J_addr" type="text" placeholder="请输入收件地址" /></span></li>\n        <li>邮编<span class="tips_txt02"><input id="J_zip" type="text" /></span></li>\n        <li class="arr_r" id="J_delivery" data-delivery-method="0">配送方式<span id="J_deliveryText" class="tips_txt01">平信(免费)</span></li>\n    </ul>\n    <p class="tips_attention" id="J_deliveryTips">发票在您的团购券使用后10个工作日内以平信方式送达。</p>\n</section>\n'}),define("text!KeywordSearchTpl",[],function(){return'<div style="position: fixed;width:100%;height:56px;z-index:2;">\n       <section id="J_keywordSearch" class="search_wrap">\n           <div class="history_close" id="J_cancel">\n               <span class="hclose">取消</span>\n           </div>\n           <form>\n           <div class="place_search_box  clear-input-box">\n                <input id="J_keywordInput" type="search" class="place_search abs_size" placeholder="位置/品牌/名称" value=""  />\n                <div class="s_city_loading"  style="display:none"></div>\n           </div>\n            </form>\n       </section>\n </div>\n<div style="height:53px;width:100%"></div>\n<section id="J_keywordSuggestWrap" class="city_box">\n    <div id="js_hotkeyword"></div>\n    <div id="js_historykeysearch"></div>\n</section>\n<script type="text/template" id="J_hotKeywordsTpl">\n    <div class="his_list border_b">\n        <p class="title">热门搜索</p>\n        <div class="switch_hot">\n            <div class="sw_clip">\n                <%var num =Math.ceil(data.length / 6);%>\n                <%for(var i = 1; i <= num ; i++){%>\n                <ul class="sw_con" >\n                    <%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%>\n                    <li data-json=<%=encodeURIComponent(JSON.stringify(data[index]))%>><%=data[index].word%></li>\n                    <%}%>\n                </ul>\n                <%}%>\n            </div>\n            <%if(num > 1){%>\n            <p class="sw_nav">\n                <%for(var ni=0; ni< num; ni++){%>\n                <i js_index="<%=ni%>" class="<%if(ni==0){%>current<%}%>"></i>\n                <%}%>\n            </p>\n            <%}%>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="J_keywordSuggestTpl">\n     <%if(data){%>\n        <%if(data.history && data.history.length>0){%>\n            <ul class="filterbox J_historykeysearch">\n            <%for(var i=0, olen=data.history.length, c; i < olen; i++) {\n                    c=data.history[i];\n            %>\n                <li class="J_resultItem city_item <% if(keyid && keyid == c.id){ %> choosed<%} %>" data-type="<%=c.type%>" data-name="<%=c.word%>" data-id="<%=c.id%>" data-filter="<%=c.word%>"><%=c.word %></li>\n            <%}%>\n            </ul>\n            <div class="base_btn01_wrap_b neg_mgt20 J_clearhistory">\n                <div class="base_btn01">清除搜索历史</div>\n            </div>\n        <%}%>\n        <%if(data.Results&&data.Results.length>0){%>\n        <ul class="city_list searchresult">\n        <%\n            _.each(data.Results, function(t) {\n        %>\n                <li class="J_resultItem city_item <% if(keyid && keyid == t.id){ %> choosed<%} %>" data-type="<%=t.type%>" data-name="<%=t.word%>" data-id="<%=t.id%>" data-filter="<%=t.word%>"><%=t.wordNew %><span class="cate"><%=t.typeNew %></span></li>\n        <%});%>\n        </ul>\n        <%}else if(data.Results){%>\n         <p class="city_noresult">抱歉，没有搜索到相关信息</p>\n        <%\n        }\n    }\n    %>\n</script>'
=======
!function(){var t=Lizard.WebresourcePDBaseUrl,e="undefined"!=typeof location&&-1!=location.search.indexOf("debug=1"),i={paths:{TuanApp:t+"tuanapp",TuanStore:t+"models/tuanstore",TuanModel:t+"models/tuanmodel",DropDown:t+"com/dropdown",TuanFilters:t+"widget/tuanfilters",SmoothSlide:t+"widget/slide",TabSlide:t+"widget/tabslide",Switch:t+"com/switch",VoiceSearch:t+"widget/voicesearch",StoreManage:t+"util/storemanage",HttpErrorHelper:t+"util/httperrortpl",NumberStep:t+"com/numberstep",Payment:t+"widget/payment",WechatShare:t+"widget/wechatshare",ScrollObserver:t+"util/scrollobserver",MemCache:t+"util/memcache",AMapWidget:t+"widget/amap",POIWidget:t+"widget/poi",LazyLoad:t+"com/lazyload",CallPhone:t+"com/callPhone",FilterXss:t+"util/filterxss",CityListData:t+"data/citylist",StringsData:t+"data/strings",Tab:t+"com/tab",PageHistory:t+"com/history",ConsoleDebug:t+"debug/console",PageTreeConfig:t+"com/pagetreeconfig",TuanBaseView:t+"com/baseview",ValidatorUtil:t+"util/form/validator",FieldUtil:t+"util/form/field",HomeTpl:t+"templates/home.html",ListProductTpl:t+"templates/list.product.html",ListBusinessTpl:t+"templates/list.business.html",BookingTpl:t+"templates/booking.html",BookingSuccessTpl:t+"templates/booking.success.html",CityListTpl:t+"templates/citylist.html",CouponTpl:t+"templates/coupon.html",DetailTpl:t+"templates/detail.html",DetailTipsTpl:t+"templates/detail.tips.html",HotelCommentsTpl:t+"templates/hotel.comments.html",HotelImagesTpl:t+"templates/hotel.images.html",HotelImageSlideTpl:t+"templates/hotel.imageslide.html",HotelMapTpl:t+"templates/hotel.map.html",HotelServiceTpl:t+"templates/hotel.service.html",HotelSubbranchTpl:t+"templates/hotel.subbranch.html",LashouTpl:t+"templates/lashou.html",InvoiceTpl:t+"templates/invoice.html",KeywordSearchTpl:t+"templates/keywordsearch.html",NearListTpl:t+"templates/near.list.html",RefundTpl:t+"templates/refund.html",RefundTipTpl:t+"templates/refund.tip.html",TuanOrderDetailTpl:t+"templates/tuanorderdetail.html",OrderDetailItemTpl:t+"templates/order.detail.item.html",RecommendTpl:t+"templates/recommend.html",MapNavTpl:t+"templates/hotel.map.nav.html"}};e&&(i.urlArgs=Date.now()),require.config(i)}(),define("config",function(){}),define("PageTreeConfig",[],function(){var t={home:{prev:"",url:"/webapp/tuan/home",range:[]},list:{prev:"home",url:"/webapp/tuan/list",range:["home"]},lottery:{prev:"home",url:"/webapp/tuan/lottery",range:["home"]},localfeature:{prev:"home",url:"/webapp/tuan/localfeature",range:["home"]},listmap:{prev:"list",url:"/webapp/tuan/listmap",range:["list"]},detail:{prev:"list",url:"/webapp/tuan/detail/{did}.html?cityid={cityid}",range:["list","detail","home","nearlist","tuanorderdetail","listmap","bookingsuccess"],params:{did:0,cityid:0}},detailtips:{prev:"detail",url:"/webapp/tuan/detailtips",range:["detail"]},lashou:{prev:"list",url:"/webapp/tuan/lashou/{pid}.html",range:["detail"],params:{pid:0}},citylist:{prev:"home",url:"/webapp/tuan/citylist",range:[]},hotelimages:{prev:"detail",url:"/webapp/tuan/hotelimages/{did}.html",range:["detail"],params:{did:0}},hotelimageslide:{prev:"hotelimages",url:"/webapp/tuan/hotelimageslide?index={imgindex}",range:["hotelimages"],params:{imgindex:1}},hotelcomments:{prev:"detail",url:"/webapp/tuan/hotelcomments",range:["detail"]},hotelservice:{prev:"detail",url:"/webapp/tuan/hotelservice",range:["detail"]},hotelmap:{prev:"detail",url:"/webapp/tuan/hotelmap?lon={lon}&lat={lat}&hotelName={hotelname}",range:["detail","tuanorderdetail","hotelsubbranch"],params:{lon:0,lat:0,hotelname:""}},hotelmapnav:{prev:"hotelmap",url:"/webapp/tuan/hotelmapnav?url={url}",range:["hotelmap"],params:{url:""}},booking:{prev:"detail",url:"/webapp/tuan/booking",range:["detail"]},bookingsuccess:{prev:"list",url:"/webapp/tuan/bookingsuccess/{orderid}.html",range:["list"],params:{orderid:0}},coupon:{prev:"booking",url:"/webapp/tuan/coupon",range:["booking"]},invoice:{prev:"booking",url:"/webapp/tuan/invoice",range:["booking"]},calendar:{prev:"booking",url:"/webapp/tuan/calendar",range:["booking"]},hotelsubbranch:{prev:"detail",url:"/webapp/tuan/hotelsubbranch",range:["detail"]},keywordsearch:{prev:"home",url:"/webapp/tuan/keywordsearch",range:["home","list"]},nearlist:{prev:"detail",url:"/webapp/tuan/nearlist",range:["detail","bookingsuccess","tuanorderdetail"]},tuanorderdetail:{prev:"home",url:"/webapp/tuan/tuanorderdetail/{orderid}.html",range:["home","bookingsuccess"],params:{orderid:0}},refund:{prev:"home",url:"/webapp/tuan/refund/{orderid}.html",range:["home","tuanorderdetail"],params:{orderid:0}},refundtip:{prev:"tuanorderdetail",url:"/webapp/tuan/refundtip",range:["tuanorderdetail"]}};return t}),define("PageHistory",["c","cStore","PageTreeConfig"],function(t,e,i){function n(t){return null===t||void 0===t}function a(t){this.data={};for(var e in t)t[e]&&this.add(e,t[e].url,t[e].prev,t[e].jump,t[e].range,t[e].params)}function s(){this.stack=c.getInstance()}var o=t.base,r=/\{([^\{\}]+)\}/g;a.prototype={constructor:a,buildNode:function(t,e,i,n,a,s){return{id:t,prev:i,url:e,jump:n||!1,range:a,params:s||{}}},add:function(t,e,i,n,a,s){this.data[t]=this.buildNode(t,e,i,n,a,s)},getNode:function(t,e){var i=this.data[t];if(!i)return null;var a=i.param||{};e=e||{};var s=(i.url||"").replace(r,function(t,i){return n(e[i])?n(a[i])?"":a[i]:e[i]});return{id:i.id,prev:i.prev,url:i.url,reurl:s,jump:i.jump,range:i.range}},getPrevNode:function(t,e){var i=this.data[t],a=i&&i.prev&&this.data[i.prev]&&this.data[i.prev];if(!a)return null;e=e||{};var s=a.params||{},o=(a.url||"").replace(r,function(t,i){return n(e[i])?n(s[i])?"":s[i]:e[i]});return{id:a.id,url:a.url,prevurl:o,prev:a.prev,jump:a.jump,range:a.range}}};var l=new a(i),c=new o.Class(e,{__propertys__:function(){this.key="P_TUAN_HISTORY_STACK",this.lifeTime="30D",this.isUserData=!0},initialize:function($super,t){$super(t)},pop:function(){var t=this.getAttr("history")||[],e=t.pop();return this.setAttr("history",t),e},push:function(t,e){var i=this.getAttr("history")||[],n=Math.max(0,i.length-1);e?i[n]=t:i.push(t),this.setAttr("history",i)},top:function(){var t=this.getAttr("history")||[],e=Math.max(0,t.length-1);return t[e]},length:function(){var t=this.getAttr("history");return t&&t.length||0},clear:function(){this.setAttr("history",[])},index:function(t){var e=this.getAttr("history")||[];return t=0>t?e.length+t:t,e[t]},addCache:function(t,e,i){var n={id:t,obj:e,replace:i};this.setAttr("cache",n)},getCache:function(){return this.getAttr("cache")||{}},clearCache:function(){this.setAttr("cache",{})},popById:function(t){for(var e=this.getAttr("history")||[],i=-1,n=0,a=null,s=e.length-1;s>-1;s--)if(n++,e[s].id===t){i=s;break}return i>-1&&(a=e.splice(i,n)),this.setAttr("history",e),a},addSequeHistory:function(t){var e=this.getAttr("sequehistory")||[],i=Math.max(0,e.length-1),n=e[i]||{};n.id!==t.id&&(e.length>10&&e.splice(0,3),e.push(t),this.setAttr("sequehistory",e))},getSequeTop:function(t){var e=this.getAttr("sequehistory")||[],i=Math.max(0,e.length-1),n=null;return e[i]&&(e[i].id!=t?n=e[i]:e[i-1]&&(n=e[i-1])),n}});s.prototype={constructor:s,push:function(t,e,i,n){this.stack.addCache(t,s.buildEntry(t,e,i),n)},confirmPush:function(t){var e=this.stack.getCache();e.id===t&&(this.stack.push(e.obj,e.replace),this.stack.clearCache())},pop:function(){return this.stack.pop()},top:function(){return this.stack.top()},index:function(t){return this.stack.index(t)},clear:function(){this.stack.clear()},getCache:function(){return this.stack.getCache()},clearCache:function(){this.stack.clearCache()},popById:function(t){return this.stack.popById(t)},addSequeHistory:function(t){this.stack.addSequeHistory(t)},getSequeTop:function(t){return this.stack.getSequeTop(t)}},s.buildEntry=function(t,e,i){return{id:t,url:e,ver:i}};var d="_____FROM_____",p=function(t,e){this.tree=t,this.stack=e};p.prototype={constructor:p,back:function(t,e){var i=this.stack.pop(),n=this.stack.top(),a=this.tree.getPrevNode(t,e),s=this.tree.getNode(t),o="",r=s.range||[];if(n&&n.id===d)return this.stack.addSequeHistory({id:t,url:o}),this.stack.pop(),{fullurl:n.url,url:n.url.replace(/^[^#]+#/g,"").replace(/^#+/g,""),jump:!0};var l=!1;return i&&i.id===t&&n&&n.id&&(!r.length||_.indexOf(r,n.id)>-1)?(o=n.url,l=i.ver!==n.ver||s.jump,t=n.id):(o=a.prevurl,l=!!s.jump,t=a.id,this.stack.clear()),this.stack.addSequeHistory({id:t,url:o}),{fullurl:o,url:o.replace(/^[^#]+#/g,"").replace(/^#+/g,""),jump:l,id:t}},popById:function(t){return this.stack.popById(t)},forward:function(t,e,i,n){if("object"==typeof e){var a=this.tree.getNode(t,e);e=a.reurl}return this.stack.push(t,e,i,n),this.stack.addSequeHistory({id:t,url:e}),e},confirmForward:function(t){this.stack.confirmPush(t)},getLastView:function(){var t,e=this.stack.getCache()||{};return t=e.id?this.stack.top():this.stack.index(-2)},getLatelyView:function(t){var e=this.stack.getSequeTop(t);return e?e.id:null},addHistory:function(t,e,i){var n=this.stack.getCache()||{};n.id&&n.id!==t&&this.stack.clearCache();var a=this.stack.top(),s=this._getFromByUrl(e);(!a||a.id!==t||s)&&(s&&(this.clearHistory(),this.stack.push(d,s),this.stack.addSequeHistory({id:d,url:s}),this.confirmForward(d)),this.stack.push(t,e,i),this.stack.addSequeHistory({id:t,url:e}),this.confirmForward(t))},clearHistory:function(t,e,i){this.stack.clear(),t&&e&&this.addHistory(t,e,i)},isPrevPageOrigin:function(){var t=this.getLastView();return t&&t.id===d},switchTree:function(t){this.tree=t},_getFromByUrl:function(t){var e="from",i=(t||"").split(/#+/g),n=i[0],a=i[1]||"",s=null;if(n.indexOf(e)>-1){var o=this._getQueryString(n);o[e]&&(s=o[e])}if(a.indexOf(e)>-1){var r=this._getQueryString(a);r[e]&&(s=r[e])}return s&&(s=decodeURIComponent(s)),s&&!s.match(/^\s*(?:http|\/)/)&&(s=null),s},_getQueryString:function(t){var e=(t||"").split("?");e.shift(),e=e.join("?").split(/(?!\?[^?]*)&/g);for(var i,n={},a=0,s=e.length;s>a;a++)i=e[a].split("="),n[i.shift()]=i.join("=");return n}};var u=new p(l,new s);return u}),define("TuanApp",["PageHistory"],function(){var t=/^ctrip:\/\//i,e=/(.*)\/webapp\/(\w+)\/(.*)/,i=/^#\w/i;window._log={stash:[],log:function(t){this.stash.push(t?JSON.stringify(t):t)}};var n={init:function(){this.saveUnion()},showLoading:function(){this.loading.show()},hideLoading:function(){this.loading.hide()},isInternalPage:function(t){return t.toLowerCase().indexOf("/tuan/")>-1},back:function(t){var e=this.lastUrl();e?(this.app.history.pop(),this.isInternalPage(e)?location.hash=e.split("#")[1]||"home":location.replace(e)):(t?(-1==t.indexOf("#")&&(t="#"+t),this.app.curView.jump(t)):window.history.go(-1),this.app.history=[])},lastUrl:function(){var t=this.app.history,e=t.length,i=e&&t[e-2]||"";return i},parsePageURL:function(n){if(!n)return!1;var a,s={module:"",link:n,isNative:!1,isInternal:!1,domain:document.domain};return n.match(i)?(s.module="tuan",s.isInternal=!0,s):n.match(t)?(s.domain="ctrip",s.isNative=!0,s):(a=e.exec(n),a&&(s.module=a[2],s.link=a[3],s.isInternal=!0),s)},gotoExternalPage:function(t,e){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,n){var a=n.create("Guider");i.isInApp()?a.cross({path:t,param:e}):location.href=location.protocol+"//"+location.host+"/webapp/"+t+"/"+e})},jumpToPage:function(t,e){if(t){var i=this,n=i.parsePageURL(t);require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,a){var s=a.create("Guider"),o=i.isInApp();return o?n.isInternal?void("tuan"==n.module?e.forwardJump(n.link.split("/")[0],"/webapp/tuan/"+n.link):s.cross({path:n.module,param:n.link})):void s.jump({targetModel:n.isNative?"app":"h5",url:n.link,title:document.title}):void(location.href=t)})}},getQuery:function(t){return Lizard.P(t)},saveUnion:function(t){require(["CommonStore"],function(e){var i=e.UnionStore&&e.UnionStore.getInstance(),a=n.getQuery("PartnerID"),s=n.getQuery("Source"),o=n.getQuery("AllianceID"),r=n.getQuery("SID"),l=n.getQuery("OUID"),c=i.get();s||o?c&&c.AllianceID==o&&c.SID==r&&c.OUID==l&&c.Source==s&&c.PartnerID==a||i.set({AllianceID:o,SID:r,OUID:l,Source:s,PartnerID:a,targetTuan:!0}):t===!0&&""!==document.referrer&&document.referrer.indexOf("/html5")>0&&c&&c.targetTuan===!0&&i.remove()})},initVoiceSearch:function(t){require(["cWidgetFactory","VoiceSearch"],function(e){var i=e.create("VoiceSearch");return new i(t)})},environment:0,tHome:function(){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(t,e){var i=e.create("Guider"),n=t.isInApp();n?i.home():location.href=location.protocol+"//"+location.host+"/html5"})},backToLastPage:function(){require(["cWidgetFactory","cWidgetGuider"],function(t){var e=t.create("Guider");e.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})})})},isOverOS7:function(){return $.os&&$.os.ios&&parseInt($.os.version,10)>=7},isProduction:!0};return require(["libs","cUtility","cWidgetFactory","cHybridFacade","cWidgetGuider"],function(t,e,i,a){var s=i.create("Guider");if(n.init(),e.isInApp()&&(_.isFunction(s.app_check_network_status)&&s.app_check_network_status({callback:function(t){n.environment="WIFI"===t.networkType?0:1}}),s.register({tagname:a.METHOD_APP_NETWORK_DID_CHANGED,callback:function(t){n.environment="WIFI"===t.networkType?0:1}})),e.isInApp()){var o=e.isPreProduction();("0"===o||"1"===o||"2"===o)&&(n.isProduction=!1)}else location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(n.isProduction=!1);!function(){var t,e,i=0;!n.isProduction&&$(document).on("click",function(){i++,t&&clearTimeout(t),t=setTimeout(function(){i>=5&&(!e&&require(["ConsoleDebug"],function(t){e=new t}),e&&e.show()),i=0},350)})}()}),window.noPic=function(t){t&&(t.src="http://pic.c-ctrip.com/common/pic_alpha.gif",t.onerror=null)},n}),define("TuanStore",["cStore","cBase","cUtility"],function(t,e,i){var n={},a=6.1;return n.TuanDetailsStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_DETAILS",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanStatusStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_STATUS",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanBranchOfficeStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_BRANCH_OFFICE",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.TuanHotelCommentListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOTEL_COMMENT",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanInvoiceStore=new e.Class(t,{__propertys__:function(){this.key="GROUP_INVOICE",this.lifetime="30M"},initialize:function($super,t){$super(t)}}),n.TuanOrderListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_LIST",this.lifeTime="3M"},initialize:function($super,t){$super(t)}}),n.TuanOrderInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_INFO",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupHotelListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOTEL_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupHotListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOT_LIST",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupSearchStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SEARCH",this.lifeTime="1D",this.defaultData={pageIdx:"1",ctyId:"2",ctyName:"上海",bdate:e.Date.format(i.getServerDate(),"Y-m-d H:i:s"),edate:e.Date.format(i.getServerDate(),"Y-m-d H:i:s"),flag:0,productType:"0",qparams:[],sortRule:"2",sortType:"0",ver:a,ctype:0}},initialize:function($super,t){$super(t)}}),n.GroupPositionFilterStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POSITIONFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.GroupConditionStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CONDITIONFILTER",this.lifeTime="3D"},initialize:function($super,t){$super(t)}}),n.TuanOrderDetailStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_ORDER_DETAIL",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupOrderParamStore=new e.Class(t,{__propertys__:function(){this.key="USER_GROUP_ORDERPARAM",this.lifeTime="15M",this.isUserData=!0},initialize:function($super,t){$super(t)}}),n.OrderDetailReturnPage=new e.Class(t,{__propertys__:function(){this.key="GROUP_RETURNPAGE",this.lifeTime="15M"},initialize:function($super,t){$super(t)}}),n.TuanCityListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CITY_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanHistoryCityListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HISTORYCITY_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.GroupCategoryFilterStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_CATEGORYFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.GroupSortStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SORTFILTER",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanHistoryKeySearchStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_HISTORYKEYSEARCH_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanKeyWordListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_KEYWORD_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanLocalCityInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_LOCAL_CITY_INFO",this.lifeTime="30M"},initialize:function($super,t){$super(t)}}),n.GroupGeolocation=new e.Class(t,{__propertys__:function(){this.key="TUAN_GEOLOCATION",this.lifeTime="60M"},initialize:function($super,t){$super(t)}}),n.GroupCustomFilters=new e.Class(t,{__propertys__:function(){this.key="TUAN_CUSTOM_FILTERS",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanInvoiceTitleStore=new e.Class(t,{__propertys__:function(){this.key="TuanGou_InvoiceTitle",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n.TuanImagesListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_IMAGES_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanPOIListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POI_LIST",this.lifeTime="15D"},initialize:function($super,t){$super(t)}}),n.TuanNearListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_NEAR_LIST",this.lifeTime="15D"}}),n.TuanStrategyIDStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_STRATEGY_ID",this.lifeTime="15D"}}),n.TuanCouponListStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_COUPON_LIST",this.lifeTime="1D"}}),n.TuanSelectedCouponStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_SELECTED_COUPON",this.lifeTime="1D"}}),n.ColaPrizeStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_COLA_PRIZE",this.lifeTime="1D"}}),n.TuanHotKeywords=new e.Class(t,{__propertys__:function(){this.key="TUAN_HOT_KEYWORDS",this.lifeTime="1D"}}),n.TuanRegionInfoStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_REGION_INFO",this.lifeTime="1D"}}),n.TuanPositionStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_POSITION",this.lifeTime="2M"},initialize:function($super,t){$super(t)}}),n.BannerClassStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_BANNER_CLASS",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),window.testStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_TEST",this.lifeTime="1M"}}),n.TicketBookingStore=new e.Class(t,{__propertys__:function(){this.key="TUAN_TICKET_BOOKING",this.lifeTime="1D"},initialize:function($super,t){$super(t)}}),n}),define("TuanModel",["cModel","cBase","TuanStore","cUtility"],function(t,e,i,n){t.baseurl=function(t){var e={test:"soa2/10101",uat:"restapi/soa2/10101",pro:"restapi/soa2/10101"},i={test:"m.fat.ctripqa.com",uat:"m.uat.ctripqa.com",pro:"m.ctrip.com"},a=location.host,s=i.test,o=e.test;return n.isInApp()?"1"==n.isPreProduction()?(s="https"==t?"restful.m.ctrip.com":i.pro,o=e.pro):"0"==n.isPreProduction()?(s="https"==t?"restful.waptest.ctrip.com":i.test,o=e.test):"2"==n.isPreProduction()?(s=i.uat,o=e.uat):(s="https"==t?"restful.m.ctrip.com":i.pro,o=e.pro):a.match(/^(m|3g|wap)\.ctrip\.com/i)?(s=i.pro,o=e.pro):!a.match(/^(localhost|172\.16|127\.0)/i)||"https"!=location.protocol&&"https"!=t?a.match(/^(localhost|172\.16|127\.0)/i)?"https"==t?(s="restful.waptest.ctrip.com",o=e.test):(s=i.test,o=e.test):a.match(/^10\.8\.2\.111/i)?(s=i.pro,o=e.pro):!a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)||"https"!=location.protocol&&"https"!=t?a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)?(s="waptest.ctrip.com",o=e.test):a.match(/^m\.uat/i)?(s=i.uat,o=e.uat):(s=i.test,o=e.test):(s="restful.waptest.ctrip.com",o=e.test):(s="restful.waptest.ctrip.com",o=e.test),{domain:s,path:o}};var a={100:"操作成功",101:"节点数据验证不通过",102:"系统程序错误",201999:"产品不处于可售状态，不能生成订单",201e3:"产品没有供应商,生成订单失败",201001:"产品已团完,生成订单失败",201002:"产品无分销商,生成订单失败",201003:"电话格式不符合规范（例：021-10106666-），未能生成订单",201004:"产品属0元团购，分销联盟不能生成订单",201005:"产品属马上订产品，分销联盟不能生成订单",201006:"超过此产品的最大购买数量，不能生成订单",201007:"小于此产品的最少购买数量，不能生成订单",201008:"本产品携程不开发票，不能生成订单",201009:"发票创建失败，不能生成订单",201010:"发票信息有误，不能生成订单",201012:"本产品每个手机号码仅限购买一次",201011:"产品属0元团购，一个手机号只能预订一次",301e3:"订单取消成功",301001:"订单不属于用户或订单不存在",301002:"订单状态为非新订单",301003:"取消订单失败,订单状态修改失败",301004:"订单删除失败",301005:"订单删除成功",301006:"生成订单失败",301007:"订单状态修改失败",301008:"订单未查到支付记录",301009:"订单不存在",301010:"该订单已在处理中",401e3:"券号或者订单不存在或已更新，券取消失败",401001:"更新订单失败，券取消失败",401002:"更新券号失败，券取消失败",401003:"券使用失败",401004:"现渠道和此张券应属于的渠道不同，不能取消券",401005:"券取消失败",401006:"此张券已使用，不能取消券",401007:"此张券已取消，不能再次取消券",401008:"此张券已作废，不能取消券",401009:"券号已有预约记录,不能使用",401010:"券状态:已过期超过两天,不可使用",401011:"订单类型错误(1为携程收款，2为对方收款)",501e3:"联盟信息错误，无法取消券",501001:"更新联盟信息失败，未能生成订单",501002:"生成券号时发生异常，未能生成订单",601e3:"信用卡发送扣款请求失败",601001:"存在重复流水号",601002:"保存信用卡信息错误",601003:"增加支付记录失败",601004:"调用支付接口失败"},s={},o=6.1;return s.TuanDetailModel=new e.Class(t,{__propertys__:function(){this.url="/json/DetailSearch",this.method="POST",this.param={ext:"",flag:0,id:33483,ver:o},this.result=i.TuanDetailsStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanStatusModel=new e.Class(t,{__propertys__:function(){this.url="/json/RoomStatusSearch",this.method="POST",this.param={bdate:"",edate:"",pid:0,ext:"",flag:0,ver:o},this.result=i.TuanStatusStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanBranchOfficeModel=new e.Class(t,{__propertys__:function(){this.url="/json/BranchOffice",this.method="POST",this.param={ext:"",flag:0,id:0,ver:o},this.result=i.TuanBranchOfficeStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotelCommentListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CommentListSearch",this.method="POST",this.param={ext:"",flag:0,hotelId:0,pageIdx:1,ver:o},this.result=i.TuanHotelCommentListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanOrderListModel=new e.Class(t,{__propertys__:function(){this.url="/OrderList/Query",this.method="POST",this.isUserData=!0,this.param={ext:"",flag:0,pageIdx:1,ver:o},this.result=i.TuanOrderListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanOrderDetailModel=new e.Class(t,{__propertys__:function(){this.url="/json/OrderDetailSearch",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o},this.result=i.TuanOrderDetailStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanSendMsgModel=new e.Class(t,{__propertys__:function(){this.url="/json/MessageSend",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o}},initialize:function($super,t){$super(t)}}),s.TuanListModel=new e.Class(t,{__propertys__:function(){this.url="/json/ListSearch",this.method="POST",this.result=i.GroupListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotelListModel=new e.Class(t,{__propertys__:function(){this.url="/json/HotelListSearch",this.method="POST",this.result=i.GroupHotelListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanHotListModel=new e.Class(t,{__propertys__:function(){this.url="/json/HotCitySearch",this.method="POST",this.usehead=!0,this.param={ext:"",flag:0,ver:o},this.result=i.GroupHotListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanConditionModel=new e.Class(t,{__propertys__:function(){this.url="/json/ConditionListSearch",this.method="POST",this.param={ver:o},this.result=i.GroupConditionStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanCityListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CityListSearch",this.method="POST",this.param={dataVer:99,ver:o},this.result=i.TuanCityListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanKeyWordListModel=new e.Class(t,{__propertys__:function(){this.url="/json/KeywordSearch",this.method="POST",this.param={},this.result=i.TuanKeyWordListStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanLocalCityInfo=new e.Class(t,{__propertys__:function(){this.url="/json/SearchCityIdByLat",this.param={},this.method="POST",this.result=i.TuanLocalCityInfoStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanCreateOrder=new e.Class(t,{__propertys__:function(){this.url="/json/CreateOrder",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)},getErrorMessage:function(t){var e=t&&t.ErrorCode,i=t&&t.Message||"";return a[e]||i}}),s.TuanSubmitOrder=new e.Class(t,{__propertys__:function(){this.url="/json/SubmitOrder",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanApplyOrder=new e.Class(t,{__propertys__:function(){this.url="/json/PaymentApply",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanRetryPayment=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/ContinueToPay",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.BannerSearch=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/bannersearch",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanRefundlTicketModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/cancelticket",this.param={ver:o},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanCancelOrderModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/OrderCancel",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanDeleteOrderModel=new e.Class(t,{__propertys__:function(){this.usehead=!0,this.url="/json/OrderDelete",this.param={},this.method="POST"},initialize:function($super,t){$super(t)}}),s.TuanImagesListModel=new e.Class(t,{__propertys__:function(){this.url="/json/ProductPictures",this.param={},this.method="POST",this.result=i.TuanImagesListStore.getInstance()}}),s.TuanPOIListModel=new e.Class(t,{__propertys__:function(){this.url="/json/POISearch",this.param={ver:o},this.method="POST",this.result=i.TuanPOIListStore.getInstance()}}),s.TuanNearListModel=new e.Class(t,{__propertys__:function(){this.url="/json/NearGroup",this.param={},this.method="POST",this.result=i.TuanNearListStore.getInstance()}}),s.TuanStrategyIDModel=new e.Class(t,{__propertys__:function(){this.url="/json/Destination",this.param={},this.method="POST",this.result=i.TuanStrategyIDStore.getInstance()}}),s.TuanValidateCouponModel=new e.Class(t,{__propertys__:function(){this.url="/json/ValidateCoupon",this.param={},this.method="POST"}}),s.TuanCouponListModel=new e.Class(t,{__propertys__:function(){this.url="/json/CouponList",this.param={ver:o},this.method="POST",this.result=i.TuanCouponListStore.getInstance()}}),s.ColaDrawModel=new e.Class(t,{__propertys__:function(){this.url="/json/GetPrizeResultService",this.param={},this.method="POST"}}),s.ColaAddPrizeModel=new e.Class(t,{__propertys__:function(){this.url="/json/SetPrizeToUser",this.param={},this.method="POST"}}),s.TuanAddFavorite=new e.Class(t,{__propertys__:function(){this.url="/json/FavoriteAdd",this.param={},this.method="POST"}}),s.TuanDelFavorite=new e.Class(t,{__propertys__:function(){this.url="/json/FavoriteDelete",this.param={},this.method="POST"}}),s.TuanHotKeywordsModel=new e.Class(t,{__propertys__:function(){this.url="/json/SearchHotWord",this.method="POST",this.param={ver:o,cityid:0},this.result=i.TuanHotKeywords.getInstance()},initialize:function($super,t){$super(t)}}),s.TuanRegionInfoModel=new e.Class(t,{__propertys__:function(){this.url="/json/ExpressCity",this.method="POST",this.param={},this.result=i.TuanRegionInfoStore.getInstance()},initialize:function($super,t){$super(t)}}),s.CrossRecommendModel=new e.Class(t,{__propertys__:function(){this.url="/json/ProductRecommend",this.method="POST",this.param={ver:o}},initialize:function($super,t){$super(t)}}),s.BannerClassModel=new e.Class(t,{__propertys__:function(){this.url="/json/BannerClass",this.method="POST",this.param={},this.result=i.BannerClassStore.getInstance()},initialize:function($super,t){$super(t)}}),s.TicketBookingModel=new e.Class(t,{__propertys__:function(){this.url="/json/TicketBooking",this.method="POST",this.param={},this.result=i.TicketBookingStore.getInstance()},initialize:function($super,t){$super(t)}}),s}),define("DropDown",["libs","cUIMask"],function(t,e){function i(t){var i={triggerEvent:"click",trigger:null,panel:null,label:null,itemCls:"li[data-type]",hasEffect:!0,hasMask:!0,selectedIndex:0,activeTriggerCls:"",selectedItemCls:"typecrt",multiple:!1,onShow:n,onHide:n,onSelect:n},s=this;this.options=a(i,t),this.trigger=this.options.trigger,this.panel=this.options.panel,this.label=this.options.label,this.disabled=!1,this.opened=!1,this.items=this.panel.find(this.options.itemCls),this.reset(!0),this.options.hasMask&&(this.mask=new e({onCreate:function(){var t=this;this.root.on("click",function(){s.hide(),t.hide()})}}),this.panel.css("z-index",9999)),this._bindEvents()}var n=function(){},a=$.extend;return i.prototype={constructor:i,_bindEvents:function(){var t=this,e=this.options,i=this.trigger;this._showHandler=$.proxy(function(){this.opened?(this.hide(),e.onHide.call(t)):(this.show(),e.onShow.call(t))},this),this._selectHandler=$.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.select(t.target),this.hide()},this),this._hideHandler=$.proxy(function(){var t=this;setTimeout(function(){t.hide()},200)},this),i.on(e.triggerEvent,this._showHandler),i.on("blur",this._hideHandler),this.panel.on("click",e.itemCls,this._selectHandler)},_unbindEvents:function(){var t=this.options;this.trigger.off(t.triggerEvent,this._showHandler),this.panel.off("click",this._selectHandler)},disable:function(){this._unbindEvents(),this.disabled=!0},enable:function(){this._bindEvents(),this.disabled=!1},show:function(){var t=this.panel;t.show(),this.options.hasEffect&&(t.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),t.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1})),this.mask&&this.mask.show(),this.trigger.addClass(this.options.activeTriggerCls),this.opened=!0},hide:function(){var t=this;t.panel.hide(),t.mask&&t.mask.hide(),t.trigger.removeClass(t.options.activeTriggerCls),t.opened=!1},getItemByAttr:function(t,e){return this.panel.find("[data-"+t+'="'+e+'"]')},getItemByIndex:function(t){return this.items[t]},select:function(t,e){var i=this.options,n=this._selected,a=i.selectedItemCls;n&&n.removeClass(a),"LI"!=t.tagName&&(t=t.parentNode),this.selectedIndex=this.items.indexOf(t),t=$(t),this.label.html(t.attr("data-name")||t.text()),t.addClass(a),!e&&this.options.onSelect.call(this,t),this._selected=t},reset:function(t,e){this.select(this.items["number"==typeof e?e:this.options.selectedIndex],t)}},i}),define("Tab",["libs","cUIScroll"],function(t,e){function i(t){var e={onSwitch:a};this.options=n(e,t),this.panel=this.options.panel,this.label=this.options.label,this.isScroll=this.options.isScroll,this.inited=!1,this.switch(this.options.labelSelectedIndex),this._bindEvents()}var n=$.extend,a=function(){};
return i.prototype={constructor:i,_bindEvents:function(){var t=this.options;this._switchHandler=$.proxy(function(t){var e=this.label.indexOf(t.currentTarget);this.switch(e)},this),this._selectHandler=$.proxy(function(e){t.onSelect($(e.currentTarget))},this),this.label.on("click",this._switchHandler),this.panel.on("click",t.itemClass,this._selectHandler)},_unbindEvents:function(){var t=this.options;this.trigger.off(t.triggerEvent,this._showHandler),this.panel.off("click",this._selectHandler)},"switch":function(t){var i=this.options;this.options.onSwitch(),$(this.label[i.labelSelectedIndex]).removeClass(i.labelSelectedClass),$(this.label[t]).addClass(i.labelSelectedClass),$(this.panel[i.labelSelectedIndex]).hide();var n=$(this.panel[t]);if(n.show(),i.isScroll&&(n.css({overflow:"hidden","max-height":"285px","margin-bottom":"5px","margin-top":"5px"}),this.scroller=new e({wrapper:n,scroller:n.find("ul")})),this.options.labelSelectedIndex=t,this.inited){var a=n.find(i.itemClass);1==a.length&&i.onSelect(a)}this.inited=!0}},i}),define("StringsData",[],function(){var t=4;return{SEARCH_DISTANCE:t,SEARCH_DISTANCE_TEXT:t+"公里内",MAP_SOURCE_ID:3,MAX_KEYWORDS_HISTORY:5,CITY_CENTER:"市中心",defaultCity:{id:2,name:"上海"},priceText:{"0|99":"&yen; 100 以下","100|250":"&yen; 100-250","250|400":"&yen; 250-400","400|600":"&yen; 400-600","601|":"&yen; 600 以上","0|1999":"&yen; 2000 以下","2000|3000":"&yen; 2000-3000","3001|":"&yen; 3000 以上"},traitText:{"103|101":"一元酒店","103|10303":"别墅轰趴","103|10304":"住店游玩","103|10305":"情侣酒店"},starText:{2:"二星/经济",3:"三星/舒适",4:"四星/高档",5:"五星/豪华"},groupType:{0:{index:0,name:"全部团购",category:"all"},1:{index:1,name:"酒店",category:"hotel"},8:{index:2,name:"美食",category:"catering"},7:{index:3,name:"旅游度假",category:"vacation"},6:{index:4,name:"门票",category:"ticket"},9:{index:5,name:"娱乐",category:"entertainment"},106:{index:6,name:"一元团购",category:"onepaygroup"},108:{index:7,name:"当地特色",category:"feature"}},index2ctype:{0:"0",1:"1",2:"8",3:"7",4:"6",5:"9"},traType:{hotelid:18,zone:5,hotelgroupid:3,location:4,activity:11,district:16,markland:17},typeToName:{zone:"位置",location:"位置",district:"位置",markland:"位置",attractions:"位置",airport:"机场",railwayStation:"火车站",subway:"地铁站",brand:"名称",productName:"名称",theme:"名称",hotelid:"名称",hotelgroupid:"名称"}}}),define("CityListData",[],function(){return{1:"北京",2:"上海",3:"天津",4:"重庆",5:"哈尔滨",6:"大连",7:"青岛",10:"西安",11:"敦煌",12:"南京",13:"无锡",14:"苏州",15:"扬州",16:"镇江",17:"杭州",18:"西塘",19:"舟山",20:"淳安",21:"千岛湖镇",22:"绍兴",23:"黄山",24:"九江",25:"厦门",26:"武夷山",27:"张家界",28:"成都",30:"深圳",31:"珠海",32:"广州",33:"桂林",34:"昆明",35:"西双版纳",36:"大理市",37:"丽江",38:"贵阳",39:"乌鲁木齐",40:"吐鲁番市",41:"拉萨",42:"海口",43:"三亚",44:"文昌",45:"万宁",46:"五指山",47:"屯昌",48:"东方",50:"定安",52:"琼海",54:"保亭",55:"陵水",57:"儋州",58:"香港",59:"澳门",82:"南通",83:"昆山",84:"海宁",86:"湖州",87:"奉化",90:"临安",91:"九寨沟",92:"日喀则",94:"都江堰",95:"峨眉山",96:"常熟",99:"银川",100:"兰州",103:"呼和浩特",104:"平遥",105:"太原",106:"五台山",108:"林芝",109:"喀什市",110:"延安",111:"咸阳",112:"宝鸡",117:"潼关",118:"铜川",119:"华阴",124:"西宁",129:"汉中",132:"格尔木",133:"榆次",134:"灵石",135:"介休",136:"大同",137:"长治",139:"临汾",140:"运城",141:"包头",143:"曲阜",144:"济南",145:"泰山",147:"秦皇岛",149:"齐齐哈尔",150:"牡丹江",155:"漠河",158:"长春",159:"吉林",171:"安康",177:"安庆",178:"鞍山",179:"安顺",180:"安溪",181:"安阳",182:"蚌埠",185:"保定",186:"玉溪",187:"北戴河",189:"北海",197:"保山",199:"长白山",201:"常德",202:"赤峰",203:"长乐",206:"长沙",209:"广德",210:"顺德",211:"朝阳",213:"常州",214:"滁州",215:"潮州",216:"沧州",218:"池州",221:"丹东",222:"登封",223:"东莞",231:"大庆",236:"东营",237:"德阳",238:"丹阳",245:"恩施",246:"福鼎",247:"丰都",251:"佛山",252:"抚顺",254:"阜新",256:"富阳",257:"阜阳",258:"福州",267:"广元",268:"赣州",270:"惠安",272:"淮北",275:"邯郸",278:"合肥",281:"黑河",282:"怀化",283:"汉口",285:"哈密市",287:"淮南",288:"华山",290:"衡水",292:"黄石",296:"黄岩",297:"衡阳",299:"惠州",305:"景德镇",307:"井冈山",308:"金华",309:"景洪",310:"蓬莱",314:"九龙",316:"江门",317:"佳木斯",318:"济宁",321:"固原",324:"建阳",325:"江阴",326:"嘉峪关",327:"锦州",328:"荆州",330:"库尔勒",331:"开封",333:"凯里",335:"开平",340:"廊坊",344:"庐山",345:"乐山",346:"丽水",348:"龙岩",350:"洛阳",351:"辽阳",352:"辽源",353:"连云港",354:"柳州",355:"泸州",365:"德宏",370:"绵阳",374:"南安",375:"宁波",376:"南昌",377:"南充",378:"宁德",380:"南宁",385:"南阳",387:"盘锦",388:"平凉",392:"平潭",403:"黟县",406:"泉州",407:"衢州",408:"瑞安",411:"上饶",412:"瑞丽",421:"绥芬河",422:"韶关",426:"石河子",427:"梁平",428:"石家庄",431:"石林",433:"汉寿",436:"三门峡",437:"三明",440:"四平",441:"商丘",443:"泗水",444:"石狮",446:"韶山",447:"汕头",448:"邵武",451:"沈阳",452:"十堰",454:"泰安",456:"通化",458:"通辽",459:"铜陵",460:"桐庐",464:"天水",468:"唐山",470:"天台",474:"武当山",475:"潍坊",477:"武汉",478:"芜湖",479:"威海",481:"吴江",484:"乌兰浩特",485:"永安",489:"婺源",491:"温州",492:"梧州",493:"新安江",494:"西昌",496:"襄阳",500:"锡林浩特",503:"萧山",507:"新乡",508:"歙县",510:"信阳",512:"徐州",513:"忻州",514:"宜宾",515:"宜昌",518:"宜春",521:"宿州",523:"延吉",527:"榆林",529:"伊宁市",533:"烟台",534:"鹰潭",536:"义乌",537:"宜兴",539:"岳阳",540:"余姚",541:"兖州",542:"淄博",544:"自贡",545:"遵化",547:"湛江",548:"诸暨",550:"张家口",551:"驻马店",552:"肇庆",553:"中山",555:"昭通",556:"中卫",557:"浑源",558:"遵义",559:"郑州",560:"漳州",561:"周庄",562:"承德",569:"临沂",571:"嘉兴",577:"淮安",578:"台州",579:"泰州",580:"桐乡",582:"海盐",583:"九华山",589:"巢湖",595:"上虞",596:"嘉善",598:"湘潭",601:"株洲",603:"新余",605:"六盘水",606:"南平",612:"郴州",614:"枣庄",617:"台北",619:"温岭",620:"雁荡山",621:"张家港",654:"太仓",658:"建德",659:"安吉",660:"香格里拉",662:"酒泉",663:"张掖",664:"武威",667:"莆田",677:"衡山",692:"阳江",693:"河源",696:"盱眙",697:"启东",729:"台山",732:"乐清",750:"广汉",755:"东阳",833:"荣成",866:"凤凰",868:"仙居",870:"三清山",871:"阳朔",872:"新昌",887:"吴桥",893:"庐江",894:"东海",895:"新沂",900:"砀山",905:"辛集",907:"阳泉",909:"滕州",918:"娄底",929:"浦江",933:"吉安",937:"咸宁",940:"耒阳",944:"桐城",947:"邢台",951:"鹤壁",956:"揭阳",957:"偃师",958:"巩义",959:"武义",960:"永康",963:"海城",965:"塘沽",966:"瓦房店",967:"大石桥",969:"荥阳",970:"永州",975:"都匀",983:"桐梓",984:"宣威",985:"曲靖",986:"镇远",992:"鄂州",996:"古田",1000:"江山",1001:"玉山",1005:"宁国",1006:"宣城",1007:"当涂",1008:"绩溪",1010:"凤阳",1011:"宁乡",1016:"繁昌",1022:"兴平",1023:"灵宝",1024:"马鞍山",1026:"祁门",1029:"义马",1030:"渭南",1031:"临潼",1037:"海阳",1038:"莱阳",1040:"高密",1043:"胶州",1044:"青州",1048:"铁岭",1050:"葫芦岛",1051:"兴城",1052:"昌黎",1054:"江油",1055:"勉县",1058:"邓州",1060:"汝州",1068:"霸州",1071:"聊城",1073:"梁山",1074:"菏泽",1078:"亳州",1079:"麻城",1083:"满洲里",1088:"漯河",1090:"定州",1092:"晋城",1093:"焦作",1094:"许昌",1095:"侯马",1097:"攀枝花",1098:"怀柔",1105:"茂名",1106:"日照",1107:"长兴",1110:"吉首",1113:"玉林",1116:"白城",1117:"随州",1121:"荆门",1122:"当阳",1123:"石门",1125:"益阳",1128:"绥化",1133:"乌海",1139:"兴义",1140:"百色",1148:"眉山",1155:"本溪",1200:"盐城",1201:"宁海",1205:"同里",1206:"平湖",1208:"慈溪",1209:"临海",1212:"嵊州",1221:"涉县",1222:"稻城",1223:"江都",1224:"仪征",1226:"南戴河",1230:"崇明",1232:"濮阳",1233:"达州",1300:"营口",1303:"松原",1317:"朔州",1323:"澧县",1332:"千岛湖",1333:"开远",1341:"红河",1342:"文山县",1358:"溧阳",1367:"德清",1370:"德州",1371:"遂宁",1372:"松潘",1422:"清远",1428:"恩平",1436:"汕尾",1443:"泰顺",1452:"莱芜",1453:"晋中",1454:"济源",1466:"安图",1472:"宿迁",1474:"丰宁",1490:"孝感",1495:"河口",1517:"汉源",1518:"贵港",1521:"赤壁",1541:"白银",1555:"枣阳",1557:"枝江",1565:"开原",1575:"安平",1592:"江津",1610:"榆树",1632:"三河",1634:"顺义",1635:"蓟县",1646:"庄河",1658:"阿尔山",1664:"亚布力",1677:"防城港",1700:"瑞昌",1705:"六安",1706:"海螺沟",1708:"荔波",1803:"晋江",1804:"莱西",1806:"怒江",1819:"腾冲",1820:"滨州",1823:"象山",1838:"阿坝",1839:"金坛",1840:"萍乡",1882:"仙桃",1884:"肥城",1892:"来宾",1893:"南丹",1899:"钦州",1904:"师宗",1983:"徐水",1991:"新乐",1993:"正定",1996:"元氏",2049:"修武",2063:"沁阳",2088:"北碚",2096:"大厂",2109:"伊川",2230:"迁安",2313:"水富",2431:"蒙自",2442:"建水",2552:"大英",2607:"五峰",2625:"绵竹",2950:"林口",2963:"平山",2966:"尚志",3053:"梅州",3221:"周口",3222:"平顶山",3230:"句容",3233:"东台",3275:"阆中",3277:"雅安",3309:"横店",3327:"布尔津",3329:"通州",3852:"黎平",3863:"寿光",3881:"泗阳",3884:"抚州",3885:"黄冈",3886:"白山",3887:"巴彦淖尔",3906:"即墨",3908:"文登",3909:"胶南",3913:"沂源",3914:"大冶",3915:"莱州",3917:"福清",3918:"乌镇",3921:"楚雄市",3923:"海安",3925:"玉环",3926:"靖江",3929:"邳州",3931:"连州",3933:"云浮",3937:"扬中",3943:"平度",3944:"彬县",3946:"龙口",3967:"东兴",3968:"桂平",3969:"河池",3972:"宜都",3976:"鄂尔多斯",3980:"泰兴",3989:"济阳",3995:"舞钢",3996:"普洱",3997:"芒市",4004:"靖边",4026:"姜堰",4029:"大丰",4124:"甘孜",4125:"高邮",4130:"康定",4132:"香河",4136:"新密",4139:"如皋",4144:"诸城",4145:"陆丰",4146:"贺州",4154:"潜江",4159:"博鳌",4185:"浏阳",4216:"石嘴山",4243:"弥勒",4244:"普陀山",4251:"招远",4255:"呼伦贝尔",7519:"邹城",7521:"龙胜",7525:"北川",7534:"昌吉市",7536:"平邑",7544:"赤水",7549:"泸定",7551:"商洛",7553:"邛崃",7554:"乳山",7557:"如东",7558:"三门",7559:"海门",7561:"密云",7564:"平谷",7567:"房山",7577:"天长",7578:"兴化",7587:"吴忠",7592:"南康",7593:"章丘",7594:"元阳",7596:"扶风",7604:"汾阳",7605:"涿州",7606:"吴川",7618:"洪湖",7619:"仁怀",7630:"沂水",7631:"吕梁",7637:"栾川",7638:"额尔古纳",7646:"酉阳",7650:"长葛",7663:"大兴安岭",7666:"苍南",7667:"罗田",7669:"栖霞",7673:"郓城",7674:"长岛",7675:"沂南",7678:"崇州",7680:"垦利",7685:"丹江口",7687:"藁城",7692:"金湖",7693:"涟水",7694:"睢宁",7695:"响水",7700:"五莲",7714:"莒南",7716:"大邑",7724:"武功山",7727:"贺兰",7728:"东平",7745:"金乡",7751:"理县",7759:"河间",7771:"新泰",7779:"利川",7799:"白沟",7834:"若尔盖",7835:"红原",7840:"沽源",10270:"杨凌",10271:"洛宁",10272:"丹巴",10273:"莒县",10297:"昌乐",10298:"茂县",19953:"平原",19956:"高唐",19959:"蒙阴",20743:"微山",20794:"灵武",20807:"和顺镇",20808:"吉县",20809:"临沭",20812:"嵩县",20825:"灌南",20827:"肥东",20846:"惠水",20849:"永泰",20868:"临高",20881:"长武",20883:"阿巴嘎旗",20896:"鹿泉",20898:"衡阳县",20914:"围场",20916:"滨海",20919:"澄江",20926:"社旗",20932:"青阳",20950:"盂县",20960:"元谋",20963:"文山",20976:"多伦",20980:"霞浦",20990:"晋州",21001:"克什克腾旗",21008:"休宁",21009:"新郑",21025:"白沙",21027:"芜湖县",21052:"长阳",21056:"芦溪",21089:"涞水",21094:"固始",21096:"雅江",21111:"沭阳",21115:"金寨",21138:"巨野",21140:"潜山",21144:"肥乡",21166:"洪泽",21168:"汶上",21179:"黔南",21182:"盐源",21183:"石柱",21194:"中牟",21199:"黔西",21208:"勐腊",21214:"栾城",21230:"阜宁",21258:"唐县",21259:"武隆",21268:"大理",21269:"阿拉善左旗",21286:"雷山",21301:"南部",21316:"彭水",21330:"迁西",21339:"额济纳旗",21349:"房县",21385:"费县",21399:"鄄城",21404:"赣榆",21409:"石台",21410:"涡阳",21411:"周至",21416:"南靖",21421:"长沙县",21436:"织金",21437:"灌云",21448:"馆陶",21452:"永春",21464:"抚松",21469:"博爱",21475:"华容",21486:"定边",21488:"肥西",21490:"文安",21508:"永顺",21509:"连江",21511:"祁县",21514:"璧山",21515:"商河",21542:"于都",21555:"青川",21560:"仙游",21563:"曲沃",21574:"泰宁",21584:"巴林左旗",21590:"建湖",21603:"射阳",21609:"小金",21610:"开县",21619:"遂平",21624:"献县",21629:"金沙",21633:"湘阴",21648:"无为",21660:"昌邑",21675:"桂阳",21683:"威宁",21691:"北流",21699:"孟州",21710:"眉县",21739:"星子",21750:"赵县",21764:"荣昌",21765:"太仆寺旗",21773:"辉县",21777:"云梦",21778:"黔东南",21783:"嘉祥",21790:"张北",21795:"滑县",21807:"丘北",21812:"内乡",21815:"阳新",21818:"广水",21858:"怀来",21860:"太谷",21863:"阿拉善右旗",21871:"泾县",21872:"容城",21883:"汶川",21885:"合浦",21896:"华县",21897:"深州",21898:"翁牛特旗",21902:"闽侯",21903:"平江",21908:"安国",21914:"南陵",21917:"行唐",21929:"兴和",21954:"漳浦",21962:"平塘",21976:"惠东",21994:"和县",21996:"利津",22001:"仁寿",22005:"大城",22012:"罗源",22024:"绥滨",22026:"西乌旗",22031:"毕节",22033:"铜仁",62441:"永定"}}),define("StoreManage",["TuanApp","TuanStore","CityListData","StringsData"],function(t,e,i,n){var a=e.GroupSearchStore.getInstance(),s=e.GroupPositionFilterStore.getInstance(),o=e.GroupCategoryFilterStore.getInstance(),r=e.TuanHistoryCityListStore.getInstance(),l=e.GroupSortStore.getInstance(),c=e.TuanCityListStore.getInstance(),d=e.GroupGeolocation.getInstance(),p=e.TuanHistoryKeySearchStore.getInstance(),u=e.GroupCustomFilters.getInstance(),h={clearSpecified:function(t){t&&a.setAttr("sortRule",2),t&&a.setAttr("sortType",0),!t&&u.remove(),!t&&a.setAttr("ctype",0),!t&&a.setAttr("weekendsAvailable",0),s.remove(),l.remove(),this.setCurrentKeyWord(!1),a.setAttr("qparams",this.getGroupQueryParam()),a.removeAttr("pos")},clearAll:function(){this.clearSpecified(),a.remove(),o.remove()},isNearBy:function(){return a.getAttr("nearby")||r.getAttr("nearby")},addHistoryCity:function(t){var e=r.get(),i=[];e&&e.list&&$.isArray(e.list)&&(i=e.list);var a,s=0;$.each(i,function(e,i){return i!=t?!0:(a=i,s=e,!1)}),a&&a==t?(i.splice(s,1),i.unshift(t)):(i.unshift(t),i.length>n.MAX_KEYWORDS_HISTORY&&i.pop()),r.setAttr("list",i)},findHistoryCity:function(t){var e=r.get(),i=[];if(!t){var n=c.get();if(!n)return;t=n.cities||n}if(e&&e.list)for(var a=e.list.length>3?3:e.list.length,s=0;a>s;s++){var o=e.list[s],l=this.findCityInfoById(o,t);l&&i.push(l)}return i},getCityCount:function(t){if(!t){var e=c.get();if(!e)return;t=e.cities||e}var i=0;if(t&&t.cities&&t.cities.length>0)for(var n,a=0,s=t.cities.length;s>a;a++)n=t.cities[a],n&&n.tag&&"热门"!=n.tag&&(i+=n.cities.length);return i},findCityInfoById:function(t,e,n){var a,s,o,r,l,d;if(!e){if(a=c.get(),!a)return{CityID:t,name:i[t]||n,cGroups:""};e=a.cities||a}for(s=0,d=e.length;d>s;s++)if(l=e[s],"热门"==l.tag&&l.cities)for(o in l.cities)if(r=l.cities[o],r.id==t)return r;for(s=0,d=e.length;d>s;s++)if(l=e[s],"热门"!=l.tag&&l.cities)for(o in l.cities)if(r=l.cities[o],r.id==t)return r;return!1},setCurrentCity:function(t){if(t){var e=d.get();if(e&&e.gps){var i=t.CityID||t,n=this.findCityInfoById(i);if(n)return e.gps.CityId=t.CityID,e.gps.CityName=n.name,e.gps.Groups=n.cGroups,d.setAttr("gps",e.gps),!0;t.CityID&&t.CityName&&(e.gps.CityId=t.CityID,e.gps.CityName=t.CityName,e.gps.Groups=0,d.setAttr("gps",e.gps))}}return!1},getCurrentCity:function(){var t=d.get();return t&&t.gps&&+t.gps.CityId>0?t.gps:!1},addHistoryKeyWord:function(t,e,i){var a,o=p.get(),r=s.getAttr("type"),l=[],c=0;o&&o.list&&$.isArray(o.list)&&(l=o.list),$.each(l,function(e,i){return i.id!=t?!0:(a=i,c=e,!1)}),a&&a.id==t?(l.splice(c,1),l.unshift({id:t,word:e,type:i})):(l.unshift({id:t,word:e,type:i}),l.length>n.MAX_KEYWORDS_HISTORY&&l.pop()),p.remove(),p.setAttr("list",l),this.setCurrentKeyWord({id:t,word:e,type:i}),(0>r||"5"==r)&&s.remove(),"4"==r&&"location"==i&&s.remove()},getHistoryKeyWord:function(){var t=p.get(),e=[];return t&&t.list&&(e=t.list),e},setCurrentKeyWord:function(t){p.setAttr("key",t)},removeCurrentKeyWord:function(){p.removeAttr("key")},getCurrentKeyWord:function(){var t=p.get();return t?t.key:!1},getGroupQueryParam:function(){var t=[],e=u.get(),i=s.get(),n=e&&e.price&&e.price.val;n&&t.push({type:1,value:n});var a=e&&e.star;if(a&&!$.isEmptyObject(a)){var l,c=[];for(l in a)c.push(l);t.push({type:2,value:c.join(",")})}var p=e&&e.brand&&e.brand.val;p&&t.push({type:3,value:p});var h=e&&e.trait&&e.trait.val;h&&t.push({type:14,value:h});var f=d.get()&&d.get().gps,_=e&&e.distance&&e.distance.val;r.getAttr("nearby")&&f?t.push({type:9,value:f.lat+"|"+f.lng+(_?"|"+_:"")}):_&&t.push({type:9,value:_});var m=e&&e.day&&e.day.val;m&&t.push({type:14,value:m});var v=e&&e.multiShop;1==v&&t.push({type:14,value:"102|10201"});var g=e&&e.voucher;1==g&&t.push({type:14,value:"102|10202"});var y=o.get();y&&y.subVal&&t.push({type:14,value:y.subVal}),i=i?i:{type:"",val:""},i&&i.type&&+i.type>0&&i.val&&""!==i.val&&t.push({type:i.type,name:i.name,value:i.val});var b=this.getCurrentKeyWord();return b&&t.push({type:7,value:b.word}),t},saveQueryString:function(t){var e=Lizard.P,s=e("ctype"),l=e("price"),c=e("star"),p=e("kwd"),h=e("place"),f=e("lat"),_=e("lng")||e("lon"),m=e("cityid"),v=e("cityname"),g=e("sort");if(m&&m!=a.getAttr("ctyId")&&(this.clearAll(),r.remove()),m&&(a.setAttr("ctyId",m),v=v||i[m]||"",a.setAttr("ctyName",v)),f&&+f>0&&_&&+_>0&&h&&""!==h){d.setAttr("gps",{address:h,location:_+","+f,city:v,lng:+_,lat:+f}),r.setAttr("nearby",!0),m&&(this.setCurrentCity({CityID:m}),this.addHistoryCity(m,v));for(var y=a.getAttr("qparams")||[],b=0,w=y.length;w>b;b++)if(9==y[b].type){y.splice(b,1);break}y.push({type:9,value:f+"|"+_+"|"+n.SEARCH_DISTANCE}),a.setAttr("qparams",y)}if(s&&(o.remove(),a.setAttr("ctype",n.index2ctype[s])),c&&1==s&&u.setAttr("star",c.replace(",","|")),l&&u.setAttr("price",l),p&&(p=p.split("|"),this.addHistoryKeyWord(p[1],p[0],p[2])),g){var T=g.indexOf("/")>-1?"/":"|";g=g.split(T),a.setAttr("sortRule",g[0]),a.setAttr("sortType",g[1]||1)}t&&t()},getCityIdByName:function(t){var e;return t&&(e=i[t]),!1},saveHotWordParam:function(t){var e=a.get();if(h.clearAll(),r.removeAttr("nearby"),t.pos){var i=t.pos.type,l=t.pos.val,c=t.pos.lat,d=t.pos.lon,p=t.pos.name;s.set({type:i,val:l,name:p,pos:{type:3,lat:c,lon:d,name:p}})}if(t.price&&n.priceText[t.price]&&u.setAttr("price",{val:t.price,txt:n.priceText[t.price]}),t.trait&&n.traitText[t.trait]&&u.setAttr("trait",{val:t.trait,txt:n.traitText[t.trait]}),t.star){var f=t.star.split(","),_={};for(var m in f)m=f[m],n.starText[m]&&(_[m]=n.starText[m]);_&&u.setAttr("star",_)}if(t.brand&&t.brand.length>0)for(var v in t.brand)v=t.brand[v],v&&v.val&&v.key&&u.setAttr("brand",{flag:1,val:v.val,txt:v.key});if(t.markland&&h.setCurrentKeyWord({id:t.markland.id,word:t.markland.name,type:"markland"}),t.hotel&&h.setCurrentKeyWord({id:t.hotel.id,word:t.hotel.name,type:"hotelid"}),t.keyword&&h.setCurrentKeyWord({word:t.word}),t.activity&&h.setCurrentKeyWord({id:t.activity.id,word:t.activity.name,type:"activity"}),t.district&&h.setCurrentKeyWord({id:t.district.id,word:t.district.name,type:"district"}),t.isweekend&&a.setAttr("weekendsAvailable",t.isweekend),t.multishop&&u.setAttr("multiShop",t.multishop),t.voucher&&u.setAttr("voucher",t.voucher),t.sort&&(a.setAttr("sortRule",t.sort.stype),a.setAttr("sortType",t.sort.sval)),t.classty){var g,y,b,w;t.classty.parent?(g=t.classty.parent.val,y=n.groupType[g],b=t.classty.val,w=t.word):(g=t.classty.val,y=n.groupType[g]),o.setAttr("tuanType",g),y&&(o.setAttr("category",y.category),o.setAttr("name",y.name),o.setAttr("tuanTypeIndex",y.index)),o.setAttr("subVal",b),o.setAttr("subName",w),a.setAttr("ctype",g)}var T=h.getGroupQueryParam();a.setAttr("qparams",T),a.setAttr("ctyId",e.ctyId),a.setAttr("ctyName",e.ctyName)}};return h}),define("TuanFilters",["cBase","cUtility","cWidgetFactory","cUIMask","cUIScroll","DropDown","Tab","StringsData","TuanModel","TuanStore","StoreManage"],function(t,e,i,n,a,s,o,r,l,c,d){var p,u=$.extend,h={weizhiquyu:"位置区域"},f=!1,m="youth"===e.getAppSys(),v=c.GroupCategoryFilterStore.getInstance(),g=c.GroupSortStore.getInstance(),y=c.GroupSearchStore.getInstance(),b=l.TuanConditionModel.getInstance(),w=c.GroupConditionStore.getInstance(),T=c.GroupCustomFilters.getInstance(),x=c.TuanHistoryCityListStore.getInstance(),C=c.GroupPositionFilterStore.getInstance(),S=["price","day","trait","distance","brand"],k=_.template(['<%if(["all", "hotel", "catering"].indexOf(category)!=-1){%>','<div class="pop_filter_chkitem" data-type="weekendsAvailable" data-text="周末可用">周末可用','<div class="pop_filter_label">','<input type="checkbox" id="weekends"<%if(weekendsAvailable==1){%> checked<%}%> /><label for="weekends"></label>',"</div>","</div>","<%}%>",'<%if(category=="hotel"){%>','<div class="pop_filter_chkitem" data-type="multiShop" data-text="多店可用">多店可用','<div class="pop_filter_label">','<input type="checkbox" id="multiShop"<%if(multiShop==1){%> checked<%}%> /><label for="multiShop"></label>',"</div>","</div>",'<div class="pop_filter_chkitem" data-type="voucher" data-text="代金券">代金券','<div class="pop_filter_label">','<input type="checkbox" id="voucher"<%if(voucher==1){%> checked<%}%> /><label for="voucher"></label>',"</div>","</div>","<%}%>"].join("")),I=_.template(['<ul class="pop_filter_tabs">','<li data-tab="price"><i class="pop_filter_point"<%if(!customdata.price || (customdata.price && customdata.price.val == "1|1")){%> style="display:none"<%}%>></i>价格</li>','<%if(category=="vacation"){%><li data-tab="day"><i class="pop_filter_point"<%if(!customdata.day){%> style="display:none"<%}%>></i>天数</li><%}%>','<%if(category=="hotel"){%><li data-tab="star"><i class="pop_filter_point"<%if(!customdata.star){%> style="display:none"<%}%>></i>星级</li><%}%>','<%if(category=="hotel"){%><li data-tab="brand"><i class="pop_filter_point"<%if(!customdata.brand){%> style="display:none"<%}%>></i>品牌</li><%}%>','<%if(category=="hotel"){%><li data-tab="trait"><i class="pop_filter_point"<%if(!customdata.trait){%> style="display:none"<%}%>></i>特色</li><%}%>','<%if((isNearBy && ["all", "hotel", "catering", "ticket", "entertainment"].indexOf(category)!=-1) || isUniversityNearBy){%><li data-tab="distance"><i class="pop_filter_point"<%if(!customdata.distance){%> style="display:none"<%}%>></i>距离</li><%}%>',"</ul>"].join("")),A=_.template(['<li data-filter="brand"<%if(!val){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-filter="brand" data-value="<%=a.val%>" data-text="<%=a.txt%>"<%if(a.val==val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div>',"</li>","<%})%>"].join("")),P=_.template(['<li data-filter="trait"<%if(!val){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-filter="trait" data-value="<%=a.val%>" data-text="<%=a.txt%>"<%if(a.val==val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div>',"</li>","<%})%>"].join("")),L=_.template(['<div class="pop_filter_lefttab">','<ul class="pop_filter_tabs">',"<%_.each(tuanType, function(v){%>",'<li class="J_categoryTabLabel<%if(v.val==tuanTypeVal){%> choosed<%}%>"><%=v.txt%></li>',"<%})%>","</ul>","</div>",'<div class="pop_filter_righttab">',"<%_.each(tuanType, function(v){%>",'<div class="J_categoryTabPanel" style="height:285px;<%if(v.val!=tuanTypeVal){%>display:none<%}%>">','<ul class="pop_filter_baselist" style="min-height:285px">','<li data-type="<%=v.val%>"<%if(v.val==tuanTypeVal && typeof subVal == "undefined"){%> class="choosed"<%}%>><div class="txt01"><%=v.val>0 ? "全部" : ""%><%=v.txt%></div><span class="txt02"><%=v.groupCount%></span></li>',"<%_.each(subTuanType, function(s){%>","<%if (s.parentType == v.val){%>",'<li data-type="<%=v.val%>" data-value="<%=s.val%>" data-name="<%=s.txt%>"<%if(typeof subVal !== "undefined" && s.val==subVal){%> class="choosed"<%}%>><div class="txt01"><%=s.txt%></div><span class="txt02"><%=s.groupCount%></span></li>',"<%}%>","<%})%>","</ul>","</div>","<%})%>","</div>"].join("")),D=_.template(['<div class="pop_filter_lefttab">','<ul class="pop_filter_tabs">','<%if(Zone.length){%><li class="J_positionTabLabel<%if(curr.type==5){%> choosed<%}%>">商业区</li><%}%>','<%if(Location.length){%><li class="J_positionTabLabel<%if(curr.type==4){%> choosed<%}%>">行政区</li><%}%>','<%if(tuanType!=7 && AirportStation.length){%><li class="J_positionTabLabel<%if(curr.type==-4){%> choosed<%}%>">机场车站</li><%}%>','<%if(tuanType!=7 && SubwayLine.length){%><li class="J_positionTabLabel<%if(curr.type==-3){%> choosed<%}%>">地铁线</li><%}%>','<%if(tuanType!=7 && Attraction.length){%><li class="J_positionTabLabel<%if(curr.type==-2){%> choosed<%}%>">景点</li><%}%>','<%if(tuanType!=7 && College.length){%><li class="J_positionTabLabel<%if(curr.type==-1){%> choosed<%}%>">大学周边</li><%}%>',"</ul>","</div>",'<div class="pop_filter_righttab">',"<%if(Zone.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=5){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=5){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Zone, function(val){%>",'<li data-type="5" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==5&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(Location.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=4){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=4){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Location, function(val){%>",'<li data-type="4" data-value="<%=val.val%>" data-text="<%=val.txt%>"<%if(curr.type==4&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && AirportStation.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-4){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=-4){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(AirportStation, function(val){%>",'<li data-type="-4" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-4&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && SubwayLine.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=19){%> style="height:285px;display:none"<%}%> id="J_subwayLine">','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.line){%> class="backwards"<%}%>><div class="txt01">不限</div></li>',"<%_.each(SubwayLine, function(val){%>",'<li data-type="-5" data-value="<%=val.val%>" data-text="<%=val.txt%>" class="arr_r<%if(curr.line==val.val){%> backwards<%}%>"><div class="txt01"><%=val.txt%></div><span class="txt03"><%if(curr.line==val.val&&curr.type==-3){%><%=curr.name%><%}%></span><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && Attraction.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-2){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.val||curr.type!=-2){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(Attraction, function(val){%>",'<li data-type="-2" data-value="<%=val.val%>" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-2&&curr.val==val.val){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>","<%if(tuanType!=7 && College.length){%>",'<div class="J_positionTabPanel"<%if(curr.type!=-1){%> style="height:285px;display:none"<%}%>>','<ul class="pop_filter_baselist" style="min-height:285px">','<li<%if(!curr.pos||curr.type!=-1){%> class="choosed"<%}%>><div class="txt01">不限</div></li>',"<%_.each(College, function(val){%>",'<li data-type="-1" data-pos=\'<%=JSON.stringify(val.pos)%>\' data-text="<%=val.txt%>"<%if(curr.type==-1&&curr.pos.lat==val.lat&&curr.pos.lon==val.lon){%> class="choosed"<%}%>><div class="txt01"><%=val.txt%></div><span class="txt02"><%=val.groupCount%></span></li>',"<%})%>","</ul>","</div>","<%}%>",'<div class="J_positionTabPanel" style="height:285px;overflow:hidden;display:none" id="J_subwayStation">','<ul class="pop_filter_baselist" style="min-height:285px;"></ul>',"</div>","</div>"].join("")),E=_.template(['<li data-type="-3"><div class="pop_filter_back">返回</div></li>','<li data-type="19" data-line="<%=lineId%>"<%if(curr.val==lineId&&curr.type==19){%> class="choosed"<%}%> data-text="<%=lineName%>"><div class="txt01">全线</div></li>',"<%_.each(arr, function(a,i){%>",'<li data-type="-3" data-value="<%=a.val%>" data-line="<%=lineId%>" data-pos=\'<%=JSON.stringify(a.pos)%>\' data-text="<%=a.txt%>"<%if(curr.val==a.val){%> class="choosed"<%}%>>','<div class="txt01"><%=a.txt%></div><span class="txt02"><%=a.groupCount%></span>',"</li>","<%})%>"].join(""));return p=new t.Class({__propertys__:function(){var t=this;this.options={},this.page=null,this.mask=new n({onCreate:function(){var e=this;this.root.on("click",function(){t.options.categoryPanel.hide(),t.options.positionPanel.hide(),t.options.filterPanel.hide(),t._categoryStatus=!1,t._positionStatus=!1,t._customFilterStatus=!1,e.hide()})}})},initSort:function(){var t=this,e=g.getAttr("sortTypeIndex")||0,i=y.getAttr("sortRule"),n=y.getAttr("sortType"),a=t.options;this.sort=new s({trigger:a.sortTrigger,panel:a.sortPanel,label:a.sortLabel,selectedIndex:e,selectedItemCls:"choosed",onShow:function(){a.categoryPanel.hide(),a.positionPanel.hide(),a.filterPanel.hide(),t.mask.hide(),t._categoryStatus=!1,t._positionStatus=!1,t._customFilterStatus=!1},onSelect:function(e){var i=$(e),n=i.attr("data-id"),a=i.attr("data-type"),s=+this.selectedIndex>=0?this.selectedIndex:0;g.setAttr("sortTypeIndex",s),y.setAttr("sortRule",n),2==n&&m&&(a=8),y.setAttr("sortType",a),t.getListData()}});var o=this.sort.panel.find('[data-id="'+i+'"][data-type="'+n+'"]');o=o&&o[0]||$(this.sort.getItemByIndex(e))[0],this.sort.select(o,!0),a.sortPanel.on("touchmove",function(t){t.preventDefault()})},initCategory:function(){var t=this,e=this.options.categoryTrigger,i=this.options.categoryPanel;this.renderCategory(),e.on("click",function(){t._categoryStatus?(i.hide(),t.mask.hide(),t._categoryStatus=!1):(t.options.positionPanel.hide(),t.options.filterPanel.hide(),t._positionStatus=!1,t._customFilterStatus=!1,t.sort.hide(),i.show(),t.mask.show(),i.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),i.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),t._categoryStatus=!0,void 0===t._categoryInited&&(t.initCategoryTab(),t._categoryInited=!0))}),i.on("touchmove",function(t){t.preventDefault()})},initCategoryTab:function(){var t=this,e=this.page.$el,i=e.find(".J_categoryTabLabel"),n=e.find(".J_categoryTabPanel");this.categoryTab=new o({label:i,panel:n,isScroll:!0,labelSelectedClass:"choosed",labelSelectedIndex:v.getAttr("tuanTypeIndex")||0,itemClass:".pop_filter_baselist li",itemSelectedClass:"choosed",onSelect:function(e){var i=e.data("type"),a=e.data("value")||"",s=e.data("name"),o=r.groupType[i];n.find(".choosed").removeClass("choosed"),e.addClass("choosed"),t.page.updateTitle(o.name),7==i&&x.removeAttr("nearby");var l=T.getAttr("distance");d.clearSpecified(!1),l&&d.isNearBy()&&T.setAttr("distance",l),t.clearCustomFilter(!0),v.setAttr("tuanType",i),v.setAttr("category",o.category),v.setAttr("name",o.name),v.setAttr("tuanTypeIndex",o.index),v.setAttr("subVal",a),v.setAttr("subName",s),y.setAttr("qparams",d.getGroupQueryParam()),y.setAttr("ctype",i),t.options.categoryTrigger.html(s||r.groupType[i].name),t.resetPosition(i),t.getListData(),t.renderFilter(o.category),t.mask.hide(),t.options.categoryPanel.hide(),t._categoryStatus=!1}})},renderCategory:function(){var t={},e=w.get(),i=v.get()||{},n=this.options.categoryTrigger;if(t.tuanTypeVal=i.tuanType||y.getAttr("ctype")||0,i.subVal&&(t.subVal=i.subVal),n.html(i.subName||r.groupType[t.tuanTypeVal].name),e&&$.isArray(e.categroy)&&e.categroy.length>0){var a=e.categroy[0].groupCondition;a&&$.isArray(a)&&a.length>0&&(t.tuanType=$.grep(a,function(t){return 16==t.type}),t.subTuanType=$.grep(a,function(t){return 32==t.type}),this.options.categoryPanel.html(L(t)))}},updateCategoryName:function(){var t=v.getAttr("tuanTypeIndex")||0,e=v.getAttr("tuanType")||0;this.categoryTab?this.categoryTab.switch(t):this.renderCategory(),this.options.categoryTrigger.html(r.groupType[e].name)},initPosition:function(){var t=this,e=this.options.positionTrigger,i=this.options.positionPanel;this.renderPosition(),e.on("click",function(){f||(t._positionStatus?(i.hide(),t.mask.hide(),t._positionStatus=!1):(t.options.categoryPanel.hide(),t.options.filterPanel.hide(),t._categoryStatus=!1,t._customFilterStatus=!1,t.sort.hide(),i.show(),t.mask.show(),i.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),i.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),void 0===t._positionInited&&(t.initPositionTab(),t._positionInited=!0),t._positionStatus=!0))}),i.on("touchmove",function(t){t.preventDefault()})},initPositionTab:function(){function t(t){c.find(".choosed").removeClass("choosed"),c.find("li:first-child").addClass("choosed"),t.addClass("choosed").siblings().removeClass("choosed")}function e(){p.find(".backwards").removeClass("backwards"),p.find(".txt03").text("")}function i(i){t(i),e()}var n=this,s=this.page.$el,l=s.find(".J_positionTabLabel"),c=s.find(".J_positionTabPanel"),p=s.find("#J_subwayLine"),u=s.find("#J_subwayStation"),f={5:0,4:1,"-4":2,"-3":3,19:3,"-2":4,"-1":5};this.positionTab=new o({label:l,panel:c,isScroll:!0,labelSelectedClass:"choosed",labelSelectedIndex:f[C.getAttr("type")]||0,itemClass:".pop_filter_baselist li",itemSelectedClass:"choosed",onSwitch:function(){u.hide()},onSelect:function(t){var e,s,o=t.data("type"),l=t.data("text"),c=y.get(),f=d.getCurrentKeyWord();if(d.isNearBy()){x.setAttr("nearby",!1),T.removeAttr("distance");var _=n.page.$el.find('#J_filterTabLabel li[data-tab="distance"]'),m=n.page.$el.find('#J_filterTabPanel div[data-tab="distance"]');_.hide(),m.hide(),_.find("i").hide(),n.updateCustomFilterIcon(),y.removeAttr("pos")}if(f&&((0>o||"5"==o)&&d.removeCurrentKeyWord(),"4"==o&&"location"==f.type&&d.removeCurrentKeyWord()),c){if(+c.ctyId>0){var v=d.findCityInfoById(c.ctyId);v&&y.setAttr("ctyName",v.name)}c.edate||y.setAttr("edate",c.bdate)}if(l)switch(o){case 5:i(t),C.set({type:5,name:l,val:t.data("value"),pos:t.data("pos")});
break;case 4:i(t),C.set({type:4,name:l,val:t.data("value")});break;case 19:i(t),e=t.data("line"),s=p.find('li[data-value="'+e+'"]'),C.set({type:19,name:l,line:e,val:e}),u.hide(),p.show(),p.find(".txt03").text(""),p.find("li:first-child").removeClass("choosed"),s.addClass("backwards").siblings().removeClass("backwards");break;case-5:if(e=t.data("value"),e==u.data("line"))return p.hide(),void u.show();var g=n.getSubwayStation(e,l),b=u.find("ul");p.hide(),u.data("line",e).show(),b.html(E(g));var w=new a({wrapper:u,scroller:b});return void w.scrollTo(0,0,0);case-3:case-4:case-2:case-1:var S={type:o,name:l,pos:t.data("pos")},k=t.data("value");k&&(S.val=k),-3==o?(e=t.data("line"),s=p.find('li[data-value="'+e+'"]'),S.line=e,p.show(),u.hide(),p.find("li:first-child").removeClass("choosed"),p.find(".txt03").text(""),s.addClass("backwards").siblings().removeClass("backwards"),s.find(".txt03").text(l),t.addClass("choosed").siblings().removeClass("choosed")):i(t),C.set(S),T.setAttr("distance",{val:1,txt:"1公里内"})}else{if(-3==o)return p.show(),void u.hide();i(t),C.remove(),T.removeAttr("distance")}n.updatePositionName(l||h.weizhiquyu);var I=y.getAttr("ctype");0>o?n.renderFilter(r.groupType[I].category,!0):(T.removeAttr("distance"),n.renderFilter(r.groupType[I].category,!1)),n.updateCustomFilterIcon();var A=d.getGroupQueryParam();y.setAttr("qparams",A),C.setAttr("ctyId",c.ctyId),n.getListData(),n.mask.hide(),n.options.positionPanel.hide(),n._positionStatus=!1}})},renderPosition:function(t,e){var i={Zone:[],Location:[],College:[],AirportStation:[],SubwayLine:[],Attraction:[]},n=this.options.positionPanel,a=this.options.positionTrigger,s=w.get();if(i.curr=C.get()||{},this.updatePositionName(),t=t||y.getAttr("ctype")||0,i.tuanType=t,s&&$.isArray(s.categroy)&&s.categroy.length>0){var o=$.grep(s.categroy,function(e){return e.ctype==t});if(o&&$.isArray(o)&&o.length>0){var r=s.categroy[0].groupCondition;r&&$.isArray(r)&&r.length>0&&$.each(r,function(t,e){switch(e.type){case 2:i.Location.push(e);break;case 4:i.Zone.push(e);break;case 8:i.College.push(e);break;case 256:case 512:i.AirportStation.push(e);break;case 1024:i.SubwayLine.push(e);break;case 4096:i.Attraction.push(e)}})}else a.hide();7===+t?i.Zone.length||i.Location.length||i.College.length?(a.show(),n.html(D(i)),e&&e()):a.hide():i.Zone.length||i.Location.length||i.College.length||i.AirportStation.length||i.SubwayLine.length||i.Attraction.length?(a.show(),n.html(D(i)),e&&e()):a.hide()}},resetPosition:function(t){var e=this,i=1;i|=2,i|=4,i|=8,i|=64,i|=128,i|=256,i|=512,i|=1024,i|=2048,i|=4096,i|=8192,f=!0,this.options.positionTrigger.html(h.weizhiquyu),b.setParam({ctyId:y.getAttr("ctyId"),categroy:t,type:i}),b.excute(function(){e.renderPosition(t,function(){f=!1,e._positionInited=void 0})},function(){},!1,this)},updatePositionName:function(t){var e=this.options.positionTrigger;if(t)e.html(t);else{var i=C.get()||{},n=i.name;-6==i.type&&(n=h.weizhiquyu),e.html(n||h.weizhiquyu)}},initCustomFilter:function(){var t=this,e=t.options.customFilter,i=this.page.$el,n=i.find("#J_filterPanel"),a=i.find("#J_checkboxWrap"),s=i.find(".pop_filter_cancel"),o=i.find(".pop_filter_sure"),r=i.find(".pop_filter_clear");this.renderFilter(v.getAttr("category")),this.updateCustomFilterIcon(),e.on("click",function(){t._customFilterStatus?(n.hide(),t.mask.hide(),t._customFilterStatus=!1):(t.sort.hide(),t.options.categoryPanel.hide(),t.options.positionPanel.hide(),t._categoryStatus=!1,t._positionStatus=!1,n.show(),t.mask.show(),n.css({"-webkit-transform":"translate(0, 30px) translateZ(0)",opacity:0}),n.animate({"-webkit-transform":"translate(0, -8px) translateZ(0)",opacity:1}),void 0===t._customFilterInited&&(t.initFilterTab(),t._customFilterInited=!0),t._customFilterStatus=!0)}),s.on("click",function(){n.hide(),t.mask.hide(),t._customFilterStatus=!1}),o.on("click",function(){n.hide(),t.mask.hide(),t.sureCustomFilter(),t._customFilterStatus=!1}),r.on("click",function(){t.clearCustomFilter(),t._customFilterStatus=!1}),a.on("click","div[data-type]",function(e){if("LABEL"!=e.target.tagName){var i=$(e.currentTarget),n=i.data("type"),a=i.find("input:checked").length;"weekendsAvailable"==n?y.setAttr("weekendsAvailable",a?1:0):T.setAttr(n,a?1:0),r[t.customFilterSelectedCount()?"removeClass":"addClass"]("sta-disabled")}}),n.on("touchmove",function(t){t.preventDefault()})},initFilterTab:function(){var t=this,e=this.page.$el,i=e.find("#J_filterTabLabel"),n=e.find("#J_filterTabPanel"),a=e.find("input[data-value]"),s=e.find(".pop_filter_clear");i.on("click","li",function(e){var a=$(e.currentTarget);if(!a.hasClass("choosed")){var s=a.data("tab");i.find(".choosed").removeClass("choosed"),a.addClass("choosed"),n.find("div[data-tab]").hide(),t.renderTabWrap(s,n,!0)}}),n.on("click",".pop_filter_baselist li",function(e){var n=$(e.currentTarget),o=n.data("value"),r=n.data("text"),l=n.data("filter");if(S.indexOf(l)>-1)n.addClass("choosed").siblings(".choosed").removeClass("choosed"),o?T.setAttr(l,{val:o,txt:r}):T.removeAttr(l),i.find('li[data-tab="'+l+'"]>i')[o?"show":"hide"]();else if("star"==l)if(o){o=o.toString();var c=T.getAttr("star")||{};a[0].checked=n.parent().find("input:checked").length?!1:!0,n.find("input:checked").length?c[o]=r:delete c[o],T.setAttr("star",c),i.find('li[data-tab="star"]>i')[$.isEmptyObject(c)?"hide":"show"]()}else a.each(function(t,e){t>0&&(e.checked=!1)}),T.removeAttr("star"),i.find('li[data-tab="star"]>i').hide();s[t.customFilterSelectedCount()?"removeClass":"addClass"]("sta-disabled")})},renderTabWrap:function(t,e,i){var n,s,o,r=T.get(),l=e.find('div[data-tab="'+t+'"]');switch(i&&l.show(),t){case"price":7==y.getAttr("ctype")?(l.find('li[data-ptype="0"]').hide(),l.find('li[data-ptype="1"]').show()):(l.find('li[data-ptype="0"]').show(),l.find('li[data-ptype="1"]').hide()),l.find(".choosed").removeClass("choosed"),r&&r.price?l.find('li[data-value="'+r.price.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed");break;case"day":l.find(".choosed").removeClass("choosed"),r&&r.day?l.find('li[data-value="'+r.day.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed");break;case"star":if(r&&r.star){var c=r.star;l.find("input:checked")[0].checked=!1,_.each(c,function(t,e){l.find('input[data-value="'+e+'"]')[0].checked=!0})}else l.find("input[data-value]").each(function(t,e){e.checked=0>=t});break;case"brand":var d=l.find("#J_brand");if(d.length){var p=d.parent();p.css({overflow:"hidden","max-height":"295px"}),d.html(A(this.getDataFromCondition("brand",1))),n=new a({wrapper:p,scroller:d})}break;case"trait":var u=l.find("#J_trait");if(u.length){var h=u.parent();h.css({overflow:"hidden","max-height":"295px"}),u.html(P(this.getDataFromCondition("trait",8192))),s=new a({traitWrapper:h,scroller:u})}break;case"distance":l.data("scrolled")||(o=new a({wrapper:l,scroller:l.find("ul")}),l.data("scrolled","true")),l.find(".choosed").removeClass("choosed"),r&&r.distance?l.find('li[data-value="'+r.distance.val+'"]').addClass("choosed"):l.find('li[data-value=""]').addClass("choosed")}},renderFilter:function(t,e){var i=this.page.$el,n=T.get(),a=i.find("#J_checkboxWrap"),s=i.find("#J_filterTabLabel"),o=i.find("#J_filterTabPanel"),r={category:t,weekendsAvailable:y.getAttr("weekendsAvailable"),multiShop:n&&n.multiShop,voucher:n&&n.voucher},l=k(r);l?a.show().html(l):a.hide(),s.html(I({category:t||"all",isNearBy:d.isNearBy(),customdata:n||{},isUniversityNearBy:e})),o.find("div[data-tab]").hide(),this.renderTabWrap(s.find("li:first-child").addClass("choosed").data("tab"),o,!0)},getDataFromCondition:function(t,e){var i={val:"",arr:[]},n=w.get(),a=T.getAttr(t);if(a&&a.val&&(i.val=a.val),n&&$.isArray(n.categroy)&&n.categroy.length>0){var s=n.categroy[0].groupCondition;s&&$.isArray(s)&&s.length>0&&(i.arr=$.grep(s,function(t){return t.type==e}))}return i},getSubwayStation:function(t,e){var i={lineId:t,lineName:e,arr:[]},n=w.get();if(i.curr=C.get()||{},n&&$.isArray(n.categroy)&&n.categroy.length>0){var a=n.categroy[0].groupCondition;a&&$.isArray(a)&&a.length>0&&(i.arr=$.grep(a,function(e){return e.parentType==t}))}return i},clearCustomFilter:function(t){var e=this,i=d.isNearBy(),n=this.page.$el,a=n.find(".pop_filter_clear");if(!a.hasClass("sta-disabled")){var s=n.find("#J_filterTabLabel"),o=n.find("#J_filterTabPanel");y.removeAttr("weekendsAvailable"),T.removeAttr("multiShop"),T.removeAttr("voucher");var r=S.concat(["star"]);t&&i&&r.splice(r.indexOf("distance"),1),_.each(r,function(t){T.removeAttr(t),e.renderTabWrap(t,o,!1)}),s.find(".choosed").removeClass("choosed"),s.find("li i").hide(),o.find("div[data-tab]").hide(),this.renderTabWrap(s.find("li:first-child").addClass("choosed").data("tab"),o,!0),n.find("#J_checkboxWrap input:checked").each(function(t,e){e.checked=!1}),this.updateCustomFilterIcon()}},sureCustomFilter:function(){var t=y.get(),e=d.getGroupQueryParam();t&&(t.edate||y.setAttr("edate",t.bdate)),y.setAttr("qparams",e),this.getListData(),this.updateCustomFilterIcon()},customFilterSelectedCount:function(){var t=!1,e=d.getGroupQueryParam(),i=y.getAttr("weekendsAvailable"),n=e&&e.length>0&&e.filter(function(e){!t&&(t=9===parseInt(e.type,10));var i=parseInt(e.type,10);return 14==i&&e.value==v.getAttr("subVal")?!1:-1!==[1,2,3,9,14].indexOf(i)}).length;return 1==i&&(n+=1),!T.getAttr("distance")&&t&&(n-=1),"1|1"==T.getAttr("price.val")&&(n-=1),n>0?n:0},updateCustomFilterIcon:function(){var t=this,e=this.page.$el,i=t.options.customFilter,n=t.customFilterSelectedCount(),a=e.find(".pop_filter_clear");i.find(".fil_num").text(n)[n>0?"show":"hide"](),a[n>0?"removeClass":"addClass"]("sta-disabled")},getListData:function(){y.setAttr("pageIdx","1"),this.page.isLoading=!0,window.scrollTo(0,0),this.page.showLoading(),this.page.hideBottomLoading(),this.page.getGroupListData()},initialize:function(t){u(this.options,t),this.page=this.options.page,this.initCategory(),this.initPosition(),this.initSort(),this.initCustomFilter()}}),p.getInstance=function(t){return new p(t)},p}),define("SmoothSlide",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}function a(t){if(t&&!$(t).data("loaded")){var e=new Image;e.src=t.dataset["data-src"]||t.getAttribute("data-src"),e.onload=function(){t.src=e.src,$(t).data("loaded",!0)}}}var s,o="SmoothSlide",r=function(){},l=null,c=/\-?[0-9]+\.?[0-9]*/g,d=function(){var t=$.browser,e="";return e=t.webkit?"-webkit-":t.firefox?"-moz-":t.ie?"-ms-":""}(),p=d.replace(/\-/g,"");i.hasWidget(o)||(s=new t.Class({__propertys__:function(){this.options={container:l,autoplay:5e3,currentIndex:0,direction:s.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:l,tpl:'<div class="cui-slide"><div class="cui-slide-imgsouter"><div class="cui-slide-imgsinter" style="width:9999px"><%for(var i=0,len=data.length;i<len;i++){%><%var item = data[i]%><div class="cui-slide-img-item"><img data-href="<%=item.href%>" data-src="<%=item.src%>" data-img-id="<%=item.id%>" data-img-title="<%=item.title%>"/></div><%}%></div></div></div>',itemCls:".cui-slide-img-item",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:r,onSwitchEnd:r,onInit:r}},initialize:function(t){var e;n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.container=e.container,this.tpl=e.tpl,this.container&&this.container.length&&(this.render(e.source,e.currentIndex),this._isInteractive()&&this._bindEvents(),e.autoplay&&this._autoplay())},_isInteractive:function(){var t=this.options;return t.pageSize<t.source.length},_createLayout:function(){var t=this.source;this.container.html(_.template(this.tpl)({data:t})),this.source&&1===this.source.length&&this.container.find(".pics_show_box_in").css("width","100%")},_autoplay:function(){var t=this;clearTimeout(this.__autoplayTimer),this.__autoplayTimer=setTimeout(function(){t.next(!0),t._autoplay()},this.options.autoplay)},_bindEvents:function(){var t=this._runtime,e=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),e.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),e.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),e.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),t.root.on(p+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var t=this._runtime,e=this.container;e.off("touchmove",this.__moveHandler),e.on("touchstart",this.__touchStartHandler),e.on("touchend",this.__touchEndHandler),t.root.off(p+"TransitionEnd",this.__transitionEndHandler)},_current:0,count:function(){return this.source.length},render:function(t,e){clearTimeout(this.__autoplayTimer);var i=this.options;return this.source=t,this._createLayout(t),this.items=this.container.find(i.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._showCurrent(this._runtime.root,e),this._prefetch(i.direction),i.onInit.call(this,this._current),this},current:function(){return this._current},next:function(t){this.goto(this._current+this.options.pageSize,s.LEFT,t)},prev:function(){this.goto(this._current-this.options.pageSize,s.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(t,e,i){var n=this,a=this._runtime,o=this.options,r=o.direction,l=o.autoplay&&i,c=a.count,d=a.width;l&&(0>t?t=c-1:t>=c&&(t=0)),t>=0&&c>t?(s.animate(a.root,r*d*this._current,r*d*t,this.options.animationDuration),this._current=t,this._prefetch(e),setTimeout(function(){n.options.onSwitch.call(n,t,n.source[t])},10)):this.goto(this._current)},_showCurrent:function(t,e){var i=this._runtime;s.translate(i.root,this.options.direction*i.width*e,0),this._current=e,this._prefetch()},_prefetch:function(t){if(!(this.options.prefetch<0)){t||(t=s.LEFT);var e,i=this._current,n=this.options.prefetch,o=n*t;do e=this.items[i+n-o*t],e=e&&e.children[0],e&&a(e);while(o-=t)}},_getSwipeDirection:function(t,e){var i,n=e-t,a=Math.abs(n);return a>0&&a>this.options.minSwipe&&(i=n/a),i},_getRuntimeEnv:function(){var t=this.items,e=this.options,i=$(t[0]),n=i.parent(),a=n.parent(),s=a.offset(),o=this.count();return{width:e.width||s.width,root:n,stage:a,count:o}},__touchStartHandler:function(t){var e=t.touches[0],i=this._getRuntimeEnv().root,n=i.css(d+"transform").match(c);n=n&&n[0]||0,this.__lastTouchStartPos={left:Number(n),x:e.pageX,y:e.pageY,t:+new Date}},__touchEndHandler:function(t){var e=this.__lastTouchStartPos,i=this._getSwipeDirection(e.x,t.changedTouches[0].pageX);this[i===s.LEFT?"next":i===s.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(t){var e=this._current,i=this;setTimeout(function(){i.options.onSwitchEnd.call(i,t,e,i.source[e])},10)},__moveHandler:function(t){if(t.preventDefault(),!(t.touches.length>1||t.scale&&1!==t.scale)){var e=t.touches[0],i=this._getRuntimeEnv(),n=i.root,a=this.__lastTouchStartPos,o=a.left+e.pageX-a.x;s.translate(n,o,0)}}}),s.LEFT=-1,s.RIGHT=1,s.translate=function(t,e,i){var n=t[0],a=n&&n.style;a&&(t.css(d+"transition",i+"ms ease-out"),t.css(d+"transform","translate("+e+"px,0) translateZ(0)"))},s.animate=function(t,e,i,n){this.translate(t,i,n)},i.register({name:o,fn:s}))}),define("TabSlide",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}var a,s="TabSlide",o=function(){},r=null,l=/\-?[0-9]+\.?[0-9]*/g,c=function(){var t=$.browser,e="";return e=t.webkit?"-webkit-":t.firefox?"-moz-":t.ie?"-ms-":""}(),d=c.replace(/\-/g,"");i.hasWidget(s)||(a=new t.Class({__propertys__:function(){this.options={container:r,currentIndex:0,direction:a.LEFT,animationDuration:300,prefetch:0,placeholder:"",source:r,tpl:'<div class="sw_clip"><%var num =Math.ceil(data.length / 6);%><%for(var i = 1; i <= num ; i++){%><ul class="sw_con" js_index="<%=i%>"  ><%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%><li data-json=<%=JSON.stringify(data[index])%>><%=data[index].word%></li><%}%></ul><%}%></div><%if(num > 1){%><p class="sw_nav"><%for(var ni=1; ni<= num; ni++){%><i js_index="<%=ni%>" class="<%if(ni==1){%>current<%}%>"></i><%}%></p><%}%>',itemCls:".sw_con",pageSize:1,minSwipe:40,width:0,height:0,onSwitch:o,onSwitchEnd:o,onInit:o}},initialize:function(t){var e;if(n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.container=e.container,this.tpl=e.tpl,this.container&&this.container.length){this.render(e.source,e.currentIndex);var i=this;window.addEventListener("resize",$.proxy(i._resize,i)),this._isInteractive()&&this._bindEvents()}},_isInteractive:function(){var t=this.options;return t.source.length/6>1},_createLayout:function(){var t=this.source;this.container.html(_.template(this.tpl)({data:t}))},_bindEvents:function(){var t=this._runtime,e=this.container;this.__moveHandler=$.proxy(this.__moveHandler,this),e.on("touchmove",this.__moveHandler),this.__touchStartHandler=$.proxy(this.__touchStartHandler,this),e.on("touchstart",this.__touchStartHandler),this.__touchEndHandler=$.proxy(this.__touchEndHandler,this),e.on("touchend",this.__touchEndHandler),this.__transitionEndHandler=$.proxy(this.__transitionEndHandler,this),t.root.on(d+"TransitionEnd",this.__transitionEndHandler)},_unbindEvents:function(){var t=this._runtime,e=this.container;e.off("touchmove",this.__moveHandler),e.on("touchstart",this.__touchStartHandler),e.on("touchend",this.__touchEndHandler),t.root.off(d+"TransitionEnd",this.__transitionEndHandler)},destroy:function(){var t=this;t.container.innerHTML="",window.removeEventListener("resize",t._resize)},_current:0,count:function(){return Math.ceil(this.source.length/6)},render:function(t,e){var i=this.options;return this.source=t,this._createLayout(t),this.items=this.container.find(i.itemCls),this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,e),this},current:function(){return this._current},next:function(t){this.goto(this._current+this.options.pageSize,a.LEFT,t)},prev:function(){this.goto(this._current-this.options.pageSize,a.RIGHT)},play:function(){this.options.autoplay&&this._autoplay()},pause:function(){clearTimeout(this.__autoplayTimer)},stop:function(){clearTimeout(this.__autoplayTimer),this.goto(0)},"goto":function(t){var e=this._runtime,i=this.options,n=i.direction,s=e.count,o=e.width;t>=0&&s>t&&(a.animate(e.root,n*o*this._current,n*o*t,this.options.animationDuration),this._current=t,_.each(this.container.find(".sw_nav>i"),function(e){$(e).attr("js_index")==t?$(e).addClass("current"):$(e).removeClass("current")}))},_resize:function(){this._runtime=this._getRuntimeEnv(),this.items.css("width",this._runtime.width),this._runtime.root.css("width",this._runtime.width*this._runtime.count+"px"),this._showCurrent(this._runtime.root,this._current)},_showCurrent:function(t,e){var i=this._runtime;a.translate(i.root,this.options.direction*i.width*e,0),this._current=e},_getSwipeDirection:function(t,e){var i,n=e-t,a=Math.abs(n);return a>0&&a>this.options.minSwipe&&(i=n/a),i},_getRuntimeEnv:function(){var t=this.items,e=this.options,i=$(t[0]),n=i.parent(),a=n.parent(),s=a.offset(),o=this.count();return{width:e.width||s.width,root:n,stage:a,count:o}},__touchStartHandler:function(t){var e=t.touches[0],i=this._getRuntimeEnv().root,n=i.css(c+"transform").match(l);n=n&&n[0]||0,this.__lastTouchStartPos={left:Number(n),x:e.pageX,y:e.pageY,t:+new Date}},__touchEndHandler:function(t){var e=this.__lastTouchStartPos,i=this._getSwipeDirection(e.x,t.changedTouches[0].pageX);this[i===a.LEFT?"next":i===a.RIGHT?"prev":"goto"]()},__transitionEndHandler:function(){},__moveHandler:function(t){t.preventDefault(),t.touches.length>1||t.scale&&1!==t.scale}}),a.LEFT=-1,a.RIGHT=1,a.translate=function(t,e){var i=t[0],n=i&&i.style;n&&t.css(c+"transform","translate3d("+e+"px, 0, 0)")},a.animate=function(t,e,i,n){this.translate(t,i,n)},i.register({name:s,fn:a}))}),define("Switch",["cBase"],function(){function t(t){this.options={wrap:null,cursor:null,cursorCls:"",turnOnCls:"active",html:"<i>关</i>",isTurnOn:!1,onChange:e},this.initialize(t),this.turn(this.isTurnOn,!0)}var e=function(){},i=$.extend;return t.prototype={initialize:function(t){i(this.options,t),this.isTurnOn=this.options.isTurnOn,this.wrap=this.options.wrap,this.wrap&&this.renderHTML(),this.cursor=this.options.cursor?this.options.cursor:this.wrap.find(this.options.cursorCls),this.bindEvents()},renderHTML:function(){this.wrap.html(this.options.html)},bindEvents:function(){var t=this.cursor,e=this;this._clickHandler=function(){e.turn()},t&&t.length&&t.parent().bind("click",this._clickHandler)},unbindEvents:function(){this.cursor.parent().unbind("click",this._clickHandler)},turn:function(t){var e,i=this.options;e=void 0===t?!this.isTurnOn:t;try{this.wrap&&this.wrap[e?"addClass":"removeClass"](i.turnOnCls),i.onChange.call(this,e),this.isTurnOn=e}catch(n){}},on:function(){this.turn(!0)},off:function(){this.turn(!1)}},t}),define("VoiceSearch",["cBase","cWidgetFactory","cWidgetGuider","libs"],function(t,e){var i,n="VoiceSearch",a=e.create("Guider");e.hasWidget(n)||(i=new t.Class({__propertys__:function(){this.trigger=null},initialize:function(t){this.trigger=t,t&&t.length&&this._bindEvents()},_bindEvents:function(){var t=this;this.trigger.on("click",function(){t.showPanel()})},showPanel:function(){a.show_voice_search({bussinessType:i.TUAN})}}),i.TUAN=70,e.register({name:n,fn:i}))}),define("HttpErrorHelper",[],function(){var t={500:"服务器出错，请稍后再试！",404:"连接失败，网络不给力哦！",408:"网络不给力哦，请在更好的网络环境下使用！"},e=function(e){return t[e]},i={getMessage:function(t){var i=t.status,n=t.statusText;if(i>=500)switch(i){case 500:n=e(500,{});break;default:n=e(500,{})}else if(i>=400)switch(i){case 408:n=e(408,{});break;case 404:n=e(404,{});break;default:n=e(404,{})}else n=e(404,{});return n}};return i}),define("NumberStep",["libs"],function(){function t(t){var e=function(){},i={max:9,min:1,initialVal:1,step:1,html:'<i class="minus <%if(initialVal <= min ){ %>num_invalid<%} %>">-</i><span id="J_curNum"><%=initialVal %></span><i class="plus <%if(initialVal >= max ){ %>num_invalid<%} %>">+</i>',wrap:null,disableClass:"num_invalid",onChange:e,onMax:e,onMin:e};this.options=$.extend(i,t),this.wrap=this.options.wrap,this.renderHtml(),this.els={curNumDom:this.wrap.find("#J_curNum"),plusDom:this.wrap.find(".plus"),minusDom:this.wrap.find(".minus"),flagDom:this.wrap.find("i")},this.bindEvents()}return t.prototype={constructor:t,bindEvents:function(){var t=this;this.wrap.on("click",".plus,.minus",function(e){var i=$(e.target),n=parseInt(t.els.curNumDom.text().trim()),a=i.text().trim()||i.attr("data-flag");return i.hasClass(t.options.disableClass)?!1:("+"===a&&n<t.options.max?n++:"-"===a&&n>t.options.min?n--:n=t.options.min,t.els.flagDom.removeClass(t.options.disableClass),n===t.options.min&&(i.addClass(t.options.disableClass),t.options.onMin(e)),n===t.options.max&&(i.addClass(t.options.disableClass),t.options.onMax(e)),t.els.curNumDom.html(n),void t.options.onChange.call(t))})},triggerChange:function(){this.options.onChange.call(this)},unbindEvents:function(){this.wrap.off("click")},_changeStatus:function(t,e){var i="disable"===e?"addClass":"removeClass";"+"===t?this.els.plusDom[i](this.options.disableClass):"-"===t?this.els.minusDom[i](this.options.disableClass):this.els.flagDom[i](this.options.disableClass)},disable:function(t){this._changeStatus(t,"disable")},enable:function(t){this._changeStatus(t,"enable")},renderHtml:function(){this.wrap.html(_.template(this.options.html,this.options))},getCurrentNum:function(){return this.els.curNumDom.text().trim()},setCurrentNum:function(t){this.els.curNumDom.text(t)},setOptions:function(t,e){e&&(this.options[t]=e,this.options.onChange.call(this))}},t}),define("Payment",["cUtility","cWidgetGuider","cWidgetFactory","cHybridFacade","cUtilityCrypt"],function(t,e,i,n,a){function s(t,e,i){var n,s,r,l=t.oid||t.orderID,d=e?"/webapp/tuan/index.html#booking":"/webapp/tuan/booking",p=e?"/webapp/tuan/index.html#booking.success!{orderid}":"/webapp/tuan/bookingsuccess/{orderid}.html",u=e?"index.html":c[o()],h=e?"file:/":"http://"+location.host,f={IsNeedCardRisk:!0,payTypeList:t.payTypeList,subPayTypeList:t.subPayTypeList},_=p.replace("{orderid}",l);return i&&(f.isRealTimePay=i.IsRealPay||0),n=h+_,s=h+d,r=h+(t.from||d),t.oid=t.oid.toString(10),t.from=r,t.sback=n,t.eback=n,t.rback="",u+"#index?bustype="+t.bustype+"&extend="+encodeURIComponent(a.Base64.encode(JSON.stringify(f)))+"&oid="+t.oid+"&token="+encodeURIComponent(a.Base64.encode(JSON.stringify(t)))}function o(){var t=d.location.host.toLowerCase(),e="uat";return t.match(/^(m|3g|wap)\.ctrip\.com/i)||"10.8.2.111"==t?e="pro":t.match(/^m\.uat\.qa/i)?e="uat":(t.match(/^(m|w\-tuan\-m)\.fat/i)||t.match(/^(localhost|127\.0)/i))&&(e="dev"),e.toUpperCase()}var r,l="Payment",c={DEV:"https://secure.fat18.qa.nt.ctripcorp.com/webapp/payment2/index.html",TEST:"https://secure.fat18.qa.nt.ctripcorp.com/webapp/payment2/index.html",UAT:"https://secure.uat.qa.nt.ctripcorp.com/webapp/payment2/index.html",PRO:"https://secure.ctrip.com/webapp/payment2/index.html"},d=window,p=t.isInApp(),u=i.create("Guider");r=p?{submit:function(t,e,i){var n=s(e,!0,i);/file\:[\\\/]*/i.test(n)&&(n="index.html#"+n.split("#")[1]),u.cross({path:"payment2",param:n})}}:{submit:function(t,e,i){t.jump(s(e,!1,i))}},i.register({name:l,fn:r})}),define("WechatShare",["cBase"],function(t){function e(t){return t===Object(t)}var i,n=function(){};return i=new t.Class({__propertys__:function(){this.options={data:null,enableNative:!0,onShared:n}},share:function(t,e,i){this._invoke(e,t,i||this.options.onShared)},shareFriends:function(t){t=t||this.options.data,this.share(t,i.SHARE_APP_MESSAGE)},shareTimeline:function(t){t=t||this.options.data,this.share(t,i.SHARE_TIMELINE)},shareWeibo:function(t){t=t||this.options.data,this.share({content:t.desc,url:t.link},i.SHARE_WEIBO)},initialize:function(t){e(t)&&(this.options=$.extend(this.options,t),this.options.enableNative&&this._bindEvents())},_bindEvents:function(){var t=this;WeixinJSBridge.on("menu:share:appmessage",function(){t.shareFriends()}),WeixinJSBridge.on("menu:share:timeline",function(){t.shareTimeline()}),WeixinJSBridge.on("menu:share:weibo",function(){t.shareWeibo()})},_invoke:function(t,e,i){WeixinJSBridge.invoke(t,e,function(t){i&&i(t)})}}),i.SHARE_TIMELINE="shareTimeline",i.SHARE_APP_MESSAGE="sendAppMessage",i.SHARE_WEIBO="shareWeibo",i}),define("ScrollObserver",["c"],function(){function t(t,e,i,n){return Math.abs(t-e)>=Math.abs(i-n)?t-e>c?"left":"right":i-n>c?"up":"down"}function e(){var t=this,e=r.body,i=e.scrollLeft,n=e.scrollTop;t.status=p.END,o.trigger(u.END,{direction:t.direction,y:n,x:i}),f=e.scrollTop,h=e.scrollLeft}function n(){var n=this,a=r.body,s=a.scrollLeft,c=a.scrollTop;i=(new Date).getTime(),n.status===p.END?(n.status=p.START,n.direction=t(h,s,f,c),o.trigger(u.START,{direction:n.direction,y:c,x:s})):n.status=p.SCROLLING,clearTimeout(_),_=setTimeout($.proxy(e,n),l)}function a(){n.call(this)}var s,o=window,r=o.document,l=800,c=0,d="scroll",p={START:0,SCROLLING:1,END:2},u={START:"customScrollStart",END:"customScrollEnd"},h=0,f=0,_=null;return o=$(o),s={init:function(){return this.status=p.END,this.__scrollHandler=$.proxy(a,this),this},enable:function(){o.on(d,this.__scrollHandler)},disable:function(){o.off(d,this.__scrollHandler)}}}),define("MemCache",["c"],function(){var t,e={};return t={setItem:function(t,i){return e[t]=i,this},getItem:function(t){return e[t]},removeItem:function(t){delete e[t]}}}),define("AMapWidget",["cBase","cUICore","cUtility","cWidgetFactory","cGeoService","cWidgetGeolocation","libs"],function(t,e,i,n,a){function s(t){return t===Object(t)}var o,r="AMapWidget",l=function(){},c=null,d=$.isArray;o=new t.Class({__propertys__:function(){this.options={key:"0b895f63ca21c9e82eb158f46fe7f502",webapi:"http://webapi.amap.com/maps?v=1.2",level:13,center:c,height:0,width:0,locationButton:c,onReady:l,onZoom:l,onMovestart:l,onGeoBegin:l,onGeoComplete:l,onGeoError:l},this.__stacks=[]},initialize:function(t){var e,i=this;s(t)&&(e=$.extend(this.options,t)),this.options=e,i._updateContainerSize(e.width,e.height),i._loadScript($.proxy(i._createMap,i)),i.gps=a.GeoLocation},addMarker:function(t){var e=this,i=this.host,n=[];return i?d(t)?(t.forEach(function(t){n.push(e.addMarker(t))}),n):(n=new i.Marker(t),n.setMap(this.map),n):void this.__stacks.push(t)},removeMarker:function(t){t.setMap(null)},addEvent:function(t,e,i,n){var a,o=this;if(s(e))for(a in e)e.hasOwnProperty(a)&&o.addEvent(t,e,e[a],n);else o.host.event.addListener(t,e,i,n)},removeEvent:function(t,e,i){var n,a=this;if(s(e))for(n in e)e.hasOwnProperty(n)&&a.addEvent(e,e[n]);else a.host.event.removeListener(t,e,i)},setFitView:function(){this.map.setFitView()},setPosition:function(t,e,i){t.setPosition(new this.host.LngLat(e,i))},removeControl:function(t){this.map.removeControl(t)},_bindEvents:function(){var t=this.host.event;this.__zoomendHandler=$.proxy(this._zoomendHandler,this),this.__movestartHandler=$.proxy(this._movestartHandler,this),t.addListener(this.map,"zoomchange",this.__zoomendHandler),t.addListener(this.map,"movestart",this.__movestartHandler),this.__clickHandler=$.proxy(this._clickHandler,this),t.addListener(this.map,"click",this.__clickHandler)},_unbindEvents:function(){this.host.event.event.removeListener(this.map,"zoomchange",this.__zoomendHandler),this.host.event.event.removeListener(this.map,"click",this.__clickHandler)},_clickHandler:function(){this.options.onClick.call(this)},_zoomendHandler:function(t){var e=this.options;e.onZoom.call(this,t,this.map.getZoom())},_movestartHandler:function(t){var e=this.options;e.onMovestart.call(this,t)},_formatGPSInfo:function(t){return{coords:{latitude:t.lat,longitude:t.lng,accuracy:50},timestamp:+new Date}},_addCurrentLocationTool:function(t,e,n){var a=this,s=this.map,o=this.host;s.plugin("AMap.Geolocation",function(){var r=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,buttonDom:a.options.locationButton,showButton:!0,buttonPosition:"LB",buttonOffset:new o.Pixel(0,0),showMarker:!0,showCircle:!0,panToLocation:!1,zoomToAccuracy:!1});i.isInApp()&&(r.onButtonClick=function(){n&&n.call(r,r._container),a.gps.Subscribe("tuan/amap",{onComplete:function(t){r.onPositionComplete(a._formatGPSInfo(t))},onError:function(t){r.onPositionError(t)},onPosComplete:function(){},onPosError:function(t){r.onPositionError(t)}},a,!0)}),s.addControl(r),o.event.addListener(r,"complete",$.proxy(t,a)),o.event.addListener(r,"error",$.proxy(e,a)),a.geolocation=r})},_updateContainerSize:function(t,e){var i=this.options,n=i.container,a=document.body,s=n.offset();t||(t=s.width||a.clientWidth),e||(e=s.height||a.clientHeight),n.css({width:t,height:e})},_createMap:function(){var t=window.AMap,e=this.options,i=this.__stacks,n=e.center.split("|");if(!t)throw new Error("no mapapi!");this.host=t,this.map=new t.Map(e.container[0],{level:11,center:new t.LngLat(n[0],n[1])}),i.length&&this.addMarker(i),this._bindEvents(),e.locationButton&&this._addCurrentLocationTool(e.onGeoComplete,e.onGeoError,e.onGeoBegin),e.onReady.call(this)},_loadScript:function(t){if(window.AMap)return void t();var e=document.createElement("script"),i=this.options,n="__"+r+Date.now();window[n]=t,e.type="text/javascript",e.src=i.webapi+"&key="+i.key+"&callback="+n,document.body.appendChild(e)}}),n.register({name:r,fn:o})}),define("POIWidget",["cBase","cUICore","cWidgetFactory","libs"],function(t,e,i){function n(t){return t===Object(t)}var a,s="POIWidget",o=function(){},r=null;a=new t.Class({__propertys__:function(){this.options={model:r,source:3,params:{},onSuccess:o,onError:o}},initialize:function(t){var e;n(t)&&(this.options=$.extend(this.options,t)),e=this.options,this.model=e.model},query:function(t,e,i){var a=this,s=a.options,o=s.params;n(t)&&(t=$.extend(o,t)),this.model.param=t,this.model.excute(function(t){(e||s.onSuccess).call(a,t)
},function(t){(i||s.onError).call(a,t)},!1,a)},abort:function(){this.options.model.abort()}}),i.register({name:s,fn:a})}),define("LazyLoad",["libs"],function(){function t(t){var e=function(){},i={attr:"data-lazy",wrap:window,container:window,event:["scroll","resize"],time:100,threshold:180,vertical:!0,stateAttr:"data-load-state",onComplete:e,animateCls:"fade-in"};this.options=$.extend(i,t),this.container=$(this.options.container),this.wrap=$(this.options.wrap),this.eles=this.options.wrap===window?$("img"):$("img",this.wrap),this.bindEvents()}return t.prototype={constructor:t,bindEvents:function(){var t=this.options.event,e=function(t){this.TimerFun&&clearTimeout(this.TimerFun),this.TimerFun=setTimeout(function(){this.triggerEvent(t)}.bind(this),this.options.time)}.bind(this);for(var i in t)this.container.on(this.options.event[i],e)},_imgLoaded:function(t,e){t[0].src=t.attr(e.attr),t.addClass(e.animateCls),t.attr(e.stateAttr,"true")},triggerEvent:function(t){for(var e,i,n=this,a=0,s=n.options;a<n.eles.length;a++)e=$(n.eles[a]),i=e.attr(s.attr),i&&e[0].src.trim()!==i.trim()&&this.isReady(e)&&this._loadImage(e,n._imgLoaded);s.onComplete.call(this,t)},_loadImage:function(t,e){var i=this,n=i.options,a=new Image;return a.src=t.attr(n.attr),a.complete?void e.call(i,t,n):void(a.onload=function(){a.onload=null,e.call(i,t,n)})},isReady:function(t){var e=this.options.vertical?"scrollTop":"scrollLeft",i=this.options.vertical?"top":"left",n=t.offset()[i],a=this.options.vertical?this.container.height():this.container.width(),s=this.container[e]();return n>=s&&n<=a+s+this.options.threshold},updateDom:function(){this.eles=this.options.wrap===window?$("img").not("["+this.options.stateAttr+' = "true"]'):$("img",this.wrap).not("["+this.options.stateAttr+'="true"]'),this.container.trigger(this.options.event[0])},unbindEvents:function(){for(var t in this.options.event)this.container.off(this.options.event[t])}},t}),define("CallPhone",["libs","c","cWidgetFactory","cWidgetGuider","cUtility"],function(t,e,i,n,a){function s(t){var e=function(){},i={tpl:'<%_.each(data, function(t) {%> <div class="base_btn02 J_phoneItem" data-phone="<%=t %>"><a href="tel:<%=t %>" style="display: inline-block;width: 100%;"><%=t %></a></div> <%});%><div class="base_btn02 J_cancelPhone">取消</div>',wrap:'<div class="wrapBottom J_phoneListPanel" style="z-index: 9999"></div>',ele:".J_phone",onSelect:e,onHide:e,onShow:e,dataName:"data-phone",view:""};this.opt=$.extend(i,t),this.view=this.opt.view,this.ele=$(this.opt.ele),this.dataName=this.opt.dataName,this.bindEvents()}var o=i.create("Guider"),r=a.isInApp();return s.prototype={_initMask:function(){var t=this;!this.mask&&(this.mask=new e.ui.Mask({onCreate:function(){this.root.on("click",function(){t.hidePanel(),t.hideMask()})}})),this.showMask()},showMask:function(){this.mask&&this.mask.show(),this.opt.onShow&&this.opt.onShow.apply(this)},hideMask:function(){this.mask&&this.mask.hide(),this.opt.onHide&&this.opt.onHide.apply(this)},bindEvents:function(){this.ele.on("click",this._clickHandler.bind(this))},_clickHandler:function(t){r&&t.preventDefault();var e=$(t.currentTarget).attr(this.dataName);e&&(e=e.split(",")),e&&e.length&&(r||e.length>1)&&(this._initMask(),this._initPanel(),this._updatePhoneList(e))},_phoneItemHandler:function(t){r&&t.preventDefault(),this.hideMask(),this.hidePanel();var e=$(t.currentTarget).attr("data-phone");e&&this.makePhoneCall(e),this.opt.onSelect&&this.opt.onSelect.apply(this)},_initPanel:function(){this.phonePanel=this.view.$el.find(".J_phoneListPanel"),(!this.phonePanel||this.phonePanel&&0===this.phonePanel.length)&&(this.view.$el.append(this.opt.wrap),this.phonePanel=this.view.$el.find(".J_phoneListPanel"),this.phonePanel.on("click",".J_phoneItem",this._phoneItemHandler.bind(this)),this.phonePanel.on("click",".J_cancelPhone",function(){this.hideMask(),this.hidePanel()}.bind(this)))},hidePanel:function(){this.phonePanel&&this.phonePanel.hide()},_updatePhoneList:function(t){this.phonePanel.html(_.template(this.opt.tpl,{data:t})),this.phonePanel.show()},makePhoneCall:function(t){o.apply({hybridCallback:function(){return o.callPhone({tel:t}),!1},callback:function(){return!0}})},updateDom:function(t){this.ele=$(t),this.bindEvents()}},s}),define("FilterXss",[],function(){function t(t,e,i){if("href"===e||"src"===e){if(p.lastIndex=0,p.test(i))return"#";if(u.lastIndex=0,u.test(i))return"#"}else if("style"===e){if(h.lastIndex=0,h.test(i))return"#";if(f.lastIndex=0,f.test(i))return""}}function e(t){return i(t)}function i(t){return t.replace(o,"&lt;").replace(r,"&gt;")}function n(t,e){return String.fromCharCode(parseInt(e))}function a(i){this.options=i=i||{},this.whiteList=$.extend(!0,s,i.whiteList||{}),this.onTagAttr=$.extend(!0,t,i.onTagAttr||{}),this.onIgnoreTag=$.extend(!0,e,i.onIgnoreTag||{})}var s={h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],hr:[],span:[],strong:[],b:[],i:[],br:[],p:[],pre:[],code:[],a:["target","href","title"],img:["src","alt","title"],div:[],table:["width","border"],tr:[],td:["width","colspan"],th:["width","colspan"],tbody:[],ul:[],li:[],ol:[],dl:[],dt:[],em:[],cite:[],section:[],header:[],footer:[],blockquote:[],audio:["autoplay","controls","loop","preload","src"],video:["autoplay","controls","loop","preload","src","height","width"]},o=/</g,r=/>/g,l=/"/g,c=/[^a-zA-Z0-9_:\.\-]/gim,d=/&#([a-zA-Z0-9]*);?/gim,p=/\/\*|\*\//gm,u=/^[\s"'`]*((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,h=/\/\*|\*\//gm,f=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi;return a.prototype={constructor:a,filterAttributes:function(t,e){t=t.toLowerCase();for(var i,a=this,s=this.whiteList[t],o=0,r="",p=!1,u=!1,h=function(e,i){if(e=e.trim(),!u&&"/"===e)return void(u=!0);if(e=e.replace(c,"").toLowerCase(),!(e.length<1)&&-1!==s.indexOf(e)){if(i){i=i.trim().replace(l,"&quote;"),i=i.replace(d,n);for(var o="",p=0,h=i.length;h>p;p++)o+=i.charCodeAt(p)<32?" ":i[p];i=o.trim();var f=a.onTagAttr(t,e,i);"undefined"!=typeof f&&(i=f)}r+=e+(i?'="'+i+'"':"")+" "}},f=0,_=e.length;_>f;f++){var m=e[f];if(p!==!1||"="!==m)if(p===!1||f!==o||'"'!==m&&"'"!==m)" "!==m||(i=e.slice(o,f).trim(),p===!1?h(i):h(p,i),p=!1,o=f+1);else{var v=e.indexOf(m,f+1);if(-1===v)break;i=e.slice(o+1,v).trim(),h(p,i),p=!1,f=v,o=f+1}else p=e.slice(o,f),o=f+1}return o<e.length&&(p===!1?h(e.slice(o)):h(p,e.slice(o))),u&&(r+="/"),r.trim()},addNewTag:function(t,e,n){var a,s="",o="</"===t.slice(0,2)?2:1,r=t.indexOf(" ");if(a=-1===r?t.slice(o,t.length-1).trim():t.slice(o,r+1).trim(),a=a.toLowerCase(),a in this.whiteList)if(-1===r)s+=t.slice(0,o)+a+">";else{var l=this.filterAttributes(a,t.slice(r+1,t.length-1).trim());s+=t.slice(0,o)+a+(l.length>0?" "+l:"")+">"}else{var c={isClosing:2===o,position:n,originalPosition:e-t.length+1},d=this.onIgnoreTag(a,t,c);"undefined"==typeof d&&(d=i(t)),s+=d}return s},process:function(t){var e="",n=0,a=!1,s=!1,o=0;if("string"!==$.type(t))return"";for(var r=t.length;r>o;o++){var l=t[o];if(a===!1){if("<"===l){a=o;continue}}else if(s===!1){if("<"===l){e+=i(t.slice(n,o)),a=o,n=o;continue}if(">"===l){e+=i(t.slice(n,a)),e+=this.addNewTag(t.slice(a,o+1),o,e.length),n=o+1,a=!1;continue}if('"'===l||"'"===l){s=l;continue}}else if(l===s){s=!1;continue}}return n<t.length&&(e+=i(t.substr(n))),e}},a.Instance=new a,{filterXSS:function(t,e){return e&&$.isPlainObject(e)&&(a.Instance=new a(e)),a.Instance.process(t)},tagFilter:function(t,e){"function"!=typeof e&&(e=function(){});var i=[],n=!1;return{onIgnoreTag:function(a,s,o){if(-1!==t.indexOf(a)){var r="[removed]";if(n!==!1&&o.isClosing){var l=o.position+r.length;i.push([n,l]),n=!1}else n=o.position;return r}return e(a,s,o)},filter:function(t){var e="",n=0;return i.forEach(function(i){e+=t.slice(n,i[0]),n=i[1]}),e+=t.slice(n)}}}}}),define("ConsoleDebug",["libs","c","cUtility"],function(t,e,i){function n(t){var e={btn:'<i style="position:fixed;bottom:300px;color:green;z-index:9999;">CL</i>',div:'<div style="position:fixed;bottom:290px;z-index:10000;display:none;width: 100%;"><button class="J_clearStorage">Clear</button><button class="J_xiaoli">Xiaoli</button><button class="J_www">www</button><button class="J_normal">Normal</button><button class="J_noOne">None</button><button class="J_reload">Reload</button><div class="J_debugLogSwitch"></div></div>',conBox:'<div class="J_logContent" style="position: fixed;bottom:100px;z-index: 10001;height:130px;width: 100%;display: none;background:gray;"><i style="height: 30px;" class="cui-grayload-close"></i><textarea style="width: 100%;height: 100%;" placeholder="Here is log"></textarea></div>'};this.opt=$.extend(e,t),this.init()}var a=$("#main"),s=$("body"),o={user:'{"value":{"UserID":"21634352BAC43044380A7807B0699491","LoginName":"","IsNonUser":false,"UserName":"wwwwwwtestc","Mobile":"13523612123","BMobile":"13523612123","Address":"","Birthday":"00010101","Experience":514987975,"Gender":1,"PostCode":"","VipGrade":30,"VipGradeRemark":"钻石贵宾","Email":"yqshui@yqshui.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"5085D900D69F03960C109A10DFD383C17419D30D241A442C5CA0CAE41F6B56CE"},"oldvalue":null,"timeout":"2015/01/03 10:46:12","savedate":"2014/12/04 10:46:12"}',userinfo:'{"data":{"UserID":"21634352BAC43044380A7807B0699491","LoginName":"","IsNonUser":false,"UserName":"wwwwwwtestc","Mobile":"13523612123","BMobile":"13523612123","Address":"","Birthday":"00010101","Experience":514987975,"Gender":1,"PostCode":"","VipGrade":30,"VipGradeRemark":"钻石贵宾","Email":"yqshui@yqshui.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"5085D900D69F03960C109A10DFD383C17419D30D241A442C5CA0CAE41F6B56CE"},"timeout":"2015-01-03 10:46:07"}'},r={user:'{"value":{"UserID":"AEFF51E4F9EA6CCBA42E11736E72441C","LoginName":"","IsNonUser":false,"UserName":"xiaoli-FAT","Mobile":"13023112562","BMobile":"","Address":"","Birthday":"19210101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"chen.xiaoli@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"22489D878AF6215DED9BAB44EE3AB2D7CFE94333D4E38D59DF80561A3E5DD066"},"oldvalue":null,"timeout":"2015/12/14 10:11:42","savedate":"2014/11/14 10:11:42"}',userinfo:'{"data":{"UserID":"AEFF51E4F9EA6CCBA42E11736E72441C","LoginName":"","IsNonUser":false,"UserName":"xiaoli-FAT","Mobile":"13023112562","BMobile":"","Address":"","Birthday":"19210101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"chen.xiaoli@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"22489D878AF6215DED9BAB44EE3AB2D7CFE94333D4E38D59DF80561A3E5DD066"},"timeout":"2014-12-12 20:38:51"}'},l={user:'{"value":{"UserID":"FCA154F6235E2ECF665F5DFE71D4D5B1","LoginName":"","IsNonUser":false,"UserName":"","Mobile":"","BMobile":"","Address":"","Birthday":"00010101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"daihy@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"7B5C33A12EE614DE6656E23ABD8897D505C1DE90901325518281D46C2D640A85"},"oldvalue":null,"timeout":"2014/12/14 15:38:25","savedate":"2015/11/14 15:38:25"}',userinfo:'{"data":{"UserID":"FCA154F6235E2ECF665F5DFE71D4D5B1","LoginName":"","IsNonUser":false,"UserName":"","Mobile":"","BMobile":"","Address":"","Birthday":"00010101","Experience":1200,"Gender":2,"PostCode":"","VipGrade":0,"VipGradeRemark":"普通会员","Email":"daihy@ctrip.com","ExpiredTime":"/Date(-62135596800000-0000)/","Auth":"7B5C33A12EE614DE6656E23ABD8897D505C1DE90901325518281D46C2D640A85"},"timeout":"2014-12-14 15:38:22"}'},c="TUAN_DEBUG_CON",d=window.localStorage;return n.prototype={init:function(){var t=this;this._isDevEnv()&&(window._log=$.extend(window._log,{log:function(e){var i=t.consoleBox.find("textarea"),n=this.stash;n.push("undefined"!=typeof e?JSON.stringify(e):""),i.text(n.join("\n"))}})),this.renderHtml(),this.showMask(),this.renderConsoleBox(),this._bindEvents(),this.clearAds()},_isDevEnv:function(){var t,e=!1;return i.isInApp()?(t=i.isPreProduction(),("0"===t||"1"===t||"2"===t)&&(e=!0)):location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(e=!0),e},_bindEvents:function(){var t=this;this.btn&&this.btn.on("click",function(){t.renderHtml(),t.showMask()}),a.on("click","button",function(e){var i,n=$(e.target);n.hasClass("J_xiaoli")?(i="已切换为小丽登陆！",t.setUserLogin(r)):n.hasClass("J_noOne")?(i="已切换为无用户登陆！",t.setUserLogin()):n.hasClass("J_www")?(i="已切换为www用户登陆",t.setUserLogin(o)):n.hasClass("J_normal")?(i="已切换为普通账户登录",t.setUserLogin(l)):n.hasClass("J_clearStorage")?(i="",t.clearLocal(),t.showToast("Clear",1,function(){t.reset()})):n.hasClass("J_reload")&&(i="Reloading Page"),i&&t.showToast(i,1,function(){t.refreshPage()})}),s.on("click",".J_logContent i",function(){t.consoleBox.hide(),t.setStatusLocal(!1)})},setUserLogin:function(t){d.setItem("USER",t&&t.user),d.setItem("USERINFO",t&&t.userinfo)},showToast:function(t,i,n){!this.toast&&(this.toast=new e.ui.Toast),this.toast.show(t,i||1,n)},showMask:function(){var t=this;!this.mask&&(this.mask=new e.ui.Mask({onCreate:function(){this.root.on("click",function(){t.reset()})}})),this.mask.show()},hideMask:function(){this.mask&&this.mask.hide()},renderHtml:function(){var t=this;this.div||(this.div=$(this.opt.div).appendTo(a),this.switch=new e.ui.cuiSwitch({rootBox:$(".J_debugLogSwitch"),checked:this.getStatusLocal()?!0:!1,changed:function(){t.setStatusLocal(this.getStatus()),t.switchConsoleBox(this.getStatus())}}),this.div.find("button").addClass("btn_blue1").css({width:"70px",display:"inline-block",margin:"3px","line-height":"24px",height:"24px"})),this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.div.show()},clearLocal:function(){var t=this.getStatusLocal();d&&d.clear(),this.setStatusLocal(t)},clearAds:function(){var t=setInterval(function(){var e=$(".dl_panel-bg .dl_btn-close");e&&e.length&&(e.trigger("click"),clearInterval(t))},100)},renderConsoleBox:function(){this.consoleBox=$(this.opt.conBox).appendTo(s),this.switchConsoleBox(this.getStatusLocal())},switchConsoleBox:function(t){this.consoleBox[t?"show":"hide"](),t&&window._log.log(),this.reset()},reset:function(){this.hideMask(),this.div&&this.div.hide()},getStatusLocal:function(){var t=d.getItem(c);return t&&"false"!=t?!0:!1},setStatusLocal:function(t){d.setItem(c,t)},show:function(){this.switch&&this.switch[this.getStatusLocal()?"checked":"unChecked"](),this.showMask(),this.div.show()},refreshPage:function(){location.reload()}},n}),define("TuanBaseView",["c","cStore","cPageView","cCommonListPage","cUtility","cHybridFacade","cCommonPageFactory","PageHistory","cWidgetFactory","cWidgetGuider"],function(t,e,i,n,a,s,o,r,l){var c="TuanBaseView",d="TuanBaseListView",p=a.isInApp(),u=l.create("Guider");if(!o.hasPage(c)&&!o.hasPage(d)){var h=new t.base.Class(e,{__propertys__:function(){this.key="P_TUAN_BURN_AFTER_READING",this.lifeTime="1H",this.defaultData={}},initialize:function($super){$super()},setOneMessage:function(t,e){this.setAttr(t,e)},getOneMessage:function(t){var e=this.getAttr(t);return e&&this.setAttr(t,""),e}}),f=h.getInstance(),m=m||{};m={"super":i.prototype,show:function(){var t=r.getLatelyView(this.getViewName())||"";this.lastViewId=t,this.__onLoad(t),this.super.show.apply(this,arguments),this.__onShow(t)},hide:function(){this.super.hide.apply(this,arguments),this.__onHide(arguments)},getViewName:function(){return this.config&&this.config.viewName},__onLoad:function(){r.confirmForward(this.getViewName()),r.addHistory(this.getViewName(),location.href,2)},__onShow:function(){},__onHide:function(){},getHistory:function(){return r},back:function(t,e){if(p&&1==Lizard.P("from_native_page"))return void u.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})});this.setOneMessage("__lastViewName__",this.getViewName());var i=r.back(this.getViewName(),t);if(void 0===e&&(e=!1),i.jump)location.href=i.fullurl;else if(a.isInApp()){var n=/#(.*)$/.exec(i.fullurl);n&&n.length>1&&n[1]?Lizard.goTo(n[1],{viewName:i.id,cache:"list"==i.id?!0:e}):Lizard.goTo(i.fullurl,{viewName:i.id,cache:"list"==i.id?!0:e})}else Lizard.goTo(i.fullurl,{viewName:i.id,cache:"list"==i.id?!0:e})},popById:function(t){var e=r.popById(t);e||r.clearHistory()},clearHistory:function(t,e){r.clearHistory(t,e)},forwardJump:function(t,e,i,n,a){if(this.setOneMessage("__lastViewName__",this.getViewName()),_.isObject(i)&&(i=!1),i)e=r.forward(t,e,1,n),this.jump(e);else{e=r.forward(t,e,2,n);var s={viewName:t};a&&(s.cache=!0),s.loading=!1,Lizard.goTo(e,s)}},getLastViewName:function(){return this.getOneMessage("__lastViewName__")},setOneMessage:function(t,e){f.setOneMessage(t,e)},getOneMessage:function(t){return f.getOneMessage(t)},showMessage:function(t,e){this.alert.setViewData({message:t,title:e,buttons:[{text:"知道了",click:function(){this.hide()}}]}),this.alert.show()},showCommonMap:function(t,e,i){var n=this.geolocation;n||(n=l.create("Geolocation"),this.geolocation=n),p?n.show_map({latitude:i,longitude:e,title:t}):this.forwardJump("hotelmap","/webapp/tuan/hotelmap?lon="+e+"&lat="+i+"&hotelName="+t)}};var v=i.extend(m);o.register({name:c,fn:v}),n=o.create("CommonListPage");var g=n.extend(m);o.register({name:d,fn:g})}}),define("ValidatorUtil",["libs"],function(){function t(t){var i=this,n={forceCheckAll:!1};i.options=e(n,t||{}),i._fields=[]}var e=$.extend;return t.prototype={constructor:t,addField:function(t){var e=this;return e._fields.push(t),e},removeField:function(t){var e=this._fields;return t="number"==typeof t?t:e.indexOf(t),t>-1&&t<e.length&&e.splice(t,1)[0].destroy()},removeAllFields:function(){for(;this._fields.length;)this._fields.pop().destroy()},validate:function(){var t=this._fields,e=t.length,i=1,n=this.options.forceCheckAll,a=0;if(e)for(;e>a&&(i&=t[a].check(),i||n);a++);return!!i}},t}),define("FieldUtil",["libs"],function(){function t(t){var i=this,n=null,a=function(){};i.options={dom:n,rules:n,onCheck:a,required:!0,triggerEvent:""},i.options=e(i.options,t||{}),i.dom=i.options.dom,i.initialize()}var e=$.extend;return t.prototype={initialize:function(){var t=this,e=t.options.triggerEvent,i=t.dom;t.required=t.options.required,i&&i[0]&&(t.__blurHandler=function(){t.check()},e&&i.on(e,t.__blurHandler))},constructor:t,check:function(){var t,e,i=this.dom,n=i&&i.val()||"",a=this.options,s=a.rules,o=1,r=0,l=this.required,c=$.isFunction;for(!Array.isArray(s)&&(s=[s]),e=s.length;e>r&&(t=s[r],!l&&!n||(o&=c(t)?t(n):t.test(n)));r++);return a.onCheck.call(this,!!o,{val:n,dom:i,rule:r}),o||!l},destroy:function(){var t=this,e=t.dom;return e&&e.off(t.options.triggerEvent,t.__blurHandler),!0}},t}),define("text!HomeTpl",[],function(){return'<div class="hot_tit">热卖推荐<a href="javascript:;" id="J_allTuan">查看全部团购</a></div>\n<ul class="pro_list pro_list1 index_hot">\n<%\nif(typeof products!="undefined" && products && products.length>0 && count && +count > 0) {\n    for(var i=0, len=products.length; i < len; i++){\n        var p=products[i];\n        var labelsNum = p.labels && p.labels.length;\n%>\n    <li data-id="<%=p.id %>" data-len="<%=products.length %>" data-count="<%=count %>">\n        <div class="pro_list_imgbox">\n            <img data-img="<%=i %>" onerror="javascript:noPic(this);" src="http://pic.c-ctrip.com/common/pic_alpha.gif" data-lazy="<%=p.imgUrl?p.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %> " />\n        </div>\n        <div class="pro_list_info">\n            <h4 class="pro_list_tit"><%=p.name%></h4>\n            <%if(p.distance>0 && ctype!==7){%>\n            <p class="pro_list_dist">\n                <%if(p.distance>=1){%>\n                    <%=p.distance.toFixed(1)+\'公里\'%>\n                <%}else{%>\n                    <%=p.distance*1000+\'米\'%>\n                <%}%>\n            </p>\n            <%}%>\n            <p class="pro_list_subtit"><%=(p.descriptionhead && p.name.indexOf(\'【多店通用】\') == -1 ? \'[\' + p.descriptionhead + \']\' : \'\') + (p.hotdescription || \'\')%></p>\n            <p class="pro_list_price">&yen;<i><%=p.price.dPrice%></i></p>\n            <p class="wrap_label">\n                <%if(labelsNum <= 2){%>\n                    <%_.each(p.labels || [], function(o) {%>\n                        <span class="onsale_label02"><%=o.labelTxt%></span>\n                    <%}); %>\n                <%} else {%>\n                    <span class="onsale_label02"><%=p.labels[0].labelTxt%></span>\n                    <span class="onsale_label03">更多优惠+</span>\n                <%}%>\n            </p>\n            <p class="pro_list_ext">\n                <span class="pro_list_oldprice"><del data-price="<%=p.price.cPrice %>">&yen;<%=p.price.cPrice %></del></span>\n                <%if(+p.cSold>0){%><span class="pro_list_sold">已售<%=p.cSold %></span><%}%>\n                <%if(+p.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=p.score %></i>分</span><%}%>\n            </p>\n            <%if (p.activities && p.activities.length > 0) {\n                for (var j in p.activities) {\n                    var a = p.activities[j];\n                    if(a && a.type && +a.type > 0 && (+a.type == 2 || +a.type == 3) && +a.arg > 0) {\n            %>\n                <!--<span class="onsale_label01">返 ¥<%=a.arg%></span> -->\n            <%      }\n                }\n            }%>\n        </div>\n        <%if(p.labelVal && p.labelVal==99){ %><div class="sold_out">售完</div><%} %>\n    </li>\n    <%\n    }\n}%>\n</ul>\n<!--/END 热卖-->\n<div class="base_btn01 btn_more">查看更多推荐团购</div>\n'}),define("text!ListProductTpl",[],function(){return'<%if(typeof products!=\'undefined\' && products && products.length>0 && count && +count > 0) {%>\n    <%if(pageIdx<=1){%><ul class="pro_list pro_list1"><%}%>\n    <%\n    for(var i = 0, len = products.length; i < len; i++){\n        var p = products[i];\n        var labelsNum = p.labels && p.labels.length;\n    %>\n    <li data-id="<%=p.id %>" data-len="<%=products.length %>" data-count="<%=count %>">\n        <div class="pro_list_imgbox">\n            <img data-img="<%=i %>" onerror="javascript:noPic(this);" data-lazy="<%=p.imgUrl?p.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %>" src="http://pic.c-ctrip.com/common/pic_alpha.gif" />\n        </div>\n        <div class="pro_list_info">\n            <h4 class="pro_list_tit"><%=p.name%></h4>\n            <%if(p.distance>0 && ctype!==7){%>\n            <p class="pro_list_dist">\n                <%if(p.distance>=1){%>\n                    <%=p.distance.toFixed(1)+\'公里\'%>\n                <%}else{%>\n                    <%=p.distance*1000+\'米\'%>\n                <%}%>\n            </p>\n            <%}%>\n            <p class="pro_list_subtit"><%=(p.descriptionhead && p.name.indexOf(\'【多店通用】\') == -1 ? \'[\' + p.descriptionhead + \']\' : \'\') + (p.hotdescription || \'\')%></p>\n            <p class="pro_list_price">&yen;<i><%=p.price.dPrice%></i></p>\n            <p class="wrap_label">\n                <%if(labelsNum <= 2){%>\n                    <%_.each(p.labels || [], function(o) {%>\n                        <span class="onsale_label02"><%=o.labelTxt%></span>\n                    <%}); %>\n                <%} else {%>\n                    <span class="onsale_label02"><%=p.labels[0].labelTxt%></span>\n                    <span class="onsale_label03">更多优惠+</span>\n                <%}%>\n            </p>\n            <p class="pro_list_ext">\n                <span class="pro_list_oldprice"><del data-price="<%=p.price.cPrice %>">&yen;<%=p.price.cPrice %></del></span>\n                <%if(+p.cSold>0){%><span class="pro_list_sold">已售<%=p.cSold %></span><%}%>\n                <%if(+p.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=p.score %></i>分</span><%}%>\n            </p>\n            <%if (p.activities && p.activities.length > 0) {\n                for (var j in p.activities) {\n                    var a = p.activities[j];\n                    if(a && a.type && +a.type > 0 && (+a.type == 2 || +a.type == 3) && +a.arg > 0) {\n            %>\n                <!--<span class="onsale_label01">返 ¥<%=a.arg%></span> -->\n            <%      }\n                }\n            }%>\n        </div>\n        <%if(p.labelVal && p.labelVal==99){ %><div class="sold_out">售完</div><%} %>\n    </li>\n    <%}%>\n    <%if(pageIdx<=1){%></ul><%}%>\n<%}else{\n    if(typeof msg != \'undefined\' &&  msg || (msg=\'未知错误\')){%>\n    <div class="sec-noresult">\n        <div class="ui-result-no">\n            <span class="ico-search"></span>\n            <span class="ui-info"><%=msg %></span>\n        </div>\n        <ul class="ui-result-tar" id="J_deleteFilter">\n            <%_.each(customFilter, function(item, key) {%>\n                <%if(key==\'star\'){%>\n                    <%_.each(item, function(v, i) {%>\n                    <li data-type="<%=key%>" data-value="<%=i%>"><%=v%></li>\n                    <%})%>\n                <%}else if(key==\'multiShop\'){%>\n                    <li data-type="multiShop">多店可用</li>\n                <%}else if(key==\'voucher\'){%>\n                    <li data-type="voucher">代金券</li>\n                <%}else{%>\n                    <li data-type="<%=key%>" data-value="<%=item.val%>"><%=item.txt%></li>\n                <%}%>\n            <%})%>\n            <%if (positionFilter.name) {%>\n                <%if (positionFilter.type != -6) {%>\n                    <li data-type="position"><%=positionFilter.name%></li>\n                <%}else{%>\n                    <li data-type="position"><%=positionFilter.pos.distance%>公里</li>\n                <%}%>\n            <%}%>\n            <%if (weekendsAvailable) {%><li data-type="weekendsAvailable">周末可用</li><%}%>\n            <%if (keywordData && keywordData.word) {%><li data-type="keyword"><%=keywordData.word%></li><%}%>\n        </ul>\n        <div class="ui-tips">\n            <p>或者拨打携程客服电话</p>\n            <a href="tel:4000086666" data-phone="4000086666" class="btn-telephone J_phone">联系客服</a>\n        </div>\n    </div>\n    <%}%>\n<%}%>\n'}),define("text!ListBusinessTpl",[],function(){return'<%if(typeof hotels != \'undefined\' && hotels && hotels.length > 0 && count > 0) {%>\n<%var n = 0;\n    _.each(hotels, function(hotel) {%>\n<section class="list_title">\n    <h2><%=hotel.name%></h2>\n    <%if(+ctype!==7){%><span class="list_distance"><%=hotel.distance > 1 ? (hotel.distance.toFixed(1) + \'公里\') : (Math.round(hotel.distance * 1000) + \'米\')%></span><%}%>\n</section>\n<ul class="pro_list pro_list2">\n    <%var len = hotel.products && hotel.products.length;\n    _.each(hotel.products, function(product, index) {\n        var labelsNum = product.labels && product.labels.length;\n    %>\n        <li<%if(index>1){%> style="display: none" <%}%> data-id="<%=product.id%>" data-len="<%=len%>" data-count="<%=count%>">\n\n            <div class="pro_list_imgbox">\n                <img data-img="<%=n++ %>" onerror="javascript:noPic(this);" data-lazy="<%=product.imgUrl?product.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %>" src="http://pic.c-ctrip.com/common/pic_alpha.gif" width="70" height="70" alt="<%=product.name%>" />\n            </div>\n            <div class="pro_list_info">\n                <h4 class="pro_list_tit"><%=product.name%></h4>\n                <p class="pro_list_price">¥<i><%=product.price.dPrice%></i></p>\n                <p class="wrap_label">\n                    <%if(labelsNum <= 2){%>\n                        <%_.each(product.labels || [], function(o) {%>\n                            <span class="onsale_label02"><%=o.labelTxt%></span>\n                        <%}); %>\n                    <%} else {%>\n                        <span class="onsale_label02"><%=product.labels[0].labelTxt%></span>\n                        <span class="onsale_label03">更多优惠+</span>\n                    <%}%>\n                </p>\n                <p class="pro_list_ext">\n                    <span class="pro_list_oldprice"><del>¥<%=product.price.cPrice%></del></span>\n                    <%if(+product.cSold>0){%><span class="pro_list_sold">已售<%=product.cSold %></span><%}%>\n                    <%if(+product.score>0 && ctype!==7){%><span class="split">|</span><span class="pro_list_rank"><i><%=product.score %></i>分</span><%}%>\n                </p>\n            </div>\n        </li>\n    <%})%>\n    <%if (len>2) {%>\n        <li class="more view_unfold J_showMore">查看其他<%=len-2%>条团购<span></span></li>\n    <%}%>\n</ul>\n<%})%>\n<%}else{\n    if(typeof msg != \'undefined\' &&  msg || (msg=\'未知错误\')){%>\n    <div class="sec-noresult">\n        <div class="ui-result-no">\n            <span class="ico-search"></span>\n            <span class="ui-info"><%=msg %></span>\n        </div>\n        <ul class="ui-result-tar" id="J_deleteFilter">\n            <%_.each(customFilter, function(item, key) {%>\n                <%if(key==\'star\'){%>\n                    <%_.each(item, function(v, i) {%>\n                    <li data-type="<%=key%>" data-value="<%=i%>"><%=v%></li>\n                    <%})%>\n                <%}else if(key==\'multiShop\'){%>\n                    <li data-type="multiShop">多店可用</li>\n                <%}else if(key==\'voucher\'){%>\n                    <li data-type="voucher">代金券</li>\n                <%}else{%>\n                    <li data-type="<%=key%>" data-value="<%=item.val%>"><%=item.txt%></li>\n                <%}%>\n            <%})%>\n            <%if (positionFilter.name) {%>\n                <%if (positionFilter.type != -6) {%>\n                    <li data-type="position"><%=positionFilter.name%></li>\n                <%}else{%>\n                    <li data-type="position"><%=positionFilter.pos.distance%>公里</li>\n                <%}%>\n            <%}%>\n            <%if (weekendsAvailable) {%><li data-type="weekendsAvailable">周末可用</li><%}%>\n            <%if (keywordData && keywordData.word) {%><li data-type="keyword"><%=keywordData.word%></li><%}%>\n        </ul>\n        <div class="ui-tips">\n            <p>或者拨打携程客服电话</p>\n            <a href="tel:4000086666" data-phone="4000086666" class="btn-telephone J_phone">联系客服</a>\n        </div>\n    </div>\n    <%}%>\n<%}%>\n'}),define("text!BookingTpl",[],function(){return'<section class="cont_wrap" style="padding-bottom:55px;">\n    <%if(!user || user.IsNonUser==true) { %>\n    <ul class="fillin_list">\n        <li>\n            <%if(activities[0] && (activities[0].type == 2 || activities[0].type == 3)) {%>\n            登录后使用消费券可获得返现<span class="colmoney">¥<%=activities[0].arg %></span>\n            <% }else{%>\n            登录后预订更便捷\n            <% }%>\n            <a href="javascript:;" class="btns_login J_loginBtn ">马上登录</a>\n        </li>\n    </ul>\n    <% }%>\n    <!--@since 2014/10/21 修改门票预定页面 li.xx  -->\n    <% var isTicket = typeof category != \'undefined\' ? (category.ctgoryid === 6 && category.subctgory === 2) : false;\n    if (isTicket) {%>\n    <ul class="box_list box_list_ticketA">\n        <li class="title titleT2"><%=name %></li>\n        <li class="arr_r">\n            <span class="label">使用日期</span>\n            <span class="iptbox"><input type="text" readonly="" placeholder="请选择游玩日期" class="J_selectDate" date-date="<%= typeof ckintime === \'undefined\' ? \'\' : ckintime %>" value="<%= (typeof ckintimetxt === \'undefined\') ? \'\' : ckintimetxt  %>"></span>\n        </li>\n        <li>\n            <span class="label">购买数量</span>\n            <div class="btn_fine_tuning J_numberStep">\n            </div>\n        </li>\n    </ul>\n    <ul class="box_list box_list_ticketB">\n        <li class="">\n            <span class="label">取票人</span>\n            <span class="iptbox"><input type="text" placeholder="需与证件上的名字一致" id="J_ticketUser"><i class="icon icon_del"></i></span>\n        </li>\n        <li class="">\n            <span class="label">手机号码</span>\n            <span class="iptbox"><input type="tel" placeholder="用于接收取票凭证短信" id="J_tel" value="<%=tel%>"><i class="icon icon_del"></i></span>\n            <% if (isInApp) {%>\n            <i class="icon icon_user" id="J_selectContact" style="z-index: 999; padding: 10px 5px;"></i>\n            <%}%>\n        </li>\n    </ul>\n    <%} else { %>\n    <div class="order_htl_info">\n        <div class="order_htl_info_t"><%=name %></div>\n        <div class="fillin_price">单价：<span>&yen;<%=price.dPrice %></span></div>\n    </div>\n    <ul class="fillin_list">\n        <li>\n            <span class="label">购买数量</span>\n            <div class="btn_fine_tuning J_numberStep">\n            </div>\n        </li>\n\n        <!--TODO: 优惠  -->\n        <%if(activities && activities.length > 0 && (((activities[0].type == 2 || activities[0].type == 3) && user) || activities[0].type == 1)) { %>\n        <li <%if(activities[0].type == 1){%>style="display:none"<%}%> class="orderwrite_hint" id="privilege">\n        <%if((activities[0].type == 2 || activities[0].type == 3) && user) {%>\n        入住后返\n        <%} %>\n        <span class="price1"><i>¥</i><span id="J_pPrice"><%=activities[0].arg * curNum%></span><%if(activities[0].type == 2 && user) {%>现金<%} %><%if(activities[0].type == 3 && user){%>携程礼品卡<%} %></span>\n        </li>\n        <%} %>\n        <li>手机\n            <span class="inputbox"><input type="tel" placeholder="用于接收团购券号和密码" maxlength="11" required id="J_tel" value="<%=tel%>" /></span>\n            <% if (isInApp) {%>\n            <i class="icon icon_user" id="J_selectContact" style="z-index: 999; padding: 10px 5px;"></i>\n            <%}%>\n        </li>\n\n        <!--\n        三种情况判断：\n            1. 默认展示不需要发票，点击发票栏进入发票填写页\n            2. 酒店开具发票，提供文案: "产品发票由酒店提供，请入住酒店时向酒店前台索取。"\n            3. 携程开具发票，显示发票填写控件\n        groupFlag: 位操作(1,多家分店;  2,分店信息分组;  4,存在关联团购;  8,有房态条目;  16,携程提供发票;  32,已售完 64,酒店提供发票； 128,无发票)\n        -->\n        <%if(isLogin && (groupFlag & 16) == 16) { %>\n        <li class="arr_r" id="J_invoice">发票\n            <%if(invoice) {%>\n            <%if(invoice.deliveryMethod == 0){%>\n            <span class="txt"><%=invoice.title || \'\'%></span>\n            <%}else{%>\n            <span class="promo_code"><%=invoice.title || \'\'%></span><span class="txt2">&yen; 10</span>\n            <%}%>\n            <%}else{%>\n            <span class="txt">不需要</span>\n            <%}%>\n        </li>\n        <%}%>\n\n        <%if (price.dPrice > 0) {%>\n        <li class="arr_r" id="J_coupon"><label>优惠券</label>\n            <%\n                var couponTypeTxt = \'\';\n                if (coupon && typeof coupon === \'object\') {\n                    if (coupon.isNotUse) {\n            %>\n                <span class="num" id="J_couponCount"></span><span class="txt">不使用</span>\n            <%\n                    } else {\n                        if (coupon.couponType === 2) {\n                        couponTypeTxt = \'限1单使用\';\n                        } else if (coupon.couponType === 3) {\n                        couponTypeTxt = \'可叠加使用\';\n                        }\n            %>\n            <span class="promo_code"><%=coupon.isInput ? coupon.code : coupon.title%> <span><%=couponTypeTxt %></span></span>\n            <span class="txt2">- &yen; <span id="J_couponAmount"><%=retainTwoDecimal(coupon.amount * curNum)%></span></span>\n                <%}\n            } else{%>\n            <span class="num" id="J_couponCount"></span><span class="txt"></span>\n            <%}%>\n        </li>\n        <%}%>\n    </ul>\n\n    <%}%><!--END 门票判断-->\n\n\n    <%if((groupFlag & 16) != 16 && !_.isEmpty(invoiceText)) { %>\n        <p class="tips_attention"><%=invoiceText%></p>\n    <%}%>\n</section>\n<ul class="btm_price J_orderbtnbox">\n    <%tmpPrice = retainTwoDecimal(curNum * (price.dPrice - (coupon ? coupon.amount : 0)) + (invoice && invoice.deliveryMethod == 1 ? 10 : 0))%>\n    <li class="item03">\n        <span class="text_transparent text_size12">订单总额：</span>¥<span id="J_totalPrice"><%=tmpPrice > 0 ? tmpPrice : 0%></span>\n    </li>\n\n    <li class="btm_tuan_btn" id="J_submitOrder">去支付</li>\n</ul>'
}),define("text!BookingSuccessTpl",[],function(){return'<section class="cont_wrap">\n    <!-- 需要增加零元团的判断以及文案,模板：您的订单已成功提交！我们会尽快处理-->\n    <div class="suc_txt">\n        <%if(status==3){%>\n            <div class="fail_ico"></div>很抱歉，您的订单支付失败!\n            <p class="para01">请重新下单支付或致电携程客服</p>\n            <a href="tel:4008216666" class="telnum" id="J_tel">400-821-6666</a>\n        <%}else{%>\n            <div class="suc_ico"></div>您的订单已成功提交!\n        <%}%>\n    </div>\n    <%if(oid && +oid>0){%>\n    <div class="suc_order arr_r" id="J_orderDetail">\n        <div class="title ellipsis"><%=pname %></div>\n        <a href="javascript:;" class="ui-link">订单详情</a>\n    </div>\n    <% } %>\n    \n    <!-- 券号和密码 -->\n    <% if (!_.isArray(coupons) || coupons.length > 0 ) { %>\n        <div id="J_codeAndPwd">\n            <% _.each(coupons, function(v, i){ %>\n                <% if(!_.isEmpty(v.pwd)) { %>\n                <ul class="coupon_list m_BorderRadius">\n                    <li><span class="title">券号<%=i + 1%></span><span class="num"><%=v.code%></span></li>\n                    <li><span class="title">密码</span><span class="<%= v.pwd === \'此团购无需密码\'?\'desc\':\'num\'%>"><%=v.pwd%></span></li>\n                </ul>\n                <% } %>\n            <% }) %>\n        </div>\n    <% } %>\n    <%if (!isNonUser && typeof sendcoupons !== \'undefined\' && sendcoupons) {%>\n        <div class="coupon_info">\n            <div class="title"><span class="yuan"><i>¥</i><%=sendcoupons %></span>团购红包免费送</div>\n            <div class="context">消费成功后，将自动发至“我的携程-优惠券”中</div>\n        </div>\n    <%}%>\n    <div id="J_recommendWrap" style="display:none"></div>\n    <ul class="subblist">\n        <li id="J_destLink" class="arr_r" data-dest-id="<%=dest.id%>" data-dest-url="<%=dest.url%>" data-dest-name="<%=dest.name%>"><%=dest.name%>旅游攻略</li>\n    </ul>\n    <%if(user && user.IsNonUser){%>\n    <div class="cont_box_white">\n        <p class="order_hint">填写手机号即可成为携程会员，马上获得<i>1000</i>积分和<i>800元</i>携程消费券哦！预订还可以累计积分。</p>\n        <div class="input_box">\n                <button class="btn_blue" id="J_registerBtn" value="">提交注册</button>\n        </div>\n    </div>\n    <% }%>\n</section>'}),define("text!CityListTpl",[],function(){return'<%if(data && data.length>0){ %>\n    <h2 class="city_type J_cityType">当前</h2>\n    <ul class="city_list current m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n        <li class="J_cityItem wraploading <%if(nearby==true){%>choosed<%}%>" data-name="正在获取您的位置…" data-id="positioning" data-filter=""><div class="ui-loading-inline"><div class="ui-loading"><span class="ico-loading"></span></div>正在获取您的位置…</div></li>\n        <% if(currentcityid!=undefined && currentcityid!="" && currentcityname!=undefined && currentcityname!=""){ %>\n        <li class="J_cityItem <% if(cityid && cityid == currentcityid){ %> choosed<%} %>" data-name="<%=currentcityname%>" data-id="<%=currentcityid%>" data-filter=""><%=currentcityname %><i>(<%=currentgroups %>)</i></li>\n        <% }else{ %>\n        <li class="J_cityItem currentcity" style="display:none;" data-name="" data-id="" data-filter=""></li>\n        <% } %>\n    </ul>\n\n\n    <% if(history && history.length>0){ %>\n        <h2 class="city_type J_cityType">历史选择</h2>\n        <ul class="city_list m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n        <%\n            for(var j in history){\n            var c=history[j];\n        %>\n        <li class="J_cityItem <% if(cityid && cityid == c.id){ %> choosed<%} %>" data-name="<%=c.name%>" data-id="<%=c.id%>" data-filter="<%=((c.jp?c.jp.toLowerCase():\'\')  + \' \' + ( c.initial?\'\':c.initial.toLowerCase())  + \' \' + c.name + \' \' + (c.py?c.py.toLowerCase():\'\') ) %>"><%=c.name %></li>\n        <%}%>\n        </ul>\n    <%}%>\n    <h2 class="city_type J_cityType">热门城市</h2>\n    <ul class="city_list m_BorderRadiusWrap m_BorderRadiusWrap_city" style="display:block">\n    <%for(var i = 0, olen = data.length, Item; i < olen; i++){\n        Item=data[i];\n        if(Item.tag=="热门" && Item.cities){\n            for(var j in Item.cities){\n            var c=Item.cities[j];\n    %>\n    <li class="J_cityItem <% if(cityid && cityid == c.id){ %> choosed<%} %>" data-name="<%=c.name%>" data-id="<%=c.id%>" data-filter="<%=((c.jp?c.jp.toLowerCase():\'\')+\' \'+(c.initial?\'\':c.initial.toLowerCase())+\' \'+c.name+\' \'+(c.py?c.py.toLowerCase():\'\'))%>"><%=c.name %></li>\n    <%\n            }\n        }\n    }\n    %>\n    </ul>\n\n    <div class="box-city-all" id="J_allCitiesBox">\n        <%\n            _.each(data, function(itm) {\n            if (itm.tag !== \'热门\' && itm.cities[0]) {\n        %>\n            <dl>\n                <dt class="ui-title J_cityTagTitle arr_down"><%=itm.tag %></dt>\n                <dd>\n                    <ul class="city_list allcity">\n                        <%\n                            _.each(itm.cities, function(ctm) {\n                        %>\n                            <li style="display: none;" class="J_cityItem <% if(ctm.isHot){ %> highlight<%} %>" data-name="<%=ctm.name %>" data-id="<%=ctm.id %>" data-filter="<%=((ctm.jp?ctm.jp.toLowerCase():\'\')+\' \'+(ctm.initial?\'\':ctm.initial.toLowerCase())+\' \'+ctm.name+\' \'+(ctm.py?ctm.py.toLowerCase():\'\'))%>"><%=ctm.name %> <span><%=ctm.cGroups %></span></li>\n                        <%\n                            }); //end each citites\n                        %>\n                    </ul>\n                </dd>\n            </dl>\n        <%\n            }//end if\n        %>\n        <%\n            });//end each data\n        %>\n    </div>\n<% } %>\n<p class="city_noresult" style="display:none;">没有结果</p>\n'}),define("text!CouponTpl",[],function(){return'<article class="cont_wrap">\n    <ul class="promo_list">\n        <li <%if (notUse) {%> class="choosed"<%}%> id="J_useCouponToggle">不使用优惠券</li>\n    </ul>\n    <div id="J_enterWrap">\n        <div class="tuan_title">输入优惠券码</div>\n        <div class="promo_form">\n            <input type="text" id="J_couponInput" />\n            <div class="promo_close" id="J_clearCoupon" style="display:none"></div>\n            <div class="promo_form_btn" id="J_validateCoupon">使用</div>\n        </div>\n    </div>\n    <%if (coupons.length) {%>\n    <div class="tuan_title">选择您可用的优惠券</div>\n    <ul class="other_promo_list" id="J_couponList">\n        <%  var couponTypeTxt = \'\';\n            _.each(coupons, function(item, index) {\n            if (item.couponType === 2) {\n                couponTypeTxt = \'限1单使用\';\n            } else if (item.couponType === 3) {\n                couponTypeTxt = \'可叠加使用\';\n            }\n        %>\n        <li data-index="<%=index%>" data-code="<%=item.code%>">\n            <div class="promo_num"><%=item.amount%></div>\n            <div class="title"><%=item.title%></div>\n            <div class="time">有效期至<%=dateFormat(item.edate)%> <%=couponTypeTxt %></div>\n        </li>\n        <%})%>\n    </ul>\n    <%} %>\n</article>'}),define("text!DetailTpl",[],function(){return'<article class="cont_wrap">\n<%\nvar MAX_WORDS = 100;\nvar STRIP_TAGS = /\\<\\/*br\\s*\\/*\\>/img;  //匹配HTML\nvar imgCount=0;\nvar imgSrc=\'http://pic.c-ctrip.com/common/pic_alpha.gif\';\n//去除HTML\nvar stripTags = function(str) {\n    return str.replace(STRIP_TAGS, \'\\n\').replace(/<[^>]+>/gm, \'\');\n};\n//把\\n转化成br\nvar replaceBrTag = function(str) {\n    return str.replace(/\\n/img, \'<br/>\');\n};\n//从字符串指定位置查找第一个非数字、字母的字符的位置\nvar getNonWordNum = function(str, num) {\n    if (str[num] && /[0-9a-zA-Z]/.test(str[num])) {\n        return getNonWordNum(str, num + 1);\n    } else {\n        return num;\n    }\n};\nif (data.images && data.images[0]) {\n    imgCount = data.images.length ;\n    if (data.images[0].large) imgSrc = data.images[0].large;\n}\nvar project = \'\', prompt = \'\', lightspot = \'\', lashouProject = \'\', tips = \'\', lashouTitle = \'\';\nif (data.contents && data.contents.length) {\n    for (var n = 0, content, type; n < data.contents.length; n++) {\n        content = data.contents[n];\n        type = content.type;\n        if (type == 1) {\n            project = content.memo;\n        } else if (type == 2) {\n            prompt = content.memo;\n        } else if (type == 3) {\n            lightspot = content.memo;\n        } else if (type == 5) {\n            lashouTitle = content.title;\n            lashouProject = content.memo;\n        } else if (type == 4) {\n            tips = content.memo;\n        }\n    }\n}\nvar category = data.category;\n//是否在线订门票\nvar isOnlineBookingTicket = category ? (category.ctgoryid == 6) && (category.subctgory == 2) : false;\n%>\n<nav class="tuan_pic" id="J_pic">\n    <img src="<%=imgSrc%>"/>\n    <div class="total_num">共<%=imgCount%>张</div>\n</nav>\n<nav class="tuan_name">\n    <div class="title"><%=data.name %></div>\n    <% if (!isOnlineBookingTicket) {%>\n        <%if (lightspot && lightspot.length) {%>\n        <p class="tuan_hotel_intro"><%=lightspot%></p>\n        <%}%>\n        <p class="tuan_hotel_info">\n            <span>已售<%=data.cSold %></span>\n            <span class="tuan_hotel_time"><%if (data.groupFlag && (parseInt(data.groupFlag) < 48)) {%>剩余48小时<%}else{%>剩余2天以上<%}%></span>\n            <span class="tuan_hotel_star"><%=data.star %></span>\n        </p>\n        <%if(data.additions && data.additions.length>0){%>\n        <ul class="tuan_policy dflex" id="J_service">\n            <%\n            for(var i=0; i<data.additions.length; i++){\n            switch(data.additions[i].type){\n            case 2:%>\n            <li class="ico_return"><%=data.additions[i].txt%></li>\n            <%break; case 1:%>\n            <li class="ico_refund"><%=data.additions[i].txt%></li>\n            <%break; case 3:%>\n            <li class="ico_free"><%=data.additions[i].txt%></li>\n            <%break;}%>\n            <%\n            }\n            %>\n        </ul>\n        <%}else{%>\n        <ul class="tuan_policy dflex no_tuan_policy">\n            <li class="ico_refund">不支持未消费退款</li><li class="ico_return">不支持过期退款</li>\n        </ul>\n        <%}%>\n        <!-- 有效期展示-->\n        <%if((data.unavailableDate||data.couponBdate)&&data.type!=2) {%><!--type==2为零元团，不展示有效期-->\n        <ul class="subblist">\n            <li class="info_valid">\n                <%if(data.couponBdate) {%>\n                <span class="subb_valid i_bef">有效期：<%=data.couponBdate %>至<%=data.couponEdate%></span>\n                <%} %>\n                <%if(data.unavailableDate) {%>\n                <div class="info_suit_not" style="display:none">不适用日期：<%=data.unavailableDate %></div>\n                <div class="align_r"><span class="view_unfold" id="J_expandInvalid">查看不适用日期</span></div>\n                <%} %>\n            </li>\n        </ul>\n        <%} %>\n    <%}%>\n</nav>\n\n<%if (data.hotels && data.hotels.length) {%>\n    <div class="neg_mb10">\n        <div class="hot_tit">商户信息</div>\n    </div>\n    <ul class="subblist">\n    <%if(data.pcId!=2 && data.score&&(data.score>0)){ %>\n        <!--餐饮不显示点评 -->\n         <li class="<%if(data.ccount>0){%>arr_r <%}%>comm_qr" <%if(data.ccount>0){%>id="J_comment"<%}%>>\n            <!-- 根据实际的分数改变宽度值即可 -->\n            <div class="comm_fen"><div class="comm_fen_in" style="width:<%=data.score*100/5%>%;"></div></div>\n            <div class="comm_fen_num"><%=data.score.toFixed(1)%></div>\n            <span class="icon_txt"><%=data.ccount %>人点评</span>\n         </li>\n    <% }%>\n    <%\n    var hotel = data.hotels[0];\n    var addr = hotel && hotel.addr;\n    var hotelId = hotel && hotel.id;\n    var coords = hotel.coords[0];\n    var isShowMap=addr&&coords&&coords.lat&&coords.lon&&(coords.lat>-1&&coords.lat<1000)&&(coords.lon>-1&&coords.lon<1000);\n    var hotelTel = hotel.phoneList;\n    %>\n    <% if(addr || (hotelTel && hotelTel.length) || (data.features && data.features.length)){ %>\n        <% if(addr){ %>\n        <li class="<%if(addr&&isShowMap) {%>arr_r J_showDetailMap<%} %>" data-hotel-name="<%=hotel.shortName || hotel.name%>" data-coords="<%=coords.lon%>,<%=coords.lat%>">\n              <span class="subb_address i_bef"><%=(addr?addr:"暂无地址信息") %></span>\n              <%if(isShowMap){ %><span class="icon_txt">地图</span><%} %>\n        </li>\n        <%}%>\n    <%if(hotelTel && hotelTel.length){\n        var phones = _.map(hotelTel, function(p) {return p.phone;});\n    %>\n        <li class="arr_r wrap_phone J_phone" data-phone=\'<%=phones.join(",") %>\'>\n            <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n            <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n        </li>\n    <%} %>\n    <!-- 特色服务 -->\n    <%if(data.features && data.features.length){\n        var features = data.features,\n            featuresCount = features.length,\n            i=0,\n            feature,\n            featuresClsMap = {\n                MFTC: \'ico_parking\',\n                MFTX: \'ico_slippers\',\n                MF24XSRS: \'ico_hotwater\',\n                MFPZS: \'ico_water\',\n                MFXYYP: \'ico_toiletries\',\n                MFWIFI: \'ico_wifi_free\',\n                MFKD: \'ico_net\',\n                MFZC: \'ico_breakfast\'\n            };\n    %>\n    <li class="info_service noactive">\n      <%for(; i < featuresCount; i++) {\n         feature=features[i];\n      %>\n          <span><b class="<%=featuresClsMap[feature.code] %>"></b><%=feature.name %></span>\n      <%} %>\n    </li>\n    <%} %>\n  <%}%>\n  </ul>\n<%}%>\n    <%if(data.pcId === 1 && hotelId){%>\n    <ul class="subblist">\n        <li class="arr_r" data-hotel-id="<%=hotelId%>" id="J_gotoHotelDetail">查看更多商户信息</li>\n    </ul>\n    <%}%>\n    <%\n    var recommendHotel = data.recommendHotel;\n    var hotelData = recommendHotel && recommendHotel.hotel;\n    var coords;\n    if(hotelData){\n        _.each(hotelData.coords, function(item) {\n            if (item.type==3) {\n              coords = item.lon + \',\' + item.lat;\n            }\n        });\n    %>\n        <div class="neg_mb10">\n            <div class="hot_tit"><%=recommendHotel.title%></div>\n        </div>\n        <ul class="subblist">\n            <li class="arr_r J_showDetailMap" data-hotel-name="<%=hotelData.shortName || hotelData.name%>" data-coords="<%=coords%>">\n                <span class="subb_address i_bef"><%=hotelData.addr%></span>\n                <i class="icon_txt">地图</i>\n            </li>\n            <%if(hotelData.phoneList && hotelData.phoneList.length){\n                var phones = _.map(hotelData.phoneList, function(p) {return p.phone;});\n            %>\n            <li class="arr_r wrap_phone J_phone" data-phone="<%=phones.join(\',\')%>">\n                <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n                <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n            </li>\n            <%}%>\n        </ul>\n    <%}%>\n    <%if(data.cGroups>1){%>\n    <ul class="subblist">\n        <li id="J_branch" class="arr_r">查看全部<%=data.cGroups%>家商户</li>\n    </ul>\n    <%}%>\n\n    <!--判断非拉手产品 -->\n    <%if(!lashouProject || isOnlineBookingTicket){%>\n    <div class="neg_mb10">\n        <div class="hot_tit">团购包含</div>\n    </div>\n    <nav class="tuan_content">\n        <%\n            project = stripTags(project);\n            var nonWordNum = getNonWordNum(project, MAX_WORDS);\n        %>\n        <p><%=(replaceBrTag(project.substr(0, nonWordNum)) || "暂无相关信息")%>\n            <%if (project.length > nonWordNum) {%>\n                <span style="display:none" class="J_tipsHidden"><%=replaceBrTag(project.substr(nonWordNum))%></span>\n            <%}%>\n        </p>\n        <%if (project.length > nonWordNum) {%>\n        <p class="tac"><a href="javascript:;" class="view_unfold J_viewMoreBtn" data-state="hide">查看全部</a></p>\n        <%}%>\n    </nav>\n    <%}%>\n    <div class="neg_mb10">\n        <div class="hot_tit">特别提示</div>\n    </div>\n    <nav class="tuan_content" data-id="2">\n        <%if(prompt && prompt.length > 0){%>\n            <%\n                prompt = stripTags(prompt);\n                var nonWordNum = getNonWordNum(prompt, MAX_WORDS);\n            %>\n            <div class="tipsPanel"><%=replaceBrTag(prompt.substr(0, nonWordNum))%>\n                <%if (prompt.length > nonWordNum) {%>\n                <span style="display:none" class="J_tipsHidden"><%=replaceBrTag(prompt.substr(nonWordNum))%></span>\n                <%}%>\n            </div>\n            <%if (prompt.length > nonWordNum) {%>\n            <p class="tac"><a href="javascript:;" class="view_unfold J_viewMoreBtn" data-state="hide">查看全部</a></p>\n            <%}%>\n        <%}else{%>暂无相关信息<%}%>\n    </nav>\n    <!--拉手产品的详情需要展示在特别提示的后面 @since v2.6-->\n    <% if (lashouProject){%>\n    <ul class="subblist">\n        <li id="J_groupContain" class="arr_r"><span><%=lashouTitle || \'团购包含\'%></span><i class="icon_txt"><a href="###">查看详情</a></i></li>\n    </ul>\n    <%}%>\n    <%if(data.relatedProducts&&data.relatedProducts.length>0) {%>\n    <div class="neg_mb10">\n          <div class="hot_tit">该商户其他团购</div>\n    </div>\n    <ul class="tuan_list_other">\n      <% var MAX_VISIBLE = 10;//最大显示数量\n      _.each(data.relatedProducts,function(data, num){\n       %>\n      <li <%if(num>=MAX_VISIBLE){%>style="display:none"<%}%> class="J_relatedProducts <%if(num>=MAX_VISIBLE){%>J_relatedRest<%}%> arr_r" data-id="<%=data.id %>">\n        <div class="ellipsis"><%=data.name %></div>\n        <div class="tuan_price">\n          &yen;<%=data.dPrice %>\n        </div>\n      </li>\n      <%}) %>\n    </ul>\n    <%if(data.relatedProducts&&data.relatedProducts.length>MAX_VISIBLE) {%>\n    <p class="tuan_list_more"><a href="javascript:;" id="J_morehotel" class="view_unfold">更多</a></p>\n    <%}%>\n    <%} %>\n    <%if(data.nearGroupsCount>=2 && data.price.dPrice>0){%>\n    <div class="mod_group">\n        <div class="mod_group_tit">小伙伴们还看了\n            <%if(data.nearGroupsCount!=2 && data.nearGroupsCount!=4){ %>\n                <span id="J_recommendNearby" >更多</span>\n            <%} %>\n        </div>\n        <div class="mod_group_list">\n            <ul>\n            <% _.each(data.nearGroups,function(data,num){%>\n                <li class="J_nearProducts" data-id="<%=data.id %>">\n                    <div class="pic_thumb">\n                        <img src="<%=data.imgUrl %>" alt="" width="150" height="112">\n                    </div>\n                    <div class="hotel_info">\n                        <div class="hotel_tit"><%=data.name %></div>\n                        <div class="hotel_price">\n                            <span class="txt_color01"><dfn>¥</dfn><%=data.price.dPrice %></span>\n                            <del class="txt_color02">\n                                <dfn>¥</dfn><%=data.price.cPrice %>\n                            </del>\n                        </div>\n                    </div>\n                    <div class="ui-distance"><span class="subb_address i_bef"></span>距离该商户<%=data.distance > 1 ? (data.distance.toFixed(1) + \'公里\') : (Math.round(data.distance * 1000) + \'米\')%></div>\n                </li>\n            <%})%>\n            </ul>\n        </div>\n    </div>\n    <%}%>\n    <%if(tips&&tips.length>0){%>\n        <a class="linktips J_tips" style="margin-bottom:0" href="javascript:;" data-id="4">点击马上团代表您已阅读并同意<span>携程团购温馨提示</span></a>\n    <%}%>\n    <div style="height:45px;"></div>\n    <ul class="btm_price">\n        <li class="item01"><del>&yen;<%=data.price.cPrice %></del></li>\n        <li class="item02">\n            <%if(data.activities && data.activities[0]){\n                var type = data.activities[0].type;\n            %>\n            <%if(type==2) {%>\n            <span class="ico-text">返<i>¥</i><%=data.activities[0].arg%></span><!--返现-->\n            <%}%>\n            <%if(type==3) {%>\n            <span class="ico-text">礼<i>&yen;</i><%=data.activities[0].arg%></span><!--礼品卡-->\n            <%}%>\n            <%}%>\n            &yen;<%=data.price.dPrice %><!--原价-->\n        </li>\n        <li class="btm_tuan_btn" id="J_submit">马上团</li>\n    </ul>\n</article>\n'}),define("text!DetailTipsTpl",[],function(){return'<article class="cont_pd_wrap"><%if(data.memo){ %><%=(decodeURI(data.memo))%> <%} %></article>'}),define("text!HotelCommentsTpl",[],function(){return'<section class="cont_wrap">\n    <section class="comm_review" id="J_commTotal"></section>\n    <div class="tuan_title">用户点评</div>\n    <section class="comm_review" id="J_commList"></section>\n</section>\n\n<script type="text/template" id="J_commTotalTpl">\n    <div class="comm_overall">\n        <div class="comm_title">总评</div>\n        <div class="comm_fen">\n            <div class="comm_fen_in" style="width:<%=(custPt/5)*100%>%;"></div>\n        </div>\n        <div class="comm_fen_num"><%= custPt.toFixed(1) %></div>\n        <div class="comm_recomm"><%= (percent*100).toFixed(0)%>%用户推荐</div>\n    </div>\n    <ul class="dflex comm_score">\n        <li>卫生：<%= ratPt.toFixed(1) %></li>\n        <li>环境：<%= raatPt.toFixed(1) %></li>\n        <li>服务：<%= servPt.toFixed(1) %></li>\n        <li>设施：<%= faclPt.toFixed(1) %></li>\n    </ul>\n</script>\n\n<script type="text/template" id="J_commListTpl">\n    <% _.each(cmts,function(cmt){ %>\n    <article class="comm_list">\n        <div class="comm_user"><span><%=dateFormat(cDate.parse(cmt.date,true), "Y-m-d") %></span><%= cmt.nick %></div>\n        <div class="comm_overall">\n            <div class="comm_title">评分</div>\n            <!-- 根据实际的分数改变宽度值即可 -->\n            <div class="comm_fen">\n                <div class="comm_fen_in" style="width:<%= ((cmt.custPt/5)*100) %>%;"></div>\n            </div>\n        </div>\n        <ul class="dflex comm_score">\n            <li>卫生：<%= cmt.ratPt.toFixed(1) %></li>\n            <li>环境：<%= cmt.raatPt.toFixed(1) %></li>\n            <li>服务：<%= cmt.servPt.toFixed(1) %></li>\n            <li>设施：<%= cmt.faclPt.toFixed(1) %></li>\n        </ul>\n        <p class="comm_review_p"><%= cmt.content %></p>\n    </article>\n    <%}) %>\n</script>'}),define("text!HotelImagesTpl",[],function(){return'<article class="cont_wrap">\n    <div class="detail_pics">\n        <ul class="detail_pics_in">\n            <% _.each(obj, function(v, i) { %>\n            <li data-index="<%=i+1%>">\n                <img class="fade-in" src="<%=v.small%>" />\n            </li>\n            <% }) %>\n        </ul>\n    </div>\n</article>'}),define("text!HotelImageSlideTpl",[],function(){return'<div class="pics_show_box_in" style="height:180px;width:9999px;font-size:0;/*解决换行空格问题*/">\n    <%for(var i=0,len=data.length;i<len;i++){%>\n    <%var item = data[i]%>\n    <div class="pics_show_box_items" style="display: inline-block">\n        <img class="fade-in" data-href="<%=item.href%>" data-src="<%=item.src%>" data-img-id="<%=item.id%>" data-img-title="<%=item.title%>"/>\n    </div>\n    <%}%>\n</div>\n<p id="J_picDesc"></p>'}),define("text!HotelMapTpl",[],function(){return'<script type="application/x-javascript">addEventListener(\'DOMContentLoaded\',function(){setTimeout(function(){scrollTo(0,1);},0);},false);</script>\n<section id="J_hotelmapWrap"  class="cont_pd_wrap" style="margin: 0px; padding: 0px;">\n    <div class="ico_map_return" id="J_return"></div>\n    <div style="margin: 0px; padding: 0px;">\n        <div class="map-container" id="J_mapContainer"></div>\n    </div>\n    <div class="ico_map_navigate" id="J_navigator">导航</div>\n</section>\n<script type="text/template" id="J_centerMarkerTpl">\n    <img src="http://pic.c-ctrip.com/h5/tuan/hotel-map-locate2.png" style="width: 14px; height: 36px;">\n    <div id="J_label" class="ico_map" style="-webkit-transform: translate(-50%, -90px) !important; left: 50%; max-width:none;"><p title="<%=title%>"><%=title%></p></div>\n</script>\n'}),define("text!HotelServiceTpl",[],function(){return'<section class="cont_wrap">\n  <img src="http://pic.c-ctrip.com/h5/tuan//service.jpg" alt="" width="100%" class="service_img" />\n  <section class="service_box">\n    <div class="service_title ico_refund">未消费随时退</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>团购成功但未消费此券 → 登录“我的携程” → 在“团购订单”中“申请退款” → 审核通过后退款至携程钱包现金余额/原支付账户</dd>\n      <dt>退款时间</dt>\n      <dd>a)退至现金余额：退款申请审核通过后，会在1-2个工作日把款项退回到您的携程钱包现金账户，礼品卡支付部分退回至礼品卡账户。携程钱包现金余额可再次购买团购产品时直接冲抵现金。（此服务不收取任何手续费）<br/>\n          b) 原路退回：退款申请审核通过后，会在2-10个工作日把款项退回到您的原支付账户。（此服务不收取任何手续费）</dd>\n      <dt>以下情况不适用</dt>\n      <dd>1. 已消费的携程团购券<span class="service_txt_hl">（包括：在线预约成功的，电话预约成功的，已经使用或入住的）</span></dd>\n      <dd>2. 在产品说明中明确标明不支持"未消费，随时退"的产品或服务</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_return">券过期未消费，无条件返还</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>团购成功但未消费此券 → 登录“我的携程” → 在“团购订单”中“申请退款” → 审核通过后退款至携程钱包现金余额/原支付账户</dd>\n      <dt>退款时间</dt>\n      <dd>a) 退至现金余额：退款申请审核通过后，会在1-2个工作日把款项退回到您的携程钱包现金账户，礼品卡支付部分退回至礼品卡账户。携程钱包现金余额可再次购买团购产品时直接冲抵现金。（此服务不收取任何手续费）<br/>\n          b) 原路退回：退款申请审核通过后，会在2-10个工作日把款项退回到您的原支付账户。（此服务不收取任何手续费）</dd>\n      <dt>以下情况不适用</dt>\n      <dd>1. 已消费的携程团购券<span class="service_txt_hl">（包括：在线预约成功的，电话预约成功的，已经使用或入住的）</span></dd>\n      <dd>2. 在产品说明中明确标明不支持"券过期未消费，无条件退款"的产品或服务</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_free">消费不满意，携程来免单</div>\n    <dl class="service_con">\n      <dt>退款流程</dt>\n      <dd>商家未兑现服务承诺  →  立刻联系携程客服10106666  →  经携程客服核实确认后  →  给予立即退款</dd>\n      <dt>保障适用范围</dt>\n      <dd>1. 商家提供给携程会员的产品或服务与其承诺的产品或服务内容严重不符</dd>\n      <dd>2. 商家提供的产品出现严重质量问题，或有违反《中华人民共和国消费者权益保护法》，《中华人民共和国产品质量法》的情况</dd>\n    </dl>\n  </section>\n  <section class="service_box">\n    <div class="service_title ico_comments">全场点评信息，客观真实不造假</div>\n    <dl class="service_con">\n      <dd>全场所呈现的所有产品点评均出自真实消费者的入住亲身体验，100%真实有效，我们不做任何优化排序、造假或者篡改，保留所有好评及差评，为您的选择提供可靠参考！</dd>\n    </dl>\n  </section>\n</section>\n'}),define("text!HotelSubbranchTpl",[],function(){return'<%\n    var hotel = data && data[0];\n    var hotelInfos = hotel ? hotel.HotelInfos : [];\n    var isCurrentCity = hotelInfos[0] && hotelInfos[0].score < 0;\n%>\n<%if (isCurrentCity) {%>\n<div class="cur_pos cur_pos_has"><a href="javascript:;" class="cur_reload" id="J_relocation"></a><span id="J_gpsAddr">距离: 您的位置 <%=gps.address%></span></div>\n<%}%>\n<section class="cont_wrap"<%if (isCurrentCity) {%> style="padding-top:30px"<%}%> >\n<%_.each(data, function(hotel, index){%>\n    <div class="business_list">\n        <div class="busi_city_wrap J_busiCity <%= index==0 ?\'J_sticky\': \'\'%>">\n            <div class="busi_city"><%=hotel.ctyName %><span class="<%if(index == 0){%>arrow_skin01_up<%}else{%>arrow_skin01_down<%}%> J_arrow"></span></div>\n        </div>\n        <div class="busi_hotel J_busiHotel"<%if(index == 0){%> style="display:block;"<%}%>>\n            <% _.each(hotel.HotelInfos, function(hotelinfo){ %>\n            <%var isValidLngLat = hotelinfo.lon>0 && hotelinfo.lat>0 && hotelinfo.lon<1000 && hotelinfo.lat<1000 %>\n            <ul class="subblist">\n                <li class="<%= hotelinfo.hotelId ? \'arr_r\': \'\' %> J_jumpHotel" data-id="<%=hotelinfo.hotelId || \'\'%>" >\n                    <div class="hotelname"><%=hotelinfo.name %></div>\n                    <%if (isCurrentCity) {%>\n                        <%if (index == 0) {%><span class="icon_txt"><%=hotelinfo.distance > 1 ? (hotelinfo.distance.toFixed(1) + \'公里\') : (parseInt(hotelinfo.distance * 1000) + \'米\')%></span><%}%>\n                    <%} else {%>\n                        <%if(hotelinfo.score > 0){%><span class="icon_txt"><%=hotelinfo.score.toFixed(1) + \'分\'%></span><%}%>\n                    <%}%>\n                </li>\n                <li class="<%if(isValidLngLat){%>arr_r J_showMap<%} %>" data-coords="<%= hotelinfo.lon %>,<%= hotelinfo.lat %>" data-hotel-name="<%= hotelinfo.name %>">\n                    <span class="subb_address i_bef"><%= hotelinfo.adr %></span>\n                    <%if(isValidLngLat) {%><i class="icon_txt">地图</i><%} %>\n                </li>\n                <%if (hotelinfo.phoneList && hotelinfo.phoneList.length) {\n                    var phones = _.map(hotelinfo.phoneList, function(p) {return p.phone;});\n                %>\n                <li class="arr_r wrap_phone J_phone" data-phone=\'<%=phones.join(",") %>\'>\n                    <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n                    <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0] %>"<%} else {%>href="javascript:void(0);"<%}%>>预约/咨询</a></i>\n                </li>\n                <%}%>\n\n\n                <!--<li <%if(hotelinfo.splitphone){%>class="J_phone"<%} %> data-tel="<%=hotelinfo.splitphone %>">\n                    <span class="subb_phone i_bef"><%= hotelinfo.tel %></span>\n                    <%if(hotelinfo.splitphone){%><i class="icon_txt">预约/咨询</i><%} %>\n                </li>-->\n\n                <%if (hotelinfo.userGuide){%><li class="li_info"><%=hotelinfo.userGuide%></li><%}%>\n            </ul>\n            <%}) %>\n        </div>\n    </div>\n<%}) %>\n</section>\n\n<!--\n@PRD http://doc.ui.sh.ctriptravel.com/axure/tuangou6.0/#p=产品详情页-评分最高商户信息重新定义\n\n同城且定位，距离\n 1、默认展开显示当前城市包含全部适用商户信息（需展示适用商户距离用户定位的距离信息）\n 2、折起显示其他适用商户所在城市名称，点开后展示对应城市包含全部适用商户信息（无需展示距离信息）\n\n异地或非定位，评分\n 1、默认展开显示当前城市包含全部适用商户信息（需展示适用商户评分信息，当评分为0时不展示）\n 2、折起显示其他适用商户所在城市名称，点开后展示对应城市包含全部适用商户信息（需展示适用商户评分信息，当评分为0时不展示）\n-->\n'}),define("text!LashouTpl",[],function(){return'<article class="cont_wrap lashou"> \n<%=content.memo %>\n<div style="height:44px"></div>\n<ul class="btm_price">\n    <li class="item01"><del>原价&yen;<%=price.cPrice %></del></li>\n    <li class="item02">\n        <%if(activities && activities[0]){\n            var type = activities[0].type;\n        %>\n        <%if(type==2) {%>\n        <span class="ico-text">返<i>¥</i><%=activities[0].arg%></span><!--返现-->\n        <%}%>\n        <%if(type==3) {%>\n        <span class="ico-text">礼<i>&yen;</i><%=activities[0].arg%></span><!--礼品卡-->\n        <%}%>\n        <%}%>\n        &yen;<%=price.dPrice %><!--原价-->\n    </li>\n    <li class="btm_tuan_btn" id="J_submit">马上团</li>\n</ul>\n</article>\n'}),define("text!InvoiceTpl",[],function(){return'<section class="cont_wrap">\n    <ul class="invoice_cont">\n        <li>需要发票<input type="checkbox" id="J_needInvoice" class="dn" /><label class="btn_switch"></label></li>\n    </ul>\n    <ul class="invoice_cont" id="J_invoiceWrap">\n        <li>发票抬头<span class="tips_txt01"><input id="J_invoiceTitle" type="text" placeholder="请输入发票抬头" /></span></li>\n        <li>收件人<span class="tips_txt02"><input id="J_recipient" type="text" placeholder="个人姓名或公司名称" /></span></li>\n        <li class="arr_r" id="J_region" data-region-index="2,2,2">所在地区<span class="tips_txt01" id="J_regionText"></span></li>\n        <li>收件地址<span class="tips_txt02"><input id="J_addr" type="text" placeholder="请输入收件地址" /></span></li>\n        <li>邮编<span class="tips_txt02"><input id="J_zip" type="text" /></span></li>\n        <li class="arr_r" id="J_delivery" data-delivery-method="0">配送方式<span id="J_deliveryText" class="tips_txt01">平信(免费)</span></li>\n    </ul>\n    <p class="tips_attention" id="J_deliveryTips">发票在您的团购券使用后10个工作日内以平信方式送达。</p>\n</section>\n'}),define("text!KeywordSearchTpl",[],function(){return'<div style="position: fixed;width:100%;height:56px;z-index:2;">\n       <section id="J_keywordSearch" class="search_wrap">\n           <div class="history_close" id="J_cancel">\n               <span class="hclose">取消</span>\n           </div>\n           <form>\n           <div class="place_search_box  clear-input-box">\n                <input id="J_keywordInput" type="search" class="place_search abs_size" placeholder="位置/品牌/名称" value=""  />\n                <div class="s_city_loading"  style="display:none"></div>\n           </div>\n            </form>\n       </section>\n </div>\n<div style="height:53px;width:100%"></div>\n<section id="J_keywordSuggestWrap" class="city_box">\n    <div id="js_hotkeyword"></div>\n    <div id="js_historykeysearch"></div>\n</section>\n<script type="text/template" id="J_hotKeywordsTpl">\n    <div class="his_list border_b">\n        <p class="title">热门搜索</p>\n        <div class="switch_hot">\n            <div class="sw_clip">\n                <%var num =Math.ceil(data.length / 6);%>\n                <%for(var i = 1; i <= num ; i++){%>\n                <ul class="sw_con" >\n                    <%for(var j = 1; j <= 6 ; j++){ var index = (i-1)*6 + (j-1); if(index >=data.length){break;}%>\n                    <li data-json=<%=encodeURIComponent(JSON.stringify(data[index]))%>><%=data[index].KeyWords.Key%></li>\n                    <%}%>\n                </ul>\n                <%}%>\n            </div>\n            <%if(num > 1){%>\n            <p class="sw_nav">\n                <%for(var ni=0; ni< num; ni++){%>\n                <i js_index="<%=ni%>" class="<%if(ni==0){%>current<%}%>"></i>\n                <%}%>\n            </p>\n            <%}%>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="J_keywordSuggestTpl">\n     <%if(data){%>\n        <%if(data.history && data.history.length>0){%>\n            <ul class="filterbox J_historykeysearch">\n            <%for(var i=0, olen=data.history.length, c; i < olen; i++) {\n                    c=data.history[i];\n            %>\n                <li class="J_resultItem city_item <% if(keyid && keyid == c.id){ %> choosed<%} %>" data-type="<%=c.type%>" data-name="<%=c.word%>" data-id="<%=c.id%>" data-filter="<%=c.word%>"><%=c.word %></li>\n            <%}%>\n            </ul>\n            <div class="base_btn01_wrap_b neg_mgt20 J_clearhistory">\n                <div class="base_btn01">清除搜索历史</div>\n            </div>\n        <%}%>\n        <%if(data.Results&&data.Results.length>0){%>\n        <ul class="city_list searchresult">\n        <%\n            _.each(data.Results, function(t) {\n        %>\n                <li class="J_resultItem city_item <% if(keyid && keyid == t.id){ %> choosed<%} %>" data-type="<%=t.type%>" data-name="<%=t.word%>" data-id="<%=t.id%>" data-filter="<%=t.word%>"><%=t.wordNew %><span class="cate"><%=t.typeNew %></span></li>\n        <%});%>\n        </ul>\n        <%}else if(data.Results){%>\n         <p class="city_noresult">抱歉，没有搜索到相关信息</p>\n        <%\n        }\n    }\n    %>\n</script>'
>>>>>>> b290e89... Merge branch 'v2.7' of ssh://code.ctripcorp.com:29418/hotel/group/tuanapp into v2.7
}),define("text!NearListTpl",[],function(){return'<section class="cont_wrap">\n    <ul class="pro_list">\n        <%\n        if(typeof products!=\'undefined\' && products && products.length>0) {\n            for(var i = 0, len = products.length; i < len; i++){\n                var p = products[i];\n        %>\n        <li data-id="<%=p.id %>" data-len="<%=products.length %>">\n            <div class="pro_list_imgbox">\n                <img data-img="<%=i %>" onerror="javascript:noPic(this);" src="<%=p.imgUrl?p.imgUrl:\'http://pic.c-ctrip.com/common/pic_alpha.gif\' %>" />\n            </div>\n            <div class="pro_list_info">\n                <h4 class="pro_list_tit"><%=(p.descriptionhead && p.name.indexOf(\'【多店通用】\') == -1 ? \'[\' + p.descriptionhead + \']\' : \'\') + p.name%></h4>\n                <p class="wrap_label">\n                    <%if(false && labelsNum < 2 && p.star){%><%=p.star%><%}%>\n                    <%if(p.labels && p.labels.length){ %>\n                        <em class="pro_label_list">\n                        <%_.each(p.labels || [],function(o){%>\n                            <span class="onsale_label02"><%=o.labelTxt%></span>\n                        <%}); %>\n                        </em>\n                    <%} %>\n                </p>\n                <p class="pro_list_rank">\n                    <%if(+p.score>0){%><span class="font_blue"><i><%=p.score %></i>分</span><%}%>\n                    <span class="pro_list_sold">已售<%=p.cSold %></span>\n                </p>\n                <%if(p.distance>0){%>\n                <p class="pro_list_txt">\n                    <%if(p.distance>=1){%>\n                        <%=p.distance.toFixed(1)+\'公里\'%>\n                    <%}else{%>\n                        <%=p.distance*1000+\'米\'%>\n                    <%}%>\n                </p>\n                <%}%>\n                <p class="pro_list_price" data-discount="<%=p.price.discount %>">\n                    <span class="pro_list_oldprice">\n                        <del data-price="<%=p.price.cPrice %>">&yen;<%=p.price.cPrice %></del>\n                     <%if(p.activities && p.activities.length>0){\n                       for(var j in p.activities){\n                           if(p.activities[j].type && +p.activities[j].type==1){\n                                break;\n                            }\n                        }\n                    }\n                    %>\n\n                    <%\n                    var a1;\n                    if(p.activities && p.activities.length>0){\n                        for(var j in p.activities){\n                            var a=p.activities[j];\n                            if(a && a.type && +a.type>0){\n                                if(+a.type==1){\n                                    a1=a;\n                    %>\n                    <%\n                                }\n                                if((+a.type==2 || +a.type==3) && +a.arg>0){\n                    %>\n                                    <span class="onsale_label01">返 ¥<%=a.arg%></span>\n                    <%\n                                }\n                            }\n                        }\n                    }else{\n                        a1=false;\n                    };\n                    %>\n                    </span>\n                    &yen;<i><%=p.price.dPrice%></i>\n                </p>\n            </div>\n            <%if(p.labelVal && p.labelVal==99){ %><div class="sold_out">售完</div><%} %>\n        </li>\n        <%}}%>\n    </ul>\n</section>\n'}),define("text!RefundTpl",[],function(){return'<article  class="cont_wrap">\n    <div class="tuan_title">团购信息</div>\n    <ul class="apply_refund">\n        <li class="J_needHideInTicket"><span id="J_productName" class="productName"></span>\n            <p class="color_gray">您有<strong id="J_iscCount">0</strong>张可退的团购券，请选择要退回的数量</p>\n        </li>\n        <li class="J_needHideInTicket">退回数量\n            <div class="btn_fine_tuning J_numberStep">\n            </div>\n        </li>\n        <li>退款金额&nbsp;&nbsp;&nbsp;&nbsp;\n            <span class="total_order_price" id="J_refundAmount">0</span>\n        </li>\n        <li style="display:none" id="J_refundInvoiceWrap">退回快递费&nbsp;&nbsp;\n            <span class="total_order_price" id="J_refundInvoiceAmount">0</span>\n        </li>\n        <li style="display:none" id="J_refundCouponWrap">退回优惠券&nbsp;&nbsp;\n            <span class="total_order_price" id="J_refundCouponAmount">0</span>\n        </li>\n    </ul>\n    <div class="tuan_title">退款方式</div>\n    <ul class="apply_refund choose_list">\n        <li class="J_refundType" data-type="1" style="display: none;">退至现金余额\n            <p class="color_gray">1-2个工作日内退回携程钱包现金余额，礼品卡<br>支付部分退回礼品卡账户，无手续费</p>\n        </li>\n        <li class="J_refundType <%if (!newType) {%>choosed<%}%>"  data-type="0">原路退回\n            <p class="color_gray">2-10个工作日内退回您的原支付账户，无手续费</p>\n        </li>\n    </ul>\n    <div class="tuan_title">退款原因</div>\n    <ul class="apply_refund choose_list apply_refund_reason">\n        <li>买多了/买错了</li>\n        <li>计划有变，没时间消费</li>\n        <li>预约不上</li>\n        <li>商家无法验券</li>\n        <li>产品的描述与实际不符</li>\n        <li>商家说没有该团购产品</li>\n        <li>其他</li>\n    </ul>\n    <div class="mg10 reason_other_text" style="display:none">\n        <textarea class="in_reason_other" placeholder="请输入其他退款原因。"></textarea>\n    </div>\n    <div class="mg10">\n        <input type="button" class="btn_blue J_btnSubmit" value="确认退款">\n    </div>\n</article>\n'}),define("text!RefundTipTpl",[],function(){return'<section  class="cont_wrap">\n    <p class="txt_refund">本团购暂不支持客户端退款操作，您可以直接拨打客服电话进行退款。</p>\n    <div class="wrap_tel">\n        <div class="base_btn01 J_contactService">联系客服</div>\n    </div>\n</section>\n'}),define("text!TuanOrderDetailTpl",[],function(){return'<article  class="cont_wrap">\n    <%\n    var btns = typeof btn === \'object\' && btn; //按钮集合\n    var isTicket = typeof product === \'object\' && product.category && (product.category.ctgoryid === 6 && product.category.subctgory === 2); //是否是门票对接\n        var hasInvoice = (typeof invoice!=\'undefined\' && invoice) %>\n    <section class="order_bg">\n    <!--\n        mooncakeStatus 0 非月饼产品\n        mooncakeStatus 1 月饼产品但暂未结果\n        mooncakeStatus 2 月饼产品有抽奖结果 未中奖\n        mooncakeStatus 3 月饼产品有结果   中奖\n    -->\n    <%if(typeof mooncakeStatus != \'undefined\' && mooncakeStatus == 1){%>\n        <div class="coupons_loading"><i></i>抽奖进行中，请稍候...</div>\n    <%}else if(typeof mooncakeStatus != \'undefined\' && mooncakeStatus == 2){%>\n        <div class="order_htl_info order_mid_autumn arr_r" id="J_tuanDetail">\n            <div class="order_htl_info_t"><%=pname%></div>\n            <%if(typeof couponValidDate!=\'undefined\') {%><div class="order_htl_info_txt"><%=couponValidDate%>过期</div><%}%>\n        </div>\n        <div class="get_coupons">\n            <span class="suc_ico"></span>\n            <div class="coupons_tit">恭喜您获得携程团购优惠券</div>\n            <p class="coupons_intro">现在购买携程团购产品即可享受优惠！</p>\n        </div>\n        <div class="coupons_btnwrap">\n            <span id="J_viewCoupon">查看优惠券</span>\n            <span id="J_immediateUse">立即使用</span>\n        </div>\n    <%}else{%>\n        <!--产品名称、信息-->\n        <%var hasAddrOrPhone = ContactInfo.hotelAddr||ContactInfo.splitphone%>\n        <div class="order_htl_info arr_r<%if(!hasAddrOrPhone){%> order_mid_autumn<%}%> <%=isTicket?\'order_htl_ticket\':\'\' %>" id="J_tuanDetail">\n            <div class="order_htl_info_t"><%=pname %></div>\n            <!-- 门票对接去除使用有效期  -->\n            <%if(typeof couponValidDate!=\'undefined\' && !isTicket) {%><div class="order_htl_info_txt"><%=couponValidDate%>过期</div><%}%>\n        </div>\n        <!--地址电话-->\n        <%if(hasAddrOrPhone){%>\n        <ul class="<%=isTicket? \'box_list box_listT2\' :\'subblist\' %>">\n            <%if(ContactInfo.hotelAddr){%>\n            <li class="arr_r" id="J_hotelMap" data-coords="<%=ContactInfo.hotelLnglat[0].longitude + \',\' + ContactInfo.hotelLnglat[0].latitude%>" data-hotel-name="<%=ContactInfo.hotelName%>">\n                <span class="subb_address i_bef"><%=ContactInfo.hotelAddr%></span>\n                <i class="icon_txt">地图</i>\n            </li>\n            <%}%>\n            <%if (ContactInfo.phoneList && ContactInfo.phoneList.length) {\n                var phones = _.map(ContactInfo.phoneList, function(p) {return p.phone;});\n            %>\n                <li class="arr_r wrap_phone" id="J_hotelTel" data-phone="<%=phones.join(\',\')%>">\n                    <span class="subb_phone i_bef"><%_.each(phones, function(t) {%><span><%=t %></span><%}); %></span>\n                    <i class="icon_txt"><a <%if (phones.length === 1) {%>href="tel:<%=phones[0]%>"<%} else {%>href="javascript:void(0);" <%}%>>预约/咨询</a></i>\n\n                </li>\n            <%}%>\n\n            <!-- 门票对接增加使用时间和兑换方式-->\n            <%  var hasBinfo = (typeof binfo === \'object\') && (binfo.ckintime);\n            if (hasBinfo) {%>\n            <li class="autocon"><dl class="order_dl">\n                <dt>使用日期</dt><dd><%=binfo.ckintime %></dd>\n                <!--<dt>兑换方式</dt><dd><%=binfo.des %></dd>-->\n            </dl></li>\n            <%}%>\n        </ul>\n        <%}%>\n        <!-- 门票对接去除优惠券，需要在JS去除  -->\n        <div id="J_couponsWrap"></div>\n    <%}%>\n\n        <div class="tuan_title">订单信息</div>\n\n        <dl class="order_dl">\n            <dt>订单编号</dt><dd><%=oid %></dd>\n            <dt>订单状态</dt><dd><%=statusRmk %></dd>\n            <dt><%= isTicket ? \'购买日期\' : \'预订日期\' %></dt><dd><%=date %></dd>\n            <%if(payType){%>\n            <dt>支付方式</dt><dd><%=payType %></dd>\n            <%}%>\n        </dl>\n\n        <dl class="order_dl">\n            <dt>单价</dt><dd>¥<%=product.price.dPrice%></dd>\n            <dt>数量</dt><dd><%=qty%>份</dd>\n            <%if (couponAmt) {%><dt>已享优惠</dt><dd>-¥<%=couponAmt%></dd><%}%>\n            <dt>发票配送费</dt><dd>¥<%=invoiceAmt%></dd>\n            <dt>总额</dt><dd><span class="total_order_price"><%=retainTwoDecimal((amt - couponAmt > 0 ? amt - couponAmt : 0) + invoiceAmt)%></span></dd>\n        </dl>\n        <!-- 门票对接去除礼品卡  -->\n        <%if((typeof gtt != \'undefined\' && gtt.adt == \'送礼品卡\' && gtt.aam > 0) && !isTicket){%>\n            <dl class="order_dl">\n                <dt>送礼品卡</dt>\n                <dd><dfn>¥</dfn><%=gtt.aam%></dd>\n            </dl>\n        <%}%>\n\n        <%if(appNonsupport){%>\n            <ul class="dflex scheme_01 mgb10">\n                <%if(canRefund && btns.refund){%>\n                <li id="J_refund">申请退款</li>\n                <%}%>\n                <%if(status==1 && btns.cancelord){%>\n                <li id="J_cancelOrder">取消订单</li>\n                <%}%>\n                <%if(status>2 && canDelete && btns.del){%>\n                <li id="J_deleteOrder">删除订单</li>\n                <%}%>\n            </ul>\n        <%}%>\n        <% if (isTicket && hasBinfo) {%>\n            <ul class="box_list">\n                <li class="title titleT2">取票人信息</li>\n                <li class="autocon">\n                    <dl class="order_dl">\n                        <dt>取票人</dt><dd><%=binfo.name %></dd>\n                        <dt>手机号码</dt><dd><%= contact && contact.mphone %></dd>\n                    </dl>\n                </li>\n            </ul>\n            <div class="tuan_hotline">\n                <p class="desc">如需发票或重发取票凭证短信，请致电携程客服</p>\n                <a href="tel:400-008-6666"><p class="cont border_t_b">携程客服电话: 400-821-6666</p></a>\n            </div>\n        <%}%>\n    </section>\n\n    <!-- 门票对接去除发票信息  -->\n    <%if(hasInvoice && !isTicket) {%>\n    <section class="order_bg sec-last">\n        <div class="tuan_title">发票信息</div>\n        <dl class="order_dl">\n            <dt>发票抬头</dt>\n            <dd><%=invoice.title %><br/><%=invoice.name %></dd>\n        </dl>\n        <dl class="order_dl">\n            <dt>寄送地址</dt>\n            <dd><%=invoice.addr %><br/><%=invoice.postCode%></dd>\n        </dl>\n        <dl class="order_dl">\n            <dt>配送方式</dt>\n            <dd><%=invoice.expressType == 1 ? \'快递\' : \'平信\' %></dd>\n        </dl>\n    </section>\n    <% }%>\n    <div id="J_recommendWrap" style="display:none"></div>\n    <%if(typeof statusRmk!=\'undefined\' && (statusRmk==\'待支付\') && btns.conpay){%>\n    <div style="height:45px"></div>\n    <ul class="btm_price">\n        <li class="item03">\n            <span class="text_transparent text_size12">订单总额：</span><%=amt %>\n        </li>\n        <!-- 已过期、已抢完、APP不支持售卖产品 class="btm_tuan_btn_dis" -->\n        <li class="<%=appNonsupport ? \'btm_tuan_btn\' : \'btm_tuan_btn_dis\'%>" id="J_retryPayment">继续支付</li>\n    </ul>\n    <%} %>\n</article>\n'}),define("text!OrderDetailItemTpl",[],function(){return'<%if(list && list.length){%>\n    <% if (orderStatus == 2) { %>\n<div class="tips_tickets">订单正在扣款，券号暂时无法使用</div>\n    <% } else { %>\n<div class="tips_tickets">直接出示券号和密码即可消费</div>\n    <% } %>\n<%}%>\n<%_.each(list, function(v, i){ %>\n    <% if (orderStatus == 3) {%>\n    <ul class="box_list box_listCoupon box_listCouponCancel">\n    <% } else { %>\n    <ul class="box_list box_listCoupon">\n        <% } %>\n        <li>\n            <span class="items">券号<%=i + 1%></span><span class="items"><%=v.code%></span>\n            <span class="items"><%=v.statusRmk%></span>\n        </li>\n\n        <% if (!_.isEmpty(v.pwd)) { %>\n            <li><span class="items">密码</span><span class="<%=v.pwd=== \'此团购无需密码\' ? \'items_desc\' : \'items\'%>"><%=v.pwd%></span></li>\n        <% } %>\n\n        <% if (v.status == 1 && _.isEmpty(v.pwd)) { %>\n            <li class="act J_sendToPhone" data-val="<%=v.val%>" data-id="<%=v.code%>">发送到手机</li>\n        <% } else if (v.status == 1) {  %>\n            <li class="act J_sendToPhone" data-val="<%=v.val%>" data-id="<%=v.code%>">发送到手机</li>\n        <% } %>\n    </ul>\n    <%})%>\n'}),define("text!RecommendTpl",[],function(){return'<!--\n    1. 产品数量>=2时展示模块\n    2. 外露产品数量=2或4\n    3. 产品数量=3或>4时展示“更多”按钮\n-->\n<%\n    var left = data && data[0];\n    var right = data && data[1];\n    var hasLeftMod = left && left.products && left.products.length > 1;\n    var hasRightMod = right && right.products && right.products.length > 1;\n\nif (hasLeftMod || hasRightMod) {\n%>\n    <div class="sec-viewers">\n    <div class="tuan_title">小伙伴们还买了</div>\n    <div class="ui-tab-tar">\n        <ul class="dflex" id="J_tabNav">\n            <%if(hasLeftMod){%><li class="sta-on" data-index="0"><%=left.channelTitle%></li><%}%>\n            <%if(hasRightMod){%><li <%= !hasLeftMod ? \'class="sta-on"\' : \'\'%> data-index="1"><%=right.channelTitle%></li><%}%>\n        </ul>\n    </div>\n    <div class="ui-tab-cont mod_group_list" id="J_tabCon">\n        <%if(hasLeftMod){%>\n        <div class="ui-item">\n            <ul>\n                <%\n                for(var i = 0; i < left.products.length; i++){\n                    var item = left.products[i];\n                    if(!item){ return; }\n                %>\n                <li class="J_viewDetail" data-pid="<%=item.id%>" data-type="<%=left.channelType%>">\n                    <div class="pic_thumb"><img src="<%=item.imgUrl%>" alt="<%=item.name%>" width="150" height="112"></div>\n                    <div class="hotel_info">\n                        <div class="hotel_tit"><%=item.name%></div>\n                        <div class="hotel_price">\n                            <span class="txt_color01"><dfn>¥</dfn><%=item.price.dPrice%></span>\n                            <del class="txt_color02"><dfn>¥</dfn><%=item.price.cPrice%></del>\n                        </div>\n                    </div>\n                    <div class="ui-distance"><span class="subb_address i_bef"></span>距离该商户<%=item.distance > 1 ? (item.distance.toFixed(1) + \'公里\') : (Math.round(item.distance * 1000) + \'米\')%></div>\n                </li>\n                <%\n                    if ((i == 2 && left.productCount == 2) || (i == 3  && left.productCount > 4)) break;\n                }\n                %>\n            </ul>\n            <%if(left.productCount == 3 || left.productCount > 4){%><div class="link-more" data-pid="<%=pid%>" data-cityname="<%=city.cityName%>" data-cityid="<%=city.cityid%>" data-type="<%=left.channelType%>" data-title="<%=left.channelTitle%>">查看更多</div><%}%>\n        </div>\n        <%}%>\n\n        <%if(hasRightMod){%>\n        <div class="ui-item" style="<%=hasLeftMod ? \'display:none\' : \'\'%>">\n            <ul>\n                <%\n                for(var i = 0; i < right.productCount; i++){\n                    var item = right.products[i];\n                %>\n                <li class="J_viewDetail" data-pid="<%=item.id%>" data-type="<%=right.channelType%>">\n                    <div class="pic_thumb"><img src="<%=item.imgUrl%>" alt="<%=item.name%>" width="150" height="112"></div>\n                    <div class="hotel_info">\n                        <div class="hotel_tit"><%=item.name%></div>\n                        <div class="hotel_price">\n                            <span class="txt_color01"><dfn>¥</dfn><%=item.price.dPrice%></span>\n                            <del class="txt_color02"><dfn>¥</dfn><%=item.price.cPrice%></del>\n                        </div>\n                    </div>\n                    <div class="ui-distance"><span class="subb_address i_bef"></span>距离该商户<%=item.distance > 1 ? (item.distance.toFixed(1) + \'公里\') : (Math.round(item.distance * 1000) + \'米\')%></div>\n                </li>\n                <%\n                    if ((i == 2 && right.productCount == 2) || (i == 3  && right.productCount > 4)) break;\n                }\n                %>\n            </ul>\n            <%if(right.productCount == 3 || right.productCount > 4){%><div class="link-more" data-pid="<%=pid%>" data-cityname="<%=city.cityName%>" data-cityid="<%=city.cityid%>" data-type="<%=right.channelType%>" data-title="<%=right.channelTitle%>">查看更多</div><%}%>\n        </div>\n        <%}%>\n    </div>\n</div>\n<%} %>\n'}),define("text!MapNavTpl",[],function(){return'<iframe id="J_hotelMapIframe" src="<%=url %>" style="height: 100%;width:100%"></iframe>'});