define(["libs","c","cWidgetFactory","cWidgetGuider","cUtility"],function(t,e,i,n,h){function a(t){var e=function(){},i={tpl:'<%_.each(data, function(t) {%> <div class="base_btn02 J_phoneItem" data-phone="<%=t %>"><a href="tel:<%=t %>" style="display: inline-block;width: 100%;"><%=t %></a></div> <%});%><div class="base_btn02 J_cancelPhone">取消</div>',wrap:'<div class="wrapBottom J_phoneListPanel" style="z-index: 9999"></div>',ele:".J_phone",onSelect:e,onHide:e,onShow:e,dataName:"data-phone",view:""};this.opt=$.extend(i,t),this.view=this.opt.view,this.ele=$(this.opt.ele),this.dataName=this.opt.dataName,this.bindEvents()}var s=i.create("Guider"),o=h.isInApp();return a.prototype={_initMask:function(){var t=this;!this.mask&&(this.mask=new e.ui.Mask({onCreate:function(){this.root.on("click",function(){t.hidePanel(),t.hideMask()})}})),this.showMask()},showMask:function(){this.mask&&this.mask.show(),this.opt.onShow&&this.opt.onShow.apply(this)},hideMask:function(){this.mask&&this.mask.hide(),this.opt.onHide&&this.opt.onHide.apply(this)},bindEvents:function(){this.ele.on("click",this._clickHandler.bind(this))},_clickHandler:function(t){o&&t.preventDefault();var e=$(t.currentTarget).attr(this.dataName);e&&(e=e.split(",")),e&&e.length&&(this._initMask(),this._initPanel(),this._updatePhoneList(e))},_phoneItemHandler:function(t){o&&t.preventDefault(),this.hideMask(),this.hidePanel();var e=$(t.currentTarget).attr("data-phone");e&&this.makePhoneCall(e),this.opt.onSelect&&this.opt.onSelect.apply(this)},_initPanel:function(){this.phonePanel=this.view.$el.find(".J_phoneListPanel"),(!this.phonePanel||this.phonePanel&&0===this.phonePanel.length)&&(this.view.$el.append(this.opt.wrap),this.phonePanel=this.view.$el.find(".J_phoneListPanel"),this.phonePanel.on("click",".J_phoneItem",this._phoneItemHandler.bind(this)),this.phonePanel.on("click",".J_cancelPhone",function(){this.hideMask(),this.hidePanel()}.bind(this)))},hidePanel:function(){this.phonePanel&&this.phonePanel.hide()},_updatePhoneList:function(t){this.phonePanel.html(_.template(this.opt.tpl,{data:t})),this.phonePanel.show()},makePhoneCall:function(t){s.apply({hybridCallback:function(){return s.callPhone({tel:t}),!1},callback:function(){return!0}})},updateDom:function(t){this.ele=$(t),this.bindEvents()}},a});