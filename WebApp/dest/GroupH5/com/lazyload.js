define(["libs"],function(){function t(t){var i=function(){},n={attr:"data-lazy",wrap:window,container:window,event:["scroll","resize"],time:100,threshold:180,vertical:!0,stateAttr:"data-load-state",onComplete:i,animateCls:"fade-in"};this.options=$.extend(n,t),this.container=$(this.options.container),this.wrap=$(this.options.wrap),this.eles=this.options.wrap===window?$("img"):$("img",this.wrap),this.bindEvents()}return t.prototype={constructor:t,bindEvents:function(){var t=this.options.event,i=function(t){this.TimerFun&&clearTimeout(this.TimerFun),this.TimerFun=setTimeout(function(){this.triggerEvent(t)}.bind(this),this.options.time)}.bind(this);for(var n in t)this.container.on(this.options.event[n],i);this.triggerNow()},_imgLoaded:function(t,i){t[0].src=t.attr(i.attr),t.addClass(i.animateCls),t.attr(i.stateAttr,"true")},triggerEvent:function(t){for(var i,n,o=this,e=0,s=o.options;e<o.eles.length;e++)i=$(o.eles[e]),n=i.attr(s.attr),n&&i[0].src.trim()!==n.trim()&&this.isReady(i)&&this._loadImage(i,o._imgLoaded);s.onComplete.call(this,t)},_loadImage:function(t,i){var n=this,o=n.options,e=new Image;return e.src=t.attr(o.attr),e.complete?void i.call(n,t,o):void(e.onload=function(){e.onload=null,i.call(n,t,o)})},isReady:function(t){var i=this.options.vertical?"scrollTop":"scrollLeft",n=this.options.vertical?"top":"left",o=t.offset()[n],e=this.options.vertical?this.container.height():this.container.width(),s=this.container[i]();return o>=s&&o<=e+s+this.options.threshold},updateDom:function(){this.eles=this.options.wrap===window?$("img").not("["+this.options.stateAttr+' = "true"]'):$("img",this.wrap).not("["+this.options.stateAttr+'="true"]'),this.triggerNow()},unbindEvents:function(){for(var t in this.options.event)this.container.off(this.options.event[t])},triggerNow:function(){this.container.trigger(this.options.event[0])}},t});