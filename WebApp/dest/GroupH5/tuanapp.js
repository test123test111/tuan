define(["PageHistory"],function(){var i=/^ctrip:\/\//i,e=/(.*)\/webapp\/(\w+)\/(.*)/,t=/^#\w/i;window._log={stash:[],log:function(i){this.stash.push(i?JSON.stringify(i):i)}};var n={init:function(){this.saveUnion()},isSEO:"server"===Lizard.renderAt,showLoading:function(){this.loading.show()},hideLoading:function(){this.loading.hide()},isInternalPage:function(i){return i.toLowerCase().indexOf("/tuan/")>-1},back:function(i){var e=this.lastUrl();e?(this.app.history.pop(),this.isInternalPage(e)?location.hash=e.split("#")[1]||"home":location.replace(e)):(i?(-1==i.indexOf("#")&&(i="#"+i),this.app.curView.jump(i)):window.history.go(-1),this.app.history=[])},lastUrl:function(){var i=this.app.history,e=i.length,t=e&&i[e-2]||"";return t},parsePageURL:function(n){if(!n)return!1;var r,o={module:"",link:n,isNative:!1,isInternal:!1,domain:document.domain};return n.match(t)?(o.module="tuan",o.isInternal=!0,o):n.match(i)?(o.domain="ctrip",o.isNative=!0,o):(r=e.exec(n),r&&(o.module=r[2],o.link=r[3],o.isInternal=!0),o)},gotoExternalPage:function(i,e){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(t,n){var r=n.create("Guider");t.isInApp()?r.cross({path:i,param:e}):location.href=location.protocol+"//"+location.host+"/webapp/"+i+"/"+e})},jumpToPage:function(i,e){if(i){var t=this,n=t.parsePageURL(i);require(["cUtility","cWidgetFactory","cWidgetGuider"],function(t,r){var o=r.create("Guider"),a=t.isInApp();return a?n.isInternal?void("tuan"==n.module?e.forwardJump(n.link.split("/")[0],"/webapp/tuan/"+n.link):o.cross({path:n.module,param:n.link})):void o.jump({targetModel:n.isNative?"app":"h5",url:n.link,title:document.title}):void(location.href=i)})}},getQuery:function(i){return Lizard.P(i)},saveUnion:function(i){require(["CommonStore"],function(e){var t=e.UnionStore&&e.UnionStore.getInstance(),r=n.getQuery("PartnerID"),o=n.getQuery("Source"),a=n.getQuery("AllianceID"),c=n.getQuery("SID"),u=n.getQuery("OUID"),s=t.get();o||a?s&&s.AllianceID==a&&s.SID==c&&s.OUID==u&&s.Source==o&&s.PartnerID==r||t.set({AllianceID:a,SID:c,OUID:u,Source:o,PartnerID:r,targetTuan:!0}):1==i&&""!=document.referrer&&document.referrer.indexOf("/html5")>0&&s&&1==s.targetTuan&&t.remove()})},initVoiceSearch:function(i){require(["cWidgetFactory","VoiceSearch"],function(e){var t=e.create("VoiceSearch");new t(i)})},environment:0,tHome:function(){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,e){var t=e.create("Guider"),n=i.isInApp();n?t.home():location.href=location.protocol+"//"+location.host+"/html5"})},backToLastPage:function(){require(["cWidgetFactory","cWidgetGuider"],function(i){var e=i.create("Guider");e.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})})})},isOverOS7:function(){return $.os&&$.os.ios&&parseInt($.os.version,10)>=7},isProduction:!0};return require(["libs","cUtility","cWidgetFactory","cHybridFacade","cWidgetGuider"],function(i,e,t,r){var o=t.create("Guider");if(n.init(),e.isInApp()&&(_.isFunction(o.app_check_network_status)&&o.app_check_network_status({callback:function(i){n.environment="WIFI"===i.networkType?0:1}}),o.register({tagname:r.METHOD_APP_NETWORK_DID_CHANGED,callback:function(i){n.environment="WIFI"===i.networkType?0:1}})),e.isInApp()){var a=e.isPreProduction();("0"===a||"1"===a||"2"===a)&&(n.isProduction=!1)}else location.host.match(/^(m|3g|wap)\.ctrip\.com/i)||(n.isProduction=!1);!function(){var i,e,t=0;!n.isProduction&&$(document).on("click",function(){t++,i&&clearTimeout(i),i=setTimeout(function(){t>=5&&(!e&&require(["ConsoleDebug"],function(i){e=new i}),e&&e.show()),t=0},350)})}()}),window.noPic=function(i){i&&(i.src="http://pic.c-ctrip.com/common/pic_alpha.gif",i.onerror=null)},n});