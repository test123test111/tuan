define(["PageHistory"],function(){var e=/^ctrip:\/\//i,t=/(.*)\/webapp\/(\w+)\/(.*)/,i=/^#\w/i;window._log=function(){};var n={init:function(){this.saveUnion()},isSEO:"server"===Lizard.renderAt,showLoading:function(){this.loading.show()},hideLoading:function(){this.loading.hide()},isInternalPage:function(e){return e.toLowerCase().indexOf("/tuan/")>-1},back:function(e){var t=this.lastUrl();t?(this.app.history.pop(),this.isInternalPage(t)?location.hash=t.split("#")[1]||"home":location.replace(t)):(e?(-1==e.indexOf("#")&&(e="#"+e),this.app.curView.jump(e)):window.history.go(-1),this.app.history=[])},lastUrl:function(){var e=this.app.history,t=e.length,i=t&&e[t-2]||"";return i},parsePageURL:function(n){if(!n)return!1;var r,o={module:"",link:n,isNative:!1,isInternal:!1,domain:document.domain};return n.match(i)?(o.module="tuan",o.isInternal=!0,o):n.match(e)?(o.domain="ctrip",o.isNative=!0,o):(r=t.exec(n),r&&(o.module=r[2],o.link=r[3],o.isInternal=!0),o)},gotoExternalPage:function(e,t){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,n){var r=n.create("Guider");i.isInApp()?r.cross({path:e,param:t}):location.href=location.protocol+"//"+location.host+"/webapp/"+e+"/"+t})},jumpToPage:function(e,t){if(e){var i=this,n=i.parsePageURL(e);require(["cUtility","cWidgetFactory","cWidgetGuider"],function(i,r){var o=r.create("Guider"),a=i.isInApp();return a?n.isInternal?void("tuan"==n.module?t.forwardJump(n.link.split("/")[0],"/webapp/tuan/"+n.link):o.cross({path:n.module,param:n.link})):void o.jump({targetModel:n.isNative?"app":"h5",url:n.link,title:document.title}):void(location.href=e)})}},getQuery:function(e){return Lizard.P(e)},saveUnion:function(e){require(["CommonStore"],function(t){var i=t.UnionStore&&t.UnionStore.getInstance(),r=n.getQuery("PartnerID"),o=n.getQuery("Source"),a=n.getQuery("AllianceID"),c=n.getQuery("SID"),u=n.getQuery("OUID"),s=i.get();o||a?s&&s.AllianceID==a&&s.SID==c&&s.OUID==u&&s.Source==o&&s.PartnerID==r||i.set({AllianceID:a,SID:c,OUID:u,Source:o,PartnerID:r,targetTuan:!0}):1==e&&""!=document.referrer&&document.referrer.indexOf("/html5")>0&&s&&1==s.targetTuan&&i.remove()})},initVoiceSearch:function(e){require(["cWidgetFactory","VoiceSearch"],function(t){var i=t.create("VoiceSearch");new i(e)})},environment:0,tHome:function(){require(["cUtility","cWidgetFactory","cWidgetGuider"],function(e,t){var i=t.create("Guider"),n=e.isInApp();n?i.home():location.href=location.protocol+"//"+location.host+"/html5"})},backToLastPage:function(){require(["cWidgetFactory","cWidgetGuider"],function(e){var t=e.create("Guider");t.backToLastPage({param:JSON.stringify({biz:"tuan",refresh:"1"})})})},isOverOS7:function(){return $.os&&$.os.ios&&parseInt($.os.version,10)>=7}};return require(["libs","cUtility","cWidgetFactory","cHybridFacade","cWidgetGuider"],function(e,t,i,r){var o=i.create("Guider");n.init(),t.isInApp()&&(_.isFunction(o.app_check_network_status)&&o.app_check_network_status({callback:function(e){n.environment="WIFI"===e.networkType?0:1}}),o.register({tagname:r.METHOD_APP_NETWORK_DID_CHANGED,callback:function(e){n.environment="WIFI"===e.networkType?0:1}})),function(){var e,t,i=0;$(document).on("click",function(){i++,e&&clearTimeout(e),e=setTimeout(function(){i>=5&&(!t&&require(["ConsoleDebug"],function(e){t=new e}),t&&t.show()),i=0},350)})}()}),window.noPic=function(e){e&&(e.src="http://pic.c-ctrip.com/common/pic_alpha.gif",e.onerror=null)},n});