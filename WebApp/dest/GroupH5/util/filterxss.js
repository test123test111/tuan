define([],function(){function t(t,e,i){if("href"===e||"src"===e){if(u.lastIndex=0,u.test(i))return"#";if(h.lastIndex=0,h.test(i))return"#"}else if("style"===e){if(g.lastIndex=0,g.test(i))return"#";if(d.lastIndex=0,d.test(i))return""}}function e(t){return i(t)}function i(t){return t.replace(o,"&lt;").replace(l,"&gt;")}function n(t,e){return String.fromCharCode(parseInt(e))}function s(i){this.options=i=i||{},this.whiteList=$.extend(!0,r,i.whiteList||{}),this.onTagAttr=$.extend(!0,t,i.onTagAttr||{}),this.onIgnoreTag=$.extend(!0,e,i.onIgnoreTag||{})}var r={h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],hr:[],span:[],strong:[],b:[],i:[],br:[],p:[],pre:[],code:[],a:["target","href","title"],img:["src","alt","title"],div:[],table:["width","border"],tr:[],td:["width","colspan"],th:["width","colspan"],tbody:[],ul:[],li:[],ol:[],dl:[],dt:[],em:[],cite:[],section:[],header:[],footer:[],blockquote:[],audio:["autoplay","controls","loop","preload","src"],video:["autoplay","controls","loop","preload","src","height","width"]},o=/</g,l=/>/g,a=/"/g,c=/[^a-zA-Z0-9_:\.\-]/gim,f=/&#([a-zA-Z0-9]*);?/gim,u=/\/\*|\*\//gm,h=/^[\s"'`]*((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,g=/\/\*|\*\//gm,d=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi;return s.prototype={constructor:s,filterAttributes:function(t,e){t=t.toLowerCase();for(var i,s=this,r=this.whiteList[t],o=0,l="",u=!1,h=!1,g=function(e,i){if(e=e.trim(),!h&&"/"===e)return void(h=!0);if(e=e.replace(c,"").toLowerCase(),!(e.length<1)&&-1!==r.indexOf(e)){if(i){i=i.trim().replace(a,"&quote;"),i=i.replace(f,n);for(var o="",u=0,g=i.length;g>u;u++)o+=i.charCodeAt(u)<32?" ":i[u];i=o.trim();var d=s.onTagAttr(t,e,i);"undefined"!=typeof d&&(i=d)}l+=e+(i?'="'+i+'"':"")+" "}},d=0,p=e.length;p>d;d++){var v=e[d];if(u!==!1||"="!==v)if(u===!1||d!==o||'"'!==v&&"'"!==v)" "!==v||(i=e.slice(o,d).trim(),u===!1?g(i):g(u,i),u=!1,o=d+1);else{var m=e.indexOf(v,d+1);if(-1===m)break;i=e.slice(o+1,m).trim(),g(u,i),u=!1,d=m,o=d+1}else u=e.slice(o,d),o=d+1}return o<e.length&&(u===!1?g(e.slice(o)):g(u,e.slice(o))),h&&(l+="/"),l.trim()},addNewTag:function(t,e,n){var s,r="",o="</"===t.slice(0,2)?2:1,l=t.indexOf(" ");if(s=-1===l?t.slice(o,t.length-1).trim():t.slice(o,l+1).trim(),s=s.toLowerCase(),s in this.whiteList)if(-1===l)r+=t.slice(0,o)+s+">";else{var a=this.filterAttributes(s,t.slice(l+1,t.length-1).trim());r+=t.slice(0,o)+s+(a.length>0?" "+a:"")+">"}else{var c={isClosing:2===o,position:n,originalPosition:e-t.length+1},f=this.onIgnoreTag(s,t,c);"undefined"==typeof f&&(f=i(t)),r+=f}return r},process:function(t){var e="",n=0,s=!1,r=!1,o=0;if("string"!==$.type(t))return"";for(var l=t.length;l>o;o++){var a=t[o];if(s===!1){if("<"===a){s=o;continue}}else if(r===!1){if("<"===a){e+=i(t.slice(n,o)),s=o,n=o;continue}if(">"===a){e+=i(t.slice(n,s)),e+=this.addNewTag(t.slice(s,o+1),o,e.length),n=o+1,s=!1;continue}if('"'===a||"'"===a){r=a;continue}}else if(a===r){r=!1;continue}}return n<t.length&&(e+=i(t.substr(n))),e}},s.Instance=new s,{filterXSS:function(t,e){return e&&$.isPlainObject(e)&&(s.Instance=new s(e)),s.Instance.process(t)},tagFilter:function(t,e){"function"!=typeof e&&(e=function(){});var i=[],n=!1;return{onIgnoreTag:function(s,r,o){if(-1!==t.indexOf(s)){var l="[removed]";if(n!==!1&&o.isClosing){var a=o.position+l.length;i.push([n,a]),n=!1}else n=o.position;return l}return e(s,r,o)},filter:function(t){var e="",n=0;return i.forEach(function(i){e+=t.slice(n,i[0]),n=i[1]}),e+=t.slice(n)}}}}});