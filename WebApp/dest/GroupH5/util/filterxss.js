"use strict";define([],function(){function l(e,t,n){if(t==="href"||t==="src"){o.lastIndex=0;if(o.test(n))return"#";u.lastIndex=0;if(u.test(n))return"#"}else if(t==="style"){a.lastIndex=0;if(a.test(n))return"#";f.lastIndex=0;if(f.test(n))return""}}function c(e,t,n){return h(t)}function h(e){return e.replace(t,"&lt;").replace(n,"&gt;")}function p(e,t){return String.fromCharCode(parseInt(t))}function d(t){this.options=t=t||{},this.whiteList=$.extend(!0,e,t.whiteList||{}),this.onTagAttr=$.extend(!0,l,t.onTagAttr||{}),this.onIgnoreTag=$.extend(!0,c,t.onIgnoreTag||{})}var e={h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],hr:[],span:[],strong:[],b:[],i:[],br:[],p:[],pre:[],code:[],a:["target","href","title"],img:["src","alt","title"],div:[],table:["width","border"],tr:[],td:["width","colspan"],th:["width","colspan"],tbody:[],ul:[],li:[],ol:[],dl:[],dt:[],em:[],cite:[],section:[],header:[],footer:[],blockquote:[],audio:["autoplay","controls","loop","preload","src"],video:["autoplay","controls","loop","preload","src","height","width"]},t=/</g,n=/>/g,r=/"/g,i=/[^a-zA-Z0-9_:\.\-]/img,s=/&#([a-zA-Z0-9]*);?/img,o=/\/\*|\*\//mg,u=/^[\s"'`]*((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/ig,a=/\/\*|\*\//mg,f=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/ig;return d.prototype={constructor:d,filterAttributes:function(e,t){e=e.toLowerCase();var n=this,o=this.whiteList[e],u=0,a="",f=!1,l=!1,c=function(t,u){t=t.trim();if(!l&&t==="/"){l=!0;return}t=t.replace(i,"").toLowerCase();if(t.length<1)return;if(o.indexOf(t)!==-1){if(u){u=u.trim().replace(r,"&quote;"),u=u.replace(s,p);var f="";for(var c=0,h=u.length;c<h;c++)f+=u.charCodeAt(c)<32?" ":u[c];u=f.trim();var d=n.onTagAttr(e,t,u);typeof d!="undefined"&&(u=d)}a+=t+(u?'="'+u+'"':"")+" "}};for(var h=0,d=t.length;h<d;h++){var v=t[h];if(f===!1&&v==="="){f=t.slice(u,h),u=h+1;continue}if(f!==!1&&h===u&&(v==='"'||v==="'")){var m=t.indexOf(v,h+1);if(m===-1)break;var g=t.slice(u+1,m).trim();c(f,g),f=!1,h=m,u=h+1;continue}if(v===" "){var g=t.slice(u,h).trim();f===!1?c(g):c(f,g),f=!1,u=h+1;continue}}return u<t.length&&(f===!1?c(t.slice(u)):c(f,t.slice(u))),l&&(a+="/"),a.trim()},addNewTag:function(e,t,n){var r="",i=e.slice(0,2)==="</"?2:1,s=e.indexOf(" ");if(s===-1)var o=e.slice(i,e.length-1).trim();else var o=e.slice(i,s+1).trim();o=o.toLowerCase();if(o in this.whiteList)if(s===-1)r+=e.slice(0,i)+o+">";else{var u=this.filterAttributes(o,e.slice(s+1,e.length-1).trim());r+=e.slice(0,i)+o+(u.length>0?" "+u:"")+">"}else{var a={isClosing:i===2,position:n,originalPosition:t-e.length+1},f=this.onIgnoreTag(o,e,a);typeof f=="undefined"&&(f=h(e)),r+=f}return r},process:function(e){var t="",n=0,r=!1,i=!1,s=0;if($.type(e)!=="string")return"";for(var s=0,o=e.length;s<o;s++){var u=e[s];if(r===!1){if(u==="<"){r=s;continue}}else if(i===!1){if(u==="<"){t+=h(e.slice(n,s)),r=s,n=s;continue}if(u===">"){t+=h(e.slice(n,r)),t+=this.addNewTag(e.slice(r,s+1),s,t.length),n=s+1,r=!1;continue}if(u==='"'||u==="'"){i=u;continue}}else if(u===i){i=!1;continue}}return n<e.length&&(t+=h(e.substr(n))),t}},d.Instance=new d,{filterXSS:function(e,t){return t&&$.isPlainObject(t)&&(d.Instance=new d(t)),d.Instance.process(e)},tagFilter:function(e,t){typeof t!="function"&&(t=function(){});var n=[],r=!1;return{onIgnoreTag:function(i,s,o){if(e.indexOf(i)!==-1){var u="[removed]";if(r!==!1&&o.isClosing){var a=o.position+u.length;n.push([r,a]),r=!1}else r=o.position;return u}return t(i,s,o)},filter:function(e){var t="",r=0;return n.forEach(function(n){t+=e.slice(r,n[0]),r=n[1]}),t+=e.slice(r),t}}}}});